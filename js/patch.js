var CABLES=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";i.r(e);var s={};i.r(s),i.d(s,"getShortOpName",(function(){return _})),i.d(s,"shuffleArray",(function(){return p})),i.d(s,"shortId",(function(){return m})),i.d(s,"uuid",(function(){return T})),i.d(s,"generateUUID",(function(){return A})),i.d(s,"simpleId",(function(){return y})),i.d(s,"smoothStep",(function(){return v})),i.d(s,"smootherStep",(function(){return x})),i.d(s,"clamp",(function(){return I})),i.d(s,"map",(function(){return O})),i.d(s,"cacheBust",(function(){return R})),i.d(s,"copyArray",(function(){return S})),i.d(s,"basename",(function(){return P})),i.d(s,"jsonp",(function(){return F})),i.d(s,"ajaxSync",(function(){return C})),i.d(s,"ajax",(function(){return w})),i.d(s,"request",(function(){return M})),i.d(s,"keyCodeToName",(function(){return U})),i.d(s,"UTILS",(function(){return g}));var r={};i.r(r),i.d(r,"base64Chars",(function(){return k})),i.d(r,"base64lookup",(function(){return V})),i.d(r,"b64encTypesArray",(function(){return G})),i.d(r,"b64decTypedArray",(function(){return H}));var n={};i.r(n),i.d(n,"easeExpoIn",(function(){return K})),i.d(n,"easeExpoOut",(function(){return j})),i.d(n,"easeExpoInOut",(function(){return Q})),i.d(n,"easeCubicIn",(function(){return q})),i.d(n,"easeCubicOut",(function(){return J})),i.d(n,"easeCubicInOut",(function(){return Z})),i.d(n,"ANIM",(function(){return X})),i.d(n,"Anim",(function(){return $})),i.d(n,"TL",(function(){return tt}));var o={};i.r(o),i.d(o,"PatchConnectionReceiver",(function(){return kt})),i.d(o,"PatchConnectionSender",(function(){return Dt})),i.d(o,"PatchConnectorBroadcastChannel",(function(){return Vt}));class h{constructor(t){this._logs=[],this.initiator=t}stack(t){console.error("["+this.initiator+"] ",t),console.log((new Error).stack),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",t)}groupCollapsed(t){console.groupCollapsed("["+this.initiator+"] "+t)}table(t){console.table(t)}groupEnd(){console.groupEnd()}error(t){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",arguments)}info(t){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"info",arguments)}warn(t){console.warn("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"warn",arguments)}verbose(){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"verbose",arguments)}log(t){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"log",arguments)}userInteraction(t){}}const a={EASINGS:["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out"],EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27},l={OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},c={PORT_DIR_IN:0,PORT_DIR_OUT:1},u={PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10,PACO_TRIGGERS:11,PACO_PORT_SETVARIABLE:12,PACO_PORT_SETANIMATED:13,PACO_PORT_ANIM_UPDATED:14,PACO_DESERIALIZE:15},g={float32Concat:function(t,e){t instanceof Float32Array||(t=new Float32Array(t)),e instanceof Float32Array||(e=new Float32Array(e));const i=new Float32Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}},_=function(t){let e=t.split(".")[t.split(".").length-1];if(e.indexOf(l.OP_VERSION_PREFIX)>0){const t=e.split(l.OP_VERSION_PREFIX)[1];e=e.substring(0,e.length-(l.OP_VERSION_PREFIX+t).length)}return e},p=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}return t},d={},f=function(){let t=Math.random().toString(36).substr(2,9);return d.hasOwnProperty(t)&&(t=f()),d[t]=!0,t},m=f,E=function(){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)})},T=E,A=E;let b=0;const y=function(){return b++,b},v=function(t){const e=Math.max(0,Math.min(1,(t-0)/1));return t=e*e*(3-2*e)},x=function(t){const e=Math.max(0,Math.min(1,(t-0)/1));return t=e*e*e*(e*(6*e-15)+10)},I=function(t,e,i){return Math.min(Math.max(t,e),i)},O=function(t,e,i,s,r,n){if(t>=i)return r;if(t<=e)return s;let o=!1;const h=Math.min(e,i),a=Math.max(e,i);h!=e&&(o=!0);let l=!1;const c=Math.min(s,r),u=Math.max(s,r);c!=s&&(l=!0);let g=0,_=0;return g=o?(a-t)*(u-c)/(a-h):(t-h)*(u-c)/(a-h),_=l?u-g:g+c,n?1==n?s+(t=Math.max(0,Math.min(1,(_-s)/(r-s))))*t*(3-2*t)*(r-s):2==n?s+(t=Math.max(0,Math.min(1,(_-s)/(r-s))))*t*t*(t*(6*t-15)+10)*(r-s):_:_};Math.randomSeed=1,Math.seededRandom=function(t,e){0===Math.randomSeed&&(Math.randomSeed=999*Math.random()),t=t||1,e=e||0,Math.randomSeed=(9301*Math.randomSeed+49297)%233280;return e+Math.randomSeed/233280*(t-e)},g.arrayWriteToEnd=function(t,e){for(let e=1;e<t.length;e++)t[e-1]=t[e];t[t.length-1]=e},g.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},g.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},String.prototype.endl=function(){return this+"\n"},String.prototype.startsWith=function(t){return 0===this.indexOf(t)},String.prototype.endsWith=function(t){return this.match(t+"$")==t};const R=function(t){return t.indexOf("?")>-1?t+="&":t+="?",t+"cb="+CABLES.uuid()},S=function(t,e){if(!t)return null;(e=e||[]).length=t.length;for(let i=0;i<t.length;i++)e[i]=t[i];return e},P=function(t){let e="";if(!t)return"";const i=(t+"").split("/");if(i.length>0){let t=i[i.length-1].split("?");e=t[0],t=e.split("."),e=t[0]}return e};let N=null;const F=function(t,e){N=N||0,N++;const i=N;CABLES["jsonpFunc"+i]=function(t){e(!1,t)};let s="?";t.indexOf(s)>-1&&(s="&");const r=document.createElement("script");r.setAttribute("src",t+s+"callback=CABLES.jsonpFunc"+i),document.body.appendChild(r)},C=function(t,e,i,s,r){M({url:t,cb:e,method:i,data:s,contenttype:r,sync:!0})},w=function(t,e,i,s,r,n,o={}){M({url:t,cb:e,method:i,data:s,contenttype:r,sync:!1,jsonP:n,headers:o})},M=function(t){let e;t.hasOwnProperty("asynch")||(t.asynch=!0);try{e=new XMLHttpRequest}catch(t){}if(e.onreadystatechange=function(){4==e.readyState&&t.cb&&(200==e.status||0==e.status?t.cb(!1,e.responseText,e):t.cb(!0,e.responseText,e))},e.addEventListener("progress",t=>{}),e.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync),"object"==typeof t.headers){const i=Object.keys(t.headers);for(let s=0;s<i.length;s++){const r=i[s],n=t.headers[r];e.setRequestHeader(r,n)}}t.post||t.data?(e.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded"),e.send(t.data||t.post)):e.send()},U=function(t){if(!t&&0!==t)return"Unidentified";const e={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};return e[t]?e[t]:String.fromCharCode(t)};window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}};const L=function(t,e){if(!t)throw new Error("no cgl");this._log=new h("cgl_texture"),this._cgl=t,this.tex=this._cgl.gl.createTexture(),this.id=T(),this.width=0,this.height=0,this.loading=!1,this.flip=!0,this.flipped=!1,this.shadowMap=!1,this.deleted=!1,this.image=null,this.anisotropic=0,this.filter=L.FILTER_NEAREST,this.wrap=L.WRAP_CLAMP_TO_EDGE,this.texTarget=this._cgl.gl.TEXTURE_2D,e&&e.type&&(this.texTarget=e.type),this.textureType=L.TYPE_DEFAULT,this.unpackAlpha=!0,this._fromData=!0,this.name="unknown",e?(this.name=e.name||this.name,e.isDepthTexture&&(this.textureType=L.TYPE_DEPTH),e.isFloatingPointTexture&&(this.textureType=L.TYPE_FLOAT),"textureType"in e&&(this.textureType=e.textureType),"filter"in e&&(this.filter=e.filter),"wrap"in e&&(this.wrap=e.wrap),"unpackAlpha"in e&&(this.unpackAlpha=e.unpackAlpha),"flip"in e&&(this.flip=e.flip),"shadowMap"in e&&(this.shadowMap=e.shadowMap),"anisotropic"in e&&(this.anisotropic=e.anisotropic)):e={},e.width||(e.width=8),e.height||(e.height=8),this._cgl.profileData.profileTextureNew++,this._cgl.profileData.addHeavyEvent("texture created",this.name,e.width+"x"+e.height),this.setSize(e.width,e.height),this.getInfoOneLine()};L.prototype.isFloatingPoint=function(){return this.textureType==L.TYPE_FLOAT},L.prototype.compareSettings=function(t){return!!t&&(t.width==this.width&&t.height==this.height&&t.filter==this.filter&&t.wrap==this.wrap&&t.textureType==this.textureType&&t.unpackAlpha==this.unpackAlpha&&t.anisotropic==this.anisotropic&&t.shadowMap==this.shadowMap&&t.texTarget==this.texTarget&&t.flip==this.flip)},L.prototype.clone=function(){const t=new L(this._cgl,{name:this.name,filter:this.filter,wrap:this.wrap,textureType:this.textureType,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});return this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height),this.compareSettings(t)||(this._log.error("Cloned texture settings do not compare!"),this._log.error(this),this._log.error(t)),t},L.prototype.setSize=function(t,e){if((t!=t||t<=0||!t)&&(t=8),(e!=e||e<=0||!e)&&(e=8),(t>this._cgl.maxTexSize||e>this._cgl.maxTexSize)&&this._log.error("texture size too big! "+t+"x"+e+" / max: "+this._cgl.maxTexSize),t=Math.min(t,this._cgl.maxTexSize),e=Math.min(e,this._cgl.maxTexSize),t=Math.floor(t),e=Math.floor(e),this.width==t&&this.height==e)return;this.width=t,this.height=e,this.deleted=!1,this.shortInfoString=this.getInfoOneLine(),this._cgl.gl.bindTexture(this.texTarget,this.tex),this._cgl.profileData.profileTextureResize++;if(this._cgl.patch.config.canvas.forceTextureNearest&&(this.filter=L.FILTER_NEAREST),1!=this._cgl.glVersion||this.textureType!=L.TYPE_FLOAT||this.filter!=L.FILTER_LINEAR||this._cgl.gl.getExtension("OES_texture_float_linear")||(console.warn("this graphics card does not support floating point texture linear interpolation! using NEAREST"),this.filter=L.FILTER_NEAREST),this.textureType==L.TYPE_FLOAT)if(1==this._cgl.glVersion)if(this._cgl.glUseHalfFloatTex){const i=this._cgl.gl.getExtension("OES_texture_half_float");this._cgl.gl.getExtension("EXT_color_buffer_half_float");if(!i)throw new Error("no half float texture extension");this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,i.HALF_FLOAT_OES,null)}else this._cgl.gl.getExtension("OES_texture_float"),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null);else if(this._cgl.glUseHalfFloatTex){if(!this._cgl.gl.getExtension("EXT_color_buffer_half_float"))throw new Error("no half float texture extension");console.log("half float",this._cgl.gl.RGBA16F,this._cgl.gl.HALF_FLOAT),console.log("half float",this._cgl.gl.HALF_FLOAT),console.log("half float",this._cgl.gl.RGBA16F),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.HALF_FLOAT,null)}else this._cgl.gl.getExtension("EXT_color_buffer_float"),this._cgl.gl.getExtension("EXT_color_buffer_float_linear"),this._cgl.gl.getExtension("OES_texture_float_linear"),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null);else if(this.textureType==L.TYPE_DEPTH)if(1==this._cgl.glVersion){const i=this._cgl.gl.DEPTH_COMPONENT;this._cgl.gl.texImage2D(this.texTarget,0,i,t,e,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.UNSIGNED_SHORT,null)}else{const i=this._cgl.gl.DEPTH_COMPONENT32F;this._cgl.gl.texImage2D(this.texTarget,0,i,t,e,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.FLOAT,null)}else this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,null);this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null)},L.prototype.initFromData=function(t,e,i,s,r){if(this.filter=s,this.wrap=r,null==s&&(this.filter=L.FILTER_LINEAR),null==r&&(this.wrap=L.WRAP_CLAMP_TO_EDGE),this.width=e,this.height=i,this._fromData=!0,this.deleted=!1,this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const t=CGL.Texture.getTempTexture(this._cgl);return this.width=t.width,this.height=t.height,this.tex=t.tex,void this._log.error("[cgl_texture] texture size to big!!!",this.width,this.height,this._cgl.maxTexSize)}this.flip&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip),this._cgl.gl.bindTexture(this.texTarget,this.tex),this.textureType==L.TYPE_FLOAT?this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,e,i,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,t):this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,e,i,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,t),this._setFilter(),this.updateMipMap(),this.flip&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,!1),this._cgl.gl.bindTexture(this.texTarget,null)},L.prototype.updateMipMap=function(){2!=this._cgl.glVersion&&!this.isPowerOfTwo()||this.filter!=L.FILTER_MIPMAP||(this._cgl.gl.generateMipmap(this.texTarget),this._cgl.profileData.profileGenMipMap++)},L.prototype.initTexture=function(t,e){if(this._cgl.printError("before initTexture"),this._cgl.checkFrameStarted("texture inittexture"),this._fromData=!1,this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),t.width&&(this.width=t.width),t.height&&(this.height=t.height),e&&(this.filter=e),t.height>this._cgl.maxTexSize||t.width>this._cgl.maxTexSize){const e=CGL.Texture.getTempTexture(this._cgl);return this.width=e.width,this.height=e.height,this.tex=e.tex,void this._log.error("[cgl_texture] texture size to big!!!",t.width,t.height,this._cgl.maxTexSize)}this._cgl.gl.bindTexture(this.texTarget,this.tex),this.deleted=!1,this.flipped=!this.flip,this.flipped&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,t),this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null),this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.flipped&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,!1),this.getInfoOneLine(),this._cgl.printError("initTexture")},L.prototype.delete=function(){this.loading||(this.deleted=!0,this.width=0,this.height=0,this._cgl.profileData.profileTextureDelete++,this._cgl.gl.deleteTexture(this.tex),this.image=null,this.tex=null)},L.prototype.isPowerOfTwo=function(){return L.isPowerOfTwo(this.width)&&L.isPowerOfTwo(this.height)},L.prototype.printInfo=function(){console.log(this.getInfo())},L.prototype.getInfoReadable=function(){const t=this.getInfo();let e="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const i in t)e+="* "+i+":  **"+t[i]+"**\n";return e},L.prototype.getInfoOneLine=function(){let t=this.width+" x "+this.height;return this.textureType===CGL.Texture.TYPE_FLOAT?t+=" 32bit":t+=" 8bit",this.filter===CGL.Texture.FILTER_NEAREST&&(t+=" nearest"),this.filter===CGL.Texture.FILTER_LINEAR&&(t+=" linear"),this.filter===CGL.Texture.FILTER_MIPMAP&&(t+=" mipmap"),this.wrap===CGL.Texture.WRAP_CLAMP_TO_EDGE&&(t+=" clamp"),this.wrap===CGL.Texture.WRAP_REPEAT&&(t+=" repeat"),this.wrap===CGL.Texture.WRAP_MIRRORED_REPEAT&&(t+=" repeatmir"),this.shortInfoString=t,t},L.prototype.getInfo=function(){const t={};t.name=this.name,t["power of two"]=this.isPowerOfTwo(),t.size=this.width+" x "+this.height;let e=this.texTarget;return this.texTarget==this._cgl.gl.TEXTURE_2D&&(e="TEXTURE_2D"),t.target=e,t.unpackAlpha=this.unpackAlpha,this.textureType==L.TYPE_FLOAT?t.textureType="TYPE_FLOAT":this.textureType==L.TYPE_DEPTH?t.textureType="TYPE_DEPTH":this.textureType==L.TYPE_DEFAULT?t.textureType="TYPE_DEFAULT":t.textureType="UNKNOWN",this.wrap==L.WRAP_CLAMP_TO_EDGE?t.wrap="CLAMP_TO_EDGE":this.wrap==L.WRAP_REPEAT?t.wrap="WRAP_REPEAT":this.wrap==L.WRAP_MIRRORED_REPEAT?t.wrap="WRAP_MIRRORED_REPEAT":t.wrap="UNKNOWN",this.filter==L.FILTER_NEAREST?t.filter="FILTER_NEAREST":this.filter==L.FILTER_LINEAR?t.filter="FILTER_LINEAR":this.filter==L.FILTER_MIPMAP?t.filter="FILTER_MIPMAP":t.filter="UNKNOWN",t},L.prototype._setFilter=function(){if(this._cgl.printError("before _setFilter"),this._fromData||this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),this.shadowMap&&(this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE),this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)),this.textureType==L.TYPE_FLOAT&&this.filter==L.FILTER_MIPMAP&&(this.filter=L.FILTER_LINEAR,this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")),1!=this._cgl.glVersion||this.isPowerOfTwo()){if(this.wrap==L.WRAP_CLAMP_TO_EDGE?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)):this.wrap==L.WRAP_REPEAT?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)):this.wrap==L.WRAP_MIRRORED_REPEAT&&(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)),this.filter==L.FILTER_NEAREST)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);else if(this.filter==L.FILTER_LINEAR)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);else{if(this.filter!=L.FILTER_MIPMAP)throw this._log.log("unknown texture filter!",this.filter),new Error("unknown texture filter!"+this.filter);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}if(this.anisotropic){const t=this._cgl.gl.getExtension("EXT_texture_filter_anisotropic");if(t){const e=this._cgl.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this.anisotropic))}}}else this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE),this.filter=L.FILTER_NEAREST,this.wrap=L.WRAP_CLAMP_TO_EDGE;this.getInfoOneLine(),this._cgl.printError("_setFilter")},L.load=function(t,e,i,s){if(!e)return i({error:!0});let r=null;t.patch.loading.existByName(e)||(r=t.patch.loading.start("texture",e));const n=new L(t);return n.name=e,t.patch.isEditorMode()&&gui.jobs().start({id:"loadtexture"+r,title:"loading texture "+CABLES.basename(e)}),n.image=new Image,n.image.crossOrigin="anonymous",n.loading=!0,s&&s.hasOwnProperty("filter")&&(n.filter=s.filter),s&&s.hasOwnProperty("flip")&&(n.flip=s.flip),s&&s.hasOwnProperty("wrap")&&(n.wrap=s.wrap),s&&s.hasOwnProperty("anisotropic")&&(n.anisotropic=s.anisotropic),s&&s.hasOwnProperty("unpackAlpha")&&(n.unpackAlpha=s.unpackAlpha),n.image.onabort=n.image.onerror=s=>{console.warn("[cgl.texture.load] error loading texture",e,s),n.loading=!1,r&&t.patch.loading.finished(r);i&&i({error:!0},n),t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r)},n.image.onload=function(e){t.addNextFrameOnceCallback(()=>{n.initTexture(n.image),r&&t.patch.loading.finished(r),n.loading=!1,t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r),i&&i(null,n)})},n.image.src=e,n},L.getTempTexture=function(t){return t||console.error("[getTempTexture] no cgl!"),t.tempTexture||(t.tempTexture=L.getTemporaryTexture(t,256,L.FILTER_LINEAR,L.REPEAT)),t.tempTexture},L.getEmptyTexture=function(t,e){if(e)return L.getEmptyTextureFloat(t);if(t||console.error("[getEmptyTexture] no cgl!"),t.tempTextureEmpty)return t.tempTextureEmpty;t.tempTextureEmpty=new L(t,{name:"emptyTexture"});const i=new Uint8Array(256).fill(0);for(let t=0;t<256;t+=4)i[t+3]=0;return t.tempTextureEmpty.initFromData(i,8,8,L.FILTER_NEAREST,L.WRAP_REPEAT),t.tempTextureEmpty},L.getEmptyTextureFloat=function(t){if(t||console.error("[getEmptyTextureFloat] no cgl!"),t.tempTextureEmptyFloat)return t.tempTextureEmptyFloat;t.tempTextureEmptyFloat=new L(t,{name:"emptyTexture",isFloatingPointTexture:!0});const e=new Float32Array(256).fill(1);for(let t=0;t<256;t+=4)e[t+3]=0;return t.tempTextureEmptyFloat.initFromData(e,8,8,L.FILTER_NEAREST,L.WRAP_REPEAT),t.tempTextureEmptyFloat},L.getRandomTexture=function(t){if(t||console.error("[getRandomTexture] no cgl!"),t.randomTexture)return t.randomTexture;const e=new Uint8Array(262144);for(let t=0;t<65536;t++)e[4*t+0]=255*Math.random(),e[4*t+1]=255*Math.random(),e[4*t+2]=255*Math.random(),e[4*t+3]=255;return t.randomTexture=new L(t),t.randomTexture.initFromData(e,256,256,L.FILTER_NEAREST,L.WRAP_REPEAT),t.randomTexture},L.getBlackTexture=function(t){if(t||this._log.error("[getBlackTexture] no cgl!"),t.blackTexture)return t.blackTexture;const e=new Uint8Array(256);for(let t=0;t<64;t++)e[4*t+0]=e[4*t+1]=e[4*t+2]=0,e[4*t+3]=255;return t.blackTexture=new L(t),t.blackTexture.initFromData(e,8,8,L.FILTER_NEAREST,L.WRAP_REPEAT),t.blackTexture},L.getEmptyCubemapTexture=function(t){const e=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z],i=t.gl.createTexture(),s=t.gl.TEXTURE_CUBE_MAP,r=L.FILTER_NEAREST,n=L.WRAP_CLAMP_TO_EDGE;t.profileData.profileTextureNew++,t.gl.bindTexture(s,i),t.profileData.profileTextureResize++;for(let i=0;i<6;i+=1){const r=new Uint8Array(256);t.gl.texImage2D(e[i],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,r),t.gl.texParameteri(s,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST),t.gl.texParameteri(s,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST),t.gl.texParameteri(s,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE),t.gl.texParameteri(s,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}return t.gl.bindTexture(s,null),{id:CABLES.uuid(),tex:i,cubemap:i,width:8,height:8,filter:r,wrap:n,unpackAlpha:!0,flip:!0,_fromData:!0,name:"emptyCubemapTexture",anisotropic:0}},L.getTempGradientTexture=function(t){if(t||console.error("[getTempGradientTexture] no cgl!"),t.tempTextureGradient)return t.tempTextureGradient;const e=new L(t),i=new Uint8Array(262144);for(let t=0;t<256;t++)for(let e=0;e<256;e++)i[4*(e+256*t)+0]=i[4*(e+256*t)+1]=i[4*(e+256*t)+2]=255-t,i[4*(e+256*t)+3]=255;return e.initFromData(i,256,256,L.FILTER_NEAREST,L.WRAP_REPEAT),t.tempTextureGradient=e,e},L.getTemporaryTexture=function(t,e,i,s){const r=new L(t),n=[];for(let t=0;t<e;t++)for(let i=0;i<e;i++)(i+t)%64<32?(n.push(200+t/e*25+i/e*25),n.push(200+t/e*25+i/e*25),n.push(200+t/e*25+i/e*25)):(n.push(40+t/e*25+i/e*25),n.push(40+t/e*25+i/e*25),n.push(40+t/e*25+i/e*25)),n.push(255);const o=new Uint8Array(n);return r.initFromData(o,e,e,i,s),r},L.createFromImage=function(t,e,i){const s=new L(t,i=i||{});return s.flip=!1,s.image=e,s.width=e.width,s.height=e.height,s.initTexture(e,i.filter),s},L.fromImage=function(t,e,i,s){console.error("deprecated texture from image...");const r=new L(t);return r.flip=!1,i&&(r.filter=i),s&&(r.wrap=s),r.image=e,r.initTexture(e),r},L.isPowerOfTwo=function(t){return 1==t||2==t||4==t||8==t||16==t||32==t||64==t||128==t||256==t||512==t||1024==t||2048==t||4096==t||8192==t||16384==t},L.FILTER_NEAREST=0,L.FILTER_LINEAR=1,L.FILTER_MIPMAP=2,L.WRAP_REPEAT=0,L.WRAP_MIRRORED_REPEAT=1,L.WRAP_CLAMP_TO_EDGE=2,L.TYPE_DEFAULT=0,L.TYPE_DEPTH=1,L.TYPE_FLOAT=2,L.PFORMATSTR_RGBA32F="RGBA 32bit float",L.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte",L.PIXELFORMATS=[L.PFORMATSTR_RGBA8UB,L.PFORMATSTR_RGBA32F];const B=function(t,e,i,s){this._log=new h("cgl_framebuffer2"),this.Framebuffer2DrawTargetsDefault=null,this.Framebuffer2BlittingFramebuffer=null,this.Framebuffer2FinalFramebuffer=null,this._cgl=t,this._cgl.printError("before framebuffer2 constructor"),this._width=0,this._height=0,this._depthRenderbuffer=null,this._frameBuffer=null,this._textureFrameBuffer=null,this._colorRenderbuffers=[],this._drawTargetArray=[],this.Framebuffer2BlittingFramebuffer||(this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer()),this.Framebuffer2FinalFramebuffer||(this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer()),this.Framebuffer2DrawTargetsDefault||(this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0]),this._options=s||{isFloatingPointTexture:!1},this.name=this._options.name||"unknown",this._cgl.profileData.addHeavyEvent("framebuffer create",this.name),this._options.hasOwnProperty("numRenderBuffers")||(this._options.numRenderBuffers=1),this._options.hasOwnProperty("depth")||(this._options.depth=!0),this._options.hasOwnProperty("clear")||(this._options.clear=!0),this._options.hasOwnProperty("multisampling")||(this._options.multisampling=!1,this._options.multisamplingSamples=0),this._options.multisamplingSamples&&(this._cgl.glSlowRenderer&&(this._options.multisamplingSamples=0),this._cgl.gl.MAX_SAMPLES?this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples):this._options.multisamplingSamples=0),this._options.hasOwnProperty("filter")||(this._options.filter=L.FILTER_LINEAR),this._options.hasOwnProperty("wrap")||(this._options.wrap=L.WRAP_REPEAT),this._numRenderBuffers=this._options.numRenderBuffers,this._colorTextures=[];for(let e=0;e<this._numRenderBuffers;e++)this._colorTextures[e]=new L(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,filter:this._options.filter,wrap:this._options.wrap});let r=L.FILTER_NEAREST;this._options.shadowMap&&(r=L.FILTER_LINEAR);this._options.depth&&(this._textureDepth=new L(t,{name:"fb2 depth "+this.name,isDepthTexture:!0,filter:r,shadowMap:this._options.shadowMap||!1,width:e||512,height:i||512})),t.aborted||(this.setSize(e||512,i||512),this._cgl.printError("framebuffer2 constructor"))};B.prototype.getWidth=function(){return this._width},B.prototype.getHeight=function(){return this._height},B.prototype.getGlFrameBuffer=function(){return this._frameBuffer},B.prototype.getDepthRenderBuffer=function(){return this._depthRenderbuffer},B.prototype.getTextureColor=function(){return this._colorTextures[0]},B.prototype.getTextureColorNum=function(t){return this._colorTextures[t]},B.prototype.getTextureDepth=function(){return this._textureDepth},B.prototype.setFilter=function(t){for(let e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].filter=t,this._colorTextures[e].setSize(this._width,this._height)},B.prototype.delete=B.prototype.dispose=function(){let t=0;for(t=0;t<this._numRenderBuffers;t++)this._colorTextures[t].delete();for(this._textureDepth&&this._textureDepth.delete(),t=0;t<this._numRenderBuffers;t++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[t]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuffer),this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)},B.prototype.setSize=function(t,e){this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;if(this._width=Math.floor(t),this._height=Math.floor(e),this._width=Math.min(this._width,this._cgl.maxTexSize),this._height=Math.min(this._height,this._cgl.maxTexSize),this._cgl.profileData.profileFrameBuffercreate++,this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuffer),this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer(),this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const s=this._options.depth;for(i=0;i<this._numRenderBuffers;i++)this._colorTextures[i].setSize(this._width,this._height);for(i=0;i<this._numRenderBuffers;i++){const t=this._cgl.gl.createRenderbuffer();this._cgl.gl.getExtension("EXT_color_buffer_float");if(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,t),this._options.isFloatingPointTexture){this._cgl.gl.getExtension("EXT_color_buffer_float"),this._cgl.gl.getExtension("EXT_color_buffer_float_linear"),this._cgl.gl.getExtension("OES_texture_float_linear");if(this._options.multisampling&&this._options.multisamplingSamples)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,this._cgl.gl.RGBA32F,this._width,this._height);else{let t=this._cgl.gl.RGBA32F;this._cgl._isSafariCrap&&(t=this._cgl.gl.RGBA16F),this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,t,this._width,this._height)}}else this._options.multisampling&&this._options.multisamplingSamples?this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,this._cgl.gl.RGBA8,this._width,this._height):this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA8,this._width,this._height);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,t),this._colorRenderbuffers[i]=t}for(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer),i=0;i<this._numRenderBuffers;i++)this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0);this._options.depth&&this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;for(this._cgl.glSlowRenderer&&(r=this._cgl.gl.DEPTH_COMPONENT16),s&&(this._textureDepth.setSize(this._width,this._height),this._depthRenderbuffer=this._cgl.gl.createRenderbuffer(),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer),this._options.isFloatingPointTexture,this._options.multisampling?this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height):this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)),this._drawTargetArray.length=0,i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);this._cgl.gl.isFramebuffer(this._textureFrameBuffer)||this._this._log.warn("invalid framebuffer");const n=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(n!=this._cgl.gl.FRAMEBUFFER_COMPLETE)switch(this._log.error("framebuffer incomplete: "+this.name,this),n){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:throw this._log.warn("FRAMEBUFFER_UNSUPPORTED"),new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw this._log.warn("incomplete framebuffer",n),new Error("Incomplete framebuffer: "+n)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)},B.prototype.renderStart=function(){this._cgl.checkFrameStarted("fb2 renderstart"),this._cgl.pushModelMatrix(),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer),this._cgl.pushGlFrameBuffer(this._frameBuffer),this._cgl.pushFrameBuffer(this),this._cgl.pushPMatrix(),this._cgl.gl.viewport(0,0,this._width,this._height),this._cgl.gl.drawBuffers(this._drawTargetArray),this._options.clear&&(this._cgl.gl.clearColor(0,0,0,0),this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT))},B.prototype.renderEnd=function(){if(this._cgl.popPMatrix(),this._cgl.profileData.profileFramebuffer++,this._numRenderBuffers<=1)this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer),this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]),this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST);else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);let e=this._cgl.gl.COLOR_BUFFER_BIT;0==t&&(e|=this._cgl.gl.DEPTH_BUFFER_BIT),this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}if(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer()),this._cgl.popFrameBuffer(),this._cgl.popModelMatrix(),this._cgl.resetViewPort(),this._colorTextures[0].filter==L.FILTER_MIPMAP)for(let t=0;t<this._numRenderBuffers;t++)this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex),this._colorTextures[t].updateMipMap(),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)};const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=new Uint8Array(256);for(let t=0;t<k.length;t++)D[k.charCodeAt(t)]=t;const V=D,G=function(t){t.buffer&&(t=t.buffer);let e,i=new Uint8Array(t),s=i.length,r="";for(e=0;e<s;e+=3)r+=k[i[e]>>2],r+=k[(3&i[e])<<4|i[e+1]>>4],r+=k[(15&i[e+1])<<2|i[e+2]>>6],r+=k[63&i[e+2]];return s%3==2?r=r.substring(0,r.length-1)+"=":s%3==1&&(r=r.substring(0,r.length-2)+"=="),r},H=function(t){let e,i,s,r,n,o=.75*t.length,h=t.length,a=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);let l=new ArrayBuffer(o),c=new Uint8Array(l);for(e=0;e<h;e+=4)i=V[t.charCodeAt(e)],s=V[t.charCodeAt(e+1)],r=V[t.charCodeAt(e+2)],n=V[t.charCodeAt(e+3)],c[a++]=i<<2|s>>4,c[a++]=(15&s)<<4|r>>2,c[a++]=(3&r)<<6|63&n;return l};class z{constructor(t){this._init(),this._first=!0,this._wireMesh=null,t&&this.apply(t)}_init(){this._max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],this._min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this._center=[0,0,0],this._size=[0,0,0],this._maxAxis=0,this._first=!0}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(t,e){if(t){if(t instanceof z){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ),this.applyPos(e.minX,e.minY,e.minZ)}else for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2]);this.calcCenterSize()}}copy(){return new z(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(t,e,i){if(t!=Number.MAX_VALUE&&t!=-Number.MAX_VALUE&&e!=Number.MAX_VALUE&&e!=-Number.MAX_VALUE&&i!=Number.MAX_VALUE&&i!=-Number.MAX_VALUE&&CABLES.UTILS.isNumeric(t)&&CABLES.UTILS.isNumeric(e)&&CABLES.UTILS.isNumeric(i)){if(this._first)return this._max[0]=t,this._max[1]=e,this._max[2]=i,this._min[0]=t,this._min[1]=e,this._min[2]=i,void(this._first=!1);this._max[0]=Math.max(this._max[0],t),this._max[1]=Math.max(this._max[1],e),this._max[2]=Math.max(this._max[2],i),this._min[0]=Math.min(this._min[0],t),this._min[1]=Math.min(this._min[1],e),this._min[2]=Math.min(this._min[2],i)}}calcCenterSize(){this._first||(this._size[0]=this._max[0]-this._min[0],this._size[1]=this._max[1]-this._min[1],this._size[2]=this._max[2]-this._min[2],this._center[0]=(this._min[0]+this._max[0])/2,this._center[1]=(this._min[1]+this._max[1])/2,this._center[2]=(this._min[2]+this._max[2])/2,this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1])))}mulMat4(t){this._first&&(this._max[0]=0,this._max[1]=0,this._max[2]=0,this._min[0]=0,this._min[1]=0,this._min[2]=0,this._first=!1),vec3.transformMat4(this._max,this._max,t),vec3.transformMat4(this._min,this._min,t),this.calcCenterSize()}render(t,e){this._wireMesh||(this._wireMesh=new CGL.WireCube(t)),t.pushModelMatrix(),mat4.translate(t.mMatrix,t.mMatrix,this._center),this._wireMesh.render(t,this._size[0]/2,this._size[1]/2,this._size[2]/2),t.popModelMatrix()}}const Y=function(t){this.name=t||"unknown",this._log=new h("cgl_geometry"),this.faceVertCount=3,this._vertices=[],this.verticesIndices=[],this.texCoords=new Float32Array,this.texCoordsIndices=[],this.vertexNormals=[],this.tangents=[],this.biTangents=[],this.morphTargets=[],this.vertexColors=[],this._attributes={},this.glPrimitive=null,Object.defineProperty(this,"vertices",{get(){return this._vertices},set(t){this.setVertices(t)}})};Y.prototype.clear=function(){this.vertices=new Float32Array([]),this.verticesIndices.length=0,this.texCoords=new Float32Array([]),this.texCoordsIndices.length=0,this.vertexNormals=new Float32Array([])},Y.prototype.getAttributes=function(){return this._attributes},Y.prototype.getAttribute=function(t){for(const e in this._attributes)if(this._attributes[e].name==t)return this._attributes[e];return null},Y.prototype.setAttribute=function(t,e,i){let s="";1==i?s="float":2==i?s="vec2":3==i?s="vec3":4==i&&(s="vec4");const r={name:t,data:e,itemSize:i,type:s};this._attributes[t]=r},Y.prototype.setVertices=function(t){t instanceof Float32Array?this._vertices=t:this._vertices=new Float32Array(t)},Y.prototype.setTexCoords=function(t){t instanceof Float32Array?this.texCoords=t:this.texCoords=new Float32Array(t)},Y.prototype.calcNormals=function(t){t||this.unIndex(),this.calculateNormals({})},Y.prototype.flipNormals=function(t,e,i){let s=vec3.create();null==t&&(t=1),null==e&&(e=1),null==i&&(i=1);for(let r=0;r<this.vertexNormals.length;r+=3)vec3.set(s,this.vertexNormals[r+0],this.vertexNormals[r+1],this.vertexNormals[r+2]),s[0]*=-t,s[1]*=-e,s[2]*=-i,vec3.normalize(s,s),this.vertexNormals[r+0]=s[0],this.vertexNormals[r+1]=s[1],this.vertexNormals[r+2]=s[2]},Y.prototype.getNumTriangles=function(){return this.verticesIndices&&this.verticesIndices.length?this.verticesIndices.length/3:this.vertices.length/3},Y.prototype.flipVertDir=function(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3)t[e]=this.verticesIndices[e+2],t[e+1]=this.verticesIndices[e+1],t[e+2]=this.verticesIndices[e];this.verticesIndices=t},Y.prototype.setPointVertices=function(t){if(t.length%3==0){t instanceof Float32Array?this.vertices=t:this.vertices=new Float32Array(t),this.texCoords instanceof Float32Array||(this.texCoords=new Float32Array(t.length/3*2)),this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++)this.verticesIndices[e]=e,this.texCoords[2*e]=0,this.texCoords[2*e+1]=0}else this._log.error("SetPointVertices: Array must be multiple of three.")},Y.prototype.merge=function(t){if(!t)return;const e=this.verticesIndices.length,i=this.vertices.length/3;this.verticesIndices.length=this.verticesIndices.length+t.verticesIndices.length;for(let s=0;s<t.verticesIndices.length;s++)this.verticesIndices[e+s]=t.verticesIndices[s]+i;this.vertices=g.float32Concat(this.vertices,t.vertices),this.texCoords=g.float32Concat(this.texCoords,t.texCoords),this.vertexNormals=g.float32Concat(this.vertexNormals,t.vertexNormals),this.tangents=g.float32Concat(this.tangents,t.tangents),this.biTangents=g.float32Concat(this.biTangents,t.biTangents)},Y.prototype.copy=function(){let t=0;const e=new Y(this.name+" copy");if(e.faceVertCount=this.faceVertCount,e.glPrimitive=this.glPrimitive,e.setVertices(this._vertices.slice(0)),this.verticesIndices)for(e.verticesIndices.length=this.verticesIndices.length,t=0;t<this.verticesIndices.length;t++)e.verticesIndices[t]=this.verticesIndices[t];if(this.texCoords)for(e.texCoords=new Float32Array(this.texCoords.length),t=0;t<this.texCoords.length;t++)e.texCoords[t]=this.texCoords[t];if(this.texCoordsIndices)for(e.texCoordsIndices.length=this.texCoordsIndices.length,t=0;t<this.texCoordsIndices.length;t++)e.texCoordsIndices[t]=this.texCoordsIndices[t];if(this.vertexNormals)for(e.vertexNormals=new Float32Array(this.vertexNormals.length),t=0;t<this.vertexNormals.length;t++)e.vertexNormals[t]=this.vertexNormals[t];if(this.tangents)for(e.tangents=[],e.tangents.length=this.tangents.length,t=0;t<this.tangents.length;t++)e.tangents[t]=this.tangents[t];if(this.biTangents)for(e.biTangents=[],e.biTangents.length=this.biTangents.length,t=0;t<this.biTangents.length;t++)e.biTangents[t]=this.biTangents[t];for(e.morphTargets.length=this.morphTargets.length,t=0;t<this.morphTargets.length;t++)e.morphTargets[t]=this.morphTargets[t];for(e.vertexColors.length=this.vertexColors.length,t=0;t<this.vertexColors.length;t++)e.vertexColors[t]=this.vertexColors[t];return e},Y.prototype.calculateNormals=function(t){const e=vec3.create(),i=vec3.create(),s=vec3.create();function r(r){return vec3.subtract(e,r[0],r[1]),vec3.subtract(i,r[0],r[2]),vec3.cross(s,e,i),vec3.normalize(s,s),t&&t.forceZUp&&s[2]<0&&(s[0]*=-1,s[1]*=-1,s[2]*=-1),s}this.getVertexVec=function(t){const e=[0,0,0];return e[0]=this.vertices[3*t+0],e[1]=this.vertices[3*t+1],e[2]=this.vertices[3*t+2],e},this.vertexNormals instanceof Float32Array&&this.vertexNormals.length==this.vertices.length||(this.vertexNormals=new Float32Array(this.vertices.length));for(let t=0;t<this.vertices.length;t++)this.vertexNormals[t]=0;if(this.isIndexed()){const t=[];t.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const i=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];t[e/3]=r(i),this.vertexNormals[3*this.verticesIndices[e+0]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+0]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+0]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+1]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+1]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+1]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+2]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+2]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+2]+2]+=t[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3)for(let e=0;e<3;e++){const i=[this.vertexNormals[3*this.verticesIndices[t+e]+0],this.vertexNormals[3*this.verticesIndices[t+e]+1],this.vertexNormals[3*this.verticesIndices[t+e]+2]];vec3.normalize(i,i),this.vertexNormals[3*this.verticesIndices[t+e]+0]=i[0],this.vertexNormals[3*this.verticesIndices[t+e]+1]=i[1],this.vertexNormals[3*this.verticesIndices[t+e]+2]=i[2]}}else{const t=[];for(let e=0;e<this.vertices.length;e+=9){const i=r([[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]]);t.push(i[0],i[1],i[2],i[0],i[1],i[2],i[0],i[1],i[2])}this.vertexNormals=t}},Y.prototype.calcTangentsBitangents=function(){if(!this.vertices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertices.");if(!this.vertexNormals.length)return void this._log.error("Cannot calculate tangents/bitangents without normals.");if(!this.texCoords.length){const t=this.vertices.length/3*2;this.texCoords=new Float32Array(t);for(let e=0;e<t;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertex indices.");if(this.verticesIndices.length%3!=0)return void this._log.error("Vertex indices mismatch!");const t=this.verticesIndices.length/3,e=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length),this.biTangents=new Float32Array(this.vertexNormals.length);const i=[];i.length=2*e;const s=vec3.create(),r=vec3.create(),n=vec3.create(),o=vec2.create(),h=vec2.create(),a=vec2.create(),l=vec3.create(),c=vec3.create();for(let u=0;u<t;u+=1){const t=this.verticesIndices[3*u],g=this.verticesIndices[3*u+1],_=this.verticesIndices[3*u+2];vec3.set(s,this.vertices[3*t],this.vertices[3*t+1],this.vertices[3*t+2]),vec3.set(r,this.vertices[3*g],this.vertices[3*g+1],this.vertices[3*g+2]),vec3.set(n,this.vertices[3*_],this.vertices[3*_+1],this.vertices[3*_+2]),vec2.set(o,this.texCoords[2*t],this.texCoords[2*t+1]),vec2.set(h,this.texCoords[2*g],this.texCoords[2*g+1]),vec2.set(a,this.texCoords[2*_],this.texCoords[2*_+1]);const p=r[0]-s[0],d=n[0]-s[0],f=r[1]-s[1],m=n[1]-s[1],E=r[2]-s[2],T=n[2]-s[2],A=h[0]-o[0],b=a[0]-o[0],y=h[1]-o[1],v=a[1]-o[1],x=1/(A*v-b*y);vec3.set(l,(v*p-y*d)*x,(v*f-y*m)*x,(v*E-y*T)*x),vec3.set(c,(A*d-b*p)*x,(A*m-b*f)*x,(A*T-b*E)*x),i[t]=l,i[g]=l,i[_]=l,i[t+e]=c,i[g+e]=c,i[_+e]=c}const u=vec3.create(),g=vec3.create(),_=vec3.create(),p=vec3.create(),d=vec3.create(),f=vec3.create(),m=vec3.create(),E=vec3.create();for(let t=0;t<e;t+=1){if(!i[t])continue;vec3.set(u,this.vertexNormals[3*t],this.vertexNormals[3*t+1],this.vertexNormals[3*t+2]),vec3.set(g,i[t][0],i[t][1],i[t][2]);const s=vec3.dot(u,g);vec3.scale(d,u,s),vec3.subtract(f,g,d),vec3.normalize(E,f),vec3.cross(m,u,g);vec3.dot(m,i[t+e]);const r=1;vec3.scale(_,E,1/r),vec3.cross(p,u,_),this.tangents[3*t+0]=_[0],this.tangents[3*t+1]=_[1],this.tangents[3*t+2]=_[2],this.biTangents[3*t+0]=p[0],this.biTangents[3*t+1]=p[1],this.biTangents[3*t+2]=p[2]}},Y.prototype.isIndexed=function(){return 0!=this.verticesIndices.length},Y.prototype.unIndex=function(t,e){const i=[],s=[],r=[],n=[],o=[],h=[];let a=0,l=0;for(l=0;l<this.verticesIndices.length;l+=3)i.push(this.vertices[3*this.verticesIndices[l+0]+0],this.vertices[3*this.verticesIndices[l+0]+1],this.vertices[3*this.verticesIndices[l+0]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+0]+0],this.vertexNormals[3*this.verticesIndices[l+0]+1],this.vertexNormals[3*this.verticesIndices[l+0]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+0]+0],this.tangents[3*this.verticesIndices[l+0]+1],this.tangents[3*this.verticesIndices[l+0]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+0]+0],this.biTangents[3*this.verticesIndices[l+0]+1],this.biTangents[3*this.verticesIndices[l+0]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+0]+0],this.texCoords[2*this.verticesIndices[l+0]+1]):r.push(0,0),s.push(a),a++,i.push(this.vertices[3*this.verticesIndices[l+1]+0],this.vertices[3*this.verticesIndices[l+1]+1],this.vertices[3*this.verticesIndices[l+1]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+1]+0],this.vertexNormals[3*this.verticesIndices[l+1]+1],this.vertexNormals[3*this.verticesIndices[l+1]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+1]+0],this.tangents[3*this.verticesIndices[l+1]+1],this.tangents[3*this.verticesIndices[l+1]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+1]+0],this.biTangents[3*this.verticesIndices[l+1]+1],this.biTangents[3*this.verticesIndices[l+1]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+1]+0],this.texCoords[2*this.verticesIndices[l+1]+1]):r.push(0,0),s.push(a),a++,i.push(this.vertices[3*this.verticesIndices[l+2]+0],this.vertices[3*this.verticesIndices[l+2]+1],this.vertices[3*this.verticesIndices[l+2]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+2]+0],this.vertexNormals[3*this.verticesIndices[l+2]+1],this.vertexNormals[3*this.verticesIndices[l+2]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+2]+0],this.tangents[3*this.verticesIndices[l+2]+1],this.tangents[3*this.verticesIndices[l+2]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+2]+0],this.biTangents[3*this.verticesIndices[l+2]+1],this.biTangents[3*this.verticesIndices[l+2]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+2]+0],this.texCoords[2*this.verticesIndices[l+2]+1]):r.push(0,0),s.push(a),a++;this.vertices=i,this.texCoords=r,this.vertexNormals=n,o.length>0&&(this.tangents=o),h.length>0&&(this.biTangents=h),this.verticesIndices.length=0,t&&(this.verticesIndices=s),e||this.calculateNormals()},Y.prototype.calcBarycentric=function(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let e=0;for(let i=0;i<this.vertices.length;i+=3)t[i+e]=1,e++,3==e&&(e=0);this.setAttribute("attrBarycentric",t,3)},Y.prototype.getBounds=function(){return new z(this)},Y.prototype.center=function(t,e,i){void 0===t&&(t=!0,e=!0,i=!0);let s=0;const r=this.getBounds(),n=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(s=0;s<this.vertices.length;s+=3)this.vertices[s+0]==this.vertices[s+0]&&(t&&(this.vertices[s+0]-=n[0]),e&&(this.vertices[s+1]-=n[1]),i&&(this.vertices[s+2]-=n[2]));return n},Y.prototype.mapTexCoords2d=function(){const t=this.getBounds(),e=this.vertices.length/3;this.texCoords=new Float32Array(2*e);for(let i=0;i<e;i++){const e=this.vertices[3*i+0],s=this.vertices[3*i+1];this.texCoords[2*i+0]=e/(t.maxX-t.minX)+.5,this.texCoords[2*i+1]=1-s/(t.maxY-t.minY)+.5}},Y.prototype.getInfo=function(){const t={};return this.verticesIndices?t.numFaces=this.verticesIndices.length/3:t.numFaces=0,this.vertices?t.numVerts=this.vertices.length/3:t.numVerts=0,this.vertexNormals?t.numNormals=this.vertexNormals.length/3:t.numNormals=0,this.texCoords?t.numTexCoords=this.texCoords.length/2:t.numTexCoords=0,this.tangents?t.numTangents=this.tangents.length/3:t.numTangents=0,this.biTangents?t.numBiTangents=this.biTangents.length/3:t.numBiTangents=0,this.biTangents?t.numBiTangents=this.biTangents.length/3:t.numBiTangents=0,this.vertexColors?t.numVertexColors=this.vertexColors.length/4:t.numVertexColors=0,this.getAttributes()?t.numAttribs=Object.keys(this.getAttributes()).length:t.numAttribs=0,t.isIndexed=this.isIndexed(),t},Y.buildFromFaces=function(t,e,i){const s=[],r=[];for(let e=0;e<t.length;e+=3){const n=t[e+0],o=t[e+1],h=t[e+2],a=[-1,-1,-1];if(i)for(let t=0;t<s.length;t+=3)s[t+0]==n[0]&&s[t+1]==n[1]&&s[t+2]==n[2]&&(a[0]=t/3),s[t+0]==o[0]&&s[t+1]==o[1]&&s[t+2]==o[2]&&(a[1]=t/3),s[t+0]==h[0]&&s[t+1]==h[1]&&s[t+2]==h[2]&&(a[2]=t/3);-1==a[0]&&(s.push(n[0],n[1],n[2]),a[0]=(s.length-1)/3),-1==a[1]&&(s.push(o[0],o[1],o[2]),a[1]=(s.length-1)/3),-1==a[2]&&(s.push(h[0],h[1],h[2]),a[2]=(s.length-1)/3),r.push(parseInt(a[0],10)),r.push(parseInt(a[1],10)),r.push(parseInt(a[2],10))}const n=new Y(e);return n.name=e,n.vertices=s,n.verticesIndices=r,n},Y.json2geom=function(t){const e=new Y("jsonMeshGeom");if(e.verticesIndices=[],e.vertices=t.vertices||[],e.vertexNormals=t.normals||[],e.vertexColors=t.colors||[],e.tangents=t.tangents||[],e.biTangents=t.bitangents||[],t.texturecoords&&e.setTexCoords(t.texturecoords[0]),t.vertices_b64&&(e.vertices=new Float32Array(H(t.vertices_b64))),t.normals_b64&&(e.vertexNormals=new Float32Array(H(t.normals_b64))),t.tangents_b64&&(e.tangents=new Float32Array(H(t.tangents_b64))),t.bitangents_b64&&(e.biTangents=new Float32Array(H(t.bitangents_b64))),t.texturecoords_b64&&e.setTexCoords(new Float32Array(H(t.texturecoords_b64[0]))),t.faces_b64)e.verticesIndices=new Uint32Array(H(t.faces_b64));else{e.verticesIndices.length=3*t.faces.length;for(let i=0;i<t.faces.length;i++)e.verticesIndices[3*i]=t.faces[i][0],e.verticesIndices[3*i+1]=t.faces[i][1],e.verticesIndices[3*i+2]=t.faces[i][2]}return e};const W=function(){this._log=new h("eventtaget"),this._eventCallbacks={},this._logName="",this._logEvents=!1,this._listeners={},this.addEventListener=this.on=function(t,e,i){const s={id:(i||"")+CABLES.uuid(),name:t,cb:e};return this._eventCallbacks[t]?this._eventCallbacks[t].push(s):this._eventCallbacks[t]=[s],this._listeners[s.id]=s,s.id},this.hasEventListener=function(t,e){if(t&&!e)return!!this._listeners[t];if(this._log.warn("old eventtarget function haseventlistener!"),t&&e&&this._eventCallbacks[t]){return-1!=this._eventCallbacks[t].indexOf(e)}},this.removeEventListener=this.off=function(t,e){if(null==t)return;if(!e){const e=this._listeners[t];if(!e)return;let i=!0;for(;i;){i=!1;let s=-1;for(let r=0;r<this._eventCallbacks[e.name].length;r++)0===this._eventCallbacks[e.name][r].id.indexOf(t)&&(i=!0,s=r);-1!==s&&(this._eventCallbacks[e.name].splice(s,1),delete this._listeners[t])}return}this._log.stack(" old function signature: removeEventListener! use listener id");let i=null;for(let s=0;s<this._eventCallbacks[t].length;s++)this._eventCallbacks[t][s].cb==e&&(i=s);null!==i?delete this._eventCallbacks[i]:this._log.warn("removeEventListener not found "+t)},this.logEvents=function(t,e){this._logEvents=t,this._logName=e},this.emitEvent=function(t,e,i,s,r,n,o){if(this._logEvents&&console.log("[event] ",this._logName,t,this._eventCallbacks),this._eventCallbacks[t])for(let h=0;h<this._eventCallbacks[t].length;h++)this._eventCallbacks[t][h]&&this._eventCallbacks[t][h].cb(e,i,s,r,n,o);else this._logEvents&&console.log("[event] has no event callback",t,this._eventCallbacks)}},X={Key:function(t){this.time=0,this.value=0,this.ui=null,this.onChange=null,this._easing=0,this.bezTangIn=0,this.bezTangOut=0,this.cb=null,this.cbTriggered=!1;this.setEasing(a.EASING_LINEAR),this.set(t)}};X.Key.cubicSpline=function(t,e,i){let s=t*t,r=s*t;return(2*r-3*s+1)*e.value+(r-2*s+t)*e.bezTangOut+(-2*r+3*s)*i.value+(r-s)*i.bezTangIn},X.Key.easeCubicSpline=function(t,e){return X.Key.cubicSpline(t,this,e)},X.Key.linear=function(t,e,i){return parseFloat(e.value)+parseFloat(i.value-e.value)*t},X.Key.easeLinear=function(t,e){return X.Key.linear(t,this,e)},X.Key.easeAbsolute=function(t,e){return this.value};const K=function(t){return Math.pow(2,10*(t-1))};X.Key.easeExpoIn=function(t,e){return t=K(t),X.Key.linear(t,this,e)};const j=function(t){return t=1-Math.pow(2,-10*t)};X.Key.easeExpoOut=function(t,e){return t=j(t),X.Key.linear(t,this,e)};const Q=function(t){return(t*=2)<1?t=.5*Math.pow(2,10*(t-1)):(t--,t=.5*(2-Math.pow(2,-10*t))),t};X.Key.easeExpoInOut=function(t,e){return t=Q(t),X.Key.linear(t,this,e)},X.Key.easeSinIn=function(t,e){return t=-1*Math.cos(t*Math.PI/2)+1,X.Key.linear(t,this,e)},X.Key.easeSinOut=function(t,e){return t=Math.sin(t*Math.PI/2),X.Key.linear(t,this,e)},X.Key.easeSinInOut=function(t,e){return t=-.5*(Math.cos(Math.PI*t)-1),X.Key.linear(t,this,e)};const q=function(t){return t*=t*t};X.Key.easeCubicIn=function(t,e){return t=q(t),X.Key.linear(t,this,e)},X.Key.easeInQuint=function(t,e){return t*=t*t*t*t,X.Key.linear(t,this,e)},X.Key.easeOutQuint=function(t,e){return t=(t-=1)*t*t*t*t+1,X.Key.linear(t,this,e)},X.Key.easeInOutQuint=function(t,e){return(t/=.5)<1?t*=.5*t*t*t*t:t=.5*((t-=2)*t*t*t*t+2),X.Key.linear(t,this,e)},X.Key.easeInQuart=function(t,e){return t*=t*t*t,X.Key.linear(t,this,e)},X.Key.easeOutQuart=function(t,e){return t=-1*((t-=1)*t*t*t-1),X.Key.linear(t,this,e)},X.Key.easeInOutQuart=function(t,e){return(t/=.5)<1?t*=.5*t*t*t:t=-.5*((t-=2)*t*t*t-2),X.Key.linear(t,this,e)},X.Key.bounce=function(t){return(t/=1)<1/2.75?t*=7.5625*t:t=t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,t},X.Key.easeInBounce=function(t,e){return X.Key.linear(X.Key.bounce(t),this,e)},X.Key.easeOutBounce=function(t,e){return X.Key.linear(X.Key.bounce(t),this,e)},X.Key.easeInElastic=function(t,e){let i=1.70158,s=0,r=1;return 0===t?t=0:1==(t/=1)?t=1:(s||(s=.3),r<Math.abs(1)?(r=1,i=s/4):i=s/(2*Math.PI)*Math.asin(1/r),t=-r*Math.pow(2,10*(t-=1))*Math.sin((1*t-i)*(2*Math.PI)/s)+0),X.Key.linear(t,this,e)},X.Key.easeOutElastic=function(t,e){let i=1.70158,s=0,r=1;return 0===t?t=0:1==(t/=1)?t=1:(s||(s=.3),r<Math.abs(1)?(r=1,i=s/4):i=s/(2*Math.PI)*Math.asin(1/r),t=r*Math.pow(2,-10*t)*Math.sin((1*t-i)*(2*Math.PI)/s)+1+0),X.Key.linear(t,this,e)},X.Key.easeInBack=function(t,e){const i=1.70158;return t=t*t*((i+1)*t-i),X.Key.linear(t,this,e)},X.Key.easeOutBack=function(t,e){const i=1.70158;return t=(t=t/1-1)*t*((i+1)*t+i)+1,X.Key.linear(t,this,e)},X.Key.easeInOutBack=function(t,e){let i=1.70158;return t=(t/=.5)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2),X.Key.linear(t,this,e)};const J=function(t){return t=--t*t*t+1};X.Key.easeCubicOut=function(t,e){return t=J(t),X.Key.linear(t,this,e)};const Z=function(t){return(t*=2)<1?t*=.5*t*t:t=.5*((t-=2)*t*t+2),t};X.Key.easeCubicInOut=function(t,e){return t=Z(t),X.Key.linear(t,this,e)},X.Key.easeSmoothStep=function(t,e){const i=Math.max(0,Math.min(1,t));return t=i*i*(3-2*i),X.Key.linear(t,this,e)},X.Key.easeSmootherStep=function(t,e){const i=Math.max(0,Math.min(1,(t-0)/1));return t=i*i*i*(i*(6*i-15)+10),X.Key.linear(t,this,e)},X.Key.prototype.setEasing=function(t){this._easing=t,this._easing==a.EASING_LINEAR?this.ease=X.Key.easeLinear:this._easing==a.EASING_ABSOLUTE?this.ease=X.Key.easeAbsolute:this._easing==a.EASING_SMOOTHSTEP?this.ease=X.Key.easeSmoothStep:this._easing==a.EASING_SMOOTHERSTEP?this.ease=X.Key.easeSmootherStep:this._easing==a.EASING_CUBIC_IN?this.ease=X.Key.easeCubicIn:this._easing==a.EASING_CUBIC_OUT?this.ease=X.Key.easeCubicOut:this._easing==a.EASING_CUBIC_INOUT?this.ease=X.Key.easeCubicInOut:this._easing==a.EASING_EXPO_IN?this.ease=X.Key.easeExpoIn:this._easing==a.EASING_EXPO_OUT?this.ease=X.Key.easeExpoOut:this._easing==a.EASING_EXPO_INOUT?this.ease=X.Key.easeExpoInOut:this._easing==a.EASING_SIN_IN?this.ease=X.Key.easeSinIn:this._easing==a.EASING_SIN_OUT?this.ease=X.Key.easeSinOut:this._easing==a.EASING_SIN_INOUT?this.ease=X.Key.easeSinInOut:this._easing==a.EASING_BACK_OUT?this.ease=X.Key.easeOutBack:this._easing==a.EASING_BACK_IN?this.ease=X.Key.easeInBack:this._easing==a.EASING_BACK_INOUT?this.ease=X.Key.easeInOutBack:this._easing==a.EASING_ELASTIC_IN?this.ease=X.Key.easeInElastic:this._easing==a.EASING_ELASTIC_OUT?this.ease=X.Key.easeOutElastic:this._easing==a.EASING_ELASTIC_INOUT?this.ease=X.Key.easeElasticInOut:this._easing==a.EASING_BOUNCE_IN?this.ease=X.Key.easeInBounce:this._easing==a.EASING_BOUNCE_OUT?this.ease=X.Key.easeOutBounce:this._easing==a.EASING_QUART_OUT?this.ease=X.Key.easeOutQuart:this._easing==a.EASING_QUART_IN?this.ease=X.Key.easeInQuart:this._easing==a.EASING_QUART_INOUT?this.ease=X.Key.easeInOutQuart:this._easing==a.EASING_QUINT_OUT?this.ease=X.Key.easeOutQuint:this._easing==a.EASING_QUINT_IN?this.ease=X.Key.easeInQuint:this._easing==a.EASING_QUINT_INOUT?this.ease=X.Key.easeInOutQuint:this._easing==a.EASING_CUBICSPLINE?this.ease=X.Key.easeCubicSpline:(this._easing=a.EASING_LINEAR,this.ease=X.Key.easeLinear)},X.Key.prototype.trigger=function(){this.cb(),this.cbTriggered=!0},X.Key.prototype.setValue=function(t){this.value=t,null!==this.onChange&&this.onChange()},X.Key.prototype.set=function(t){t&&(t.e&&this.setEasing(t.e),t.cb&&(this.cb=t.cb,this.cbTriggered=!1),t.b,t.hasOwnProperty("t")&&(this.time=t.t),t.hasOwnProperty("time")&&(this.time=t.time),t.hasOwnProperty("v")?this.value=t.v:t.hasOwnProperty("value")&&(this.value=t.value)),null!==this.onChange&&this.onChange()},X.Key.prototype.getSerialized=function(){const t={};return t.t=this.time,t.v=this.value,t.e=this._easing,t},X.Key.prototype.getEasing=function(){return this._easing};const $=function(t){W.apply(this),t=t||{},this.keys=[],this.onChange=null,this.stayInTimeline=!1,this.loop=!1,this._log=new h("Anim"),this.defaultEasing=t.defaultEasing||a.EASING_LINEAR,this.onLooped=null,this._timesLooped=0,this._needsSort=!1};$.prototype.forceChangeCallback=function(){null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this)},$.prototype.getLoop=function(){return this.loop},$.prototype.setLoop=function(t){this.loop=t,this.emitEvent("onChange",this)},$.prototype.hasEnded=function(t){return 0===this.keys.length||this.keys[this.keys.length-1].time<=t},$.prototype.isRising=function(t){if(this.hasEnded(t))return!1;const e=this.getKeyIndex(t);return this.keys[e].value<this.keys[e+1].value},$.prototype.clearBefore=function(t){const e=this.getValue(t),i=this.getKeyIndex(t);this.setValue(t,e),i>1&&this.keys.splice(0,i)},$.prototype.clear=function(t){let e=0;t&&(e=this.getValue(t)),this.keys.length=0,t&&this.setValue(t,e),null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this)},$.prototype.sortKeys=function(){this.keys.sort((t,e)=>parseFloat(t.time)-parseFloat(e.time)),this._needsSort=!1},$.prototype.getLength=function(){return 0===this.keys.length?0:this.keys[this.keys.length-1].time},$.prototype.getKeyIndex=function(t){let e=0;for(let i=0;i<this.keys.length;i++)if(t>=this.keys[i].time&&(e=i),this.keys[i].time>t)return e;return e},$.prototype.setValue=function(t,e,i){let s=null;for(const r in this.keys)if(this.keys[r].time==t){s=this.keys[r],this.keys[r].setValue(e),this.keys[r].cb=i;break}return s||(s=new X.Key({time:t,value:e,e:this.defaultEasing,cb:i}),this.keys.push(s)),this.onChange&&this.onChange(),this.emitEvent("onChange",this),this._needsSort=!0,s},$.prototype.setKeyEasing=function(t,e){this.keys[t]&&(this.keys[t].setEasing(e),this.emitEvent("onChange",this))},$.prototype.getSerialized=function(){const t={keys:[]};t.loop=this.loop;for(const e in this.keys)t.keys.push(this.keys[e].getSerialized());return t},$.prototype.getKey=function(t){const e=this.getKeyIndex(t);return this.keys[e]},$.prototype.getNextKey=function(t){let e=this.getKeyIndex(t)+1;return e>=this.keys.length&&(e=this.keys.length-1),this.keys[e]},$.prototype.isFinished=function(t){return this.keys.length<=0||t>this.keys[this.keys.length-1].time},$.prototype.isStarted=function(t){return!(this.keys.length<=0)&&t>=this.keys[0].time},$.prototype.getValue=function(t){if(0===this.keys.length)return 0;if(this._needsSort&&this.sortKeys(),t<this.keys[0].time)return this.keys[0].value;const e=this.keys.length-1;if(this.loop&&t>this.keys[e].time){t/this.keys[e].time>this._timesLooped&&(this._timesLooped++,this.onLooped&&this.onLooped()),t=(t-this.keys[0].time)%(this.keys[e].time-this.keys[0].time),t+=this.keys[0].time}const i=this.getKeyIndex(t);if(i>=e)return this.keys[e].cb&&!this.keys[e].cbTriggered&&this.keys[e].trigger(),this.keys[e].value;const s=parseInt(i,10)+1,r=this.keys[i],n=this.keys[s];if(r.cb&&!r.cbTriggered&&r.trigger(),!n)return-1;const o=(t-r.time)/(n.time-r.time);return r.ease||this.log._warn("has no ease",r,n),r.ease(o,n)},$.prototype.addKey=function(t){void 0===t.time?this.log.warn("key time undefined, ignoring!"):(this.keys.push(t),null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this))},$.prototype.easingFromString=function(t){return"linear"==t?a.EASING_LINEAR:"absolute"==t?a.EASING_ABSOLUTE:"smoothstep"==t?a.EASING_SMOOTHSTEP:"smootherstep"==t?a.EASING_SMOOTHERSTEP:"Cubic In"==t?a.EASING_CUBIC_IN:"Cubic Out"==t?a.EASING_CUBIC_OUT:"Cubic In Out"==t?a.EASING_CUBIC_INOUT:"Expo In"==t?a.EASING_EXPO_IN:"Expo Out"==t?a.EASING_EXPO_OUT:"Expo In Out"==t?a.EASING_EXPO_INOUT:"Sin In"==t?a.EASING_SIN_IN:"Sin Out"==t?a.EASING_SIN_OUT:"Sin In Out"==t?a.EASING_SIN_INOUT:"Back In"==t?a.EASING_BACK_IN:"Back Out"==t?a.EASING_BACK_OUT:"Back In Out"==t?a.EASING_BACK_INOUT:"Elastic In"==t?a.EASING_ELASTIC_IN:"Elastic Out"==t?a.EASING_ELASTIC_OUT:"Bounce In"==t?a.EASING_BOUNCE_IN:"Bounce Out"==t?a.EASING_BOUNCE_OUT:"Quart Out"==t?a.EASING_QUART_OUT:"Quart In"==t?a.EASING_QUART_IN:"Quart In Out"==t?a.EASING_QUART_INOUT:"Quint Out"==t?a.EASING_QUINT_OUT:"Quint In"==t?a.EASING_QUINT_IN:"Quint In Out"==t?a.EASING_QUINT_INOUT:void 0},$.prototype.createPort=function(t,e,i){const s=t.inDropDown(e,a.EASINGS);return s.set("linear"),s.defaultValue="linear",s.onChange=function(){this.defaultEasing=this.easingFromString(s.get()),i&&i()}.bind(this),s},$.slerpQuaternion=function(t,e,i,s,r,n){$.slerpQuaternion.q1||($.slerpQuaternion.q1=quat.create(),$.slerpQuaternion.q2=quat.create());const o=i.getKeyIndex(t);let h=o+1;if(h>=i.keys.length&&(h=i.keys.length-1),o==h)quat.set(e,i.keys[o].value,s.keys[o].value,r.keys[o].value,n.keys[o].value);else{const a=i.keys[o].time,l=(t-a)/(i.keys[h].time-a);quat.set($.slerpQuaternion.q1,i.keys[o].value,s.keys[o].value,r.keys[o].value,n.keys[o].value),quat.set($.slerpQuaternion.q2,i.keys[h].value,s.keys[h].value,r.keys[h].value,n.keys[h].value),quat.slerp(e,$.slerpQuaternion.q1,$.slerpQuaternion.q2,l)}return e};const tt=X;tt.Anim=$;const et=function(t,e,i,s){W.apply(this),this.data={},this._log=new h("core_port"),this.direction=c.PORT_DIR_IN,this.id=A(),this.parent=t,this.links=[],this.value=0,this.name=e,this.type=i||l.OP_PORT_TYPE_VALUE,this.uiAttribs=s||{},this.anim=null,this._oldAnimVal=-5711,this.defaultValue=null,this._uiActiveState=!0,this.ignoreValueSerialize=!1,this.onLinkChanged=null,this.crashed=!1,this._valueBeforeLink=null,this._lastAnimFrame=-1,this._animated=!1,this.onValueChanged=null,this.onTriggered=null,this.onUiActiveStateChange=null,this.changeAlways=!1,this._warnedDeprecated=!1,this._useVariableName=null,this.activityCounter=0,this._tempLastUiValue=null,Object.defineProperty(this,"val",{get(){return this._log.warn("val getter deprecated!",this),this._log.stack("val getter deprecated"),this._warnedDeprecated=!0,this.get()},set(t){this._log.warn("val setter deprecated!",this),this._log.stack("val setter deprecated"),this.setValue(t),this._warnedDeprecated=!0}})};et.prototype.getValueForDisplay=function(){let t=String(this.value);return this.uiAttribs&&"boolnum"==this.uiAttribs.display&&(t+=" - ",this.value?t+="true":t+="false"),t=t.replace(/(<([^>]+)>)/gi,""),t.length>100&&(t=t.substring(0,100)),t},et.prototype.onAnimToggle=function(){},et.prototype._onAnimToggle=function(){this.onAnimToggle()},et.prototype.remove=function(){this.removeLinks(),this.parent.removePort(this)},et.prototype.setUiAttribs=function(t){let e=!1;this.uiAttribs||(this.uiAttribs={});for(const i in t)this.uiAttribs[i]!=t[i]&&(e=!0),this.uiAttribs[i]=t[i],"group"==i&&this.indexPort&&this.indexPort.setUiAttribs({group:t[i]});e&&this.emitEvent("onUiAttrChange",t)},et.prototype.getUiAttribs=function(){return this.uiAttribs},et.prototype.getUiAttrib=function(t){return this.uiAttribs&&this.uiAttribs.hasOwnProperty(t)?this.uiAttribs[t]:null},et.prototype.get=function(){return this._animated&&this._lastAnimFrame!=this.parent.patch.getFrameNum()&&(this._lastAnimFrame=this.parent.patch.getFrameNum(),this.value=this.anim.getValue(this.parent.patch.timer.getTime()),this._oldAnimVal=this.value,this.forceChange()),this.value},et.prototype.set=et.prototype.setValue=function(t){if(void 0!==t&&this.parent.enabled&&!this.crashed&&(t!==this.value||this.changeAlways||this.type==l.OP_PORT_TYPE_TEXTURE||this.type==l.OP_PORT_TYPE_ARRAY)){if(this._animated)this.anim.setValue(this.parent.patch.timer.getTime(),t);else{try{this.value=t,this.forceChange()}catch(t){this.crashed=!0,this.setValue=function(t){},this.onTriggered=function(){},this._log.error("onvaluechanged exception cought",t),this._log.error(t.stack),this._log.warn("exception in: "+this.parent.name),this.parent.patch.isEditorMode()&&gui.showOpCrash(this.parent),this.parent.patch.emitEvent("exception",t,this.parent),this.parent.onError&&this.parent.onError(t)}this.parent&&this.parent.patch&&this.parent.patch.isEditorMode()&&this.type==l.OP_PORT_TYPE_TEXTURE&&gui.texturePreview().updateTexturePort(this)}if(this.direction==c.PORT_DIR_OUT)for(let t=0;t<this.links.length;++t)this.links[t].setValue()}},et.prototype.updateAnim=function(){this._animated&&(this.value=this.get(),(this._oldAnimVal!=this.value||this.changeAlways)&&(this._oldAnimVal=this.value,this.forceChange()),this._oldAnimVal=this.value)},et.args=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},et.prototype.forceChange=function(){this.onValueChanged||this.onChange,this._activity(),this.emitEvent("change",this.value,this),this.onChange?this.onChange(this,this.value):this.onValueChanged&&this.onValueChanged(this,this.value)},et.prototype.getTypeString=function(){return this.type==l.OP_PORT_TYPE_VALUE?"Number":this.type==l.OP_PORT_TYPE_FUNCTION?"Trigger":this.type==l.OP_PORT_TYPE_OBJECT?"Object":this.type==l.OP_PORT_TYPE_DYNAMIC?"Dynamic":this.type==l.OP_PORT_TYPE_ARRAY?"Array":this.type==l.OP_PORT_TYPE_STRING?"String":"Unknown"},et.prototype.deSerializeSettings=function(t){if(t&&(t.animated&&this.setAnimated(t.animated),t.useVariable&&this.setVariableName(t.useVariable),t.anim)){this.anim||(this.anim=new $),this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)}),t.anim.loop&&(this.anim.loop=t.anim.loop);for(const e in t.anim.keys)this.anim.keys.push(new X.Key(t.anim.keys[e]))}},et.prototype.getSerialized=function(){const t={};if(t.name=this.getName(),this.ignoreValueSerialize||0!==this.links.length||this.type==l.OP_PORT_TYPE_OBJECT&&this.value&&this.value.tex||(t.value=this.value),this._useVariableName&&(t.useVariable=this._useVariableName),this._animated&&(t.animated=!0),this.anim&&(t.anim=this.anim.getSerialized()),"file"==this.uiAttribs.display&&(t.display=this.uiAttribs.display),this.direction==c.PORT_DIR_OUT&&this.links.length>0){t.links=[];for(const e in this.links)!this.links[e].ignoreInSerialize&&this.links[e].portIn&&this.links[e].portOut&&t.links.push(this.links[e].getSerialized())}return t},et.prototype.shouldLink=function(){return!0},et.prototype.removeLinks=function(){let t=0;for(;this.links.length>0;){if(t++,t>5e3){this._log.warn("could not delete links... / infinite loop"),this.links.length=0;break}this.links[0].remove()}},et.prototype.removeLink=function(t){for(const e in this.links)this.links[e]==t&&this.links.splice(e,1);this.direction==c.PORT_DIR_IN&&(this.type==l.OP_PORT_TYPE_VALUE?this.setValue(this._valueBeforeLink||0):this.setValue(this._valueBeforeLink||null)),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},et.prototype.getName=function(){return this.name},et.prototype.addLink=function(t){this._valueBeforeLink=this.value,this.links.push(t),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},et.prototype.getLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]},et.prototype.removeLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e].remove(),this.onLinkChanged&&this.onLinkChanged(),void this.emitEvent("onLinkChanged")},et.prototype.isLinkedTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},et.prototype._activity=function(){this.activityCounter++},et.prototype.trigger=function(){if(this._activity(),0===this.links.length)return;if(!this.parent.enabled)return;let t=null;try{for(let e=0;e<this.links.length;++e)this.links[e].portIn&&(t=this.links[e].portIn,t.parent.patch.pushTriggerStack(t),t._onTriggered(),t.parent.patch.popTriggerStack()),this.links[e]&&this.links[e].activity()}catch(e){this.parent.enabled=!1,this.parent.patch.isEditorMode()&&(this.parent.patch.emitEvent("exception",e,t.parent),this.parent.patch.emitEvent("opcrash",t),t.parent.onError&&t.parent.onError(e)),this._log.warn("exception!"),this._log.error("ontriggered exception cought",e),this._log.error(e.stack),this._log.warn("exception in: "+t.parent.name)}},et.prototype.call=function(){this._log.warn("call deprecated - use trigger() "),this.trigger()},et.prototype.execute=function(){this._log.warn("### execute port: "+this.getName(),this.goals.length)},et.prototype.setVariableName=function(t){this._useVariableName=t},et.prototype.getVariableName=function(){return this._useVariableName},et.prototype.setVariable=function(t){this.setAnimated(!1);const e={useVariable:!1};this._variableIn&&(this._variableIn.removeListener(this.set.bind(this)),this._variableIn=null),t?(this._variableIn=this.parent.patch.getVar(t),this._variableIn?(this.type==l.OP_PORT_TYPE_OBJECT?this._variableIn.addListener(()=>{this.set(null),this.set(this._variableIn.getValue())}):this._variableIn.addListener(this.set.bind(this)),this.set(this._variableIn.getValue())):this._log.warn("PORT VAR NOT FOUND!!!",t),this._useVariableName=t,e.useVariable=!0,e.variableName=this._useVariableName):(e.variableName=this._useVariableName=null,e.useVariable=!1),this.setUiAttribs(e),this.parent.patch.emitEvent("portSetVariable",this.parent,this,t)},et.prototype._handleNoTriggerOpAnimUpdates=function(t){let e=!1;for(let t=0;t<this.parent.portsIn.length;t++)if(this.parent.portsIn.type==l.OP_PORT_TYPE_FUNCTION){e=!0;break}e||(t?this._notriggerAnimUpdate=this.parent.patch.on("onRenderFrame",()=>{this.updateAnim()}):this.parent.patch.removeEventListener(this._notriggerAnimUpdate))},et.prototype.setAnimated=function(t){this._animated!=t&&(this._animated=t,this._animated&&!this.anim&&(this.anim=new $,this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)})),this._onAnimToggle()),this._handleNoTriggerOpAnimUpdates(t),this.setUiAttribs({isAnimated:this._animated})},et.prototype.toggleAnim=function(t){this._animated=!this._animated,this._animated&&!this.anim&&(this.anim=new $,this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)})),this.setAnimated(this._animated),this._onAnimToggle(),this.setUiAttribs({isAnimated:this._animated})},et.prototype.getType=function(){return this.type},et.prototype.isLinked=function(){return this.links.length>0},et.prototype.isBoundToVar=function(){return null!=this._useVariableName},et.prototype.isAnimated=function(){return this._animated},et.prototype.isHidden=function(){return this.uiAttribs.hidePort},et.prototype._onTriggered=function(t){this._activity(),this.parent.updateAnims(),this.parent.enabled&&this.onTriggered&&this.onTriggered(t)},et.prototype._onSetProfiling=function(t){this.parent.patch.profiler.add("port",this),this.setValue(t),this.parent.patch.profiler.add("port",null)},et.prototype._onTriggeredProfiling=function(){this.parent.enabled&&this.onTriggered&&(this.parent.patch.profiler.add("port",this),this.onTriggered(),this.parent.patch.profiler.add("port",null))},et.prototype.onValueChange=function(t){this.onChange=t},et.prototype.getUiActiveState=function(){return this._uiActiveState},et.prototype.setUiActiveState=function(t){this._uiActiveState=t,this.onUiActiveStateChange&&this.onUiActiveStateChange()},et.prototype.hidePort=function(){this._log.warn("op.hideport() is deprecated, do not use it!")},et.portTypeNumberToString=function(t){return t==l.OP_PORT_TYPE_VALUE?"value":t==l.OP_PORT_TYPE_FUNCTION?"function":t==l.OP_PORT_TYPE_OBJECT?"object":t==l.OP_PORT_TYPE_ARRAY?"array":t==l.OP_PORT_TYPE_STRING?"string":t==l.OP_PORT_TYPE_DYNAMIC?"dynamic":"unknown"};class it extends et{constructor(t,e,i,s,r){super(t,e,i,s),this.indexPort=r,this.indexPort.set=t=>{const e=s.values;if(!e)return;let i=Math.floor(t);i=Math.min(i,e.length-1),i=Math.max(i,0),this.indexPort.setValue(i),this.set(e[i]),this.parent.patch.isEditorMode()&&window.gui&&gui.patchView.isCurrentOp(this.parent)&&gui.opParams.show(this.parent)}}setUiAttribs(t){const e=t.hidePort;t.hidePort=!0,super.setUiAttribs(t),void 0!==e&&this.indexPort.setUiAttribs({hidePort:e})}}class st extends it{setUiAttribs(t){if(this.indexPort.isLinked())for(const e in t)"greyout"!=e||t[e]||(t[e]="true");super.setUiAttribs(t)}}const rt=function(t,e,i,s,r,n,o,a,l,c){if(this._loc=-1,this._log=new h("cgl_uniform"),this._type=e,this._cgl=t._cgl,this._name=i,this._shader=t,this._value=1e-5,this._oldValue=null,this._port=null,this._structName=l,this._structUniformName=a,this._propertyName=c,this._shader._addUniform(this),this.needsUpdate=!0,this.shaderType=null,this.comment=null,"f"==e)this.set=this.setValue=this.setValueF.bind(this),this.updateValue=this.updateValueF.bind(this);else if("f[]"==e)this.set=this.setValue=this.setValueArrayF.bind(this),this.updateValue=this.updateValueArrayF.bind(this);else if("2f[]"==e)this.set=this.setValue=this.setValueArray2F.bind(this),this.updateValue=this.updateValueArray2F.bind(this);else if("3f[]"==e)this.set=this.setValue=this.setValueArray3F.bind(this),this.updateValue=this.updateValueArray3F.bind(this);else if("4f[]"==e)this.set=this.setValue=this.setValueArray4F.bind(this),this.updateValue=this.updateValueArray4F.bind(this);else if("i"==e)this.set=this.setValue=this.setValueI.bind(this),this.updateValue=this.updateValueI.bind(this);else if("2i"==e)this.set=this.setValue=this.setValue2I.bind(this),this.updateValue=this.updateValue2I.bind(this);else if("3i"==e)this.set=this.setValue=this.setValue3I.bind(this),this.updateValue=this.updateValue3I.bind(this);else if("4i"==e)this.set=this.setValue=this.setValue4I.bind(this),this.updateValue=this.updateValue4I.bind(this);else if("b"==e)this.set=this.setValue=this.setValueBool.bind(this),this.updateValue=this.updateValueBool.bind(this);else if("4f"==e)this.set=this.setValue=this.setValue4F.bind(this),this.updateValue=this.updateValue4F.bind(this);else if("3f"==e)this.set=this.setValue=this.setValue3F.bind(this),this.updateValue=this.updateValue3F.bind(this);else if("2f"==e)this.set=this.setValue=this.setValue2F.bind(this),this.updateValue=this.updateValue2F.bind(this);else if("t"==e)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("tc"==e)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("t[]"==e)this.set=this.setValue=this.setValueArrayT.bind(this),this.updateValue=this.updateValueArrayT.bind(this);else{if("m4"!=e&&"m4[]"!=e)throw new Error("Unknown uniform type");this.set=this.setValue=this.setValueM4.bind(this),this.updateValue=this.updateValueM4.bind(this)}"object"==typeof s&&s instanceof et?(this._port=s,this._value=this._port.get(),r&&n&&o?(r instanceof et&&n instanceof et&&o instanceof et||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0,0],this._port2=r,this._port3=n,this._port4=o,this._port.on("change",this.updateFromPort4f.bind(this)),this._port2.on("change",this.updateFromPort4f.bind(this)),this._port3.on("change",this.updateFromPort4f.bind(this)),this._port4.on("change",this.updateFromPort4f.bind(this)),this.updateFromPort4f()):r&&n?(r instanceof et&&n instanceof et||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0],this._port2=r,this._port3=n,this._port.on("change",this.updateFromPort3f.bind(this)),this._port2.on("change",this.updateFromPort3f.bind(this)),this._port3.on("change",this.updateFromPort3f.bind(this)),this.updateFromPort3f()):r?(r instanceof et||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0],this._port2=r,this._port.on("change",this.updateFromPort2f.bind(this)),this._port2.on("change",this.updateFromPort2f.bind(this)),this.updateFromPort2f()):this._port.on("change",this.updateFromPort.bind(this))):this._value=s,this.setValue(this._value),this.needsUpdate=!0};rt.prototype.copy=function(t){const e=new rt(t,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);return e.shaderType=this.shaderType,e},rt.prototype.getGlslTypeString=function(){return"f"==this._type?"float":"b"==this._type?"bool":"i"==this._type?"int":"2i"==this._type?"ivec2":"2f"==this._type?"vec2":"3f"==this._type?"vec3":"4f"==this._type?"vec4":"m4"==this._type?"mat4":"t"==this._type?"sampler2D":"tc"==this._type?"samplerCube":"3f[]"==this._type||"m4[]"==this._type?null:void this._log.warn("[CGL UNIFORM] unknown glsl type string ",this._type)},rt.prototype._isValidLoc=function(){return-1!=this._loc},rt.prototype.getType=function(){return this._type},rt.prototype.getName=function(){return this._name},rt.prototype.getValue=function(){return this._value},rt.prototype.getShaderType=function(){return this.shaderType},rt.prototype.isStructMember=function(){return!!this._structName},rt.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},rt.prototype.bindTextures=function(){return this._value},rt.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},rt.prototype.bindTextures=function(){},rt.prototype.getLoc=function(){return this._loc},rt.prototype.updateFromPort4f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this._value[3]=this._port4.get(),this.setValue(this._value)},rt.prototype.updateFromPort3f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this.setValue(this._value)},rt.prototype.updateFromPort2f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this.setValue(this._value)},rt.prototype.updateFromPort=function(){this.setValue(this._port.get())},rt.prototype.updateValueF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1f(this._loc,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueF=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.updateValueI=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.updateValue2I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValue3I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValue4I=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueI=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.setValue2I=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1],this.needsUpdate=!0),this._value=t)},rt.prototype.setValue3I=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2],this.needsUpdate=!0),this._value=t)},rt.prototype.setValue4I=function(t){this.needsUpdate=!0,this._value=t||vec4.create()},rt.prototype.updateValueBool=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueBool=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.setValueArray4F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray4F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform4fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArray3F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray3F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform3fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArray2F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray2F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform2fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArrayF=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArrayF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArrayT=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValue3F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.setValue3F=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValue2F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.setValue2F=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValue4F=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._value||(this._log.warn("no value for uniform",this._name,this),this._value=[0,0,0,0]),this.needsUpdate=!1,this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},rt.prototype.setValue4F=function(t){"number"==typeof this.value&&(this.value=vec4.create()),t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]&&t[3]==this._oldValue[3]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2,3],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValueM4=function(){if(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,!1,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueM4=function(t){this.needsUpdate=!0,this._value=t||mat4.create()},rt.prototype.updateValueArrayT=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1iv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValueT=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._cgl.profileData.profileUniformCount++,this._shader.getCgl().gl.uniform1i(this._loc,this._value),this.needsUpdate=!1},rt.prototype.setValueT=function(t){this.needsUpdate=!0,this._value=t};const nt=180/Math.PI,ot={MATH:{DEG2RAD:Math.PI/180,RAD2DEG:nt},SHADER:{SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_VIEWPOS:"camPos"},BLEND_MODES:{BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4}};const ht={lastMesh:null},at=function(t,e,i){this._cgl=t,this._log=new h("cgl_mesh"),this._bufVertexAttrib=null,this._bufVerticesIndizes=this._cgl.gl.createBuffer(),this._indexType=this._cgl.gl.UNSIGNED_SHORT,this._attributes=[],this._attribLocs={},this._geom=null,this._lastShader=null,this._numInstances=0,this._glPrimitive=i,this._preWireframeGeom=null,this.addVertexNumbers=!1,this.feedBackAttributes=[],this.setGeom(e),this._feedBacks=[],this._feedBacksChanged=!1,this._transformFeedBackLoc=-1,this._lastAttrUpdate=0,this._name="unknown",this._cgl.profileData.addHeavyEvent("mesh constructed",this._name),this._queryExt=null,Object.defineProperty(this,"numInstances",{get(){return this._numInstances},set(t){this.setNumInstances(t)}})};at.prototype.updateVertices=function(t){this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_POSITION,t.vertices,3),this._numVerts=t.vertices.length/3},at.prototype.setAttributePointer=function(t,e,i,s){for(let r=0;r<this._attributes.length;r++)this._attributes[r].name==t&&(this._attributes[r].pointer||(this._attributes[r].pointer=[]),this._attributes[r].pointer.push({loc:-1,name:e,stride:i,offset:s,instanced:t==ot.SHADER.SHADERVAR_INSTANCE_MMATRIX}))},at.prototype.getAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]},at.prototype.setAttributeRange=function(t,e,i,s){t&&(i||s)&&(t.name||(console.log(t),this._log.stack("no attrname?!")),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,t.buffer),this._cgl.profileData.profileMeshAttributes+=s-i||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]=this._cgl.profileData.profileSingleMeshAttribute[this._name]||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]+=s-i||0,t.numItems<e.length/t.itemSize&&this._resizeAttr(e,t),s>=e.length-1&&this._log.log(this._cgl.canvas.id+" "+t.name+" buffersubdata out of bounds ?",e.length,s,i,t),1==this._cgl.glVersion?this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,0,e):this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,4*i,e,i,s-i))},at.prototype._resizeAttr=function(t,e){e.buffer&&this._cgl.gl.deleteBuffer(e.buffer),e.buffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,e.buffer),this._bufferArray(t,e),e.numItems=t.length/e.itemSize},at.prototype._bufferArray=function(t,e){let i=null;t&&(this._cgl.debugOneFrame&&console.log("_bufferArray",t.length,e.name),t instanceof Float32Array?i=t:e&&i&&i.length==t.length?i.set(t):(i=new Float32Array(t),this._cgl.debugOneFrame&&console.log("_bufferArray create new float32array",t.length,e.name),this._cgl.profileData.profileNonTypedAttrib++,this._cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+e.name+")"),e.arrayLength=i.length,this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,i,this._cgl.gl.DYNAMIC_DRAW))},at.prototype.addAttribute=at.prototype.updateAttribute=at.prototype.setAttribute=function(t,e,i,s){if(!e)throw this._log.error("mesh addAttribute - no array given! "+t),new Error;let r=null,n=!1,o=0;const h=e.length/i;for(this._cgl.profileData.profileMeshAttributes+=h||0,"function"==typeof s&&(r=s),"object"==typeof s&&(s.cb&&(r=s.cb),s.instanced&&(n=s.instanced)),t==ot.SHADER.SHADERVAR_INSTANCE_MMATRIX&&(n=!0),o=0;o<this._attributes.length;o++){const i=this._attributes[o];if(i.name==t)return i.numItems===h||this._resizeAttr(e,i),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,i.buffer),this._bufferArray(e,i),i}const a=this._cgl.gl.createBuffer();this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,a);let l=this._cgl.gl.FLOAT;s&&s.type&&(l=s.type);const c={buffer:a,name:t,cb:r,itemSize:i,numItems:h,startItem:0,instanced:n,type:l};return this._bufferArray(e,c),t==ot.SHADER.SHADERVAR_VERTEX_POSITION&&(this._bufVertexAttrib=c),this._attributes.push(c),this._attribLocs={},c},at.prototype.getAttributes=function(){return this._attributes},at.prototype.updateTexCoords=function(t){if(t.texCoords&&t.texCoords.length>0)this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_TEXCOORD,t.texCoords,2);else{const e=new Float32Array(Math.round(t.vertices.length/3*2));this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_TEXCOORD,e,2)}},at.prototype.updateNormals=function(t){if(t.vertexNormals&&t.vertexNormals.length>0)this.setAttribute("attrVertNormal",t.vertexNormals,3);else{const e=new Float32Array(Math.round(t.vertices.length));this.setAttribute("attrVertNormal",e,3)}},at.prototype._setVertexNumbers=function(t){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||t){if(t)this._verticesNumbers=t;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let t=0;t<this._numVerts;t++)this._verticesNumbers[t]=t}this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(t,e,i)=>{i.uniformNumVertices||(i.uniformNumVertices=new rt(i,"f","numVertices",this._numVerts)),i.uniformNumVertices.setValue(this._numVerts)})}},at.prototype.setVertexIndices=function(t){if(this._bufVerticesIndizes)if(t.length>0){for(let e=0;e<t.length;e++)if(t[e]>=this._numVerts)return void this._log.warn("invalid index in "+this._name);this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes),t instanceof Float32Array&&this._log.warn("vertIndices float32Array: "+this._name),t instanceof Uint32Array?(this.vertIndicesTyped=t,this._indexType=this._cgl.gl.UNSIGNED_INT):t instanceof Uint16Array?this.vertIndicesTyped=t:this.vertIndicesTyped=new Uint16Array(t),this._cgl.gl.bufferData(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this._cgl.gl.DYNAMIC_DRAW),this._bufVerticesIndizes.itemSize=1,this._bufVerticesIndizes.numItems=t.length}else this._bufVerticesIndizes.numItems=0;else this._log.warn("no bufVerticesIndizes: "+this._name)},at.prototype.setGeom=function(t,e){this._geom=t,null!=t.glPrimitive&&(this._glPrimitive=t.glPrimitive),this._geom&&this._geom.name&&(this._name="mesh "+this._geom.name),ht.lastMesh=null,this._cgl.profileData.profileMeshSetGeom++,this._disposeAttributes(),this.updateVertices(this._geom),this.setVertexIndices(this._geom.verticesIndices),this.updateTexCoords(this._geom),this.updateNormals(this._geom),this._geom.hasOwnProperty("tangents")&&this._geom.tangents&&this._geom.tangents.length>0&&this.setAttribute("attrTangent",this._geom.tangents,3),this._geom.hasOwnProperty("biTangents")&&this._geom.biTangents&&this._geom.biTangents.length>0&&this.setAttribute("attrBiTangent",this._geom.biTangents,3),this._geom.vertexColors.length>0&&(this._geom.vertexColors.flat&&this._geom.vertexColors.flat(100),this.setAttribute("attrVertColor",this._geom.vertexColors,4)),this.addVertexNumbers&&this._setVertexNumbers();const i=this._geom.getAttributes();for(const t in i)this.setAttribute(t,i[t].data,i[t].itemSize);e&&(this._geom=null)},at.prototype._preBind=function(t){for(let e=0;e<this._attributes.length;e++)this._attributes[e].cb&&this._attributes[e].cb(this._attributes[e],this._geom,t)},at.prototype._checkAttrLengths=function(){for(let t=0;t<this._attributes.length;t++)if(this._attributes[t].arrayLength/this._attributes[t].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let t="unknown";this._geom&&(t=this._geom.name)}},at.prototype._bind=function(t){if(!t.isValid())return;let e=[];if(this._attribLocs[t.id]?e=this._attribLocs[t.id]:this._attribLocs[t.id]=e,this._lastShader=t,t.lastCompile>this._lastAttrUpdate||e.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let t=0;t<this._attributes.length;t++)e[t]=-1}for(let i=0;i<this._attributes.length;i++){const s=this._attributes[i];if(-1==e[i]&&s._attrLocationLastShaderTime!=t.lastCompile&&(s._attrLocationLastShaderTime=t.lastCompile,e[i]=this._cgl.glGetAttribLocation(t.getProgram(),s.name),this._cgl.profileData.profileAttrLoc++),-1!=e[i])if(this._cgl.gl.enableVertexAttribArray(e[i]),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.buffer),s.instanced)if(s.itemSize<=4)s.itemSize&&0!=s.itemSize||this._log.warn("instanced attrib itemsize error",this._geom.name,s),this._cgl.gl.vertexAttribPointer(e[i],s.itemSize,s.type,!1,4*s.itemSize,0),this._cgl.gl.vertexAttribDivisor(e[i],1);else if(16==s.itemSize){const t=64;this._cgl.gl.vertexAttribPointer(e[i],4,s.type,!1,t,0),this._cgl.gl.enableVertexAttribArray(e[i]+1),this._cgl.gl.vertexAttribPointer(e[i]+1,4,s.type,!1,t,16),this._cgl.gl.enableVertexAttribArray(e[i]+2),this._cgl.gl.vertexAttribPointer(e[i]+2,4,s.type,!1,t,32),this._cgl.gl.enableVertexAttribArray(e[i]+3),this._cgl.gl.vertexAttribPointer(e[i]+3,4,s.type,!1,t,48),this._cgl.gl.vertexAttribDivisor(e[i],1),this._cgl.gl.vertexAttribDivisor(e[i]+1,1),this._cgl.gl.vertexAttribDivisor(e[i]+2,1),this._cgl.gl.vertexAttribDivisor(e[i]+3,1)}else this._log.warn("unknown instance attrib size",s.name);else{if(s.itemSize&&0!=s.itemSize||this._log.warn("attrib itemsize error",this._name,s),this._cgl.gl.vertexAttribPointer(e[i],s.itemSize,s.type,!1,4*s.itemSize,0),s.pointer)for(let e=0;e<s.pointer.length;e++){const i=s.pointer[e];-1==i.loc&&(i.loc=this._cgl.glGetAttribLocation(t.getProgram(),i.name)),this._cgl.profileData.profileAttrLoc++,this._cgl.gl.enableVertexAttribArray(i.loc),this._cgl.gl.vertexAttribPointer(i.loc,s.itemSize,s.type,!1,i.stride,i.offset)}this.bindFeedback(s)}}0!==this._bufVerticesIndizes.numItems&&this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes)},at.prototype.unBind=function(){const t=this._lastShader;if(this._lastShader=null,!t)return;let e=[];this._attribLocs[t.id]?e=this._attribLocs[t.id]:this._attribLocs[t.id]=e,ht.lastMesh=null;for(let t=0;t<this._attributes.length;t++)this._attributes[t].instanced&&(this._attributes[t].itemSize<=4?(-1!=e[t]&&this._cgl.gl.vertexAttribDivisor(e[t],0),e[t]>=0&&this._cgl.gl.disableVertexAttribArray(e[t])):(this._cgl.gl.vertexAttribDivisor(e[t],0),this._cgl.gl.vertexAttribDivisor(e[t]+1,0),this._cgl.gl.vertexAttribDivisor(e[t]+2,0),this._cgl.gl.vertexAttribDivisor(e[t]+3,0),this._cgl.gl.disableVertexAttribArray(e[t]+1),this._cgl.gl.disableVertexAttribArray(e[t]+2),this._cgl.gl.disableVertexAttribArray(e[t]+3))),-1!=e[t]&&this._cgl.gl.disableVertexAttribArray(e[t])},at.prototype.meshChanged=function(){return this._cgl.lastMesh&&this._cgl.lastMesh!=this},at.prototype.printDebug=function(t){console.log("--attributes");for(let t=0;t<this._attributes.length;t++)console.log("attribute "+t+" "+this._attributes[t].name)},at.prototype.setNumVertices=function(t){this._bufVertexAttrib.numItems=t},at.prototype.getNumVertices=function(){return this._bufVertexAttrib.numItems},at.prototype.render=function(t){if(!t||!t.isValid())return;if(this._checkAttrLengths(),this._geom&&(!this._preWireframeGeom||t.wireframe||this._geom.isIndexed()||(this.setGeom(this._preWireframeGeom),this._preWireframeGeom=null),t.wireframe)){let t=!1;this._geom.isIndexed()&&(this._preWireframeGeom||(this._preWireframeGeom=this._geom,this._geom=this._geom.copy()),this._geom.unIndex(),t=!0),this._geom.getAttribute("attrBarycentric")||(this._preWireframeGeom||(this._preWireframeGeom=this._geom,this._geom=this._geom.copy()),t=!0,this._geom.calcBarycentric()),t&&this.setGeom(this._geom)}let e=!1;ht.lastMesh!=this&&(ht.lastMesh&&ht.lastMesh.unBind(),e=!0),e&&this._preBind(t),t.bind(),t.bindTextures&&t.bindTextures(),this._bind(t),this.addVertexNumbers&&this._setVertexNumbers(),ht.lastMesh=this;let i=this._cgl.gl.TRIANGLES;void 0!==this._glPrimitive&&(i=this._glPrimitive),null!==t.glPrimitive&&(i=t.glPrimitive);let s=1,r=this._cgl.profileData.doProfileGlQuery,n=!1;if(r){let e=this._name+" "+t.getName()+" #"+t.id;this._numInstances&&(e+=" instanced "+this._numInstances+"x");let i=this._cgl.profileData.glQueryData[e];if(i||(i={id:e,num:0},this._cgl.profileData.glQueryData[e]=i),this._queryExt||!1===this._queryExt||(this._queryExt=this._cgl.gl.getExtension("EXT_disjoint_timer_query_webgl2")||!1),this._queryExt){if(i._drawQuery){if(this._cgl.gl.getQueryParameter(i._drawQuery,this._cgl.gl.QUERY_RESULT_AVAILABLE)){const t=this._cgl.gl.getQueryParameter(i._drawQuery,this._cgl.gl.QUERY_RESULT)/1e6;i._times+=t,i._numcount++,i.when=performance.now(),i._drawQuery=null,i.queryStarted=!1}}i.queryStarted||(i._drawQuery=this._cgl.gl.createQuery(),this._cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,i._drawQuery),n=i.queryStarted=!0)}}if(this.hasFeedbacks()?this.drawFeedbacks(t,i):0===this._bufVerticesIndizes.numItems?(i==this._cgl.gl.TRIANGLES&&(s=3),0===this._numInstances?this._cgl.gl.drawArrays(i,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem):this._cgl.gl.drawArraysInstanced(i,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)):0===this._numInstances?this._cgl.gl.drawElements(i,this._bufVerticesIndizes.numItems,this._indexType,0):this._cgl.gl.drawElementsInstanced(i,this._bufVerticesIndizes.numItems,this._indexType,0,this._numInstances),this._cgl.debugOneFrame&&this._cgl.gl.getError()!=this._cgl.gl.NO_ERROR){this._log.error("mesh draw gl error"),this._log.error("mesh",this),this._log.error("shader",t);for(let e=0;e<this._cgl.gl.getProgramParameter(t.getProgram(),this._cgl.gl.ACTIVE_ATTRIBUTES);e++){const i=this._cgl.gl.getActiveAttrib(t.getProgram(),e).name;this._log.error("attrib ",i)}}this._cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/s*(this._numInstances||1),this._cgl.profileData.profileMeshDraw++,r&&n&&this._cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT),this.unBind()},at.prototype.setNumInstances=function(t){if(t=Math.max(0,t),this._numInstances!=t){this._numInstances=t;const e=new Float32Array(t);for(let i=0;i<t;i++)e[i]=i;this.setAttribute("instanceIndex",e,1,{instanced:!0})}},at.prototype._disposeAttributes=function(){if(this._attributes){for(let t=0;t<this._attributes.length;t++)this._attributes[t].buffer&&(this._cgl.gl.deleteBuffer(this._attributes[t].buffer),this._attributes[t].buffer=null);this._attributes.length=0}},at.prototype.dispose=function(){this._bufVertexAttrib&&this._bufVertexAttrib.buffer&&this._cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer),this._bufVerticesIndizes&&this._cgl.gl.deleteBuffer(this._bufVerticesIndizes),this._bufVerticesIndizes=null,this._disposeAttributes()},function(t){t.prototype.hasFeedbacks=function(){return this._feedBacks.length>0},t.prototype.removeFeedbacks=function(t){this._feedbacks&&(this._feedbacks.length=0,this._feedBacksChanged=!0)},t.prototype.setAttributeFeedback=function(){},t.prototype.setFeedback=function(t,e,i){let s={nameOut:e},r=!1;this.unBindFeedbacks();for(let t=0;t<this._feedBacks.length;t++)this._feedBacks[t].nameOut==e&&(s=this._feedBacks[t],r=!0);return r||(this._feedBacksChanged=!0),s.initialArr=i,s.attrib=t,s.outBuffer&&this._cgl.gl.deleteBuffer(s.outBuffer),s.outBuffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.outBuffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,s.initialArr,this._cgl.gl.STATIC_DRAW),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.attrib.buffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,s.initialArr,this._cgl.gl.STATIC_DRAW),r||this._feedBacks.push(s),s},t.prototype.bindFeedback=function(t){if(!this._feedBacks||0===this._feedBacks.length)return;-1==this._transformFeedBackLoc&&(this._transformFeedBackLoc=this._cgl.gl.createTransformFeedback()),this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc);let e=!1;for(let i=0;i<this._feedBacks.length;i++){const s=this._feedBacks[i];s.attrib==t&&(e=!0,this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,i,s.outBuffer))}},t.prototype.drawFeedbacks=function(t,e){let i=0;if(this._feedBacksChanged){const e=[];for(this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc),i=0;i<this._feedBacks.length;i++)e.push(this._feedBacks[i].nameOut);return t.setFeedbackNames(e),console.log("feedbacknames",e),t.compile(),this._feedBacksChanged=!1,this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null),void console.log("changed finished")}this._cgl.gl.beginTransformFeedback(this.glPrimitive),this._cgl.gl.drawArrays(e,0,this._feedBacks[0].attrib.numItems),this._cgl.gl.endTransformFeedback(),this.unBindFeedbacks(),this.feedBacksSwapBuffers()},t.prototype.unBindFeedbacks=function(){for(let t=0;t<this._feedBacks.length;t++)this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,t,null);this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null)},t.prototype.feedBacksSwapBuffers=function(){for(let t=0;t<this._feedBacks.length;t++){const e=this._feedBacks[t].attrib.buffer;this._feedBacks[t].attrib.buffer=this._feedBacks[t].outBuffer,this._feedBacks[t].outBuffer=e}}}(at);const lt={getSimpleRect:function(t,e){const i=new Y(e);return i.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],i.texCoords=[1,1,0,1,1,0,0,0],i.verticesIndices=[0,1,2,2,1,3],i.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0],new at(t,i)}},ct=function(t,e){this._cgl=t,this._log=new h("cgl_TextureEffect"),t.TextureEffectMesh||this.createMesh(),this._textureSource=null,this._options=e,this.imgCompVer=0,this.aspectRatio=1,this._textureTarget=null,this._frameBuf=this._cgl.gl.createFramebuffer(),this._frameBuf2=this._cgl.gl.createFramebuffer(),this._renderbuffer=this._cgl.gl.createRenderbuffer(),this._renderbuffer2=this._cgl.gl.createRenderbuffer(),this.switched=!1,this.depth=!1};ct.prototype.getWidth=function(){return this._textureSource.width},ct.prototype.getHeight=function(){return this._textureSource.height},ct.prototype.setSourceTexture=function(t){t.textureType==L.TYPE_FLOAT&&this._cgl.gl.getExtension("EXT_color_buffer_float"),null===t?(this._textureSource=new L(this._cgl),this._textureSource.setSize(16,16)):this._textureSource=t,this._textureSource.compareSettings(this._textureTarget)||(this._textureTarget&&this._textureTarget.delete(),this._textureTarget=this._textureSource.clone(),this._cgl.profileData.profileEffectBuffercreate++,this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer),this.depth&&this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0),this.depth&&this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2),this.depth&&this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0),this.depth&&this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)),this.aspectRatio=this._textureSource.width/this._textureSource.height},ct.prototype.continueEffect=function(){this._cgl.pushDepthTest(!1),this._cgl.pushModelMatrix(),this._cgl.pushPMatrix(),this._cgl.gl.viewport(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height),mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100),this._cgl.pushPMatrix(),mat4.identity(this._cgl.pMatrix),this._cgl.pushViewMatrix(),mat4.identity(this._cgl.vMatrix),this._cgl.pushModelMatrix(),mat4.identity(this._cgl.mvMatrix)},ct.prototype.startEffect=function(t){this._textureTarget?(this.switched=!1,this.continueEffect(),t&&(this._bgTex=t),this._countEffects=0):this._log.warn("effect has no target")},ct.prototype.endEffect=function(){this._cgl.popDepthTest(),this._cgl.popModelMatrix(),this._cgl.popPMatrix(),this._cgl.popModelMatrix(),this._cgl.popViewMatrix(),this._cgl.popPMatrix(),this._cgl.resetViewPort()},ct.prototype.bind=function(){null!==this._textureSource?this.switched?(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2),this._cgl.pushGlFrameBuffer(this._frameBuf2)):(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf),this._cgl.pushGlFrameBuffer(this._frameBuf)):this._log.warn("no base texture set!")},ct.prototype.finish=function(){null!==this._textureSource?(this._cgl.TextureEffectMesh.render(this._cgl.getShader()),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer()),this._cgl.profileData.profileTextureEffect++,this._textureTarget.filter==L.FILTER_MIPMAP&&(this.switched?(this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex),this._textureSource.updateMipMap()):(this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex),this._textureTarget.updateMipMap()),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)),this.switched=!this.switched,this._countEffects++):this._log.warn("no base texture set!")},ct.prototype.getCurrentTargetTexture=function(){return this.switched?this._textureSource:this._textureTarget},ct.prototype.getCurrentSourceTexture=function(){return 0==this._countEffects&&this._bgTex?this._bgTex:this.switched?this._textureTarget:this._textureSource},ct.prototype.delete=function(){this._textureTarget&&this._textureTarget.delete(),this._textureSource&&this._textureSource.delete(),this._cgl.gl.deleteRenderbuffer(this._renderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuf)},ct.prototype.createMesh=function(){this._cgl.TextureEffectMesh=lt.getSimpleRect(this._cgl,"texEffectRect")},ct.checkOpNotInTextureEffect=function(t){return t.uiAttribs.error&&!t.patch.cgl.currentTextureEffect?(t.setUiError("textureeffect",null),!0):!t.patch.cgl.currentTextureEffect||(t.patch.cgl.currentTextureEffect&&!t.uiAttribs.error?(t.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0),!1):!t.patch.cgl.currentTextureEffect)},ct.checkOpInEffect=function(t,e){if(e=e||0,t.patch.cgl.currentTextureEffect){if(t.uiAttribs.uierrors&&t.patch.cgl.currentTextureEffect.imgCompVer>=e)return t.setUiError("texeffect",null),!0;e&&t.patch.cgl.currentTextureEffect.imgCompVer<e&&t.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+e+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+t.id+"','"+t.name+"')\">Downgrade</span> to previous version",1)}return!!t.patch.cgl.currentTextureEffect||(t.patch.cgl.currentTextureEffect||t.uiAttribs.uierrors&&0!=t.uiAttribs.uierrors.length?!!t.patch.cgl.currentTextureEffect:(t.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://docs.cables.gl/image_composition/image_composition.html" target="_blank">here</a>. ',1),!1))},ct.getBlendCode=function(t){let e="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();return t||(e+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl()),t>=3&&(e+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"}".endl()),e},ct.onChangeBlendSelect=function(t,e,i){t.toggleDefine("BM_NORMAL","normal"==e),t.toggleDefine("BM_MULTIPLY","multiply"==e),t.toggleDefine("BM_MULTIPLY_INV","multiply invert"==e),t.toggleDefine("BM_AVERAGE","average"==e),t.toggleDefine("BM_ADD","add"==e),t.toggleDefine("BM_SUBTRACT_ONE","subtract one"==e),t.toggleDefine("BM_SUBTRACT","subtract"==e),t.toggleDefine("BM_DIFFERENCE","difference"==e),t.toggleDefine("BM_NEGATION","negation"==e),t.toggleDefine("BM_EXCLUSION","exclusion"==e),t.toggleDefine("BM_LIGHTEN","lighten"==e),t.toggleDefine("BM_DARKEN","darken"==e),t.toggleDefine("BM_OVERLAY","overlay"==e),t.toggleDefine("BM_SCREEN","screen"==e),t.toggleDefine("BM_SOFTLIGHT","softlight"==e),t.toggleDefine("BM_HARDLIGHT","hardlight"==e),t.toggleDefine("BM_COLORDODGE","color dodge"==e),t.toggleDefine("BM_COLORBURN","color burn"==e),t.toggleDefine("BM_ALPHAMASKED",i)},ct.AddBlendSelect=function(t,e,i){return t.inValueSelect(e||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one"],i||"normal")},ct.AddBlendAlphaMask=function(t,e,i){return t.inSwitch(e||"Alpha Mask",["Off","On"],i||"Off")},ct.setupBlending=function(t,e,i,s,r){const n=()=>{let s=!1;r&&(s="On"==r.get()),ct.onChangeBlendSelect(e,i.get(),s);let n=i.get();"normal"==n?n=null:"multiply"==n?n="mul":"multiply invert"==n?n="mulinv":"lighten"==n?n="light":"darken"==n?n="darken":"average"==n?n="avg":"subtract one"==n?n="sub one":"subtract"==n?n="sub":"difference"==n?n="diff":"negation"==n||"negation"==n||"negation"==n?n="neg":"exclusion"==n?n="exc":"overlay"==n?n="ovl":"color dodge"==n?n="dodge":"color burn"==n?n="burn":"softlight"==n?n="soft":"hardlight"==n&&(n="hard"),t.setUiAttrib({extendTitle:n})};t.setPortGroup("Blending",[i,s,r]);let o=!1;i.onChange=n,r&&(r.onChange=n,o="On"==r.get()),ct.onChangeBlendSelect(e,i.get(),o)};const ut={"CGL.BLENDMODES":function(){this.name="blendmodes",this.srcHeadFrag=ct.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3",this.srcHeadFrag=ct.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance",this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber",this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber",this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex",this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}",this.initUniforms=function(t){return[new rt(t,"t","CGLRNDTEX",7)]},this.onBind=function(t,e){L.getRandomTexture(t),t.setTexture(7,L.getRandomTexture(t).tex)}}},gt=function(){return window.performance.now()},_t=function(){return gt()},pt=function(){CABLES.EventTarget.apply(this),this._timeStart=gt(),this._timeOffset=0,this._currentTime=0,this._lastTime=0,this._paused=!0,this._delay=0,this._eventsPaused=!1,this.overwriteTime=-1,this.cbPlayPause=[],this.cbTimeChange=[]};pt.prototype._getTime=function(){return this._lastTime=(gt()-this._timeStart)/1e3,this._lastTime+this._timeOffset},pt.prototype._eventPlayPause=function(){if(this.emitEvent("playPause"),!this._eventsPaused)for(const t in this.cbPlayPause)this.cbPlayPause[t]()},pt.prototype._eventTimeChange=function(){if(!this._eventsPaused)for(const t in this.cbTimeChange)this.cbTimeChange[t]()},pt.prototype.setDelay=function(t){this._delay=t,this._eventTimeChange()},pt.prototype.isPlaying=function(){return!this._paused},pt.prototype.update=function(){if(!this._paused)return this._currentTime=this._getTime(),this._currentTime},pt.prototype.getMillis=function(){return 1e3*this.get()},pt.prototype.get=pt.prototype.getTime=function(){return this.overwriteTime>=0?this.overwriteTime-this._delay:this._currentTime-this._delay},pt.prototype.togglePlay=function(){this._paused?this.play():this.pause()},pt.prototype.setTime=function(t){t<0&&(t=0),this._timeStart=gt(),this._timeOffset=t,this._currentTime=t,this._eventTimeChange()},pt.prototype.setOffset=function(t){this._currentTime+t<0?(this._timeStart=gt(),this._timeOffset=0,this._currentTime=0):(this._timeOffset+=t,this._currentTime=this._lastTime+this._timeOffset),this._eventTimeChange()},pt.prototype.play=function(){this._timeStart=gt(),this._paused=!1,this._eventPlayPause()},pt.prototype.pause=function(){this._timeOffset=this._currentTime,this._paused=!0,this._eventPlayPause()},pt.prototype.pauseEvents=function(t){this._eventsPaused=t},pt.prototype.onPlayPause=function(t){t&&"function"==typeof t&&this.cbPlayPause.push(t)},pt.prototype.onTimeChange=function(t){t&&"function"==typeof t&&this.cbTimeChange.push(t)};const dt=Math.PI/180,ft=(Math.PI,-1!=window.navigator.userAgent.indexOf("Windows")),mt=function(t){let e;if(t.wheelDelta)e=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30,e*=-1.5,ft&&(e*=2);else{let i=t.deltaY;t.shiftKey&&(i=t.deltaX);const s=i||t.detail;e=-(s%3?10*s:s/3),e*=-3}return e>20&&(e=20),e<-20&&(e=-20),e},Et=mt,Tt=mt,At={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bt=/[&<>"']/g,yt=RegExp(bt.source);const vt=function(t,e){if(!t)throw new Error("shader constructed without cgl "+e);this._log=new h("cgl_shader"),this._cgl=t,e||this._log.stack("no shader name given"),this._name=e||"unknown",this.glslVersion=0,t.glVersion>1&&(this.glslVersion=300),this.id=y(),this._isValid=!0,this._program=null,this._uniforms=[],this._drawBuffers=[!0],this._defines=[],this._needsRecompile=!0,this._compileReason="initial",this._projMatrixUniform=null,this._mvMatrixUniform=null,this._mMatrixUniform=null,this._vMatrixUniform=null,this._camPosUniform=null,this._normalMatrixUniform=null,this._inverseViewMatrixUniform=null,this._attrVertexPos=-1,this.precision=t.patch.config.glslPrecision||"highp",this._pMatrixState=-1,this._vMatrixState=-1,this._modGroupCount=0,this._feedBackNames=[],this._attributes=[],this.glPrimitive=null,this.offScreenPass=!1,this._extensions=[],this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader(),this.lastCompile=0,this._moduleNames=[],this._modules=[],this._moduleNumId=0,this._libs=[],this._structNames=[],this._structUniformNames=[],this._textureStackUni=[],this._textureStackTex=[],this._textureStackType=[],this._textureStackTexCgl=[],this._tempNormalMatrix=mat4.create(),this._tempCamPosMatrix=mat4.create(),this._tempInverseViewMatrix=mat4.create(),this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"])};vt.prototype.isValid=function(){return this._isValid},vt.prototype.getCgl=function(){return this._cgl},vt.prototype.getName=function(){return this._name},vt.prototype.enableExtension=function(t){this.setWhyCompile("enable extension "+t),this._needsRecompile=!0,this._extensions.push(t)},vt.prototype.getAttrVertexPos=function(){return this._attrVertexPos},vt.prototype.hasTextureUniforms=function(){for(let t=0;t<this._uniforms.length;t++)if("t"==this._uniforms[t].getType())return!0;return!1},vt.prototype.setWhyCompile=function(t){this._compileReason=t},vt.prototype.copyUniformValues=function(t){for(let e=0;e<t._uniforms.length;e++)this._uniforms[e]?(-1!=t._uniforms[e].getName().indexOf("pathPoints")&&console.log("copyUniformValues",t._uniforms[e].getName(),t._uniforms[e].getValue()),this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())):this._log.log("unknown uniform?!");this.popTextures();for(let e=0;e<t._textureStackUni.length;e++)this._textureStackUni[e]=t._textureStackUni[e],this._textureStackTex[e]=t._textureStackTex[e],this._textureStackType[e]=t._textureStackType[e],this._textureStackTexCgl[e]=t._textureStackTexCgl[e]},vt.prototype.copy=function(){const t=new vt(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag),t._modules=JSON.parse(JSON.stringify(this._modules)),t._defines=JSON.parse(JSON.stringify(this._defines)),t._modGroupCount=this._modGroupCount,t._moduleNames=this._moduleNames,t.glPrimitive=this.glPrimitive,t.offScreenPass=this.offScreenPass,t._extensions=this._extensions,t.wireframe=this.wireframe;for(let e=0;e<this._uniforms.length;e++){this._uniforms[e].copy(t).resetLoc()}return this.setWhyCompile("copy"),t._needsRecompile=!0,t},vt.prototype.setSource=function(t,e){this.srcVert=t,this.srcFrag=e,this.setWhyCompile("Source changed"),this._needsRecompile=!0},vt.prototype._addLibs=function(t){for(const e in ut)if(t.indexOf(e)>-1){const i=new ut[e];t=t.replace("{{"+e+"}}",i.srcHeadFrag),this._libs.push(i),i.initUniforms&&i.initUniforms(this)}return t},vt.prototype.createStructUniforms=function(){let t="",e="";this._structNames=[],this._injectedStringsFrag={},this._injectedStringsVert={},this._structUniformNamesIndicesFrag=[],this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++)if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(-1===this._structNames.indexOf(this._uniforms[i]._structName)){const r="struct "+this._uniforms[i]._structName+" {".endl()+s+"};".endl().endl();"both"!==this._uniforms[i].getShaderType()&&"frag"!==this._uniforms[i].getShaderType()||(t=t.concat(r)),"both"!==this._uniforms[i].getShaderType()&&"vert"!==this._uniforms[i].getShaderType()||(e=e.concat(r)),this._structNames.push(this._uniforms[i]._structName),this._injectedStringsFrag[this._uniforms[i]._structName]=[],this._injectedStringsVert[this._uniforms[i]._structName]=[]}let r="";this._uniforms[i].comment&&(r=" // "+this._uniforms[i].comment);let n="";if(null==this._uniforms[i].getGlslTypeString()&&(n+="//"),n+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+r,"both"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsFrag[this._uniforms[i]._structName].indexOf(n)&&-1===this._injectedStringsVert[this._uniforms[i]._structName].indexOf(n)){const r=t.lastIndexOf(s),o=e.lastIndexOf(s);t=t.slice(0,r)+n+t.slice(r-1),e=e.slice(0,o)+n+e.slice(o-1),this._injectedStringsFrag[this._uniforms[i]._structName].push(n),this._injectedStringsVert[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesFrag.indexOf(i)&&this._structUniformNamesIndicesFrag.push(i),-1===this._structUniformNamesIndicesVert.indexOf(i)&&this._structUniformNamesIndicesVert.push(i)}else if("frag"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsFrag[this._uniforms[i]._structName].indexOf(n)){const e=t.lastIndexOf(s);t=t.slice(0,e)+n+t.slice(e-1),this._injectedStringsFrag[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesFrag.indexOf(i)&&this._structUniformNamesIndicesFrag.push(i)}else if("vert"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsVert[this._uniforms[i]._structName].indexOf(n)){const t=e.lastIndexOf(s);e=e.slice(0,t)+n+e.slice(t-1),this._injectedStringsVert[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesVert.indexOf(i)&&this._structUniformNamesIndicesVert.push(i)}}this._uniDeclarationsFrag=[],this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const i=this._structUniformNamesIndicesFrag[e],s="UNI "+this._uniforms[i]._structName+" "+this._uniforms[i]._structUniformName+";".endl();if(-1===this._uniDeclarationsFrag.indexOf(s)){const e="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";t=t.replace(e,""),t+=s,this._uniDeclarationsFrag.push(s)}}for(let t=0;t<this._structUniformNamesIndicesVert.length;t+=1){const i=this._structUniformNamesIndicesVert[t],s="UNI "+this._uniforms[i]._structName+" "+this._uniforms[i]._structUniformName+";".endl();if(-1===this._uniDeclarationsVert.indexOf(s)){const t="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";e=e.replace(t,""),e+=s,this._uniDeclarationsVert.push(s)}}return[e,t]},vt.prototype.compile=function(){const t=performance.now();this._cgl.profileData.profileShaderCompiles++,this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let e="";if(this._extensions)for(let t=0;t<this._extensions.length;t++)e+="#extension "+this._extensions[t]+" : enable".endl();let i="";this._defines.length&&(i="\n// cgl generated".endl());for(let t=0;t<this._defines.length;t++)i+="#define "+this._defines[t][0]+" "+this._defines[t][1]+"".endl();const s=this.createStructUniforms();if(this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]"),this._compileReason="",this._uniforms){const t=this._uniforms.map(t=>t._name),e=[];for(let i=0;i<this._uniforms.length;i++){const s=this._uniforms[i];t.indexOf(s._name,i+1)>-1&&e.push(i)}for(let t=this._uniforms.length-1;t>=0;t-=1)e.indexOf(t)>-1?this._uniforms.splice(t,1):this._uniforms[t].resetLoc()}this._cgl.printError("uniform resets"),this.hasTextureUniforms()&&(i+="#define HAS_TEXTURES".endl());let r="",n="";if(this.srcFrag||(this._log.error("[cgl shader] has no fragment source!"),this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader()),300==this.glslVersion){let t="";if(this.srcFrag.indexOf("outColor0")>-1&&(this._drawBuffers[0]=!0),this.srcFrag.indexOf("outColor1")>-1&&(this._drawBuffers[1]=!0),this.srcFrag.indexOf("outColor2")>-1&&(this._drawBuffers[2]=!0),this.srcFrag.indexOf("outColor3")>-1&&(this._drawBuffers[3]=!0),1==this._drawBuffers.length)t="out vec4 outColor;".endl(),t+="#define gl_FragColor outColor".endl();else{let e=0;t+="#define MULTI_COLORTARGETS".endl(),t+="vec4 outColor;".endl();for(let i=0;i<this._drawBuffers.length;i++)0==e&&(t+="#define gl_FragColor outColor"+i+"".endl()),t+="layout(location = "+i+") out vec4 outColor"+i+";".endl(),e++}r="#version 300 es".endl()+"// ".endl()+"// vertex shader "+this._name.endl()+"// ".endl()+"precision "+this.precision+" float;".endl()+"precision "+this.precision+" sampler2D;".endl()+"".endl()+"#define WEBGL2".endl()+"#define texture2D texture".endl()+"#define UNI uniform".endl()+"#define IN in".endl()+"#define OUT out".endl(),n="#version 300 es".endl()+"// ".endl()+"// fragment shader "+this._name.endl()+"// ".endl()+"precision "+this.precision+" float;".endl()+"precision "+this.precision+" sampler2D;".endl()+"".endl()+"#define WEBGL2".endl()+"#define texture2D texture".endl()+"#define IN in".endl()+"#define UNI uniform".endl()+t.endl()}else n="".endl()+"// ".endl()+"// fragment shader "+this._name.endl()+"// ".endl()+"#define WEBGL1".endl()+"#define texture texture2D".endl()+"#define outColor gl_FragColor".endl()+"#define IN varying".endl()+"#define UNI uniform".endl(),r="".endl()+"// ".endl()+"// vertex shader "+this._name.endl()+"// ".endl()+"#define WEBGL1".endl()+"#define texture texture2D".endl()+"#define OUT varying".endl()+"#define IN attribute".endl()+"#define UNI uniform".endl();let o="\n// cgl generated".endl(),h="\n// cgl generated".endl();n+="\n// active mods: --------------- ",r+="\n// active mods: --------------- ";let a=!1,l=!1;for(let t=0;t<this._moduleNames.length;t++)for(let e=0;e<this._modules.length;e++)this._modules[e].name==this._moduleNames[t]&&((this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag)&&(a=!0,n+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"),(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert)&&(r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")",l=!0));l||(n+="\n// no mods used..."),a||(n+="\n// no mods used..."),n+="\n",r+="\n";for(let t=0;t<this._uniforms.length;t++)if(this._uniforms[t].shaderType&&!this._uniforms[t].isStructMember()){let e="";this._uniforms[t].getGlslTypeString()||(e+="// "),e+="UNI "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName();let i="";this._uniforms[t].comment&&(i=" // "+this._uniforms[t].comment),"vert"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||-1==this.srcVert.indexOf(e)&&-1==this.srcVert.indexOf("uniform "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName())&&(o+=e+";"+i.endl()),"frag"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||-1==this.srcFrag.indexOf(e)&&-1==this.srcFrag.indexOf("uniform "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName())&&(h+=e+";"+i.endl())}let c=0,u=0;for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].shaderType&&!this._uniforms[t].isStructMember()&&("vert"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||u++,"frag"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||c++);c>=this._cgl.maxUniformsFrag&&this._log.warn("[cgl_shader] num uniforms frag: "+c+" / "+this._cgl.maxUniformsFrag),u>=this._cgl.maxUniformsVert&&this._log.warn("[cgl_shader] num uniforms vert: "+u+" / "+this._cgl.maxUniformsVert),-1==n.indexOf("precision")&&(n="precision "+this.precision+" float;".endl()+n),-1==r.indexOf("precision")&&(r="precision "+this.precision+" float;".endl()+r),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(n+="#define MOBILE".endl(),r+="#define MOBILE".endl()),r=e+r+i+s[0]+o+"\n// -- \n"+this.srcVert,n=e+n+i+s[1]+h+"\n// -- \n"+this.srcFrag;let g="",_="";this._modules.sort((function(t,e){return t.group-e.group})),this._modules.sort((function(t,e){return t.priority||0-e.priority||0}));let p=!1;for(let t=0;t<this._moduleNames.length;t++){let e="",i="";for(let s=0;s<this._modules.length;s++)if(this._modules[s].name==this._moduleNames[t]){if(g+="\n//---- MOD: group:"+this._modules[s].group+": idx:"+s+" - prfx:"+this._modules[s].prefix+" - "+this._modules[s].title+" ------\n",_+="\n//---- MOD: group:"+this._modules[s].group+": idx:"+s+" - prfx:"+this._modules[s].prefix+" - "+this._modules[s].title+" ------\n",e+="\n\n//---- MOD: "+this._modules[s].title+" / "+this._modules[s].priority+" ------\n",i+="\n\n//---- MOD: "+this._modules[s].title+" / "+this._modules[s].priority+" ------\n",!p){p=!0;for(let t=0;t<this._attributes.length;t++)this._attributes[t].name&&this._attributes[t].type&&(g+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].name.endl()+"  #define ATTRIB_"+this._attributes[t].name.endl()+"  IN "+this._attributes[t].type+" "+this._attributes[t].name+";".endl()+"#endif",this._attributes[t].nameFrag&&(g+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].nameFrag.endl()+"  #define ATTRIB_"+this._attributes[t].nameFrag.endl()+"  OUT "+this._attributes[t].type+" "+this._attributes[t].nameFrag+";".endl()+"#endif",e+="".endl()+this._attributes[t].nameFrag+"="+this._attributes[t].name+";"),_+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].nameFrag.endl()+"  #define ATTRIB_"+this._attributes[t].nameFrag.endl()+"  IN "+this._attributes[t].type+" "+this._attributes[t].nameFrag+";".endl()+"#endif")}g+=this._modules[s].srcHeadVert||"",_+=this._modules[s].srcHeadFrag||"",e+=this._modules[s].srcBodyVert||"",i+=this._modules[s].srcBodyFrag||"",g+="\n//---- end mod ------\n",_+="\n//---- end mod ------\n",e+="\n//---- end mod ------\n",i+="\n//---- end mod ------\n",e=e.replace(/{{mod}}/g,this._modules[s].prefix),i=i.replace(/{{mod}}/g,this._modules[s].prefix),g=g.replace(/{{mod}}/g,this._modules[s].prefix),_=_.replace(/{{mod}}/g,this._modules[s].prefix),e=e.replace(/MOD_/g,this._modules[s].prefix),i=i.replace(/MOD_/g,this._modules[s].prefix),g=g.replace(/MOD_/g,this._modules[s].prefix),_=_.replace(/MOD_/g,this._modules[s].prefix)}r=r.replace("{{"+this._moduleNames[t]+"}}",e),n=n.replace("{{"+this._moduleNames[t]+"}}",i)}if(r=r.replace("{{MODULES_HEAD}}",g),n=n.replace("{{MODULES_HEAD}}",_),r=this._addLibs(r),n=this._addLibs(n),this._program){this._program=this._createProgram(r,n),this._projMatrixUniform=null;for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].resetLoc()}else this._program=this._createProgram(r,n);this.finalShaderFrag=n,this.finalShaderVert=r,ht.lastMesh=null,ht.lastShader=null,this._needsRecompile=!1,this.lastCompile=_t(),this._cgl.profileData.shaderCompileTime+=performance.now()-t},vt.hasChanged=function(){return this._needsRecompile},vt.prototype.bind=function(){if(this._isValid&&(ht.lastShader=this,this._program&&!this._needsRecompile||this.compile(),this._isValid)){if(!this._projMatrixUniform){this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,ot.SHADER.SHADERVAR_VERTEX_POSITION),this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_PROJMAT),this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix"),this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_VIEWMAT),this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_MODELMAT),this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_VIEWPOS),this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_NORMALMAT),this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_INVVIEWMAT);for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].needsUpdate=!0}this._cgl.currentProgram!=this._program&&(this._cgl.profileData.profileShaderBinds++,this._cgl.gl.useProgram(this._program),this._cgl.currentProgram=this._program);for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].needsUpdate&&this._uniforms[t].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()&&(this._pMatrixState=this._cgl.getProjectionMatrixStateCount(),this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,!1,this._cgl.pMatrix),this._cgl.profileData.profileMVPMatrixCount++),this._vMatrixUniform)this._vMatrixState!=this._cgl.getViewMatrixStateCount()&&(this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,!1,this._cgl.vMatrix),this._cgl.profileData.profileMVPMatrixCount++,this._vMatrixState=this._cgl.getViewMatrixStateCount(),this._inverseViewMatrixUniform&&(mat4.invert(this._tempInverseViewMatrix,this._cgl.vMatrix),this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,!1,this._tempInverseViewMatrix),this._cgl.profileData.profileMVPMatrixCount++)),this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,!1,this._cgl.mMatrix),this._cgl.profileData.profileMVPMatrixCount++,this._camPosUniform&&(mat4.invert(this._tempCamPosMatrix,this._cgl.vMatrix),this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]),this._cgl.profileData.profileMVPMatrixCount++);else{const t=mat4.create();mat4.mul(t,this._cgl.vMatrix,this._cgl.mMatrix),this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,!1,t),this._cgl.profileData.profileMVPMatrixCount++}this._normalMatrixUniform&&(mat4.invert(this._tempNormalMatrix,this._cgl.mMatrix),mat4.transpose(this._tempNormalMatrix,this._tempNormalMatrix),this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,!1,this._tempNormalMatrix),this._cgl.profileData.profileMVPMatrixCount++);for(let t=0;t<this._libs.length;t++)this._libs[t].onBind&&this._libs[t].onBind.bind(this._libs[t])(this._cgl,this);this._bindTextures()}},vt.prototype.toggleDefine=function(t,e){e&&"object"==typeof e&&e.addEventListener&&(e.changeListener&&e.removeEventListener(e.changeListener),e.onToggleDefine=e=>{this.toggleDefine(t,e)},e.changeListener=e.on("change",e.onToggleDefine),e=e.get()),e?this.define(t):this.removeDefine(t)},vt.prototype.define=function(t,e){null==e&&(e=""),"object"==typeof e&&(e.removeEventListener("change",e.onDefineChange),e.onDefineChange=e=>{this.define(t,e)},e.on("change",e.onDefineChange),e=e.get());for(let i=0;i<this._defines.length;i++){if(this._defines[i][0]==t&&this._defines[i][1]==e)return;if(this._defines[i][0]==t)return this._defines[i][1]=e,this.setWhyCompile("define "+t+" "+e),void(this._needsRecompile=!0)}this.setWhyCompile("define "+t+" "+e),this._needsRecompile=!0,this._defines.push([t,e])},vt.prototype.getDefines=function(){return this._defines},vt.prototype.getDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null},vt.prototype.hasDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return!0},vt.prototype.removeDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines.splice(e,1),this._needsRecompile=!0,void this.setWhyCompile("define removed:"+t)},vt.prototype.removeModule=function(t){for(let e=0;e<this._modules.length;e++)if(t&&t.id&&(this._modules[e].id==t.id||!this._modules[e])){let i=!0;for(;i;){i=!1;for(let e=0;e<this._uniforms.length;e++)0!=this._uniforms[e].getName().indexOf(t.prefix)||(this._uniforms.splice(e,1),i=!0)}this._needsRecompile=!0,this.setWhyCompile("remove module "+t.title),this._modules.splice(e,1);break}},vt.prototype.getNumModules=function(){return this._modules.length},vt.prototype.getCurrentModules=function(){return this._modules},vt.prototype.addModule=function(t,e){return t.id||(t.id=A()),t.numId||(t.numId=this._moduleNumId),t.num||(t.num=this._modules.length),e&&!e.group&&(e.group=y()),t.group||(t.group=e?e.group:y()),t.prefix="mod"+t.group+"_",this._modules.push(t),this._needsRecompile=!0,this.setWhyCompile("add module "+t.title),this._moduleNumId++,t},vt.prototype.hasModule=function(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return!0;return!1},vt.prototype.setModules=function(t){this._moduleNames=t},vt.prototype.dispose=function(){this._cgl.gl.deleteProgram(this._program)},vt.prototype.needsRecompile=function(){return this._needsRecompile},vt.prototype.setDrawBuffers=function(t){if(this._drawBuffers.length!==t.length)return this._drawBuffers=t,this._needsRecompile=!0,void this.setWhyCompile("setDrawBuffers");for(let e=0;e<t;e++)if(t[e]!==this._drawBuffers[e])return this._drawBuffers=t,this._needsRecompile=!0,void this.setWhyCompile("setDrawBuffers")},vt.prototype.getUniforms=function(){return this._uniforms},vt.prototype.getUniform=function(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null},vt.prototype.removeUniform=function(t){for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].getName()==t&&this._uniforms.splice(e,1);this._needsRecompile=!0,this.setWhyCompile("remove uniform "+t)},vt.prototype._addUniform=function(t){this._uniforms.push(t),this.setWhyCompile("add uniform "+name),this._needsRecompile=!0},vt.prototype.addUniformFrag=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="frag",o},vt.prototype.addUniformVert=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="vert",o},vt.prototype.addUniformBoth=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="both",o},vt.prototype.addUniformStructFrag=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if(!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="frag",s[e+"."+n.name]=i}}return s},vt.prototype.addUniformStructVert=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if(!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="vert",s[e+"."+n.name]=i}}return s},vt.prototype.addUniformStructBoth=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if("2i"!==n.type&&"i"!==n.type&&"3i"!==n.type||this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",n.name," of type:",n.type,"."),!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="both",s[e+"."+n.name]=i}}return s},vt.prototype.hasUniform=function(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return!0;return!1},vt.prototype._createProgram=function(t,e){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();return this.vshader=vt.createShader(this._cgl,t,this._cgl.gl.VERTEX_SHADER,this),this.fshader=vt.createShader(this._cgl,e,this._cgl.gl.FRAGMENT_SHADER,this),this._cgl.gl.attachShader(i,this.vshader),this._cgl.gl.attachShader(i,this.fshader),this._linkProgram(i,t,e),this._cgl.printError("shader _createProgram"),i},vt.prototype.hasErrors=function(){return this._hasErrors},vt.prototype._linkProgram=function(t,e,i){this._cgl.printError("before _linkprogram"),this._feedBackNames.length>0&&this._cgl.gl.transformFeedbackVaryings(t,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS),this._cgl.gl.linkProgram(t),this._cgl.printError("gl.linkprogram"),this._isValid=!0,this._hasErrors=!1,!1!==this._cgl.patch.config.glValidateShader&&(this._cgl.gl.validateProgram(t),this._cgl.gl.getProgramParameter(t,this._cgl.gl.VALIDATE_STATUS)||(console.log("shaderprogram validation failed..."),console.log(this._name+" programinfo: ",this._cgl.gl.getProgramInfoLog(t))),this._cgl.gl.getProgramParameter(t,this._cgl.gl.LINK_STATUS)||(this._hasErrors=!0,this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader)||"empty shader infolog"),this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader)||"empty shader infolog"),this._log.error(this._name+" shader linking fail..."),console.log(this._name+" programinfo: ",this._cgl.gl.getProgramInfoLog(t)),console.log("--------------------------------------"),console.log(this),console.log("--------------------------------------"),this._isValid=!1,this._name="errorshader",this.setSource(vt.getDefaultVertexShader(),vt.getErrorFragmentShader()),this._cgl.printError("shader link err")))},vt.prototype.getProgram=function(){return this._program},vt.prototype.setFeedbackNames=function(t){this.setWhyCompile("setFeedbackNames"),this._needsRecompile=!0,this._feedBackNames=t},vt.prototype.getDefaultVertexShader=vt.getDefaultVertexShader=function(){return"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},vt.prototype.getDefaultFragmentShader=vt.getDefaultFragmentShader=function(t,e,i){return null==t&&(t=.5,e=.5,i=.5),"".endl()+"IN vec2 texCoord;".endl()+"{{MODULES_HEAD}}".endl()+"void main()".endl()+"{".endl()+"    vec4 col=vec4("+t+","+e+","+i+",1.0);".endl()+"    {{MODULE_COLOR}}".endl()+"    outColor = col;".endl()+"}"},vt.prototype.addAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return;this._attributes.push(t),this._needsRecompile=!0,this.setWhyCompile("addAttribute")},vt.prototype.bindTextures=vt.prototype._bindTextures=function(){this._textureStackTex.length>this._cgl.maxTextureUnits&&this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits);for(let t=0;t<this._textureStackTex.length;t++)if(this._textureStackTex[t]||this._textureStackTexCgl[t]){let e=this._textureStackTex[t];this._textureStackTexCgl[t]&&(e=this._textureStackTexCgl[t].tex||CGL.Texture.getEmptyTexture(this._cgl).tex);let i=!0;this._textureStackUni[t]?(this._textureStackUni[t].setValue(t),i=this._cgl.setTexture(t,e,this._textureStackType[t])):(this._log.warn("no uniform for pushtexture",this._name),i=this._cgl.setTexture(t,e,this._textureStackType[t])),i||this._log.warn("tex bind failed",this.getName(),this._textureStackUni[t])}else this._log.warn("no texture for pushtexture",this._name)},vt.prototype.setUniformTexture=function(t,e){for(let i=0;i<this._textureStackTex.length;i++)if(this._textureStackUni[i]==t){const t=this._textureStackTex[i];return this._textureStackTex[i]=e,t}return null},vt.prototype.pushTexture=function(t,e,i){if(!t)throw new Error("no uniform given to texturestack");if(e){if(!(e.hasOwnProperty("tex")||e instanceof WebGLTexture))return this._log.warn(new Error("invalid texture").stack),void this._log.warn("[cgl_shader] invalid texture...",e);this._textureStackUni.push(t),e.hasOwnProperty("tex")?(this._textureStackTexCgl.push(e),this._textureStackTex.push(null)):(this._textureStackTexCgl.push(null),this._textureStackTex.push(e)),this._textureStackType.push(i)}},vt.prototype.popTexture=function(){this._textureStackUni.pop(),this._textureStackTex.pop(),this._textureStackType.pop()},vt.prototype.popTextures=function(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0},vt.prototype.getInfo=function(){const t={};return t.name=this._name,t.defines=this.getDefines(),t.hasErrors=this.hasErrors(),t},vt.getErrorFragmentShader=function(){return"".endl()+"void main()".endl()+"{".endl()+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;".endl()+"   g= step(0.1,g);".endl()+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);".endl()+"}"},vt.createShader=function(t,e,i,s){if(t.aborted)return;const r=t.gl.createShader(i);if(t.gl.shaderSource(r,e),t.gl.compileShader(r),!t.gl.getShaderParameter(r,t.gl.COMPILE_STATUS)){console.log("compile status: "),i==t.gl.VERTEX_SHADER&&console.log("VERTEX_SHADER"),i==t.gl.FRAGMENT_SHADER&&console.log("FRAGMENT_SHADER");let o=t.gl.getShaderInfoLog(r)||"empty shader info log";const h=function(t){const e=[],i=t.split("\n");for(const t in i){const s=i[t].split(":");parseInt(s[2],10)&&e.push(parseInt(s[2],10))}return e}(o);let a='<div class="shaderErrorCode">';const l=e.match(/^.*((\r\n|\n|\r)|$)/gm);for(const t in l){const e=parseInt(t,10)+1,i=e+": "+l[t];console.log(i);let s=!1;for(const t in h)h[t]==e&&(s=!0);s&&(a+='<span class="error">'),a+=(n=i)&&yt.test(n)?n.replace(bt,(function(t){return At[t]})):n||"",s&&(a+="</span>")}console.warn(o),o=o.replace(/\n/g,"<br/>"),a=o+"<br/>"+a+"<br/><br/>",a+="</div>",t.patch.emitEvent("criticalError","Shader error "+this._name,a),t.patch.isEditorMode()&&console.log("Shader error "+this._name,a),this._name="errorshader",s.setSource(vt.getDefaultVertexShader(),vt.getErrorFragmentShader())}var n;return r};const xt=function(){this._arr=[mat4.create()],this._index=0,this.stateCounter=0};xt.prototype.push=function(t){if(this._index++,this.stateCounter++,this._index==this._arr.length){const t=mat4.create();this._arr.push(t)}return mat4.copy(this._arr[this._index],t||this._arr[this._index-1]),this._arr[this._index]},xt.prototype.pop=function(){return this.stateCounter++,this._index--,this._index<0&&(this._index=0),this._arr[this._index]},xt.prototype.length=function(){return this._index};class It{constructor(t){this._cgl=t,this._lastTime=0,this.pause=!1,this.profileUniformCount=0,this.profileShaderBinds=0,this.profileUniformCount=0,this.profileShaderCompiles=0,this.profileVideosPlaying=0,this.profileMVPMatrixCount=0,this.profileEffectBuffercreate=0,this.profileShaderGetUniform=0,this.profileFrameBuffercreate=0,this.profileMeshSetGeom=0,this.profileTextureNew=0,this.profileGenMipMap=0,this.profileOnAnimFrameOps=0,this.profileMainloopMs=0,this.profileMeshDraw=0,this.profileTextureEffect=0,this.profileTexPreviews=0,this.shaderCompileTime=0,this.profileMeshNumElements=0,this.profileMeshAttributes=0,this.profileSingleMeshAttribute=[],this.heavyEvents=[],this.doProfileGlQuery=!1,this.glQueryData={}}clear(){this.profileSingleMeshAttribute={},this.profileMeshAttributes=0,this.profileUniformCount=0,this.profileShaderGetUniform=0,this.profileShaderCompiles=0,this.profileShaderBinds=0,this.profileTextureResize=0,this.profileFrameBuffercreate=0,this.profileEffectBuffercreate=0,this.profileTextureDelete=0,this.profileMeshSetGeom=0,this.profileVideosPlaying=0,this.profileMVPMatrixCount=0,this.profileNonTypedAttrib=0,this.profileNonTypedAttribNames="",this.profileTextureNew=0,this.profileGenMipMap=0,this.profileFramebuffer=0,this.profileMeshDraw=0,this.profileTextureEffect=0,this.profileTexPreviews=0,this.profileMeshNumElements=0}clearGlQuery(){for(let t in this.glQueryData)(!this.glQueryData[t].lastClear||performance.now()-this.glQueryData[t].lastClear>1e3)&&(this.glQueryData[t].time=this.glQueryData[t]._times/this.glQueryData[t]._numcount,this.glQueryData[t].num=this.glQueryData[t]._numcount,this.glQueryData[t]._times=0,this.glQueryData[t]._numcount=0,this.glQueryData[t].lastClear=performance.now())}addHeavyEvent(t,e,i){const s={event:t,name:e,info:i,date:performance.now()};this.heavyEvents.push(s),this._cgl.emitEvent("heavyEvent",s)}}const Ot=function(t){W.apply(this),this.profileData=new It(this),this._log=new h("cgl_context");const e=[0,0,0,0];this.glVersion=0,this.glUseHalfFloatTex=!1,this.clearCanvasTransparent=!0,this.clearCanvasDepth=!0,this.patch=t,this.debugOneFrame=!1,this.checkGlErrors=!0,this.maxTextureUnits=0,this.maxVaryingVectors=0,this.currentProgram=null,this._hadStackError=!1,this.glSlowRenderer=!1,this._isSafariCrap=!1,this.temporaryTexture=null,this.frameStore={},this._onetimeCallbacks=[],this.gl=null,this._cursor="auto",this._currentCursor="",this.pMatrix=mat4.create(),this.mMatrix=mat4.create(),this.vMatrix=mat4.create(),this._textureslots=[],this._pMatrixStack=new xt,this._mMatrixStack=new xt,this._vMatrixStack=new xt,this._glFrameBufferStack=[],this._frameBufferStack=[],this._shaderStack=[],this._stackDepthTest=[],Object.defineProperty(this,"mvMatrix",{get(){return this.mMatrix},set(t){this.mMatrix=t}}),this.canvas=null,this.pixelDensity=1,mat4.identity(this.mMatrix),mat4.identity(this.vMatrix);const i=new vt(this,"simpleshader");i.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]),i.setSource(vt.getDefaultVertexShader(),vt.getDefaultFragmentShader());let s=i;this.aborted=!1;const r=[];this.exitError=function(t,e){this.patch.exitError(t,e),this.aborted=!0},this.setCanvas=function(t){if(this.canvas="string"==typeof t?document.getElementById(t):t,this.patch.config.canvas||(this.patch.config.canvas={}),this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer")||(this.patch.config.canvas.preserveDrawingBuffer=!1),this.patch.config.canvas.hasOwnProperty("premultipliedAlpha")||(this.patch.config.canvas.premultipliedAlpha=!1),this.patch.config.canvas.hasOwnProperty("alpha")||(this.patch.config.canvas.alpha=!1),this.patch.config.hasOwnProperty("clearCanvasColor")&&(this.clearCanvasTransparent=this.patch.config.clearCanvasColor),this.patch.config.hasOwnProperty("clearCanvasDepth")&&(this.clearCanvasDepth=this.patch.config.clearCanvasDepth),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(this._isSafariCrap=!0),this.patch.config.canvas.forceWebGl1||(this.gl=this.canvas.getContext("webgl2",this.patch.config.canvas)),this.gl&&"WebGL 1.0"!=this.gl.getParameter(this.gl.VERSION)?this.glVersion=2:(this.gl=this.canvas.getContext("webgl",this.patch.config.canvas)||this.canvas.getContext("experimental-webgl",this.patch.config.canvas),this.glVersion=1,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this.glUseHalfFloatTex=!0),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(this.patch.config.canvas.hasOwnProperty("powerPreference")||(this.patch.config.canvas.powerPreference="high-performance"))),!this.gl)return void this.exitError("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");const e=this.gl.getExtension("WEBGL_debug_renderer_info");e&&(this.glRenderer=this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL),"Google SwiftShader"===this.glRenderer&&(this.glSlowRenderer=!0)),this.gl.getExtension("OES_standard_derivatives");const i=this.gl.getExtension("ANGLE_instanced_arrays")||this.gl;this.canvas.addEventListener("webglcontextlost",t=>{this._log.error("canvas lost...",t),this.emitEvent("webglcontextlost"),this.aborted=!0}),this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS),this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS),this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS),this.maxSamples=0,this.gl.MAX_SAMPLES&&(this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES)),i.vertexAttribDivisorANGLE&&(this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i),this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)),this.updateSize()},this.getInfo=function(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}},this.updateSize=function(){this.canvas.width=this.canvasWidth=this.canvas.clientWidth*this.pixelDensity,this.canvas.height=this.canvasHeight=this.canvas.clientHeight*this.pixelDensity},this.canvasWidth=-1,this.canvasHeight=-1,this.canvasScale=1;let n=-1,o=-1;this.getViewPort=function(){return e},this.resetViewPort=function(){this.gl.viewport(e[0],e[1],e[2],e[3])},this.setViewPort=function(t,i,s,r){e[0]=Math.round(t),e[1]=Math.round(i),e[2]=Math.round(s),e[3]=Math.round(r),this.gl.viewport(e[0],e[1],e[2],e[3])},this.screenShot=function(t,e,i,s){e&&(this.gl.clearColor(1,1,1,1),this.gl.colorMask(!1,!1,!1,!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.colorMask(!0,!0,!0,!0)),this.canvas&&this.canvas.toBlob&&this.canvas.toBlob(e=>{t?t(e):this._log.log("no screenshot callback...")},i,s)},this.endFrame=function(){if(this.patch.isEditorMode()&&CABLES.GL_MARKER.drawMarkerLayer(this),this.setPreviousShader(),this._vMatrixStack.length()>0&&this.logStackError("view matrix stack length !=0 at end of rendering..."),this._mMatrixStack.length()>0&&this.logStackError("mvmatrix stack length !=0 at end of rendering..."),this._pMatrixStack.length()>0&&this.logStackError("pmatrix stack length !=0 at end of rendering..."),this._glFrameBufferStack.length>0&&this.logStackError("glFrameBuffer stack length !=0 at end of rendering..."),this._stackDepthTest.length>0&&this.logStackError("depthtest stack length !=0 at end of rendering..."),this._stackDepthWrite.length>0&&this.logStackError("depthwrite stack length !=0 at end of rendering..."),this._stackDepthFunc.length>0&&this.logStackError("depthfunc stack length !=0 at end of rendering..."),this._stackBlend.length>0&&this.logStackError("blend stack length !=0 at end of rendering..."),this._stackBlendMode.length>0&&this.logStackError("blendMode stack length !=0 at end of rendering..."),this._shaderStack.length>0&&this.logStackError("this._shaderStack length !=0 at end of rendering..."),this._stackCullFace.length>0&&this.logStackError("this._stackCullFace length !=0 at end of rendering..."),this._stackCullFaceFacing.length>0&&this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering..."),this._frameStarted=!1,n!=this.canvasWidth||o!=this.canvasHeight){n=this.canvasWidth,o=this.canvasHeight,this.setSize(this.canvasWidth/this.pixelDensity,this.canvasHeight/this.pixelDensity),this.updateSize();for(let t=0;t<r.length;t++)r[t]();this.emitEvent("resize")}this._cursor!=this._currentCursor&&(this._currentCursor=this.canvas.style.cursor=this._cursor)},this.logStackError=function(t){this._hadStackError||(this._hadStackError=!0,this._log.warn("["+this.canvas.id+"]: ",t))},this.getShader=function(){if(s&&(!this.frameStore||!0===this.frameStore.renderOffscreen==s.offScreenPass==!0))return s;for(let t=this._shaderStack.length-1;t>=0;t--)if(this._shaderStack[t]&&this.frameStore.renderOffscreen==this._shaderStack[t].offScreenPass)return this._shaderStack[t]},this.getDefaultShader=function(){return i},this.pushShader=this.setShader=function(t){this._shaderStack.push(t),s=t},this.popShader=this.setPreviousShader=function(){if(0===this._shaderStack.length)throw new Error("Invalid shader stack pop!");this._shaderStack.pop(),s=this._shaderStack[this._shaderStack.length-1]},this.pushGlFrameBuffer=function(t){this._glFrameBufferStack.push(t)},this.popGlFrameBuffer=function(){return 0==this._glFrameBufferStack.length?null:(this._glFrameBufferStack.pop(),this._glFrameBufferStack[this._glFrameBufferStack.length-1])},this.getCurrentGlFrameBuffer=function(){return 0===this._glFrameBufferStack.length?null:this._glFrameBufferStack[this._glFrameBufferStack.length-1]},this.pushFrameBuffer=function(t){this._frameBufferStack.push(t)},this.popFrameBuffer=function(){return 0==this._frameBufferStack.length?null:(this._frameBufferStack.pop(),this._frameBufferStack[this._frameBufferStack.length-1])},this.getCurrentFrameBuffer=function(){return 0===this._frameBufferStack.length?null:this._frameBufferStack[this._frameBufferStack.length-1]};const a=vec3.create();vec3.set(a,0,0,2);const l=vec3.create();vec3.set(l,0,0,0),this.renderStart=function(t,e,s){e||(e=l),s||(s=a),this.pushDepthTest(!0),this.pushDepthWrite(!0),this.pushDepthFunc(t.gl.LEQUAL),this.pushCullFaceFacing(t.gl.BACK),this.pushCullFace(!1),this.clearCanvasTransparent&&(t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT)),this.clearCanvasDepth&&t.gl.clear(t.gl.DEPTH_BUFFER_BIT),t.setViewPort(0,0,t.canvasWidth,t.canvasHeight),mat4.perspective(t.pMatrix,45,t.canvasWidth/t.canvasHeight,.1,1e3),mat4.identity(t.mMatrix),mat4.identity(t.vMatrix),mat4.translate(t.mMatrix,t.mMatrix,e),mat4.translate(t.vMatrix,t.vMatrix,s),t.pushPMatrix(),t.pushModelMatrix(),t.pushViewMatrix(),t.pushBlendMode(ot.BLEND_MODES.BLEND_NORMAL,!1);for(let t=0;t<this._textureslots.length;t++)this._textureslots[t]=null;if(this.pushShader(i),this._frameStarted=!0,this._onetimeCallbacks.length>0){for(let t=0;t<this._onetimeCallbacks.length;t++)this._onetimeCallbacks[t]();this._onetimeCallbacks.length=0}this.emitEvent("beginFrame")},this.renderEnd=function(t){t.popViewMatrix(),t.popModelMatrix(),t.popPMatrix(),this.popDepthTest(),this.popDepthWrite(),this.popDepthFunc(),this.popCullFaceFacing(),this.popCullFace(),this.popBlend(),this.popBlendMode(),t.endFrame(),this.emitEvent("endFrame")},this.getTexture=function(t){return this._textureslots[t]},this.checkFrameStarted=function(t){this._frameStarted||(this._log.warn("frame not started "+t),this.patch.printTriggerStack())},this.setTexture=function(t,e,i){return this.checkFrameStarted("cgl setTexture"),null===e&&(e=CGL.Texture.getEmptyTexture(this).tex),this._textureslots[t]!=e&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(i||this.gl.TEXTURE_2D,e),this._textureslots[t]=e),!0},this.fullScreen=function(){this.canvas.requestFullscreen?this.canvas.requestFullscreen():this.canvas.mozRequestFullScreen?this.canvas.mozRequestFullScreen():this.canvas.webkitRequestFullscreen?this.canvas.webkitRequestFullscreen():this.canvas.msRequestFullscreen&&this.canvas.msRequestFullscreen()},this.setSize=function(t,e,i){i||(this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"),this.canvas.width=t*this.pixelDensity,this.canvas.height=e*this.pixelDensity,this.updateSize()},this._resizeToWindowSize=function(){this.setSize(window.innerWidth,window.innerHeight),this.updateSize()},this._resizeToParentSize=function(){const t=this.canvas.parentElement;t?(this.setSize(t.clientWidth,t.clientHeight),this.updateSize()):this._log.error("cables: can not resize to container element")},this.setAutoResize=function(t){window.removeEventListener("resize",this._resizeToWindowSize.bind(this)),window.removeEventListener("resize",this._resizeToParentSize.bind(this)),"window"==t&&(window.addEventListener("resize",this._resizeToWindowSize.bind(this)),window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this)),this._resizeToWindowSize()),"parent"==t&&(window.addEventListener("resize",this._resizeToParentSize.bind(this)),this._resizeToParentSize())},this.printError=function(t){if(!this.checkGlErrors)return;let e=!1,i=this.gl.getError();if(i!=this.gl.NO_ERROR){let s="";i==this.gl.OUT_OF_MEMORY&&(s="OUT_OF_MEMORY"),i==this.gl.INVALID_ENUM&&(s="INVALID_ENUM"),i==this.gl.INVALID_OPERATION&&(s="INVALID_OPERATION"),i==this.gl.INVALID_FRAMEBUFFER_OPERATION&&(s="INVALID_FRAMEBUFFER_OPERATION"),i==this.gl.INVALID_VALUE&&(s="INVALID_VALUE"),i==this.gl.CONTEXT_LOST_WEBGL&&(this.aborted=!0,s="CONTEXT_LOST_WEBGL"),i==this.gl.NO_ERROR&&(s="NO_ERROR"),e=!0,this._log.warn("gl error ["+this.canvas.id+"]: ",t,i,s),-1==this.canvas.id.indexOf("glGuiCanvas")&&(this._loggedGlError||(this.patch.printTriggerStack(),this._log.stack("glerror"),this._loggedGlError=!0))}return i=this.gl.getError(),e},this.saveScreenshot=function(t,e,i,s,r){this.patch.renderOneFrame();let n=this.canvas.clientWidth,o=this.canvas.clientHeight;function h(t,e,i){return Array(e-String(t).length+1).join(i||"0")+t}i&&(this.canvas.width=i,n=i),s&&(this.canvas.height=s,o=s);const a=new Date,l="".concat(String(a.getFullYear())+String(a.getMonth()+1)+String(a.getDate()),"_").concat(h(a.getHours(),2)).concat(h(a.getMinutes(),2)).concat(h(a.getSeconds(),2));t?t+=".png":t="cables_"+l+".png",this.patch.cgl.screenShot(function(i){if(this.canvas.width=n,this.canvas.height=o,i){const s=document.createElement("a");s.download=t,s.href=URL.createObjectURL(i),setTimeout((function(){s.click(),e&&e(i)}),100)}else this._log.log("screenshot: no blob")}.bind(this),r)}};Ot.prototype.addNextFrameOnceCallback=function(t){t&&this._onetimeCallbacks.push(t)},Ot.prototype.pushViewMatrix=function(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)},Ot.prototype.popViewMatrix=function(){this.vMatrix=this._vMatrixStack.pop()},Ot.prototype.getViewMatrixStateCount=function(){return this._vMatrixStack.stateCounter},Ot.prototype.pushPMatrix=function(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)},Ot.prototype.popPMatrix=function(){return this.pMatrix=this._pMatrixStack.pop(),this.pMatrix},Ot.prototype.getProjectionMatrixStateCount=function(){return this._pMatrixStack.stateCounter},Ot.prototype.pushMvMatrix=Ot.prototype.pushModelMatrix=function(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)},Ot.prototype.popMvMatrix=Ot.prototype.popmMatrix=Ot.prototype.popModelMatrix=function(){return this.mMatrix=this._mMatrixStack.pop(),this.mMatrix},Ot.prototype.modelMatrix=function(){return this.mMatrix},Ot.prototype._stackDepthTest=[],Ot.prototype.pushDepthTest=function(t){this._stackDepthTest.push(t),t?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)},Ot.prototype.stateDepthTest=function(){return this._stackDepthTest[this._stackDepthTest.length-1]},Ot.prototype.popDepthTest=function(){this._stackDepthTest.pop(),this._stackDepthTest[this._stackDepthTest.length-1]?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)},Ot.prototype._stackDepthWrite=[],Ot.prototype.pushDepthWrite=function(t){t=t||!1,this._stackDepthWrite.push(t),this.gl.depthMask(t)},Ot.prototype.stateDepthWrite=function(){return this._stackDepthWrite[this._stackDepthWrite.length-1]},Ot.prototype.popDepthWrite=function(){this._stackDepthWrite.pop(),this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||!1)},Ot.prototype._stackCullFace=[],Ot.prototype.pushCullFace=function(t){this._stackCullFace.push(t),t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE)},Ot.prototype.stateCullFace=function(){return this._stackCullFace[this._stackCullFace.length-1]},Ot.prototype.popCullFace=function(){this._stackCullFace.pop(),this._stackCullFace[this._stackCullFace.length-1]?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE)},Ot.prototype._stackCullFaceFacing=[],Ot.prototype.pushCullFaceFacing=function(t){this._stackCullFaceFacing.push(t),this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])},Ot.prototype.stateCullFaceFacing=function(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]},Ot.prototype.popCullFaceFacing=function(){this._stackCullFaceFacing.pop(),this._stackCullFaceFacing.length>0&&this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])},Ot.prototype._stackDepthFunc=[],Ot.prototype.pushDepthFunc=function(t){this._stackDepthFunc.push(t),this.gl.depthFunc(t)},Ot.prototype.stateDepthFunc=function(){return this._stackDepthFunc.length>0&&this._stackDepthFunc[this._stackDepthFunc.length-1]},Ot.prototype.popDepthFunc=function(){this._stackDepthFunc.pop(),this._stackDepthFunc.length>0&&this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])},Ot.prototype._stackBlend=[],Ot.prototype.pushBlend=function(t){this._stackBlend.push(t),t?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND)},Ot.prototype.popBlend=function(){this._stackBlend.pop(),this._stackBlend[this._stackBlend.length-1]?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND)},Ot.prototype.stateBlend=function(){return this._stackBlend[this._stackBlend.length-1]};Ot.prototype._stackBlendMode=[],Ot.prototype._stackBlendModePremul=[],Ot.prototype.pushBlendMode=function(t,e){this._stackBlendMode.push(t),this._stackBlendModePremul.push(e);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==ot.BLEND_MODES.BLEND_NONE),this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])},Ot.prototype.popBlendMode=function(){this._stackBlendMode.pop(),this._stackBlendModePremul.pop();const t=this._stackBlendMode.length-1;this.popBlend(this._stackBlendMode[t]!==ot.BLEND_MODES.BLEND_NONE),t>=0&&this._setBlendMode(this._stackBlendMode[t],this._stackBlendModePremul[t])},Ot.prototype.glGetAttribLocation=function(t,e){return this.gl.getAttribLocation(t,e)},Ot.prototype.shouldDrawHelpers=function(t){return!this.frameStore.shadowPass&&(!!t.patch.isEditorMode()&&(CABLES.UI.renderHelper||CABLES.UI.renderHelperCurrent&&t.isCurrentUiOp()))},Ot.prototype._setBlendMode=function(t,e){const i=this.gl;t==ot.BLEND_MODES.BLEND_NONE||(t==ot.BLEND_MODES.BLEND_ADD?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE)):t==ot.BLEND_MODES.BLEND_SUB?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)):t==ot.BLEND_MODES.BLEND_MUL?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ZERO,i.SRC_COLOR)):t==ot.BLEND_MODES.BLEND_NORMAL?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)):(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)):this._log.log("setblendmode: unknown blendmode"))},Ot.prototype.setCursor=function(t){this._cursor=t};const Rt=Object.assign({Framebuffer:function(t,e,i,s){const r=t;this._log=new h("Framebuffer");const n=r.gl.getExtension("WEBGL_depth_texture")||r.gl.getExtension("WEBKIT_WEBGL_depth_texture")||r.gl.getExtension("MOZ_WEBGL_depth_texture")||r.gl.DEPTH_TEXTURE;n||r.exitError("NO_DEPTH_TEXTURE","no depth texture support");let o=e||512,a=i||512;(s=s||{isFloatingPointTexture:!1}).hasOwnProperty("clear")||(s.clear=!0),s.hasOwnProperty("filter")||(s.filter=L.FILTER_LINEAR);const l=new L(r,{isFloatingPointTexture:s.isFloatingPointTexture,filter:s.filter,wrap:s.wrap||L.CLAMP_TO_EDGE});let c=null;n&&(c=new L(r,{isDepthTexture:!0})),this._options=s;const u=r.gl.createFramebuffer(),g=r.gl.createRenderbuffer();this.getWidth=function(){return o},this.getHeight=function(){return a},this.getGlFrameBuffer=function(){return u},this.getDepthRenderBuffer=function(){return g},this.getTextureColor=function(){return l},this.getTextureDepth=function(){return c},this.setFilter=function(t){l.filter=t,l.setSize(o,a)},this.setSize=function(t,e){if(t<2&&(t=2),e<2&&(e=2),o=Math.ceil(t),a=Math.ceil(e),r.profileData.profileFrameBuffercreate++,r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,u),r.gl.bindRenderbuffer(r.gl.RENDERBUFFER,g),l.setSize(o,a),c&&c.setSize(o,a),n&&r.gl.renderbufferStorage(r.gl.RENDERBUFFER,r.gl.DEPTH_COMPONENT16,o,a),r.gl.framebufferTexture2D(r.gl.FRAMEBUFFER,r.gl.COLOR_ATTACHMENT0,r.gl.TEXTURE_2D,l.tex,0),n&&(r.gl.framebufferRenderbuffer(r.gl.FRAMEBUFFER,r.gl.DEPTH_ATTACHMENT,r.gl.RENDERBUFFER,g),r.gl.framebufferTexture2D(r.gl.FRAMEBUFFER,r.gl.DEPTH_ATTACHMENT,r.gl.TEXTURE_2D,c.tex,0)),!r.gl.isFramebuffer(u))throw new Error("Invalid framebuffer");const i=r.gl.checkFramebufferStatus(r.gl.FRAMEBUFFER);switch(i){case r.gl.FRAMEBUFFER_COMPLETE:break;case r.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",o,a,l.tex,g),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case r.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case r.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case r.gl.FRAMEBUFFER_UNSUPPORTED:throw this._log.warn("FRAMEBUFFER_UNSUPPORTED"),new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");case 36059:this._log.warn("Incomplete: FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER from ext. Or Safari/iOS undefined behaviour.");break;default:throw this._log.warn("incomplete framebuffer",i),new Error("Incomplete framebuffer: "+i)}r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindRenderbuffer(r.gl.RENDERBUFFER,null),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,null)},this.renderStart=function(){r.pushModelMatrix(),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,u),r.pushGlFrameBuffer(u),r.pushFrameBuffer(this),r.pushPMatrix(),r.gl.viewport(0,0,o,a),this._options.clear&&(r.gl.clearColor(0,0,0,0),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT))},this.renderEnd=function(){r.popPMatrix(),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,r.popGlFrameBuffer()),r.popFrameBuffer(),r.popModelMatrix(),r.resetViewPort()},this.delete=function(){l.delete(),c&&c.delete(),r.gl.deleteRenderbuffer(g),r.gl.deleteFramebuffer(u)},this.setSize(o,a)},Framebuffer2:B,Geometry:Y,BoundingBox:z,Marker:function(t){const e=new Y("marker");e.setPointVertices([1e-5,0,0,1,0,0,0,1e-5,0,0,1,0,0,0,1e-5,0,0,1]);const i=new at(t,e,t.gl.LINES);i.setGeom(e);const s=new vt(t,"markermaterial"),r="".endl()+"precision highp float;".endl()+"IN vec3 axisColor;".endl()+"void main()".endl()+"{".endl()+"    vec4 col=vec4(axisColor,1.0);".endl()+"    outColor = col;".endl()+"}",n="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"OUT vec3 axisColor;".endl()+"void main()".endl()+"{".endl()+"   vec4 pos=vec4(vPosition, 1.0);".endl()+"   if(pos.x!=0.0)axisColor=vec3(1.0,0.3,0.0);".endl()+"   if(pos.y!=0.0)axisColor=vec3(0.0,1.0,0.2);".endl()+"   if(pos.z!=0.0)axisColor=vec3(0.0,0.5,1.0);".endl()+"   gl_Position = projMatrix * mvMatrix * pos;".endl()+"}";s.setSource(n,r),this._vScale=vec3.create(),this.draw=function(t,e,r){const n=e||2;t.pushModelMatrix(),t.pushShader(s),vec3.set(this._vScale,n,n,n),mat4.scale(t.mvMatrix,t.mvMatrix,this._vScale),t.pushDepthTest(1==r),i.render(t.getShader()),t.popDepthTest(),t.popShader(),t.popModelMatrix()}},WirePoint:function(t){const e=t.gl.createBuffer(),i=vec3.create();this.render=function(t,s){t.pushModelMatrix(),vec3.set(i,s,s,s),mat4.scale(t.mvMatrix,t.mvMatrix,i);const r=t.getShader();r&&(r.bind(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.vertexAttribPointer(r.getAttrVertexPos(),e.itemSize,t.gl.FLOAT,!1,0,0),t.gl.enableVertexAttribArray(r.getAttrVertexPos()),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.drawArrays(t.gl.LINE_STRIP,0,e.numItems)),t.popModelMatrix()},function(){const i=[];let s=0,r=0;for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(.5*Math.cos(r)),i.push(0),i.push(.5*Math.sin(r));for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(.5*Math.cos(r)),i.push(.5*Math.sin(r)),i.push(0);for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(0),i.push(.5*Math.cos(r)),i.push(.5*Math.sin(r));t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(i),t.gl.STATIC_DRAW),e.itemSize=3,e.numItems=i.length/e.itemSize}()},WireCube:function(t){const e=t.gl.createBuffer(),i=vec3.create();this.render=function(t,s,r,n){t.pushModelMatrix(),vec3.set(i,s||1,r||1,n||1),mat4.scale(t.mvMatrix,t.mvMatrix,i);const o=t.getShader();o&&(o.bind(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.vertexAttribPointer(o.getAttrVertexPos(),e.itemSize,t.gl.FLOAT,!1,0,0),t.gl.enableVertexAttribArray(o.getAttrVertexPos()),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.drawArrays(t.gl.LINE_STRIP,0,e.numItems)),t.popModelMatrix()},function(){const i=[];i.push(-1,-1,1),i.push(1,-1,1),i.push(1,1,1),i.push(-1,1,1),i.push(-1,-1,1),i.push(-1,-1,-1),i.push(1,-1,-1),i.push(1,1,-1),i.push(-1,1,-1),i.push(-1,-1,-1),i.push(-1,-1,-1),i.push(-1,1,-1),i.push(-1,1,1),i.push(-1,-1,1),i.push(-1,-1,-1),i.push(1,-1,-1),i.push(1,1,-1),i.push(1,1,1),i.push(1,-1,1),i.push(1,-1,-1),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(i),t.gl.STATIC_DRAW),e.itemSize=3,e.numItems=i.length/e.itemSize}()},MatrixStack:xt,Mesh:at,MESH:ht,ShaderLibMods:ut,Shader:vt,Uniform:rt,MESHES:lt,Context:Ot,Texture:L,TextureEffect:ct,isWindows:ft,getWheelSpeed:Et,getWheelDelta:Tt,onLoadingAssetsFinished:null,profileData:void 0,UniColorShader:class{constructor(t){this.shader=new CGL.Shader(t,"markermaterial");const e="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}",i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,e),this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(t,e,i,s){this.coloruni.set(t,e,i,s)}}},ot.BLEND_MODES,ot.SHADER,ot.MATH,ot.BLEND_MODES);window.CGL=Rt;const St=function(t){W.apply(this),this.id=CABLES.uuid(),this.portIn=null,this.portOut=null,this.scene=t,this.activityCounter=0,this.ignoreInSerialize=!1};St.prototype.setValue=function(t){void 0===t?this._setValue():this.portIn.set(t)},St.prototype.activity=function(){this.activityCounter++},St.prototype._setValue=function(){if(!this.portOut)return void this.remove();const t=this.portOut.get();t==t&&(this.portIn.type!=l.OP_PORT_TYPE_FUNCTION&&this.activity(),(this.portIn.get()!==t||this.portIn.changeAlways)&&this.portIn.set(t))},St.prototype.getOtherPort=function(t){return t==this.portIn?this.portOut:this.portIn},St.prototype.remove=function(){this.portIn&&this.portIn.removeLink(this),this.portOut&&this.portOut.removeLink(this),this.scene&&this.scene.emitEvent("onUnLink",this.portIn,this.portOut,this),!this.portIn||this.portIn.type!=l.OP_PORT_TYPE_OBJECT&&this.portIn.type!=l.OP_PORT_TYPE_ARRAY||(this.portIn.set(null),this.portIn.links.length>0&&this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())),this.portIn&&this.portIn.parent._checkLinksNeededToWork(),this.portOut&&this.portOut.parent._checkLinksNeededToWork(),this.portIn=null,this.portOut=null,this.scene=null},St.prototype.link=function(t,e){if(!St.canLink(t,e))return console.warn("[core_link] cannot link ports!",t,e),!1;t.direction==c.PORT_DIR_IN?(this.portIn=t,this.portOut=e):(this.portIn=e,this.portOut=t),t.addLink(this),e.addLink(this),this.setValue(),t.onLink&&t.onLink(this),e.onLink&&e.onLink(this),t.parent._checkLinksNeededToWork(),e.parent._checkLinksNeededToWork()},St.prototype.getSerialized=function(){const t={};return t.portIn=this.portIn.getName(),t.portOut=this.portOut.getName(),t.objIn=this.portIn.parent.id,t.objOut=this.portOut.parent.id,t},St.canLinkText=function(t,e){if(t.direction==e.direction){let t="(out)";return e.direction==c.PORT_DIR_IN&&(t="(in)"),"can not link: same direction "+t}return t.parent==e.parent?"can not link: same op":t.type!=l.OP_PORT_TYPE_DYNAMIC&&e.type!=l.OP_PORT_TYPE_DYNAMIC&&t.type!=e.type?"can not link: different type":t?e?t.direction==c.PORT_DIR_IN&&t.isAnimated()||e.direction==c.PORT_DIR_IN&&e.isAnimated()?"can not link: is animated":t.isLinkedTo(e)?"ports already linked":t.canLink&&!t.canLink(e)||e.canLink&&!e.canLink(t)?"Incompatible":"can link":"can not link: port 2 invalid":"can not link: port 1 invalid"},St.canLink=function(t,e){return!!t&&(!!e&&((t.direction!=c.PORT_DIR_IN||!t.isAnimated())&&((e.direction!=c.PORT_DIR_IN||!e.isAnimated())&&(!t.isHidden()&&!e.isHidden()&&(!t.isLinkedTo(e)&&(t.direction!=e.direction&&((t.type==e.type||t.type==l.OP_PORT_TYPE_DYNAMIC||e.type==l.OP_PORT_TYPE_DYNAMIC)&&(t.type==l.OP_PORT_TYPE_DYNAMIC||e.type==l.OP_PORT_TYPE_DYNAMIC||t.parent!=e.parent&&(!(t.canLink&&!t.canLink(e))&&!(e.canLink&&!e.canLink(t)))))))))))};const Pt=function(){W.apply(this),this._log=new h("core_op"),this.data={},this.storage={},this.objName="",this.portsOut=[],this.portsIn=[],this.portsInData=[],this.opId="",this.uiAttribs={},this.enabled=!0,this.patch=arguments[0],this.name=arguments[1],this._needsLinkedToWork=[],this._needsParentOp=null,this._shortOpName="",this.hasUiErrors=!1,this._uiErrors={},arguments[1]&&(this._shortOpName=CABLES.getShortOpName(arguments[1]),this.getTitle()),this.id=arguments[2]||T(),this.onAddPort=null,this.onCreate=null,this.onResize=null,this.onLoaded=null,this.onDelete=null,this.onUiAttrChange=null,this.onError=null,this._eventCallbacks={},this._instances=null,this.preRender=null,this.init=null};{Pt.prototype.clearUiAttrib=function(t){const e={name:null};this.uiAttrib(e)},Pt.prototype.getTitle=function(){return this.uiAttribs?(void 0!==this.uiAttribs.title&&""!==this.uiAttribs.title||-1!=this.objName.indexOf("Ops.Ui.")||(this.uiAttribs.title=this._shortOpName),void 0===this.uiAttribs.title&&(this.uiAttribs.title=this._shortOpName),this.uiAttribs.title):"nouiattribs"+this.name},Pt.prototype.setTitle=function(t){const e=this.name!=t;this.name=t,this.uiAttr({title:t}),e&&this.fireEvent("onTitleChange",t)};const t=function(t){if(!t)return;(t.error||t.warning||t.hint)&&this._log.warn("old ui error/warning attribute in "+this.name+", use op.setUiError !",t),"object"!=typeof t&&this._log.error("op.uiAttrib attribs are not of type object"),this.uiAttribs||(this.uiAttribs={});let e=!1;for(const i in t)this.uiAttribs[i]!=t[i]&&(e=!0),this.uiAttribs[i]=t[i];this.uiAttribs.hasOwnProperty("selected")&&0==this.uiAttribs.selected&&delete this.uiAttribs.selected,t.title&&t.title!=this.name&&this.setTitle(t.title),e&&(this.fireEvent("onUiAttribsChange",t),this.patch.emitEvent("onUiAttribsChange",this,t))};Pt.prototype.setUiAttribs=Pt.prototype.setUiAttrib=Pt.prototype.uiAttr=t,Pt.prototype.getName=function(){return this.uiAttribs.name?this.uiAttribs.name:this.objName.split(".")},Pt.prototype.addOutPort=function(t){return t.direction=c.PORT_DIR_OUT,t.parent=this,this.portsOut.push(t),this.fireEvent("onPortAdd",t),t},Pt.prototype.hasDynamicPort=function(){let t=0;for(t=0;t<this.portsIn.length;t++){if(this.portsIn[t].type==l.OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==this.portsIn[t].getName())return!0}for(t=0;t<this.portsOut.length;t++){if(this.portsOut[t].type==l.OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==this.portsOut[t].getName())return!0}return!1},Pt.prototype.addInPort=function(t){if(!(t instanceof et))throw new Error("parameter is not a port!");return t.direction=c.PORT_DIR_IN,t.parent=this,this.portsIn.push(t),this.fireEvent("onPortAdd",t),t},Pt.prototype.inFunction=Pt.prototype.inTrigger=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION));return void 0!==e&&i.set(e),i},Pt.prototype.inFunctionButton=Pt.prototype.inTriggerButton=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION,{display:"button"}));return void 0!==e&&i.set(e),i},Pt.prototype.inFunctionButton=Pt.prototype.inUiTriggerButtons=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION,{display:"buttons"}));return void 0!==e&&i.set(e),i},Pt.prototype.inValueFloat=Pt.prototype.inValue=Pt.prototype.inFloat=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE));return void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inValueBool=Pt.prototype.inBool=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"bool"}));return void 0!==e&&(i.set(e),i.defaultValue=i.get()),i},Pt.prototype.inValueString=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inString=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string"}));return e=e||"",i.value=e,i.set(e),i.defaultValue=e,i},Pt.prototype.inValueText=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string",display:"text"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inTextarea=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string",display:"text"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inStringEditor=function(t,e,i,s=!0){const r=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:s}));return r.value="",void 0!==e&&(r.set(e),r.defaultValue=e),r},Pt.prototype.inValueEditor=function(t,e,i,s=!0){const r=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:s}));return r.value="",void 0!==e&&(r.set(e),r.defaultValue=e),r},Pt.prototype.inValueSelect=Pt.prototype.inDropDown=function(t,e,i,s){let r=null;if(s){const i=new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"dropdown",hidePort:!0,type:"string",values:e});r=this.addInPort(i)}else{const s=new et(this,t+" index",l.OP_PORT_TYPE_VALUE,{increment:"integer",hideParam:!0}),n=this.addInPort(s),o=new st(this,t,l.OP_PORT_TYPE_VALUE,{display:"dropdown",hidePort:!0,type:"string",values:e},n);if(o.indexPort=s,s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})},r=this.addInPort(o),void 0!==i){r.set(i);const t=e.findIndex(t=>t==i);n.setValue(t),r.defaultValue=i,n.defaultValue=t}}return r},Pt.prototype.inSwitch=function(t,e,i,s){let r=null;if(s){const i=new et(this,t,l.OP_PORT_TYPE_STRING,{display:"switch",hidePort:!0,type:"string",values:e});r=this.addInPort(i)}else{const s=new et(this,t+" index",l.OP_PORT_TYPE_VALUE,{increment:"integer",hideParam:!0}),n=this.addInPort(s),o=new it(this,t,l.OP_PORT_TYPE_STRING,{display:"switch",hidePort:!0,type:"string",values:e},n);if(s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})},r=this.addInPort(o),void 0!==i){r.set(i);const t=e.findIndex(t=>t==i);n.setValue(t),r.defaultValue=i,n.defaultValue=t}}return r},Pt.prototype.inValueInt=Pt.prototype.inInt=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{increment:"integer"}));return void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inFile=function(t,e,i){const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"file",type:"string",filter:e}));return void 0!==i&&(s.set(i),s.defaultValue=i),s},Pt.prototype.inUrl=function(t,e,i){const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{display:"file",type:"string",filter:e}));return void 0!==i&&(s.set(i),s.defaultValue=i),s},Pt.prototype.inTexture=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{display:"texture",objType:"texture",preview:!0}));return void 0!==e&&i.set(e),i},Pt.prototype.inObject=function(t,e,i){const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{objType:i}));return void 0!==e&&s.set(e),s},Pt.prototype.inGradient=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"gradient",hidePort:!0}));return void 0!==e&&i.set(e),i},Pt.prototype.inArray=function(t,e,i){!i&&CABLES.UTILS.isNumeric(e)&&(i=e);const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_ARRAY,{stride:i}));return void 0===e||!Array.isArray(e)&&null!=e||s.set(e),s},Pt.prototype.inValueSlider=Pt.prototype.inFloatSlider=function(t,e,i,s){const r={display:"range"};null!=i&&null!=s&&(r.min=i,r.max=s);const n=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,r));return void 0!==e&&(n.set(e),n.defaultValue=e),n},Pt.prototype.outFunction=Pt.prototype.outTrigger=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION));return void 0!==e&&i.set(e),i},Pt.prototype.outValue=Pt.prototype.outNumber=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE));return void 0!==e&&i.set(e),i},Pt.prototype.outValueBool=Pt.prototype.outBool=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"bool"}));return void 0!==e?i.set(e):i.set(0),i},Pt.prototype.outBoolNum=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"boolnum"}));return i.set=function(t){this.setValue(t?1:0)}.bind(i),void 0!==e?i.set(e):i.set(0),i},Pt.prototype.outValueString=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string"}));return void 0!==e&&i.set(e),i},Pt.prototype.outString=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string"}));return void 0!==e?i.set(e):i.set(""),i},Pt.prototype.outObject=function(t,e,i){const s=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{objType:i||null}));return void 0!==e&&s.set(e),s.ignoreValueSerialize=!0,s},Pt.prototype.outArray=function(t,e,i){!i&&CABLES.UTILS.isNumeric(e)&&(i=e);const s=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_ARRAY,{stride:i}));return void 0===e||!Array.isArray(e)&&null!=e||s.set(e),s.ignoreValueSerialize=!0,s},Pt.prototype.outTexture=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{preview:!0,objType:"texture"}));return void 0!==e&&i.set(e),i.ignoreValueSerialize=!0,i},Pt.prototype.inDynamic=function(t,e,i,s){const r=new et(this,t,l.OP_PORT_TYPE_DYNAMIC,i);return r.shouldLink=function(t,i){if(e&&g.isArray(e)){for(let s=0;s<e.length;s++){if(t==this&&i.type===e[s])return!0;if(i==this&&t.type===e[s])return!0}return!1}return!0},this.addInPort(r),void 0!==s&&(r.set(s),r.defaultValue=s),r},Pt.prototype.printInfo=function(){for(let t=0;t<this.portsIn.length;t++)console.log("in: "+this.portsIn[t].getName());for(const t in this.portsOut)console.log("out: "+this.portsOut[t].getName())},Pt.prototype.getOutChilds=function(){const t=[];for(const e in this.portsOut)for(const i in this.portsOut[e].links)this.portsOut[e].type==l.OP_PORT_TYPE_FUNCTION&&t.push(this.portsOut[e].links[i].portIn.parent);return t},Pt.prototype.markChilds=function(){this.marked=!0;for(const t in this.portsOut)for(const e in this.portsOut[t].links)this.portsOut[t].parent.marked=!0,this.portsOut[t].links[e].portIn.parent!=this&&this.portsOut[t].links[e].portIn.parent.markChilds()},Pt.prototype.selectChilds=function(){this.setUiAttrib({selected:!0});for(const t in this.portsOut)for(const e in this.portsOut[t].links)this.portsOut[t].parent.setUiAttrib({selected:!0}),this.portsOut[t].links[e].portIn.parent!=this&&this.portsOut[t].links[e].portIn.parent.selectChilds()},Pt.prototype.deleteChilds=function(){const t=[];for(const e in this.portsOut)for(const i in this.portsOut[e].links)this.portsOut[e].links[i].portIn.parent!=this&&(this.portsOut[e].parent!=this&&t.push(this.portsOut[e].parent),t.push(this.portsOut[e].links[i].portIn.parent),this.portsOut[e].links[i].portIn.parent.deleteChilds());for(const e in t)this.patch.deleteOp(t[e].id)},Pt.prototype.removeLinks=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks();for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].removeLinks()},Pt.prototype.countFittingPorts=function(t){let e=0;for(const i in this.portsOut)St.canLink(t,this.portsOut[i])&&e++;for(const i in this.portsIn)St.canLink(t,this.portsIn[i])&&e++;return e},Pt.prototype.findFittingPort=function(t,e=!1){if(e){for(const e in this.portsIn)if(St.canLink(t,this.portsIn[e]))return this.portsIn[e];for(const e in this.portsOut)if(St.canLink(t,this.portsOut[e]))return this.portsOut[e]}else{for(const e in this.portsOut)if(St.canLink(t,this.portsOut[e]))return this.portsOut[e];for(const e in this.portsIn)if(St.canLink(t,this.portsIn[e]))return this.portsIn[e]}},Pt.prototype.getSerialized=function(t){const e={};this.opId&&(e.opId=this.opId),e.objName=this.objName,e.id=this.id,e.uiAttribs=this.uiAttribs,this.storage&&Object.keys(this.storage).length>0&&(e.storage=this.storage),this.uiAttribs.title==this._shortOpName&&delete this.uiAttribs.title,this.uiAttribs.hasOwnProperty("working")&&1==this.uiAttribs.working&&delete this.uiAttribs.working,t&&this.uiAttribs.hasOwnProperty("uierrors")&&delete this.uiAttribs.uierrors,e.portsIn=[],e.portsOut=[];for(let t=0;t<this.portsIn.length;t++)e.portsIn.push(this.portsIn[t].getSerialized());for(const t in this.portsOut)e.portsOut.push(this.portsOut[t].getSerialized());return e},Pt.prototype.getFirstOutPortByType=function(t){for(const e in this.portsOut)if(this.portsOut[e].type==t)return this.portsOut[e]},Pt.prototype.getFirstInPortByType=function(t){for(const e in this.portsIn)if(this.portsIn[e].type==t)return this.portsIn[e]},Pt.prototype.getPort=Pt.prototype.getPortByName=function(t,e){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t)return this.portsOut[e]}},Pt.prototype.getPortById=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]},Pt.prototype.updateAnims=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].updateAnim()},Pt.prototype.log=function(){const t="op "+this.objName;if(CABLES.UI&&!CABLES.UI.logFilter.shouldPrint(t,...arguments))return;if(!CABLES.UI&&this.patch.silent)return;const e=["[op "+this._shortOpName+"]"];e.push.apply(e,arguments),Function.prototype.apply.apply(console.log,[console,e])},Pt.prototype.error=Pt.prototype.logError=function(){const t=["[op "+this._shortOpName+"]"];t.push.apply(t,arguments),Function.prototype.apply.apply(console.error,[console,t]),window.gui&&window.gui.emitEvent("opLogEvent",this.objName,"error",arguments)},Pt.prototype.warn=Pt.prototype.logWarn=function(){const t=["[op "+this._shortOpName+"]"];t.push.apply(t,arguments),Function.prototype.apply.apply(console.warn,[console,t])},Pt.prototype.verbose=Pt.prototype.logVerbose=function(){const t="op "+this._shortOpName;if(CABLES.UI&&!CABLES.UI.logFilter.shouldPrint(t,...arguments))return;if(!CABLES.UI&&this.patch.silent)return;const e=["["+t+"]"];e.push.apply(e,arguments),Function.prototype.apply.apply(console.info,[console,e])},Pt.prototype.unLink=function(){for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].removeLinks();for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks()},Pt.prototype.profile=function(t){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t]._onTriggered=this.portsIn[t]._onTriggeredProfiling,this.portsIn[t].set=this.portsIn[t]._onSetProfiling},Pt.prototype.findParent=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].isLinked()){if(this.portsIn[e].links[0].portOut.parent.objName==t)return this.portsIn[e].links[0].portOut.parent;let i=null;if(i=this.portsIn[e].links[0].portOut.parent.findParent(t),i)return i}return null},Pt.prototype.cleanUp=function(){if(this._instances){for(let t=0;t<this._instances.length;t++)this._instances[t].onDelete&&this._instances[t].onDelete();this._instances.length=0}},Pt.prototype.instanced=function(t){if(console.log("instanced",this.patch.instancing.numCycles()),0===this.patch.instancing.numCycles())return!1;let e=0,i=0;if(!this._instances||this._instances.length!=this.patch.instancing.numCycles()){for(this._instances||(this._instances=[]),this._.log("creating instances of ",this.objName,this.patch.instancing.numCycles(),this._instances.length),this._instances.length=this.patch.instancing.numCycles(),e=0;e<this._instances.length;e++){this._instances[e]=this.patch.createOp(this.objName,!0),this._instances[e].instanced=function(){return!1},this._instances[e].uiAttr(this.uiAttribs);for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].type==l.OP_PORT_TYPE_FUNCTION&&(this._instances[e].getPortByName(this.portsOut[t].name).trigger=this.portsOut[t].trigger.bind(this.portsOut[t]))}for(i=0;i<this.portsIn.length;i++)this.portsIn[i].onChange=null,this.portsIn[i].onValueChanged=null}for(i=0;i<this.portsIn.length;i++)this.portsIn[i].type!=l.OP_PORT_TYPE_VALUE&&this.portsIn[i].type!=l.OP_PORT_TYPE_ARRAY||this._instances[this.patch.instancing.index()].portsIn[i].set(this.portsIn[i].get()),this.portsIn[i].type,l.OP_PORT_TYPE_FUNCTION;for(i=0;i<this.portsOut.length;i++)this.portsOut[i].type==l.OP_PORT_TYPE_VALUE&&this.portsOut[i].set(this._instances[this.patch.instancing.index()].portsOut[i].get());return!0},Pt.prototype.initInstancable=function(){},Pt.prototype.setValues=function(t){for(const e in t){const i=this.getPortByName(e);i?i.set(t[e]):this._log.warn("op.setValues: port not found:",e)}},Pt.prototype.setUiError=function(t,e,i){if(!e&&!this.hasUiErrors)return;if(!e&&!this._uiErrors.hasOwnProperty(t))return;if(this._uiErrors.hasOwnProperty(t)&&this._uiErrors[t].txt==e)return;t.indexOf(" ")>-1&&this._log.warn("setuierror id cant have spaces! ",t),!e&&this._uiErrors.hasOwnProperty(t)?delete this._uiErrors[t]:!e||this._uiErrors.hasOwnProperty(t)&&this._uiErrors[t].txt==e||(null==i&&(i=2),this._uiErrors[t]={txt:e,level:i,id:t});const s=[];for(const t in this._uiErrors)s.push(this._uiErrors[t]);this.uiAttr({uierrors:s}),this.hasUiErrors=Object.keys(this._uiErrors).length,console.log(t,e,this._uiErrors.hasOwnProperty(t))},Pt.prototype.setError=function(t,e){this._log.warn("old error message op.error() - use op.setUiError()")},Pt.prototype.addListener=Pt.prototype.addEventListener=function(t,e){this._eventCallbacks[t]?this._eventCallbacks[t].push(e):this._eventCallbacks[t]=[e]},Pt.prototype.hasEventListener=function(t,e){if(t&&e){if(this._eventCallbacks[t]){return-1!=this._eventCallbacks[t].indexOf(e)}}else this._log.warn("hasListener: missing parameters")},Pt.prototype.removeEventListener=function(t,e){if(this._eventCallbacks[t]){const i=this._eventCallbacks[t].indexOf(e);-1==i?this._log.warn("eventlistener "+t+" not found..."):this._eventCallbacks[t].slice(i)}},Pt.prototype.fireEvent=function(t,e){if(this._eventCallbacks[t])for(let i=0;i<this._eventCallbacks[t].length;i++)this._eventCallbacks[t][i]&&this._eventCallbacks[t][i].cb(e);this.onUiAttrChange&&"onUiAttribsChange"==t&&this.onUiAttrChange(e)},Pt.prototype.setEnabled=function(t){this.enabled=t,this.fireEvent("onEnabledChange",t)},Pt.prototype.setPortGroup=function(t,e){for(let i=0;i<e.length;i++)e[i]&&(e[i].setUiAttribs?e[i].setUiAttribs({group:t}):this._log.error("setPortGroup: invalid port!"))},Pt.prototype.setUiAxisPorts=function(t,e,i){t&&t.setUiAttribs({axis:"X"}),e&&e.setUiAttribs({axis:"Y"}),i&&i.setUiAttribs({axis:"Z"})},Pt.prototype.removePort=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e]==t)return this.portsIn.splice(e,1),this.fireEvent("onUiAttribsChange",{}),void this.fireEvent("onPortRemoved",{})},Pt.prototype._checkLinksNeededToWork=function(){},Pt.prototype.toWorkNeedsParent=function(t){this.patch.isEditorMode()&&(this._needsParentOp=t)},Pt.prototype.toWorkPortsNeedToBeLinked=function(){if(this.patch.isEditorMode())for(let t=0;t<arguments.length;t++)-1==this._needsLinkedToWork.indexOf(arguments[t])&&this._needsLinkedToWork.push(arguments[t])},Pt.prototype.toWorkPortsNeedToBeLinkedReset=function(){this.patch.isEditorMode()&&(this._needsLinkedToWork.length=0,this.checkLinkTimeWarnings&&this.checkLinkTimeWarnings())},Pt.prototype.initVarPorts=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].getVariableName()&&this.portsIn[t].setVariable(this.portsIn[t].getVariableName())},Pt.prototype.refreshParams=function(){this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp()&&gui.opParams.show(this)},Pt.prototype.isCurrentUiOp=function(){if(this.patch.isEditorMode())return gui.patchView.isCurrentOp(this)},Pt.prototype.renderVizLayer=null}Pt.getNamespaceClassName=function(t){return t?t.startsWith("Ops.Gl")?"gl":t.startsWith("Ops.WebAudio")?"audio":t.startsWith("Ops.Devices")?"devices":t.startsWith("Ops.Html")||t.startsWith("Ops.Sidebar")?"html":t.startsWith("Ops.Math")?"math":t.startsWith("Ops.User")?"user":"default":"default"},Pt.isSubpatchOp=function(t){return"Ops.Ui.Patch"==t||"Ops.Ui.SubPatch"==t};const Nt=function(t){CABLES.EventTarget.apply(this),this._log=new h("LoadingStatus"),this._loadingAssets={},this._cbFinished=[],this._assetTasks=[],this._percent=0,this._count=0,this._countFinished=0,this._order=0,this._startTime=0,this._patch=t,this._wasFinishedPrinted=!1,this._loadingAssetTaskCb=!1};Nt.prototype.setOnFinishedLoading=function(t){this._cbFinished.push(t)},Nt.prototype.getNumAssets=function(){return this._countFinished},Nt.prototype.getProgress=function(){return this._percent},Nt.prototype.checkStatus=function(){this._countFinished=0,this._count=0;for(const t in this._loadingAssets)this._count++,this._loadingAssets[t].finished||this._countFinished++;if(this._percent=(this._count-this._countFinished)/this._count,0===this._countFinished){for(let t=0;t<this._cbFinished.length;t++)if(this._cbFinished[t]){const e=this._cbFinished[t];setTimeout(()=>{e(this._patch),this.emitEvent("finishedAll")},100)}this._wasFinishedPrinted||(this._wasFinishedPrinted=!0,this.print()),this.emitEvent("finishedAll")}},Nt.prototype.getList=function(){let t=[];for(const e in this._loadingAssets)t.push(this._loadingAssets[e]);return t},Nt.prototype.getListJobs=function(){let t=[];for(const e in this._loadingAssets)this._loadingAssets[e].finished||t.push(this._loadingAssets[e].name);return t},Nt.prototype.print=function(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets)t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"]);this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s"),this._log.table(t),this._log.groupEnd()},Nt.prototype.finished=function(t){this._loadingAssets[t]&&(this._loadingAssets[t].finished=!0,this._loadingAssets[t].timeEnd=Date.now()),this.checkStatus(),this.emitEvent("finishedTask")},Nt.prototype._startAssetTasks=function(){for(let t=0;t<this._assetTasks.length;t++)this._assetTasks[t]();this._assetTasks.length=0},Nt.prototype.addAssetLoadingTask=function(t){this._patch.isEditorMode()&&!CABLES.UI.loaded?(this._assetTasks.push(t),this._loadingAssetTaskCb||window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this)),this._loadingAssetTaskCb=!0):t(),this.emitEvent("addAssetTask")},Nt.prototype.existByName=function(t){for(let e in this._loadingAssets)if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return!0},Nt.prototype.start=function(t,e){0==this._startTime&&(this._startTime=Date.now());const i=A();return this._loadingAssets[i]={id:i,type:t,name:e,finished:!1,timeStart:Date.now(),order:this._order},this._order++,this.emitEvent("startTask"),i};const Ft=function(){this._loops=[],this._indizes=[],this._index=0};Ft.prototype.pushLoop=function(t){this._loops.push(Math.abs(Math.floor(t))),this._indizes.push(this._index)},Ft.prototype.popLoop=function(){this._loops.pop(),this._index=this._indizes.pop(),0===this._loops.length&&(this._index=0)},Ft.prototype.numLoops=function(){return this._loops.length},Ft.prototype.numCycles=function(){if(0===this._loops.length)return 0;let t=this._loops[0];for(let e=1;e<this._loops.length;e++)t*=this._loops[e];return t},Ft.prototype.inLoop=function(){return this._loops.length>0},Ft.prototype.increment=function(){this._index++},Ft.prototype.index=function(){return this._index};const Ct=function(t){this.startFrame=t.getFrameNum();let e={},i=null,s=0;this.getItems=function(){return e},this.clear=function(){e={}},this.add=function(r,n){null!==i&&(n&&n.id==i||e[i]&&(e[i].timeUsed+=performance.now()-s,(!e[i].peakTime||_t()-e[i].peakTime>5e3)&&(e[i].peak=0,e[i].peakTime=_t()),e[i].peak=Math.max(e[i].peak,performance.now()-s))),null!==n?(e[n.id]||(e[n.id]={numTriggers:0,timeUsed:0}),e[n.id].lastFrame!=t.getFrameNum()&&(e[n.id].numTriggers=0),e[n.id].lastFrame=t.getFrameNum(),e[n.id].numTriggers++,e[n.id].opid=n.parent.id,e[n.id].title=n.parent.name+"."+n.name,e[n.id].subPatch=n.parent.uiAttribs.subPatch,i=n.id,s=performance.now()):i=null},this.print=function(){console.log("--------");for(const t in e)console.log(e[t].title+": "+e[t].numTriggers+" / "+e[t].timeUsed)}};var wt=class{constructor(t,e,i){this._name=t,this._changeListeners=[],this.type=i,this.setValue(e)}getValue(){return this._v}getName(){return this._name}setValue(t){this._v=t;for(let e=0;e<this._changeListeners.length;e++)this._changeListeners[e](t,this)}addListener(t){-1==this._changeListeners.indexOf(t)&&this._changeListeners.push(t)}removeListener(t){const e=this._changeListeners.indexOf(t);this._changeListeners.splice(e,1)}};const Mt=function(t){W.apply(this),this._log=new h("core_patch"),this.ops=[],this.settings={},this.config=t||{glCanvasResizeToWindow:!1,prefixAssetPath:"",prefixJsPath:"",silent:!0,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0},this.timer=new pt,this.freeTimer=new pt,this.animFrameOps=[],this.animFrameCallbacks=[],this.gui=!1,CABLES.logSilent=this.silent=!0,this.profiler=null,this.aborted=!1,this._crashedOps=[],this._renderOneFrame=!1,this._animReq=null,this._opIdCache={},this._triggerStack=[],this.loading=new Nt(this),this._perf={fps:0,ms:0,_fpsFrameCount:0,_fpsMsCount:0,_fpsStart:0},this._volumeListeners=[],this._paused=!1,this._frameNum=0,this.instancing=new Ft,this.onOneFrameRendered=null,this.namedTriggers={},this._origData=null,this._frameNext=0,this._frameInterval=0,this._lastFrameTime=0,this._frameWasdelayed=!0,function(){return!this}()||this._log.warn("not in strict mode: core patch"),this._isLocal=0===document.location.href.indexOf("file:"),this.config.hasOwnProperty("silent")&&(this.silent=CABLES.logSilent=this.config.silent),this.config.hasOwnProperty("doRequestAnimation")||(this.config.doRequestAnimation=!0),this.config.prefixAssetPath||(this.config.prefixAssetPath=""),this.config.prefixJsPath||(this.config.prefixJsPath=""),this.config.masterVolume||(this.config.masterVolume=1),this._variables={},this._variableListeners=[],this.vars={},t&&t.vars&&(this.vars=t.vars),this.cgl=new Ot(this),this.cgl.setCanvas(this.config.glCanvasId||this.config.glCanvas||"glcanvas"),!0===this.config.glCanvasResizeToWindow&&this.cgl.setAutoResize("window"),!0===this.config.glCanvasResizeToParent&&this.cgl.setAutoResize("parent"),this.loading.setOnFinishedLoading(this.config.onFinishedLoading),this.cgl.aborted&&(this.aborted=!0),this.cgl.silent&&(this.silent=!0),this.freeTimer.play(),this.exec(),this.aborted||(this.config.patch?this.deSerialize(this.config.patch):this.config.patchFile&&w(this.config.patchFile,(t,e)=>{const i=JSON.parse(e);if(t){return this._log.error("err",t),this._log.error("data",i),void this._log.error("data",i.msg)}this.deSerialize(i)}),this.timer.play()),console.log("made with https://cables.gl")};Mt.prototype.isPlaying=function(){return!this._paused},Mt.prototype.isRenderingOneFrame=function(){return this._renderOneFrame},Mt.prototype.renderOneFrame=function(){this._paused=!0,this._renderOneFrame=!0,this.exec(),this._renderOneFrame=!1},Mt.prototype.getFPS=function(){return this._perf.fps},Mt.prototype.isEditorMode=function(){return!0===this.config.editorMode},Mt.prototype.pause=function(){cancelAnimationFrame(this._animReq),this.emitEvent("pause"),this._animReq=null,this._paused=!0,this.freeTimer.pause()},Mt.prototype.resume=function(){this._paused&&(cancelAnimationFrame(this._animReq),this._paused=!1,this.freeTimer.play(),this.emitEvent("resume"),this.exec())},Mt.prototype.setVolume=function(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)},Mt.prototype.getAssetPath=function(){if(this.isEditorMode())return"/assets/"+gui.project()._id+"/";if(document.location.href.indexOf("cables.gl")>0){const t=document.location.href.split("/");return"/assets/"+t[t.length-1]+"/"}return"assets/"},Mt.prototype.getFilePath=function(t){return this._isLocal&&!this.config.allowLocalFileAccess&&this.exitError("localAccess","Browser security forbids loading files directly without a webserver. Upload files to a server to work. use allowLocalFileAccess:true to ignore this."),t?0===(t=String(t)).indexOf("https:")||0===t.indexOf("http:")||0===t.indexOf("data:")?t:(t=t.replace("//","/"),this.config.prefixAssetPath+t+(this.config.suffixAssetPath||"")):t},Mt.prototype.clear=function(){for(this.emitEvent("patchClearStart"),this.cgl.TextureEffectMesh=null,this.animFrameOps.length=0,this.timer=new pt;this.ops.length>0;)this.deleteOp(this.ops[0].id);this.emitEvent("patchClearEnd")},Mt.getOpClass=function(t){const e=t.split(".");let i=null;try{return 2==e.length?i=window[e[0]][e[1]]:3==e.length?i=window[e[0]][e[1]][e[2]]:4==e.length?i=window[e[0]][e[1]][e[2]][e[3]]:5==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]]:6==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]]:7==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]]:8==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]]:9==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]][e[8]]:10==e.length&&(i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]][e[8]][e[9]]),i}catch(t){return null}},Mt.prototype.createOp=function(t,e){const i=t.split(".");let s=null,r="";try{if(-1==t.indexOf("Ops.")){const i=t;if(!CABLES.OPS[i])throw new Error("could not find op by id: "+i);r=CABLES.OPS[i].objName,s=new CABLES.OPS[i].f(this,r,e,i),s.opId=i}if(!s){r=t;if(!Mt.getOpClass(r))throw this.emitEvent("criticalError","unknown op","unknown op: "+r),this._log.error("unknown op: "+r),new Error("unknown op: "+r);if(2==i.length?s=new window[i[0]][i[1]](this,r,e):3==i.length?s=new window[i[0]][i[1]][i[2]](this,r,e):4==i.length?s=new window[i[0]][i[1]][i[2]][i[3]](this,r,e):5==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]](this,r,e):6==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]](this,r,e):7==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]](this,r,e):8==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]](this,r,e):9==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]][i[8]](this,r,e):10==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]][i[8]][i[9]](this,r,e):this._log.warn("parts.length",i.length),s){s.opId=null;for(const t in CABLES.OPS)CABLES.OPS[t].objName==r&&(s.opId=t)}}}catch(t){if(this._crashedOps.push(r),this.emitEvent("exceptionOp",t,r,s),!this.isEditorMode())throw this._log.error(t),this._log.error("[instancing error] "+r,t),CABLES.api&&CABLES.api.sendErrorReport(t),this.exitError("INSTANCE_ERR","Instancing Error "+r,t),new Error("instancing error "+r)}return s?(s.objName=r,s.patch=this):this._log.log("no op was created!?",t,e),s},Mt.prototype.addOp=function(t,e,i,s){const r=this.createOp(t,i);if(r){if(e&&e.hasOwnProperty("errors")&&delete e.errors,e&&e.hasOwnProperty("error")&&delete e.error,r.uiAttr(e),r.onCreate&&r.onCreate(),r.hasOwnProperty("onAnimFrame")&&this.addOnAnimFrame(r),r.hasOwnProperty("onMasterVolumeChanged")&&this._volumeListeners.push(r),this._opIdCache[r.id])return void this._log.warn("opid with id "+r.id+" already exists in patch!");this.ops.push(r),this._opIdCache[r.id]=r,this.emitEvent("onOpAdd",r,s),r.init&&r.init()}else this._log.error("addop: no op.....");return r},Mt.prototype.addOnAnimFrame=function(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t)return;this.animFrameOps.push(t)},Mt.prototype.removeOnAnimFrame=function(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t)return void this.animFrameOps.splice(e,1)},Mt.prototype.addOnAnimFrameCallback=function(t){this.animFrameCallbacks.push(t)},Mt.prototype.removeOnAnimCallback=function(t){for(let e=0;e<this.animFrameCallbacks.length;e++)if(this.animFrameCallbacks[e]==t)return void this.animFrameCallbacks.splice(e,1)},Mt.prototype.deleteOp=function(t,e,i){let s=!1;for(const r in this.ops)if(this.ops[r].id==t){const n=this.ops[r];let o=null,h=null;if(n){s=!0,e&&n.portsIn.length>0&&n.portsIn[0].isLinked()&&n.portsOut.length>0&&n.portsOut[0].isLinked()&&n.portsIn[0].getType()==n.portsOut[0].getType()&&(o=n.portsIn[0].links[0].getOtherPort(n.portsIn[0]),h=n.portsOut[0].links[0].getOtherPort(n.portsOut[0]));const a=this.ops[r];a.removeLinks(),a.emitEvent("onDelete",this.ops[r]),this.onDelete&&(this._log.warn("deprecated this.onDelete",this.onDelete),this.onDelete(a)),this.ops.splice(r,1),this.emitEvent("onOpDelete",a,i),a.onDelete&&a.onDelete(i),a.cleanUp(),null!==o&&null!==h&&this.link(o.parent,o.getName(),h.parent,h.getName()),delete this._opIdCache[t];break}}s||this._log.warn("core patch deleteop: not found...")},Mt.prototype.getFrameNum=function(){return this._frameNum},Mt.prototype.renderFrame=function(t){this.timer.update(),this.freeTimer.update();const e=this.timer.getTime(),i=performance.now();for(let t=0;t<this.animFrameCallbacks.length;++t)this.animFrameCallbacks[t]&&this.animFrameCallbacks[t](e,this._frameNum);for(let t=0;t<this.animFrameOps.length;++t)this.animFrameOps[t].onAnimFrame&&this.animFrameOps[t].onAnimFrame(e);this.cgl.profileData.profileOnAnimFrameOps=performance.now()-i,this.emitEvent("onRenderFrame",e),this._frameNum++,1==this._frameNum&&this.config.onFirstFrameRendered&&this.config.onFirstFrameRendered()},Mt.prototype.exec=function(t){if(!this._renderOneFrame&&(this._paused||this.aborted))return;this.config.fpsLimit=this.config.fpsLimit||0,this.config.fpsLimit&&(this._frameInterval=1e3/this.config.fpsLimit);const e=CABLES.now(),i=e-this._frameNext;if(this.isEditorMode()&&!this._renderOneFrame&&e-this._lastFrameTime>=500&&0!==this._lastFrameTime&&!this._frameWasdelayed)return this._lastFrameTime=0,setTimeout(this.exec.bind(this),500),this.emitEvent("renderDelayStart"),void(this._frameWasdelayed=!0);if(this._renderOneFrame||0===this.config.fpsLimit||i>this._frameInterval||this._frameWasdelayed){const t=CABLES.now();this.renderFrame(),this._perf._lastFrameTime=CABLES.now(),this._perf._fpsFrameCount++,this._perf._fpsMsCount+=CABLES.now()-t,this._frameInterval&&(this._frameNext=e-i%this._frameInterval)}this._frameWasdelayed&&(this.emitEvent("renderDelayEnd"),this._frameWasdelayed=!1),this._renderOneFrame&&(this.onOneFrameRendered&&this.onOneFrameRendered(),this.emitEvent("renderedOneFrame"),this._renderOneFrame=!1),CABLES.now()-this._perf._fpsStart>=1e3&&this._perf.fps!=this._perf._fpsFrameCount&&(this._perf.fps=this._perf._fpsFrameCount,this._perf.ms=Math.round(this._perf._fpsMsCount/this._perf._fpsFrameCount),this.emitEvent("performance",this._perf),this._perf._fpsFrameCount=0,this._perf._fpsMsCount=0,this._perf._fpsStart=CABLES.now()),this.config.doRequestAnimation&&(this._animReq=requestAnimationFrame(this.exec.bind(this)))},Mt.prototype.link=function(t,e,i,s,r,n){if(!t)return void this._log.warn("link: op1 is null ");if(!i)return void this._log.warn("link: op2 is null");const o=t.getPort(e,r),h=i.getPort(s,r);if(o)if(h){if(!o.shouldLink(o,h)||!h.shouldLink(o,h))return!1;if(St.canLink(o,h)){const t=new St(this);return t.link(o,h),this.emitEvent("onLink",o,h,t,n),t}}else this._log.warn("port not found! "+s+" of "+i.name+"("+i.objName+")");else this._log.warn("port not found! "+e+"("+t.objName+")")},Mt.prototype.serialize=function(t){const e={};(t=t||{}).hasOwnProperty("removeBlueprints")||(t.removeBlueprints=!0),t.hasOwnProperty("removeFromNetworkAttr")||(t.removeFromNetworkAttr=!0),e.ops=[],e.settings=this.settings;for(const i in this.ops){const s=this.ops[i];t.removeBlueprints&&s.storage&&s.storage.blueprint||(t.removeFromNetworkAttr&&s.uiAttribs&&s.uiAttribs.hasOwnProperty("fromNetwork")&&delete s.uiAttribs.fromNetwork,e.ops.push(s.getSerialized()))}return t.asObject?e:JSON.stringify(e)},Mt.prototype.getOpById=function(t){return this._opIdCache[t]},Mt.prototype.getOpsByName=function(t){const e=[];for(const i in this.ops)this.ops[i].name==t&&e.push(this.ops[i]);return e},Mt.prototype.getOpsByObjName=function(t){const e=[];for(const i in this.ops)this.ops[i].objName==t&&e.push(this.ops[i]);return e},Mt.prototype.loadLib=function(t){C("/ui/libs/"+t+".js",(t,e)=>{const i=document.createElement("script");i.type="text/javascript",i.text=e,document.getElementsByTagName("head")[0].appendChild(i)},"GET")},Mt.prototype.reloadOp=function(t,e){let i=0;const s=[],r=[];for(const e in this.ops)this.ops[e].objName==t&&r.push(this.ops[e]);for(let e=0;e<r.length;e++){i++;const n=r[e];n.deleted=!0;const o=this,h=this.addOp(t,n.uiAttribs);if(!h)continue;let a,l;for(a in n&&n.storage&&(h.storage=n.storage),s.push(h),n.portsIn)if(0===n.portsIn[a].links.length){const t=h.getPort(n.portsIn[a].name);t?(t.set(n.portsIn[a].get()),n.portsIn[a].getVariableName()&&t.setVariable(n.portsIn[a].getVariableName())):this._log.error("[reloadOp] could not set port "+n.portsIn[a].name+", propably renamed port ?")}else for(;n.portsIn[a].links.length;){const t=n.portsIn[a].links[0].portIn.name,e=n.portsIn[a].links[0].portOut.name,i=n.portsIn[a].links[0].portOut.parent;n.portsIn[a].links[0].remove(),l=o.link(h,t,i,e),l?l.setValue():this._log.warn("[reloadOp] relink after op reload not successfull for port "+e)}for(a in n.portsOut)for(;n.portsOut[a].links.length;){const t=n.portsOut[a].links[0].portOut.name,e=n.portsOut[a].links[0].portIn.name,i=n.portsOut[a].links[0].portIn.parent;n.portsOut[a].links[0].remove(),l=o.link(h,t,i,e),l?l.setValue():this._log.warn("relink after op reload not successfull for port "+e)}this.deleteOp(n.id,!1,!0)}e(i,s)},Mt.prototype.getSubPatchOps=function(t){const e=[];for(const i in this.ops)this.ops[i].uiAttribs&&this.ops[i].uiAttribs.subPatch==t&&e.push(this.ops[i]);return e},Mt.prototype.getSubPatchOp=function(t,e){for(const i in this.ops)if(this.ops[i].uiAttribs&&this.ops[i].uiAttribs.subPatch==t&&this.ops[i].objName==e)return this.ops[i];return!1},Mt.prototype._addLink=function(t,e,i,s){this.link(this.getOpById(t),i,this.getOpById(e),s,!1,!0)},Mt.prototype.deSerialize=function(t,e){if(this.aborted)return;const i=[],s=this.loading.start("core","deserialize");this.namespace=t.namespace||"",this.name=t.name||"","string"==typeof t&&(t=JSON.parse(t)),this.settings=t.settings,this.emitEvent("patchLoadStart");for(const s in t.ops){const r=CABLES.now(),n=t.ops[s];let o=null;try{o=n.opId?this.addOp(n.opId,n.uiAttribs,n.id,!0):this.addOp(n.objName,n.uiAttribs,n.id,!0)}catch(t){throw this._log.warn("[instancing error] op data:",n,t),new Error("instancing error: "+n.objName)}if(o){e&&(o.id=T()),o.portsInData=n.portsIn,o._origData=n,o.storage=n.storage;for(const t in n.portsIn){const e=n.portsIn[t],i=o.getPort(e.name);!i||"bool"!=i.uiAttribs.display&&"bool"!=i.uiAttribs.type||isNaN(e.value)||(e.value=!0===e.value),i&&void 0!==e.value&&i.type!=l.OP_PORT_TYPE_TEXTURE&&i.set(e.value),i&&i.deSerializeSettings(e)}for(const e in n.portsOut){const i=o.getPort(n.portsOut[e].name);i&&i.type!=l.OP_PORT_TYPE_TEXTURE&&n.portsOut[e].hasOwnProperty("value")&&i.set(t.ops[s].portsOut[e].value)}i.push(o)}const h=Math.round(100*(CABLES.now()-r))/100;!this.silent&&h>200&&this._log.warn("long op init ",t.ops[s].objName,h)}for(const t in this.ops)this.ops[t].onLoadedValueSet&&(this.ops[t].onLoadedValueSet(this.ops[t]._origData),this.ops[t].onLoadedValueSet=null,this.ops[t]._origData=null);if(t.ops)for(let e=0;e<t.ops.length;e++){if(t.ops[e].portsIn)for(let i=0;i<t.ops[e].portsIn.length;i++)if(t.ops[e].portsIn[i].links)for(let s=0;s<t.ops[e].portsIn[i].links.length;s++)t.ops[e].portsIn[i].links[s]&&this._addLink(t.ops[e].portsIn[i].links[s].objIn,t.ops[e].portsIn[i].links[s].objOut,t.ops[e].portsIn[i].links[s].portIn,t.ops[e].portsIn[i].links[s].portOut);if(t.ops[e].portsOut)for(let i=0;i<t.ops[e].portsOut.length;i++)if(t.ops[e].portsOut[i].links)for(let s=0;s<t.ops[e].portsOut[i].links.length;s++)t.ops[e].portsOut[i].links[s]&&this._addLink(t.ops[e].portsOut[i].links[s].objIn,t.ops[e].portsOut[i].links[s].objOut,t.ops[e].portsOut[i].links[s].portIn,t.ops[e].portsOut[i].links[s].portOut)}for(const t in this.ops)this.ops[t].onLoaded&&(this.ops[t].onLoaded(),this.ops[t].onLoaded=null);for(const t in this.ops)this.ops[t].init&&(this.ops[t].init(),this.ops[t].init=null);if(this.config.variables)for(const t in this.config.variables)this.setVarValue(t,this.config.variables[t]);for(const t in this.ops)this.ops[t].initVarPorts(),delete this.ops[t].uiAttribs.pasted;setTimeout(()=>{this.loading.finished(s)},100),this.config.onPatchLoaded&&this.config.onPatchLoaded(this),this.emitEvent("patchLoadEnd",i,t,e)},Mt.prototype.profile=function(t){this.profiler=new Ct(this);for(const e in this.ops)this.ops[e].profile(t)},Mt.prototype.setVariable=function(t,e){void 0!==this._variables[t]?this._variables[t].setValue(e):this._log.warn("variable "+t+" not found!")},Mt.prototype._sortVars=function(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((t,e)=>t.localeCompare(e,"en",{sensitivity:"base"})).forEach(e=>{t[e]=this._variables[e]}),this._variables=t},Mt.prototype.hasVar=function(t){return void 0!==this._variables[t]},Mt.prototype.setVarValue=function(t,e,i){return this.hasVar(t)?this._variables[t].setValue(e):(this._variables[t]=new wt(t,e,i),this._sortVars(),this.emitEvent("variablesChanged")),this._variables[t]},Mt.prototype.getVarValue=function(t,e){if(this._variables.hasOwnProperty(t))return this._variables[t].getValue()},Mt.prototype.getVar=function(t){if(this._variables.hasOwnProperty(t))return this._variables[t]},Mt.prototype.deleteVar=function(t){for(let e=0;e<this.ops.length;e++)for(let i=0;i<this.ops[e].portsIn.length;i++)this.ops[e].portsIn[i].getVariableName()==t&&this.ops[e].portsIn[i].setVariable(null);delete this._variables[t],this.emitEvent("variableDeleted",t),this.emitEvent("variablesChanged")},Mt.prototype.getVars=function(t){if(void 0===t)return this._variables;const e=[];t==CABLES.OP_PORT_TYPE_STRING&&(t="string"),t==CABLES.OP_PORT_TYPE_VALUE&&(t="number"),t==CABLES.OP_PORT_TYPE_ARRAY&&(t="array"),t==CABLES.OP_PORT_TYPE_OBJECT&&(t="object");for(const i in this._variables)this._variables[i].type&&this._variables[i].type!=t||e.push(this._variables[i]);return e},Mt.prototype.exitError=function(t,e,i){if(this.aborted=!0,this&&this.config&&this.config.onError)this.config.onError(t,e);else if(!this.isEditorMode()){const s=document.createElement("div"),r=this.cgl.canvas.getBoundingClientRect();s.setAttribute("style","position:absolute;border:5px solid red;padding:15px;background-color:black;color:white;font-family:monospace;"),s.style.top=r.top+"px",s.style.left=r.left+"px";let n="cables - An error occured:<br/>";n+="["+t+"] - "+e,i&&(n+="<br/>Exception: "+i.message),s.innerHTML=n;const o=this.cgl.canvas.parentElement;for(;o.hasChildNodes();)o.removeChild(o.lastChild);document.body.appendChild(s)}},Mt.prototype.preRenderOps=function(){this._log.log("prerendering...");for(let t=0;t<this.ops.length;t++)this.ops[t].preRender&&(this.ops[t].preRender(),this._log.log("prerender "+this.ops[t].objName))},Mt.prototype.dispose=function(){this.pause(),this.clear()},Mt.prototype.pushTriggerStack=function(t){this._triggerStack.push(t)},Mt.prototype.popTriggerStack=function(){this._triggerStack.pop()},Mt.prototype.printTriggerStack=function(){if(0==this._triggerStack.length)return void console.log("stack length",this._triggerStack.length);console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].parent.name+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++)t.push(e+". "+this._triggerStack[e].parent.name+" "+this._triggerStack[e].name);console.table(t),console.groupEnd()};var Ut=Mt;const Lt={addPatch:function(t,e){let i=t,s=A();if("string"==typeof t&&(s=t,i=document.getElementById(s),!i))return void console.error(s+" Polyshape Container Element not found!");const r=document.createElement("canvas");return r.id="glcanvas_"+s,r.width=i.clientWidth,r.height=i.clientHeight,window.addEventListener("resize",function(){this.setAttribute("width",i.clientWidth),this.height=i.clientHeight}.bind(r)),i.appendChild(r),(e=e||{}).glCanvasId=r.id,e.onError||(e.onError=function(t){console.error(t)}),CABLES.patch=new Ut(e),r}},Bt={toneJsInitialized:!1,createAudioContext:function(t){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)return window.audioContext||(window.audioContext=new AudioContext),window.Tone&&!Bt.toneJsInitialized&&(Tone.setContext(window.audioContext),Bt.toneJsInitialized=!0),window.audioContext;t.patch.config.onError("NO_WEBAUDIO","Web Audio is not supported in this browser.")},getAudioContext:function(){return window.audioContext},createAudioInPort:function(t,e,i,s){if(!t||!e||!i){const e="ERROR: createAudioInPort needs three parameters, op, portName and audioNode";throw t.log(e),new Error(e)}s||(s=0),t.webAudio=t.webAudio||{},t.webAudio.audioInPorts=t.webAudio.audioInPorts||[];const r=t.inObject(e);return r.webAudio={},r.webAudio.previousAudioInNode=null,r.webAudio.audioNode=i,t.webAudio.audioInPorts[e]=r,r.onChange=function(){const e=r.get();if(e)try{e.connect?(e.connect(r.webAudio.audioNode,0,s),t.setUiError("audioCtx",null)):t.setUiError("audioCtx","The passed input is not an audio context. Please make sure you connect an audio context to the input.",2)}catch(i){throw t.log("Error: Failed to connect web audio node!",i),t.log("port.webAudio.audioNode",r.webAudio.audioNode),t.log("audioInNode: ",e),t.log("inputChannelIndex:",s),t.log("audioInNode.connect: ",e.connect),i}else if(r.webAudio.previousAudioInNode)try{r.webAudio.previousAudioInNode.disconnect&&r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode,0,s),t.setUiError("audioCtx",null)}catch(e){try{r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode)}catch(i){throw t.log("Disconnecting audio node with in/out port index, as well as without in/out-port-index did not work ",e),e.printStackTrace&&e.printStackTrace(),e}}r.webAudio.previousAudioInNode=e},r},replaceNodeInPort:function(t,e,i){const s=t.webAudio.previousAudioInNode;if(s&&s.disconnect){try{s.disconnect(e)}catch(t){throw t.printStackTrace&&t.printStackTrace(),new Error("replaceNodeInPort: Could not disconnect old audio node. "+t.name+" "+t.message)}t.webAudio.audioNode=i;try{s.connect(i)}catch(t){throw t.printStackTrace&&t.printStackTrace(),new Error("replaceNodeInPort: Could not connect to new node. "+t.name+" "+t.message)}}},createAudioOutPort:function(t,e,i){if(!t||!e||!i){const e="ERROR: createAudioOutPort needs three parameters, op, portName and audioNode";throw t.log(e),new Error(e)}const s=t.outObject(e);return s.set(i),s},createAudioParamInPort:function(t,e,i,s,r){if(!t||!e||!i)return t.log("ERROR: createAudioParamInPort needs three parameters, op, portName and audioNode"),t&&t.name&&t.log("opname: ",t.name),t.log("portName",e),void t.log("audioNode: ",i);t.webAudio=t.webAudio||{},t.webAudio.audioInPorts=t.webAudio.audioInPorts||[];const n=t.inDynamic(e,[l.OP_PORT_TYPE_VALUE,l.OP_PORT_TYPE_OBJECT],s,r);return n.webAudio={},n.webAudio.previousAudioInNode=null,n.webAudio.audioNode=i,t.webAudio.audioInPorts[e]=n,n.onChange=function(){const e=n.get(),i=n.webAudio.audioNode,s=Bt.getAudioContext();if(null!=e)if("object"==typeof e&&e.connect){try{e.connect(i)}catch(e){throw t.log("Could not connect audio node: ",e),e.printStackTrace&&e.printStackTrace(),e}n.webAudio.previousAudioInNode=e}else{if(i._param&&i._param.minValue&&i._param.maxValue)if(e>=i._param.minValue&&e<=i._param.maxValue)try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("Possible AudioParam problem with tone.js op: ",e),e.printStackTrace&&e.printStackTrace(),e}else t.log("Warning: The value for an audio parameter is out of range!");else if(i.minValue&&i.maxValue)if(e>=i.minValue&&e<=i.maxValue)try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("AudioParam has minValue / maxValue defined, and value is in range, but setting the value failed! ",e),e.printStackTrace&&e.printStackTrace(),e}else t.log("Warning: The value for an audio parameter is out of range!");else try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("Possible AudioParam problem (without minValue / maxValue): ",e),e.printStackTrace&&e.printStackTrace(),e}if(n.webAudio.previousAudioInNode&&n.webAudio.previousAudioInNode.disconnect){try{n.webAudio.previousAudioInNode.disconnect(i)}catch(e){throw t.log("Could not disconnect previous audio node: ",e),e}n.webAudio.previousAudioInNode=void 0}}else n.webAudio.previousAudioInNode},n},loadAudioFile:function(t,e,i,s,r){const n=Bt.createAudioContext();let o=null;(r||void 0===r)&&(o=t.loading.start("audio",e),t.isEditorMode()&&gui.jobs().start({id:"loadaudio"+o,title:" loading audio ("+e+")"}));const h=new XMLHttpRequest;e&&(h.open("GET",e,!0),h.responseType="arraybuffer",h.onload=function(){t.loading.finished(o),t.isEditorMode()&&gui.jobs().finish("loadaudio"+o),n.decodeAudioData(h.response,i,s)},h.send())},isValidToneTime:function(t){try{new Tone.Time(t)}catch(t){return!1}return!0},isValidToneNote:function(t){try{Tone.Frequency(t)}catch(t){return!1}return!0}},kt=function(t,e,i){this._patch=t,this.connector=i,this._log=new h("PatchConnectionReceiver")};kt.prototype._addOp=function(t){let e=null;t.vars.uiAttribs&&(e=t.vars.uiAttribs);const i=this._patch.addOp(t.vars.objName,e,t.vars.opId,!0);i&&(i.id=t.vars.opId,t.vars.portsIn&&t.vars.portsIn.forEach(t=>{const e=i.getPortByName(t.name);e&&e.set(t.value)}))},kt.prototype._receive=function(t){let e={};if(e=t.hasOwnProperty("event")?t:JSON.parse(t.data),e.event==u.PACO_OP_CREATE){if(this._patch.getOpById(e.vars.opId))return;this._log.verbose("op create:",e.vars.objName),window.gui?gui.serverOps.loadOpLibs(e.vars.objName,()=>{this._addOp(e)}):this._addOp(e)}else if(e.event==u.PACO_DESERIALIZE)e.vars.json&&(window.gui?gui.serverOps.loadProjectLibs(e.vars.json,()=>{this._patch.deSerialize(e.vars.json,e.vars.genIds)}):this._patch.deSerialize(e.vars.json,e.vars.genIds));else if(e.event==u.PACO_LOAD)this._log.verbose("PACO load patch....."),this._patch.clear(),window.gui?gui.serverOps.loadProjectLibs(JSON.parse(e.vars.patch),()=>{this._patch.deSerialize(e.vars.patch)}):this._patch.deSerialize(e.vars.patch);else if(e.event==u.PACO_CLEAR)this._patch.clear(),this._log.log("clear");else if(e.event==u.PACO_OP_DELETE){this._log.verbose("op delete",e.vars.objName);this._patch.getOpById(e.vars.op);this._patch.deleteOp(e.vars.op,!0)}else if(e.event==u.PACO_OP_ENABLE){const t=this._patch.getOpById(e.vars.op);t&&(t.enabled=!0)}else if(e.event==u.PACO_OP_DISABLE){const t=this._patch.getOpById(e.vars.op);t&&(t.enabled=!1)}else if(e.event==u.PACO_UIATTRIBS){const t=this._patch.getOpById(e.vars.op);t&&t.setUiAttrib(e.vars.uiAttribs)}else if(e.event==u.PACO_UNLINK){const t=this._patch.getOpById(e.vars.op1),i=this._patch.getOpById(e.vars.op2);if(!t||!i)return;const s=t.getPort(e.vars.port1),r=i.getPort(e.vars.port2);s&&r?s.removeLinkTo(r):this._log.warn("paco unlink could not find port...")}else if(e.event==u.PACO_LINK){const t=this._patch.getOpById(e.vars.op1),i=this._patch.getOpById(e.vars.op2);t&&i&&this._patch.link(t,e.vars.port1,i,e.vars.port2)}else if(e.event==u.PACO_VALUECHANGE){if("+ create new one"===e.vars.v)return;const t=this._patch.getOpById(e.vars.op);if(t){const i=t.getPort(e.vars.port);i&&i.set(e.vars.v)}}else if(e.event==u.PACO_VARIABLES){const t=this._patch.getOpById(e.vars.opId);t&&t.varName&&t.varName.set(e.vars.varName)}else if(e.event==u.PACO_TRIGGERS){const t=this._patch.getOpById(e.vars.opId);t&&t.varName&&t.varName.set(e.vars.varName)}else if(e.event==u.PACO_PORT_SETVARIABLE){const t=this._patch.getOpById(e.vars.opId);if(t){const i=t.getPortByName(e.vars.portName);i&&i.setVariable(e.vars.variableName)}}else if(e.event==u.PACO_PORT_SETANIMATED){const t=this._patch.getOpById(e.vars.opId);if(t){t.portsIn[e.vars.portIndex]&&e.vars.hasOwnProperty("targetState")&&this._patch.emitEvent("pacoPortValueSetAnimated",t,e.vars.portIndex,e.vars.targetState,e.vars.defaultValue)}}else if(e.event==u.PACO_PORT_ANIM_UPDATED){const t=this._patch.getOpById(e.vars.opId);if(t){const i=t.getPortByName(e.vars.portName);if(i){const t=i.getSerialized();t.anim=e.vars.anim,i.anim=null,i.deSerializeSettings(t),this._patch.emitEvent("pacoPortAnimUpdated",i)}}}else this._log.warn("unknown patchConnectionEvent!",t)};const Dt=function(t){this.connectors=[],this.paused=!1,t.addEventListener("onOpDelete",t=>{this.send(CABLES.PACO_OP_DELETE,{op:t.id,objName:t.objName})}),t.addEventListener("patchClearStart",()=>{this.paused=!0}),t.addEventListener("patchClearEnd",()=>{this.paused=!1}),t.addEventListener("patchLoadStart",()=>{this.paused=!0}),t.addEventListener("patchLoadEnd",(t,e,i)=>{this.paused=!1,this.send(CABLES.PACO_DESERIALIZE,{json:e,genIds:i})}),t.addEventListener("onOpAdd",t=>{const e=[];t.portsIn.forEach(t=>{const i={id:t.id,name:t.name,value:t.get()};e.push(i)});let i={};t.uiAttribs&&(i={...t.uiAttribs}),this.send(CABLES.PACO_OP_CREATE,{opId:t.id,objName:t.objName,uiAttribs:i,portsIn:e})}),t.addEventListener("onUnLink",(t,e)=>{this.send(CABLES.PACO_UNLINK,{op1:t.parent.id,op2:e.parent.id,port1:t.getName(),port2:e.getName()})}),t.addEventListener("onUiAttribsChange",(t,e)=>{e&&(delete e.extendTitle,delete e.history,delete e.translate,Object.keys(e).length>0&&this.send(CABLES.PACO_UIATTRIBS,{op:t.id,uiAttribs:e}))}),t.addEventListener("opVariableNameChanged",(t,e)=>{const i={opId:t.id,varName:e};this.send(CABLES.PACO_VARIABLES,i)}),t.addEventListener("opTriggerNameChanged",(t,e)=>{const i={opId:t.id,varName:e};this.send(CABLES.PACO_TRIGGERS,i)}),t.addEventListener("onLink",(t,e)=>{this.send(CABLES.PACO_LINK,{op1:t.parent.id,op2:e.parent.id,port1:t.name,port2:e.name})}),t.addEventListener("portSetVariable",(t,e,i)=>{const s={opId:t.id,portName:e.name,variableName:i};this.send(CABLES.PACO_PORT_SETVARIABLE,s)}),t.addEventListener("portAnimUpdated",(t,e,i)=>{if(t&&e){const s={opId:t.id,portName:e.name,anim:i.getSerialized()};this.send(CABLES.PACO_PORT_ANIM_UPDATED,s)}})};Dt.prototype.send=function(t,e){if(!this.paused&&(t!==CABLES.PACO_VALUECHANGE||"+ create new one"!==e.v))for(let i=0;i<this.connectors.length;i++)this.connectors[i].send(t,e)};const Vt=function(){window.BroadcastChannel&&(this.bc=new BroadcastChannel("test_channel"))};Vt.prototype.receive=function(t){this.bc&&(this._log.log("init"),this.bc.onmessage=t._receive.bind(t))},Vt.prototype.send=function(t,e){if(!this.bc)return;const i={};i.event=t,i.vars=e,this.bc.postMessage(JSON.stringify(i))};const Gt=Object.assign({EventTarget:W,EMBED:Lt,Link:St,Port:et,Op:Pt,Profiler:Ct,Patch:Ut,Instancing:Ft,Timer:pt,WEBAUDIO:Bt,Variable:function(){let t=null;const e=[];this.onChanged=function(t){e.push(t)},this.getValue=function(){return t},this.setValue=function(e){t=e,this.emitChanged()},this.emitChanged=function(){for(let t=0;t<e.length;t++)e[t]()}},LoadingStatus:Nt,now:_t,internalNow:gt},r,s,n,a,o,c,u,a,l);e.default=Gt;(function(){return!this})()||console.warn("not in strict mode: index core")}]).default;
//# sourceMappingURL=cables.min.js.map

var CABLES = CABLES || {}; CABLES.build = {"timestamp":1658229186222,"created":"2022-07-19T11:13:06.222Z","git":{"branch":"master","commit":"819fc0e7c02646be982b7338326b610a383cd8f6","date":"2022-07-19T11:09:39.000Z","message":"corelib"}};
/*!
@fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.1.0

Copyright (c) 2015-2019, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).glMatrix={})}(this,function(t){"use strict";var n=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array,r=Math.random;var u=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});var e=Object.freeze({EPSILON:n,get ARRAY_TYPE(){return a},RANDOM:r,setMatrixArrayType:function(t){a=t},toRadian:function(t){return t*u},equals:function(t,a){return Math.abs(t-a)<=n*Math.max(1,Math.abs(t),Math.abs(a))}});function o(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*i+e*c,t[1]=u*i+o*c,t[2]=r*h+e*s,t[3]=u*h+o*s,t}function i(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}var c=o,h=i,s=Object.freeze({create:function(){var t=new a(4);return a!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e},set:function(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t},transpose:function(t,n){if(t===n){var a=n[1];t[1]=n[2],t[2]=a}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*e-u*r;return o?(o=1/o,t[0]=e*o,t[1]=-r*o,t[2]=-u*o,t[3]=a*o,t):null},adjoint:function(t,n){var a=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=a,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:o,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+e*i,t[1]=u*c+o*i,t[2]=r*-i+e*c,t[3]=u*-i+o*c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1];return t[0]=r*i,t[1]=u*i,t[2]=e*c,t[3]=o*c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,n,a,r){return t[2]=r[2]/r[0],a[0]=r[0],a[1]=r[1],a[3]=r[3]-t[2]*a[1],[t,n,a]},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t},subtract:i,exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))},multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},mul:c,sub:h});function M(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return t[0]=r*h+e*s,t[1]=u*h+o*s,t[2]=r*M+e*f,t[3]=u*M+o*f,t[4]=r*l+e*v+i,t[5]=u*l+o*v+c,t}function f(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t}var l=M,v=f,b=Object.freeze({create:function(){var t=new a(6);return a!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,n,r,u,e,o){var i=new a(6);return i[0]=t,i[1]=n,i[2]=r,i[3]=u,i[4]=e,i[5]=o,i},set:function(t,n,a,r,u,e,o){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=a*e-r*u;return c?(c=1/c,t[0]=e*c,t[1]=-r*c,t[2]=-u*c,t[3]=a*c,t[4]=(u*i-e*o)*c,t[5]=(r*o-a*i)*c,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:M,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=Math.sin(a),s=Math.cos(a);return t[0]=r*s+e*h,t[1]=u*s+o*h,t[2]=r*-h+e*s,t[3]=u*-h+o*s,t[4]=i,t[5]=c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r*h,t[1]=u*h,t[2]=e*s,t[3]=o*s,t[4]=i,t[5]=c,t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=r*h+e*s+i,t[5]=u*h+o*s+c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t[4]=0,t[5]=0,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t},subtract:f,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return Math.abs(r-h)<=n*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(u-s)<=n*Math.max(1,Math.abs(u),Math.abs(s))&&Math.abs(e-M)<=n*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(o-f)<=n*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-l)<=n*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(c-v)<=n*Math.max(1,Math.abs(c),Math.abs(v))},mul:l,sub:v});function m(){var t=new a(9);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function d(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return t[0]=f*r+l*o+v*h,t[1]=f*u+l*i+v*s,t[2]=f*e+l*c+v*M,t[3]=b*r+m*o+d*h,t[4]=b*u+m*i+d*s,t[5]=b*e+m*c+d*M,t[6]=x*r+p*o+y*h,t[7]=x*u+p*i+y*s,t[8]=x*e+p*c+y*M,t}function x(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t}var p=d,y=x,q=Object.freeze({create:m,fromMat4:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},clone:function(t){var n=new a(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromValues:function(t,n,r,u,e,o,i,c,h){var s=new a(9);return s[0]=t,s[1]=n,s[2]=r,s[3]=u,s[4]=e,s[5]=o,s[6]=i,s[7]=c,s[8]=h,s},set:function(t,n,a,r,u,e,o,i,c,h){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[5];t[1]=n[3],t[2]=n[6],t[3]=a,t[5]=n[7],t[6]=r,t[7]=u}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=s*o-i*h,f=-s*e+i*c,l=h*e-o*c,v=a*M+r*f+u*l;return v?(v=1/v,t[0]=M*v,t[1]=(-s*r+u*h)*v,t[2]=(i*r-u*o)*v,t[3]=f*v,t[4]=(s*a-u*c)*v,t[5]=(-i*a+u*e)*v,t[6]=l*v,t[7]=(-h*a+r*c)*v,t[8]=(o*a-r*e)*v,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8];return t[0]=o*s-i*h,t[1]=u*h-r*s,t[2]=r*i-u*o,t[3]=i*c-e*s,t[4]=a*s-u*c,t[5]=u*e-a*i,t[6]=e*h-o*c,t[7]=r*c-a*h,t[8]=a*o-r*e,t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8];return n*(h*e-o*c)+a*(-h*u+o*i)+r*(c*u-e*i)},multiply:d,translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=f*r+l*o+h,t[7]=f*u+l*i+s,t[8]=f*e+l*c+M,t},rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=Math.sin(a),l=Math.cos(a);return t[0]=l*r+f*o,t[1]=l*u+f*i,t[2]=l*e+f*c,t[3]=l*o-f*r,t[4]=l*i-f*u,t[5]=l*c-f*e,t[6]=h,t[7]=s,t[8]=M,t},scale:function(t,n,a){var r=a[0],u=a[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=u*n[3],t[4]=u*n[4],t[5]=u*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=-a,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[3]=s-d,t[6]=f+m,t[1]=s+d,t[4]=1-h-v,t[7]=l-b,t[2]=f-m,t[5]=l+b,t[8]=1-h-M,t},normalFromMat4:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(c*z-o*I-h*R)*S,t[2]=(o*j-i*z+h*w)*S,t[3]=(u*j-r*I-e*P)*S,t[4]=(a*I-u*z+e*R)*S,t[5]=(r*z-a*j-e*w)*S,t[6]=(b*A-m*g+d*q)*S,t[7]=(m*y-v*A-d*p)*S,t[8]=(v*g-b*y+d*x)*S,t):null},projection:function(t,n,a){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/a,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t},subtract:x,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return Math.abs(r-f)<=n*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(u-l)<=n*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(e-v)<=n*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(o-b)<=n*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-m)<=n*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(c-d)<=n*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(h-x)<=n*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(s-p)<=n*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(M-y)<=n*Math.max(1,Math.abs(M),Math.abs(y))},mul:p,sub:y});function g(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],b=n[12],m=n[13],d=n[14],x=n[15],p=a[0],y=a[1],q=a[2],g=a[3];return t[0]=p*r+y*i+q*M+g*b,t[1]=p*u+y*c+q*f+g*m,t[2]=p*e+y*h+q*l+g*d,t[3]=p*o+y*s+q*v+g*x,p=a[4],y=a[5],q=a[6],g=a[7],t[4]=p*r+y*i+q*M+g*b,t[5]=p*u+y*c+q*f+g*m,t[6]=p*e+y*h+q*l+g*d,t[7]=p*o+y*s+q*v+g*x,p=a[8],y=a[9],q=a[10],g=a[11],t[8]=p*r+y*i+q*M+g*b,t[9]=p*u+y*c+q*f+g*m,t[10]=p*e+y*h+q*l+g*d,t[11]=p*o+y*s+q*v+g*x,p=a[12],y=a[13],q=a[14],g=a[15],t[12]=p*r+y*i+q*M+g*b,t[13]=p*u+y*c+q*f+g*m,t[14]=p*e+y*h+q*l+g*d,t[15]=p*o+y*s+q*v+g*x,t}function w(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=r+r,c=u+u,h=e+e,s=r*i,M=r*c,f=r*h,l=u*c,v=u*h,b=e*h,m=o*i,d=o*c,x=o*h;return t[0]=1-(l+b),t[1]=M+x,t[2]=f-d,t[3]=0,t[4]=M-x,t[5]=1-(s+b),t[6]=v+m,t[7]=0,t[8]=f+d,t[9]=v-m,t[10]=1-(s+l),t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function R(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function z(t,n){var a=n[0],r=n[1],u=n[2],e=n[4],o=n[5],i=n[6],c=n[8],h=n[9],s=n[10];return t[0]=Math.hypot(a,r,u),t[1]=Math.hypot(e,o,i),t[2]=Math.hypot(c,h,s),t}function P(t,n){var r=new a(3);z(r,n);var u=1/r[0],e=1/r[1],o=1/r[2],i=n[0]*u,c=n[1]*e,h=n[2]*o,s=n[4]*u,M=n[5]*e,f=n[6]*o,l=n[8]*u,v=n[9]*e,b=n[10]*o,m=i+M+b,d=0;return m>0?(d=2*Math.sqrt(m+1),t[3]=.25*d,t[0]=(f-v)/d,t[1]=(l-h)/d,t[2]=(c-s)/d):i>M&&i>b?(d=2*Math.sqrt(1+i-M-b),t[3]=(f-v)/d,t[0]=.25*d,t[1]=(c+s)/d,t[2]=(l+h)/d):M>b?(d=2*Math.sqrt(1+M-i-b),t[3]=(l-h)/d,t[0]=(c+s)/d,t[1]=.25*d,t[2]=(f+v)/d):(d=2*Math.sqrt(1+b-i-M),t[3]=(c-s)/d,t[0]=(l+h)/d,t[1]=(f+v)/d,t[2]=.25*d),t}function j(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t[9]=n[9]-a[9],t[10]=n[10]-a[10],t[11]=n[11]-a[11],t[12]=n[12]-a[12],t[13]=n[13]-a[13],t[14]=n[14]-a[14],t[15]=n[15]-a[15],t}var I=A,S=j,E=Object.freeze({create:function(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var n=new a(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},fromValues:function(t,n,r,u,e,o,i,c,h,s,M,f,l,v,b,m){var d=new a(16);return d[0]=t,d[1]=n,d[2]=r,d[3]=u,d[4]=e,d[5]=o,d[6]=i,d[7]=c,d[8]=h,d[9]=s,d[10]=M,d[11]=f,d[12]=l,d[13]=v,d[14]=b,d[15]=m,d},set:function(t,n,a,r,u,e,o,i,c,h,s,M,f,l,v,b,m){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t[9]=s,t[10]=M,t[11]=f,t[12]=l,t[13]=v,t[14]=b,t[15]=m,t},identity:g,transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[3],e=n[6],o=n[7],i=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=a,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=e,t[11]=n[14],t[12]=u,t[13]=o,t[14]=i}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(u*j-r*I-e*P)*S,t[2]=(b*A-m*g+d*q)*S,t[3]=(f*g-M*A-l*q)*S,t[4]=(c*z-o*I-h*R)*S,t[5]=(a*I-u*z+e*R)*S,t[6]=(m*y-v*A-d*p)*S,t[7]=(s*A-f*y+l*p)*S,t[8]=(o*j-i*z+h*w)*S,t[9]=(r*z-a*j-e*w)*S,t[10]=(v*g-b*y+d*x)*S,t[11]=(M*y-s*g-l*x)*S,t[12]=(i*R-o*P-c*w)*S,t[13]=(a*P-r*R+u*w)*S,t[14]=(b*p-v*q-m*x)*S,t[15]=(s*q-M*p+f*x)*S,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15];return t[0]=i*(f*d-l*m)-M*(c*d-h*m)+b*(c*l-h*f),t[1]=-(r*(f*d-l*m)-M*(u*d-e*m)+b*(u*l-e*f)),t[2]=r*(c*d-h*m)-i*(u*d-e*m)+b*(u*h-e*c),t[3]=-(r*(c*l-h*f)-i*(u*l-e*f)+M*(u*h-e*c)),t[4]=-(o*(f*d-l*m)-s*(c*d-h*m)+v*(c*l-h*f)),t[5]=a*(f*d-l*m)-s*(u*d-e*m)+v*(u*l-e*f),t[6]=-(a*(c*d-h*m)-o*(u*d-e*m)+v*(u*h-e*c)),t[7]=a*(c*l-h*f)-o*(u*l-e*f)+s*(u*h-e*c),t[8]=o*(M*d-l*b)-s*(i*d-h*b)+v*(i*l-h*M),t[9]=-(a*(M*d-l*b)-s*(r*d-e*b)+v*(r*l-e*M)),t[10]=a*(i*d-h*b)-o*(r*d-e*b)+v*(r*h-e*i),t[11]=-(a*(i*l-h*M)-o*(r*l-e*M)+s*(r*h-e*i)),t[12]=-(o*(M*m-f*b)-s*(i*m-c*b)+v*(i*f-c*M)),t[13]=a*(M*m-f*b)-s*(r*m-u*b)+v*(r*f-u*M),t[14]=-(a*(i*m-c*b)-o*(r*m-u*b)+v*(r*c-u*i)),t[15]=a*(i*f-c*M)-o*(r*f-u*M)+s*(r*c-u*i),t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8],s=t[9],M=t[10],f=t[11],l=t[12],v=t[13],b=t[14],m=t[15];return(n*o-a*e)*(M*m-f*b)-(n*i-r*e)*(s*m-f*v)+(n*c-u*e)*(s*b-M*v)+(a*i-r*o)*(h*m-f*l)-(a*c-u*o)*(h*b-M*l)+(r*c-u*i)*(h*v-s*l)},multiply:A,translate:function(t,n,a){var r,u,e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2];return n===t?(t[12]=n[0]*b+n[4]*m+n[8]*d+n[12],t[13]=n[1]*b+n[5]*m+n[9]*d+n[13],t[14]=n[2]*b+n[6]*m+n[10]*d+n[14],t[15]=n[3]*b+n[7]*m+n[11]*d+n[15]):(r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=h,t[7]=s,t[8]=M,t[9]=f,t[10]=l,t[11]=v,t[12]=r*b+i*m+M*d+n[12],t[13]=u*b+c*m+f*d+n[13],t[14]=e*b+h*m+l*d+n[14],t[15]=o*b+s*m+v*d+n[15]),t},scale:function(t,n,a){var r=a[0],u=a[1],e=a[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*u,t[5]=n[5]*u,t[6]=n[6]*u,t[7]=n[7]*u,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},rotate:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b,m,d,x,p,y,q,g,A,w,R,z,P,j,I=u[0],S=u[1],E=u[2],O=Math.hypot(I,S,E);return O<n?null:(I*=O=1/O,S*=O,E*=O,e=Math.sin(r),i=1-(o=Math.cos(r)),c=a[0],h=a[1],s=a[2],M=a[3],f=a[4],l=a[5],v=a[6],b=a[7],m=a[8],d=a[9],x=a[10],p=a[11],y=I*I*i+o,q=S*I*i+E*e,g=E*I*i-S*e,A=I*S*i-E*e,w=S*S*i+o,R=E*S*i+I*e,z=I*E*i+S*e,P=S*E*i-I*e,j=E*E*i+o,t[0]=c*y+f*q+m*g,t[1]=h*y+l*q+d*g,t[2]=s*y+v*q+x*g,t[3]=M*y+b*q+p*g,t[4]=c*A+f*w+m*R,t[5]=h*A+l*w+d*R,t[6]=s*A+v*w+x*R,t[7]=M*A+b*w+p*R,t[8]=c*z+f*P+m*j,t[9]=h*z+l*P+d*j,t[10]=s*z+v*P+x*j,t[11]=M*z+b*P+p*j,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},rotateX:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[4],o=n[5],i=n[6],c=n[7],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=e*u+h*r,t[5]=o*u+s*r,t[6]=i*u+M*r,t[7]=c*u+f*r,t[8]=h*u-e*r,t[9]=s*u-o*r,t[10]=M*u-i*r,t[11]=f*u-c*r,t},rotateY:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u-h*r,t[1]=o*u-s*r,t[2]=i*u-M*r,t[3]=c*u-f*r,t[8]=e*r+h*u,t[9]=o*r+s*u,t[10]=i*r+M*u,t[11]=c*r+f*u,t},rotateZ:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[4],s=n[5],M=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u+h*r,t[1]=o*u+s*r,t[2]=i*u+M*r,t[3]=c*u+f*r,t[4]=h*u-e*r,t[5]=s*u-o*r,t[6]=M*u-i*r,t[7]=f*u-c*r,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,a,r){var u,e,o,i=r[0],c=r[1],h=r[2],s=Math.hypot(i,c,h);return s<n?null:(i*=s=1/s,c*=s,h*=s,u=Math.sin(a),o=1-(e=Math.cos(a)),t[0]=i*i*o+e,t[1]=c*i*o+h*u,t[2]=h*i*o-c*u,t[3]=0,t[4]=i*c*o-h*u,t[5]=c*c*o+e,t[6]=h*c*o+i*u,t[7]=0,t[8]=i*h*o+c*u,t[9]=c*h*o-i*u,t[10]=h*h*o+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:w,fromQuat2:function(t,n){var r=new a(3),u=-n[0],e=-n[1],o=-n[2],i=n[3],c=n[4],h=n[5],s=n[6],M=n[7],f=u*u+e*e+o*o+i*i;return f>0?(r[0]=2*(c*i+M*u+h*o-s*e)/f,r[1]=2*(h*i+M*e+s*u-c*o)/f,r[2]=2*(s*i+M*o+c*e-h*u)/f):(r[0]=2*(c*i+M*u+h*o-s*e),r[1]=2*(h*i+M*e+s*u-c*o),r[2]=2*(s*i+M*o+c*e-h*u)),w(t,n,r),t},getTranslation:R,getScaling:z,getRotation:P,fromRotationTranslationScale:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3],c=u+u,h=e+e,s=o+o,M=u*c,f=u*h,l=u*s,v=e*h,b=e*s,m=o*s,d=i*c,x=i*h,p=i*s,y=r[0],q=r[1],g=r[2];return t[0]=(1-(v+m))*y,t[1]=(f+p)*y,t[2]=(l-x)*y,t[3]=0,t[4]=(f-p)*q,t[5]=(1-(M+m))*q,t[6]=(b+d)*q,t[7]=0,t[8]=(l+x)*g,t[9]=(b-d)*g,t[10]=(1-(M+v))*g,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,n,a,r,u){var e=n[0],o=n[1],i=n[2],c=n[3],h=e+e,s=o+o,M=i+i,f=e*h,l=e*s,v=e*M,b=o*s,m=o*M,d=i*M,x=c*h,p=c*s,y=c*M,q=r[0],g=r[1],A=r[2],w=u[0],R=u[1],z=u[2],P=(1-(b+d))*q,j=(l+y)*q,I=(v-p)*q,S=(l-y)*g,E=(1-(f+d))*g,O=(m+x)*g,T=(v+p)*A,D=(m-x)*A,F=(1-(f+b))*A;return t[0]=P,t[1]=j,t[2]=I,t[3]=0,t[4]=S,t[5]=E,t[6]=O,t[7]=0,t[8]=T,t[9]=D,t[10]=F,t[11]=0,t[12]=a[0]+w-(P*w+S*R+T*z),t[13]=a[1]+R-(j*w+E*R+D*z),t[14]=a[2]+z-(I*w+O*R+F*z),t[15]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[1]=s+d,t[2]=f-m,t[3]=0,t[4]=s-d,t[5]=1-h-v,t[6]=l+b,t[7]=0,t[8]=f+m,t[9]=l-b,t[10]=1-h-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,n,a,r,u,e,o){var i=1/(a-n),c=1/(u-r),h=1/(e-o);return t[0]=2*e*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*e*c,t[6]=0,t[7]=0,t[8]=(a+n)*i,t[9]=(u+r)*c,t[10]=(o+e)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e*2*h,t[15]=0,t},perspective:function(t,n,a,r,u){var e,o=1/Math.tan(n/2);return t[0]=o/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(e=1/(r-u),t[10]=(u+r)*e,t[14]=2*u*r*e):(t[10]=-1,t[14]=-2*r),t},perspectiveFromFieldOfView:function(t,n,a,r){var u=Math.tan(n.upDegrees*Math.PI/180),e=Math.tan(n.downDegrees*Math.PI/180),o=Math.tan(n.leftDegrees*Math.PI/180),i=Math.tan(n.rightDegrees*Math.PI/180),c=2/(o+i),h=2/(u+e);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(o-i)*c*.5,t[9]=(u-e)*h*.5,t[10]=r/(a-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*a/(a-r),t[15]=0,t},ortho:function(t,n,a,r,u,e,o){var i=1/(n-a),c=1/(r-u),h=1/(e-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(n+a)*i,t[13]=(u+r)*c,t[14]=(o+e)*h,t[15]=1,t},lookAt:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2],x=u[0],p=u[1],y=u[2],q=r[0],A=r[1],w=r[2];return Math.abs(b-q)<n&&Math.abs(m-A)<n&&Math.abs(d-w)<n?g(t):(M=b-q,f=m-A,l=d-w,e=p*(l*=v=1/Math.hypot(M,f,l))-y*(f*=v),o=y*(M*=v)-x*l,i=x*f-p*M,(v=Math.hypot(e,o,i))?(e*=v=1/v,o*=v,i*=v):(e=0,o=0,i=0),c=f*i-l*o,h=l*e-M*i,s=M*o-f*e,(v=Math.hypot(c,h,s))?(c*=v=1/v,h*=v,s*=v):(c=0,h=0,s=0),t[0]=e,t[1]=c,t[2]=M,t[3]=0,t[4]=o,t[5]=h,t[6]=f,t[7]=0,t[8]=i,t[9]=s,t[10]=l,t[11]=0,t[12]=-(e*b+o*m+i*d),t[13]=-(c*b+h*m+s*d),t[14]=-(M*b+f*m+l*d),t[15]=1,t)},targetTo:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=r[0],c=r[1],h=r[2],s=u-a[0],M=e-a[1],f=o-a[2],l=s*s+M*M+f*f;l>0&&(s*=l=1/Math.sqrt(l),M*=l,f*=l);var v=c*f-h*M,b=h*s-i*f,m=i*M-c*s;return(l=v*v+b*b+m*m)>0&&(v*=l=1/Math.sqrt(l),b*=l,m*=l),t[0]=v,t[1]=b,t[2]=m,t[3]=0,t[4]=M*m-f*b,t[5]=f*v-s*m,t[6]=s*b-M*v,t[7]=0,t[8]=s,t[9]=M,t[10]=f,t[11]=0,t[12]=u,t[13]=e,t[14]=o,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t[9]=n[9]+a[9],t[10]=n[10]+a[10],t[11]=n[11]+a[11],t[12]=n[12]+a[12],t[13]=n[13]+a[13],t[14]=n[14]+a[14],t[15]=n[15]+a[15],t},subtract:j,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=n[11]*a,t[12]=n[12]*a,t[13]=n[13]*a,t[14]=n[14]*a,t[15]=n[15]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t[9]=n[9]+a[9]*r,t[10]=n[10]+a[10]*r,t[11]=n[11]+a[11]*r,t[12]=n[12]+a[12]*r,t[13]=n[13]+a[13]*r,t[14]=n[14]+a[14]*r,t[15]=n[15]+a[15]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=t[9],l=t[10],v=t[11],b=t[12],m=t[13],d=t[14],x=t[15],p=a[0],y=a[1],q=a[2],g=a[3],A=a[4],w=a[5],R=a[6],z=a[7],P=a[8],j=a[9],I=a[10],S=a[11],E=a[12],O=a[13],T=a[14],D=a[15];return Math.abs(r-p)<=n*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(u-y)<=n*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(e-q)<=n*Math.max(1,Math.abs(e),Math.abs(q))&&Math.abs(o-g)<=n*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(i-A)<=n*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(c-w)<=n*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-R)<=n*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(s-z)<=n*Math.max(1,Math.abs(s),Math.abs(z))&&Math.abs(M-P)<=n*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(f-j)<=n*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(l-I)<=n*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(v-S)<=n*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(b-E)<=n*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(m-O)<=n*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(d-T)<=n*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(x-D)<=n*Math.max(1,Math.abs(x),Math.abs(D))},mul:I,sub:S});function O(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function T(t){var n=t[0],a=t[1],r=t[2];return Math.hypot(n,a,r)}function D(t,n,r){var u=new a(3);return u[0]=t,u[1]=n,u[2]=r,u}function F(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t}function L(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t}function V(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t}function Q(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return Math.hypot(a,r,u)}function Y(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return a*a+r*r+u*u}function X(t){var n=t[0],a=t[1],r=t[2];return n*n+a*a+r*r}function Z(t,n){var a=n[0],r=n[1],u=n[2],e=a*a+r*r+u*u;return e>0&&(e=1/Math.sqrt(e)),t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function _(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function B(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2];return t[0]=u*c-e*i,t[1]=e*o-r*c,t[2]=r*i-u*o,t}var N,k=F,U=L,W=V,C=Q,G=Y,H=T,J=X,K=(N=O(),function(t,n,a,r,u,e){var o,i;for(n||(n=3),a||(a=0),i=r?Math.min(r*n+a,t.length):t.length,o=a;o<i;o+=n)N[0]=t[o],N[1]=t[o+1],N[2]=t[o+2],u(N,N,e),t[o]=N[0],t[o+1]=N[1],t[o+2]=N[2];return t}),$=Object.freeze({create:O,clone:function(t){var n=new a(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},length:T,fromValues:D,copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},set:function(t,n,a,r){return t[0]=n,t[1]=a,t[2]=r,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t},subtract:F,multiply:L,divide:V,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t},distance:Q,squaredDistance:Y,squaredLength:X,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t},normalize:Z,dot:_,cross:B,lerp:function(t,n,a,r){var u=n[0],e=n[1],o=n[2];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t},hermite:function(t,n,a,r,u,e){var o=e*e,i=o*(2*e-3)+1,c=o*(e-2)+e,h=o*(e-1),s=o*(3-2*e);return t[0]=n[0]*i+a[0]*c+r[0]*h+u[0]*s,t[1]=n[1]*i+a[1]*c+r[1]*h+u[1]*s,t[2]=n[2]*i+a[2]*c+r[2]*h+u[2]*s,t},bezier:function(t,n,a,r,u,e){var o=1-e,i=o*o,c=e*e,h=i*o,s=3*e*i,M=3*c*o,f=c*e;return t[0]=n[0]*h+a[0]*s+r[0]*M+u[0]*f,t[1]=n[1]*h+a[1]*s+r[1]*M+u[1]*f,t[2]=n[2]*h+a[2]*s+r[2]*M+u[2]*f,t},random:function(t,n){n=n||1;var a=2*r()*Math.PI,u=2*r()-1,e=Math.sqrt(1-u*u)*n;return t[0]=Math.cos(a)*e,t[1]=Math.sin(a)*e,t[2]=u*n,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[3]*r+a[7]*u+a[11]*e+a[15];return o=o||1,t[0]=(a[0]*r+a[4]*u+a[8]*e+a[12])/o,t[1]=(a[1]*r+a[5]*u+a[9]*e+a[13])/o,t[2]=(a[2]*r+a[6]*u+a[10]*e+a[14])/o,t},transformMat3:function(t,n,a){var r=n[0],u=n[1],e=n[2];return t[0]=r*a[0]+u*a[3]+e*a[6],t[1]=r*a[1]+u*a[4]+e*a[7],t[2]=r*a[2]+u*a[5]+e*a[8],t},transformQuat:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=u*h-e*c,M=e*i-r*h,f=r*c-u*i,l=u*f-e*M,v=e*s-r*f,b=r*M-u*s,m=2*o;return s*=m,M*=m,f*=m,l*=2,v*=2,b*=2,t[0]=i+s+l,t[1]=c+M+v,t[2]=h+f+b,t},rotateX:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0],e[1]=u[1]*Math.cos(r)-u[2]*Math.sin(r),e[2]=u[1]*Math.sin(r)+u[2]*Math.cos(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateY:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[2]*Math.sin(r)+u[0]*Math.cos(r),e[1]=u[1],e[2]=u[2]*Math.cos(r)-u[0]*Math.sin(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateZ:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0]*Math.cos(r)-u[1]*Math.sin(r),e[1]=u[0]*Math.sin(r)+u[1]*Math.cos(r),e[2]=u[2],t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},angle:function(t,n){var a=D(t[0],t[1],t[2]),r=D(n[0],n[1],n[2]);Z(a,a),Z(r,r);var u=_(a,r);return u>1?0:u<-1?Math.PI:Math.acos(u)},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=a[0],i=a[1],c=a[2];return Math.abs(r-o)<=n*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(u-i)<=n*Math.max(1,Math.abs(u),Math.abs(i))&&Math.abs(e-c)<=n*Math.max(1,Math.abs(e),Math.abs(c))},sub:k,mul:U,div:W,dist:C,sqrDist:G,len:H,sqrLen:J,forEach:K});function tt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function nt(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function at(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e}function rt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function ut(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t}function et(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t}function ot(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}function it(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t[3]=n[3]*a[3],t}function ct(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t[3]=n[3]/a[3],t}function ht(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t}function st(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return Math.hypot(a,r,u,e)}function Mt(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return a*a+r*r+u*u+e*e}function ft(t){var n=t[0],a=t[1],r=t[2],u=t[3];return Math.hypot(n,a,r,u)}function lt(t){var n=t[0],a=t[1],r=t[2],u=t[3];return n*n+a*a+r*r+u*u}function vt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e;return o>0&&(o=1/Math.sqrt(o)),t[0]=a*o,t[1]=r*o,t[2]=u*o,t[3]=e*o,t}function bt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function mt(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t[3]=i+r*(a[3]-i),t}function dt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function xt(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))}var pt=ot,yt=it,qt=ct,gt=st,At=Mt,wt=ft,Rt=lt,zt=function(){var t=tt();return function(n,a,r,u,e,o){var i,c;for(a||(a=4),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],e(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3];return n}}(),Pt=Object.freeze({create:tt,clone:nt,fromValues:at,copy:rt,set:ut,add:et,subtract:ot,multiply:it,divide:ct,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t[3]=Math.min(n[3],a[3]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t[3]=Math.max(n[3],a[3]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t},scale:ht,scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},distance:st,squaredDistance:Mt,length:ft,squaredLength:lt,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t},normalize:vt,dot:bt,cross:function(t,n,a,r){var u=a[0]*r[1]-a[1]*r[0],e=a[0]*r[2]-a[2]*r[0],o=a[0]*r[3]-a[3]*r[0],i=a[1]*r[2]-a[2]*r[1],c=a[1]*r[3]-a[3]*r[1],h=a[2]*r[3]-a[3]*r[2],s=n[0],M=n[1],f=n[2],l=n[3];return t[0]=M*h-f*c+l*i,t[1]=-s*h+f*o-l*e,t[2]=s*c-M*o+l*u,t[3]=-s*i+M*e-f*u,t},lerp:mt,random:function(t,n){var a,u,e,o,i,c;n=n||1;do{i=(a=2*r()-1)*a+(u=2*r()-1)*u}while(i>=1);do{c=(e=2*r()-1)*e+(o=2*r()-1)*o}while(c>=1);var h=Math.sqrt((1-i)/c);return t[0]=n*a,t[1]=n*u,t[2]=n*e*h,t[3]=n*o*h,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3];return t[0]=a[0]*r+a[4]*u+a[8]*e+a[12]*o,t[1]=a[1]*r+a[5]*u+a[9]*e+a[13]*o,t[2]=a[2]*r+a[6]*u+a[10]*e+a[14]*o,t[3]=a[3]*r+a[7]*u+a[11]*e+a[15]*o,t},transformQuat:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2],h=a[3],s=h*r+i*e-c*u,M=h*u+c*r-o*e,f=h*e+o*u-i*r,l=-o*r-i*u-c*e;return t[0]=s*h+l*-o+M*-c-f*-i,t[1]=M*h+l*-i+f*-o-s*-c,t[2]=f*h+l*-c+s*-i-M*-o,t[3]=n[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:dt,equals:xt,sub:pt,mul:yt,div:qt,dist:gt,sqrDist:At,len:wt,sqrLen:Rt,forEach:zt});function jt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function It(t,n,a){a*=.5;var r=Math.sin(a);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(a),t}function St(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,t}function Et(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+o*i,t[1]=u*c+e*i,t[2]=e*c-u*i,t[3]=o*c-r*i,t}function Ot(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c-e*i,t[1]=u*c+o*i,t[2]=e*c+r*i,t[3]=o*c-u*i,t}function Tt(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+u*i,t[1]=u*c-r*i,t[2]=e*c+o*i,t[3]=o*c-e*i,t}function Dt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=Math.exp(e),c=o>0?i*Math.sin(o)/o:0;return t[0]=a*c,t[1]=r*c,t[2]=u*c,t[3]=i*Math.cos(o),t}function Ft(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=o>0?Math.atan2(o,e)/o:0;return t[0]=a*i,t[1]=r*i,t[2]=u*i,t[3]=.5*Math.log(a*a+r*r+u*u+e*e),t}function Lt(t,a,r,u){var e,o,i,c,h,s=a[0],M=a[1],f=a[2],l=a[3],v=r[0],b=r[1],m=r[2],d=r[3];return(o=s*v+M*b+f*m+l*d)<0&&(o=-o,v=-v,b=-b,m=-m,d=-d),1-o>n?(e=Math.acos(o),i=Math.sin(e),c=Math.sin((1-u)*e)/i,h=Math.sin(u*e)/i):(c=1-u,h=u),t[0]=c*s+h*v,t[1]=c*M+h*b,t[2]=c*f+h*m,t[3]=c*l+h*d,t}function Vt(t,n){var a,r=n[0]+n[4]+n[8];if(r>0)a=Math.sqrt(r+1),t[3]=.5*a,a=.5/a,t[0]=(n[5]-n[7])*a,t[1]=(n[6]-n[2])*a,t[2]=(n[1]-n[3])*a;else{var u=0;n[4]>n[0]&&(u=1),n[8]>n[3*u+u]&&(u=2);var e=(u+1)%3,o=(u+2)%3;a=Math.sqrt(n[3*u+u]-n[3*e+e]-n[3*o+o]+1),t[u]=.5*a,a=.5/a,t[3]=(n[3*e+o]-n[3*o+e])*a,t[e]=(n[3*e+u]+n[3*u+e])*a,t[o]=(n[3*o+u]+n[3*u+o])*a}return t}var Qt,Yt,Xt,Zt,_t,Bt,Nt=nt,kt=at,Ut=rt,Wt=ut,Ct=et,Gt=St,Ht=ht,Jt=bt,Kt=mt,$t=ft,tn=$t,nn=lt,an=nn,rn=vt,un=dt,en=xt,on=(Qt=O(),Yt=D(1,0,0),Xt=D(0,1,0),function(t,n,a){var r=_(n,a);return r<-.999999?(B(Qt,Yt,n),H(Qt)<1e-6&&B(Qt,Xt,n),Z(Qt,Qt),It(t,Qt,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(B(Qt,n,a),t[0]=Qt[0],t[1]=Qt[1],t[2]=Qt[2],t[3]=1+r,rn(t,t))}),cn=(Zt=jt(),_t=jt(),function(t,n,a,r,u,e){return Lt(Zt,n,u,e),Lt(_t,a,r,e),Lt(t,Zt,_t,2*e*(1-e)),t}),hn=(Bt=m(),function(t,n,a,r){return Bt[0]=a[0],Bt[3]=a[1],Bt[6]=a[2],Bt[1]=r[0],Bt[4]=r[1],Bt[7]=r[2],Bt[2]=-n[0],Bt[5]=-n[1],Bt[8]=-n[2],rn(t,Vt(t,Bt))}),sn=Object.freeze({create:jt,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:It,getAxisAngle:function(t,a){var r=2*Math.acos(a[3]),u=Math.sin(r/2);return u>n?(t[0]=a[0]/u,t[1]=a[1]/u,t[2]=a[2]/u):(t[0]=1,t[1]=0,t[2]=0),r},getAngle:function(t,n){var a=Jt(t,n);return Math.acos(2*a*a-1)},multiply:St,rotateX:Et,rotateY:Ot,rotateZ:Tt,calculateW:function(t,n){var a=n[0],r=n[1],u=n[2];return t[0]=a,t[1]=r,t[2]=u,t[3]=Math.sqrt(Math.abs(1-a*a-r*r-u*u)),t},exp:Dt,ln:Ft,pow:function(t,n,a){return Ft(t,n),Ht(t,t,a),Dt(t,t),t},slerp:Lt,random:function(t){var n=r(),a=r(),u=r(),e=Math.sqrt(1-n),o=Math.sqrt(n);return t[0]=e*Math.sin(2*Math.PI*a),t[1]=e*Math.cos(2*Math.PI*a),t[2]=o*Math.sin(2*Math.PI*u),t[3]=o*Math.cos(2*Math.PI*u),t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e,i=o?1/o:0;return t[0]=-a*i,t[1]=-r*i,t[2]=-u*i,t[3]=e*i,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},fromMat3:Vt,fromEuler:function(t,n,a,r){var u=.5*Math.PI/180;n*=u,a*=u,r*=u;var e=Math.sin(n),o=Math.cos(n),i=Math.sin(a),c=Math.cos(a),h=Math.sin(r),s=Math.cos(r);return t[0]=e*c*s-o*i*h,t[1]=o*i*s+e*c*h,t[2]=o*c*h-e*i*s,t[3]=o*c*s+e*i*h,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:Nt,fromValues:kt,copy:Ut,set:Wt,add:Ct,mul:Gt,scale:Ht,dot:Jt,lerp:Kt,length:$t,len:tn,squaredLength:nn,sqrLen:an,normalize:rn,exactEquals:un,equals:en,rotationTo:on,sqlerp:cn,setAxes:hn});function Mn(t,n,a){var r=.5*a[0],u=.5*a[1],e=.5*a[2],o=n[0],i=n[1],c=n[2],h=n[3];return t[0]=o,t[1]=i,t[2]=c,t[3]=h,t[4]=r*h+u*c-e*i,t[5]=u*h+e*o-r*c,t[6]=e*h+r*i-u*o,t[7]=-r*o-u*i-e*c,t}function fn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}var ln=Ut;var vn=Ut;function bn(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[4],c=a[5],h=a[6],s=a[7],M=n[4],f=n[5],l=n[6],v=n[7],b=a[0],m=a[1],d=a[2],x=a[3];return t[0]=r*x+o*b+u*d-e*m,t[1]=u*x+o*m+e*b-r*d,t[2]=e*x+o*d+r*m-u*b,t[3]=o*x-r*b-u*m-e*d,t[4]=r*s+o*i+u*h-e*c+M*x+v*b+f*d-l*m,t[5]=u*s+o*c+e*i-r*h+f*x+v*m+l*b-M*d,t[6]=e*s+o*h+r*c-u*i+l*x+v*d+M*m-f*b,t[7]=o*s-r*i-u*c-e*h+v*x-M*b-f*m-l*d,t}var mn=bn;var dn=Jt;var xn=$t,pn=xn,yn=nn,qn=yn;var gn=Object.freeze({create:function(){var t=new a(8);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var n=new a(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n},fromValues:function(t,n,r,u,e,o,i,c){var h=new a(8);return h[0]=t,h[1]=n,h[2]=r,h[3]=u,h[4]=e,h[5]=o,h[6]=i,h[7]=c,h},fromRotationTranslationValues:function(t,n,r,u,e,o,i){var c=new a(8);c[0]=t,c[1]=n,c[2]=r,c[3]=u;var h=.5*e,s=.5*o,M=.5*i;return c[4]=h*u+s*r-M*n,c[5]=s*u+M*t-h*r,c[6]=M*u+h*n-s*t,c[7]=-h*t-s*n-M*r,c},fromRotationTranslation:Mn,fromTranslation:function(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*n[0],t[5]=.5*n[1],t[6]=.5*n[2],t[7]=0,t},fromRotation:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,n){var r=jt();P(r,n);var u=new a(3);return R(u,n),Mn(t,r,u),t},copy:fn,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,n,a,r,u,e,o,i,c){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t},getReal:ln,getDual:function(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t},setReal:vn,setDual:function(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t},getTranslation:function(t,n){var a=n[4],r=n[5],u=n[6],e=n[7],o=-n[0],i=-n[1],c=-n[2],h=n[3];return t[0]=2*(a*h+e*o+r*c-u*i),t[1]=2*(r*h+e*i+u*o-a*c),t[2]=2*(u*h+e*c+a*i-r*o),t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=.5*a[0],c=.5*a[1],h=.5*a[2],s=n[4],M=n[5],f=n[6],l=n[7];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=o*i+u*h-e*c+s,t[5]=o*c+e*i-r*h+M,t[6]=o*h+r*c-u*i+f,t[7]=-r*i-u*c-e*h+l,t},rotateX:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Et(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateY:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Ot(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateZ:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Tt(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateByQuatAppend:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=n[3];return t[0]=i*o+s*r+c*e-h*u,t[1]=c*o+s*u+h*r-i*e,t[2]=h*o+s*e+i*u-c*r,t[3]=s*o-i*r-c*u-h*e,i=n[4],c=n[5],h=n[6],s=n[7],t[4]=i*o+s*r+c*e-h*u,t[5]=c*o+s*u+h*r-i*e,t[6]=h*o+s*e+i*u-c*r,t[7]=s*o-i*r-c*u-h*e,t},rotateByQuatPrepend:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,i=a[4],c=a[5],h=a[6],s=a[7],t[4]=r*s+o*i+u*h-e*c,t[5]=u*s+o*c+e*i-r*h,t[6]=e*s+o*h+r*c-u*i,t[7]=o*s-r*i-u*c-e*h,t},rotateAroundAxis:function(t,a,r,u){if(Math.abs(u)<n)return fn(t,a);var e=Math.hypot(r[0],r[1],r[2]);u*=.5;var o=Math.sin(u),i=o*r[0]/e,c=o*r[1]/e,h=o*r[2]/e,s=Math.cos(u),M=a[0],f=a[1],l=a[2],v=a[3];t[0]=M*s+v*i+f*h-l*c,t[1]=f*s+v*c+l*i-M*h,t[2]=l*s+v*h+M*c-f*i,t[3]=v*s-M*i-f*c-l*h;var b=a[4],m=a[5],d=a[6],x=a[7];return t[4]=b*s+x*i+m*h-d*c,t[5]=m*s+x*c+d*i-b*h,t[6]=d*s+x*h+b*c-m*i,t[7]=x*s-b*i-m*c-d*h,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t},multiply:bn,mul:mn,scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t},dot:dn,lerp:function(t,n,a,r){var u=1-r;return dn(n,a)<0&&(r=-r),t[0]=n[0]*u+a[0]*r,t[1]=n[1]*u+a[1]*r,t[2]=n[2]*u+a[2]*r,t[3]=n[3]*u+a[3]*r,t[4]=n[4]*u+a[4]*r,t[5]=n[5]*u+a[5]*r,t[6]=n[6]*u+a[6]*r,t[7]=n[7]*u+a[7]*r,t},invert:function(t,n){var a=yn(n);return t[0]=-n[0]/a,t[1]=-n[1]/a,t[2]=-n[2]/a,t[3]=n[3]/a,t[4]=-n[4]/a,t[5]=-n[5]/a,t[6]=-n[6]/a,t[7]=n[7]/a,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t},length:xn,len:pn,squaredLength:yn,sqrLen:qn,normalize:function(t,n){var a=yn(n);if(a>0){a=Math.sqrt(a);var r=n[0]/a,u=n[1]/a,e=n[2]/a,o=n[3]/a,i=n[4],c=n[5],h=n[6],s=n[7],M=r*i+u*c+e*h+o*s;t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=(i-r*M)/a,t[5]=(c-u*M)/a,t[6]=(h-e*M)/a,t[7]=(s-o*M)/a}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=a[0],f=a[1],l=a[2],v=a[3],b=a[4],m=a[5],d=a[6],x=a[7];return Math.abs(r-M)<=n*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(u-f)<=n*Math.max(1,Math.abs(u),Math.abs(f))&&Math.abs(e-l)<=n*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(o-v)<=n*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(i-b)<=n*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(c-m)<=n*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(h-d)<=n*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(s-x)<=n*Math.max(1,Math.abs(s),Math.abs(x))}});function An(){var t=new a(2);return a!=Float32Array&&(t[0]=0,t[1]=0),t}function wn(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t}function Rn(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t}function zn(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t}function Pn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return Math.hypot(a,r)}function jn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return a*a+r*r}function In(t){var n=t[0],a=t[1];return Math.hypot(n,a)}function Sn(t){var n=t[0],a=t[1];return n*n+a*a}var En=In,On=wn,Tn=Rn,Dn=zn,Fn=Pn,Ln=jn,Vn=Sn,Qn=function(){var t=An();return function(n,a,r,u,e,o){var i,c;for(a||(a=2),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],e(t,t,o),n[i]=t[0],n[i+1]=t[1];return n}}(),Yn=Object.freeze({create:An,clone:function(t){var n=new a(2);return n[0]=t[0],n[1]=t[1],n},fromValues:function(t,n){var r=new a(2);return r[0]=t,r[1]=n,r},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t},set:function(t,n,a){return t[0]=n,t[1]=a,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t},subtract:wn,multiply:Rn,divide:zn,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t},distance:Pn,squaredDistance:jn,length:In,squaredLength:Sn,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},normalize:function(t,n){var a=n[0],r=n[1],u=a*a+r*r;return u>0&&(u=1/Math.sqrt(u)),t[0]=n[0]*u,t[1]=n[1]*u,t},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]},cross:function(t,n,a){var r=n[0]*a[1]-n[1]*a[0];return t[0]=t[1]=0,t[2]=r,t},lerp:function(t,n,a,r){var u=n[0],e=n[1];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t},random:function(t,n){n=n||1;var a=2*r()*Math.PI;return t[0]=Math.cos(a)*n,t[1]=Math.sin(a)*n,t},transformMat2:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u,t[1]=a[1]*r+a[3]*u,t},transformMat2d:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u+a[4],t[1]=a[1]*r+a[3]*u+a[5],t},transformMat3:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[3]*u+a[6],t[1]=a[1]*r+a[4]*u+a[7],t},transformMat4:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[4]*u+a[12],t[1]=a[1]*r+a[5]*u+a[13],t},rotate:function(t,n,a,r){var u=n[0]-a[0],e=n[1]-a[1],o=Math.sin(r),i=Math.cos(r);return t[0]=u*i-e*o+a[0],t[1]=u*o+e*i+a[1],t},angle:function(t,n){var a=t[0],r=t[1],u=n[0],e=n[1],o=a*a+r*r;o>0&&(o=1/Math.sqrt(o));var i=u*u+e*e;i>0&&(i=1/Math.sqrt(i));var c=(a*u+r*e)*o*i;return c>1?0:c<-1?Math.PI:Math.acos(c)},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]},equals:function(t,a){var r=t[0],u=t[1],e=a[0],o=a[1];return Math.abs(r-e)<=n*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(u-o)<=n*Math.max(1,Math.abs(u),Math.abs(o))},len:En,sub:On,mul:Tn,div:Dn,dist:Fn,sqrDist:Ln,sqrLen:Vn,forEach:Qn});t.glMatrix=e,t.mat2=s,t.mat2d=b,t.mat3=q,t.mat4=E,t.quat=sn,t.quat2=gn,t.vec2=Yn,t.vec3=$,t.vec4=Pt,Object.defineProperty(t,"__esModule",{value:!0})});

// ["glMatrix", "mat2", "mat2d", "mat3", "mat4", "quat", "quat2", "vec2", "vec3", "vec4"]
window.glMatrix = glMatrix;
window.mat2 = glMatrix.mat2;
window.mat2d = glMatrix.mat2d;
window.mat3 = glMatrix.mat3;
window.mat4 = glMatrix.mat4;
window.quat = glMatrix.quat;
window.quat2 = glMatrix.quat2;
window.vec2 = glMatrix.vec2;
window.vec3 = glMatrix.vec3;
window.vec4 = glMatrix.vec4;



var CABLES = CABLES || {}; CABLES.build = {"timestamp":1658229186222,"created":"2022-07-19T11:13:06.222Z","git":{"branch":"master","commit":"819fc0e7c02646be982b7338326b610a383cd8f6","date":"2022-07-19T11:09:39.000Z","message":"corelib"}};
if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["UtILz9"]={settings:{opExample:[],licence:"none",isPublic:false},ops:[{objName:"Ops.Gl.MainLoop",id:"0",uiAttribs:{subPatch:0},portsIn:[{name:"FPS Limit",value:60},{name:"Reduce FPS not focussed",value:true},{name:"Reduce FPS loading",value:false},{name:"Clear",value:true},{name:"ClearAlpha",value:true},{name:"Fullscreen Button",value:false},{name:"Active",value:true},{name:"Hires Displays",value:false},{name:"Pixel Unit index",value:0},{name:"Pixel Unit",value:"Display"}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"6",objOut:"0"}]},{name:"width",value:903},{name:"height",value:867}]},{objName:"Ops.Gl.TextureEffects.Noise.Noise_v2",id:"1",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Amount",value:1},{name:"Animated",value:false},{name:"RGB",value:false},{name:"Normalize",value:false},{name:"Multiply"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"4",objOut:"1"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"2",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"1",objOut:"2"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"42",objOut:"2"},{portIn:"texture",portOut:"texture_out",objIn:"50",objOut:"2"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Sequence",id:"3",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"Render",portOut:"trigger 0",objIn:"2",objOut:"3"}]},{name:"trigger 1",links:[{portIn:"Render",portOut:"trigger 1",objIn:"13",objOut:"3"}]},{name:"trigger 2",links:[{portIn:"Render",portOut:"trigger 2",objIn:"34",objOut:"3"}]},{name:"trigger 3",links:[{portIn:"Execute",portOut:"trigger 3",objIn:"43",objOut:"3"}]},{name:"trigger 4",links:[{portIn:"Execute",portOut:"trigger 4",objIn:"48",objOut:"3"}]},{name:"trigger 5",links:[{portIn:"Execute",portOut:"trigger 5",objIn:"49",objOut:"3"}]},{name:"trigger 6",links:[{portIn:"Execute",portOut:"trigger 6",objIn:"56",objOut:"3"}]},{name:"trigger 7",links:[{portIn:"Execute",portOut:"trigger 7",objIn:"59",objOut:"3"}]},{name:"trigger 8",links:[{portIn:"Execute",portOut:"trigger 8",objIn:"63",objOut:"3"}]},{name:"trigger 9",links:[{portIn:"Execute",portOut:"trigger 9",objIn:"80",objOut:"3"}]},{name:"trigger 10",links:[{portIn:"Execute",portOut:"trigger 10",objIn:"83",objOut:"3"},{portIn:"Execute",portOut:"trigger 10",objIn:"91",objOut:"3"}]},{name:"trigger 11",links:[{portIn:"Execute",portOut:"trigger 11",objIn:"138",objOut:"3"}]},{name:"trigger 12",links:[{portIn:"Execute",portOut:"trigger 12",objIn:"165",objOut:"3"}]},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"4",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image",value:0},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"11",objOut:"4"}]}]},{objName:"Ops.Gl.Meshes.FullscreenRectangle",id:"5",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:false},{name:"Flip X",value:false},{name:"Texture"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"144",objOut:"5"}]}]},{objName:"Ops.Sequence",id:"6",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"exe",portOut:"trigger 0",objIn:"3",objOut:"6"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",links:[{portIn:"Execute",portOut:"trigger 14",objIn:"88",objOut:"6"}]},{name:"trigger 15",links:[{portIn:"Execute",portOut:"trigger 15",objIn:"7",objOut:"6"}]}]},{objName:"Ops.Trigger.TriggerExtender",id:"7",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"5",objOut:"7"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"8",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"87",objOut:"8"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"5",objOut:"8"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Api.FxHash.FxHash",id:"9",uiAttribs:{subPatch:0},portsIn:[{name:"Hash",value:"vwBtLbSax4j7zo4Y4q3StEziGNAR9uEBgXi1y1QqYKFWXF5vRFd"},{name:"Randomize Hash"}],portsOut:[{name:"fxhash",value:"vwBtLbSax4j7zo4Y4q3StEziGNAR9uEBgXi1y1QqYKFWXF5vRFd"},{name:"fxrand 1",links:[{portIn:"Value",portOut:"fxrand 1",objIn:"15",objOut:"9"}]},{name:"fxrand 2",links:[{portIn:"Value",portOut:"fxrand 2",objIn:"16",objOut:"9"}]},{name:"fxrand 3",links:[{portIn:"Value",portOut:"fxrand 3",objIn:"17",objOut:"9"}]},{name:"fxrand 4",links:[{portIn:"Value",portOut:"fxrand 4",objIn:"18",objOut:"9"}]},{name:"Random Numbers",links:[{portIn:"Value",portOut:"Random Numbers",objIn:"19",objOut:"9"}]},{name:"fxhash environment",value:0}]},{objName:"Ops.Gl.TextureEffects.SkewStretchImage_v2",id:"10",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Clamp",value:false},{name:"Stretch Top"},{name:"Stretch Bottom"},{name:"Stretch Left"},{name:"Stretch Right"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"26",objOut:"10"}]}]},{objName:"Ops.Gl.TextureEffects.BarrelDistortion_v3",id:"11",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Intensity",value:100}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"10",objOut:"11"}]}]},{objName:"Ops.Gl.TextureEffects.Noise.PixelNoise_v3",id:"12",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Amount",value:1},{name:"Loop",value:false},{name:"RGB",value:false},{name:"Minimum value",value:0},{name:"Maximum value",value:1},{name:"Num X",value:2},{name:"Num Y",value:2},{name:"X",value:0},{name:"Y",value:0},{name:"Z",value:0},{name:"Seed"},{name:"Centered",value:false}],portsOut:[{name:"Next",value:0}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"13",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"12",objOut:"13"}]},{name:"texture_out",links:[{portIn:"Multiply",portOut:"texture_out",objIn:"1",objOut:"13"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Devices.Mouse.Mouse_v2",id:"14",uiAttribs:{subPatch:0},portsIn:[{name:"Active",value:true},{name:"relative",value:false},{name:"normalize",value:false},{name:"flip y",value:true},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"right click prevent default",value:true},{name:"Touch support",value:true},{name:"smooth",value:false},{name:"smoothSpeed",value:20},{name:"multiply",value:1}],portsOut:[{name:"x",value:27},{name:"y",value:256},{name:"button down",value:false},{name:"click",links:[{portIn:"Randomize Hash",portOut:"click",objIn:"9",objOut:"14"}]},{name:"Button Up",value:0},{name:"click right",value:0},{name:"mouseOver",value:false},{name:"button",value:0}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"15",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"seedOne"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarSetNumber_v2",id:"16",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"seedTwo"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarSetNumber_v2",id:"17",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"seedThree"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarSetNumber_v2",id:"18",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"seedFour"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarSetArray_v2",id:"19",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"seedArray"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetArray_v2",id:"20",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"seedArray"}],portsOut:[{name:"Value",links:[{portIn:"array",portOut:"Value",objIn:"21",objOut:"20"},{portIn:"array",portOut:"Value",objIn:"31",objOut:"20"},{portIn:"array",portOut:"Value",objIn:"97",objOut:"20"},{portIn:"Value",portOut:"Value",objIn:"141",objOut:"20"}]}]},{objName:"Ops.Array.MapRangeArray",id:"21",uiAttribs:{subPatch:0},portsIn:[{name:"array"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:-20},{name:"new max",value:20},{name:"Easing index",value:0},{name:"Easing",value:"Linear"}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"22",objOut:"21"}]}]},{objName:"Ops.Vars.VarSetArray_v2",id:"22",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"skew_stretch"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetArray_v2",id:"23",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"skew_stretch"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"24",objOut:"23"}]}]},{objName:"Ops.User.dave_p.Array4GetNumbers",id:"24",uiAttribs:{subPatch:0},portsIn:[{name:"Array"},{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"Stretch Top",portOut:"X",objIn:"10",objOut:"24"}]},{name:"Y",links:[{portIn:"Stretch Bottom",portOut:"Y",objIn:"10",objOut:"24"}]},{name:"Z",links:[{portIn:"Stretch Left",portOut:"Z",objIn:"10",objOut:"24"}]},{name:"W",links:[{portIn:"Stretch Right",portOut:"W",objIn:"10",objOut:"24"}]}]},{objName:"Ops.Gl.TextureEffects.PixelDisplacement_v4",id:"25",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"displaceTex"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"amount X",value:1},{name:"amount Y",value:1},{name:"Wrap index",value:0},{name:"Wrap",value:"Repeat"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Grey"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.ScrollTexture",id:"26",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"amountX",value:1.76},{name:"amountY"},{name:"Mask"},{name:"Repeat",value:true}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"25",objOut:"26"}]}]},{objName:"Ops.Anim.Timer_v2",id:"27",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:.01},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"amountY",portOut:"Time",objIn:"26",objOut:"27"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"28",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"seedTwo"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"29",objOut:"28"},{portIn:"Value",portOut:"Value",objIn:"67",objOut:"28"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"29",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"pixelNoise_seed"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"30",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"pixelNoise_seed"}],portsOut:[{name:"Value",links:[{portIn:"Seed",portOut:"Value",objIn:"12",objOut:"30"}]}]},{objName:"Ops.Array.MapRangeArray",id:"31",uiAttribs:{subPatch:0},portsIn:[{name:"array"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:10},{name:"new max",value:20},{name:"Easing index",value:0},{name:"Easing",value:"Linear"}],portsOut:[{name:"result",links:[{portIn:"In",portOut:"result",objIn:"33",objOut:"31"}]}]},{objName:"Ops.Vars.VarSetArray_v2",id:"32",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"noiseTex_seed"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Array.ArrayCeil",id:"33",uiAttribs:{subPatch:0},portsIn:[{name:"In"}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"32",objOut:"33"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"34",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"37",objOut:"34"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"38",objOut:"34"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Vars.VarGetArray_v2",id:"35",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"noiseTex_seed"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"36",objOut:"35"}]}]},{objName:"Ops.Array.Array3GetNumbers",id:"36",uiAttribs:{subPatch:0},portsIn:[{name:"Array"},{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"Num X",portOut:"X",objIn:"37",objOut:"36"}]},{name:"Y",links:[{portIn:"Num Y",portOut:"Y",objIn:"37",objOut:"36"}]},{name:"Z",value:15}]},{objName:"Ops.Gl.TextureEffects.Noise.PixelNoise_v3",id:"37",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Amount",value:1},{name:"Loop",value:false},{name:"RGB",value:false},{name:"Minimum value",value:0},{name:"Maximum value",value:1},{name:"Num X"},{name:"Num Y"},{name:"X",value:0},{name:"Y",value:0},{name:"Z"},{name:"Seed",value:0},{name:"Centered",value:false}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"39",objOut:"37"}]}]},{objName:"Ops.Ui.VizTexture",id:"38",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"displaceTex",portOut:"Texture Out",objIn:"25",objOut:"38"}]},{name:"Info",value:"903 x 867 8bit linear repeat"}]},{objName:"Ops.Gl.TextureEffects.WaveformGradient_v3",id:"39",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Amount",value:1},{name:"Mode index",value:0},{name:"Mode",value:"Sine"},{name:"Frequency",value:1},{name:"Pow factor",value:20},{name:"Offset"},{name:"Rotate",value:0},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"41",objOut:"39"}]}]},{objName:"Ops.Anim.Timer_v2",id:"40",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:.025},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"Offset",portOut:"Time",objIn:"39",objOut:"40"}]}]},{objName:"Ops.Gl.TextureEffects.PixelDisplacement_v4",id:"41",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"displaceTex"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"amount X",value:1},{name:"amount Y",value:1},{name:"Wrap index",value:0},{name:"Wrap",value:"Mirror"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Grey"}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Textures.CopyTexture",id:"42",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Texture"},{name:"Alpha Mask",value:0},{name:"use original size",value:true},{name:"width",value:903},{name:"height",value:867},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"HDR",value:false},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"A"},{name:"Convert Greyscale index",value:0},{name:"Convert Greyscale",value:"Off"},{name:"Invert R",value:false},{name:"Invert G",value:false},{name:"Invert B",value:false},{name:"Invert A",value:false}],portsOut:[{name:"trigger",value:0},{name:"texture_out",links:[{portIn:"displaceTex",portOut:"texture_out",objIn:"41",objOut:"42"}]},{name:"Aspect Ratio",value:1.041522491349481}]},{objName:"Ops.Trigger.TriggerExtender",id:"43",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"42",objOut:"43"}]}]},{objName:"Ops.Gl.Meshes.Rectangle_v2",id:"44",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"width",value:1},{name:"height",value:1},{name:"pivot x index",value:0},{name:"pivot x",value:"center"},{name:"pivot y index",value:0},{name:"pivot y",value:"center"},{name:"num columns",value:1},{name:"num rows",value:1},{name:"axis index",value:0},{name:"axis",value:"xy"},{name:"Active",value:true}],portsOut:[{name:"trigger",value:0},{name:"geometry",links:[{portIn:"geom",portOut:"geometry",objIn:"45",objOut:"44"}]}]},{objName:"Ops.Gl.MeshInstancer_v4",id:"45",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"geom"},{name:"Scale",value:1},{name:"Limit Instances",value:false},{name:"Limit",value:100},{name:"positions"},{name:"Scale Array"},{name:"Rotations"},{name:"Rotation Type index",value:0},{name:"Rotation Type",value:"Euler"},{name:"Material blend mode index",value:0},{name:"Material blend mode",value:"Multiply"},{name:"Colors",value:0},{name:"TexCoords",value:0}],portsOut:[{name:"Trigger Out",value:0},{name:"Num",value:"exe"}]},{objName:"Ops.Gl.Render2Texture",id:"46",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"use viewport size",value:true},{name:"texture width",value:903},{name:"texture height",value:867},{name:"Auto Aspect",value:false},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"HDR",value:false},{name:"Depth",value:true},{name:"Clear",value:true}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"50",objOut:"46"}]},{name:"texture",links:[{portIn:"Image",portOut:"texture",objIn:"57",objOut:"46"},{portIn:"Mask",portOut:"texture",objIn:"26",objOut:"46"}]},{name:"textureDepth"}]},{objName:"Ops.Trigger.TriggerOnce",id:"47",uiAttribs:{subPatch:0},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"44",objOut:"47"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Trigger.TriggerExtender",id:"48",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Exec",portOut:"Next",objIn:"47",objOut:"48"}]}]},{objName:"Ops.Trigger.TriggerExtender",id:"49",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"46",objOut:"49"}]}]},{objName:"Ops.Gl.Shader.BasicMaterial_v3",id:"50",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"r",value:.9615322887523496},{name:"g",value:.8009295842712238},{name:"b",value:.6318312862419291},{name:"a",value:1},{name:"texture"},{name:"colorizeTexture",value:false},{name:"Vertex Colors",value:false},{name:"textureOpacity",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:false},{name:"Discard Transparent Pixels",value:false},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:false},{name:"billboard",value:false}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"45",objOut:"50"}]},{name:"shader"}]},{objName:"Ops.Array.RandomNumbersArray3_v2",id:"51",uiAttribs:{subPatch:0},portsIn:[{name:"numValues"},{name:"Min",value:.1},{name:"Max",value:.8},{name:"random seed"},{name:"Last == First",value:false},{name:"Integer",value:false}],portsOut:[{name:"values",links:[{portIn:"Scale Array",portOut:"values",objIn:"45",objOut:"51"}]},{name:"Total points",links:[{portIn:"Num Values",portOut:"Total points",objIn:"53",objOut:"51"}]},{name:"Array length",value:600}]},{objName:"Ops.Array.RandomArrays",id:"52",uiAttribs:{subPatch:0},portsIn:[{name:"Num Values",value:200},{name:"Mode index",value:0},{name:"Mode",value:"AB"},{name:"Random Seed "},{name:"Integer",value:false},{name:"Min A",value:-2},{name:"Max A",value:2},{name:"Min B",value:-2},{name:"Max B",value:2},{name:"Min C",value:-1},{name:"Max C",value:1},{name:"Min D",value:-1},{name:"Max D",value:1}],portsOut:[{name:"Array Out",links:[{portIn:"positions",portOut:"Array Out",objIn:"45",objOut:"52"}]},{name:"Chunks Amount",links:[{portIn:"numValues",portOut:"Chunks Amount",objIn:"51",objOut:"52"}]},{name:"Array length",value:400}]},{objName:"Ops.Array.RandomArrays",id:"53",uiAttribs:{subPatch:0},portsIn:[{name:"Num Values"},{name:"Mode index",value:0},{name:"Mode",value:"ABC"},{name:"Random Seed "},{name:"Integer",value:true},{name:"Min A",value:0},{name:"Max A",value:0},{name:"Min B",value:0},{name:"Max B",value:0},{name:"Min C",value:0},{name:"Max C",value:90},{name:"Min D",value:-1},{name:"Max D",value:1}],portsOut:[{name:"Array Out",links:[{portIn:"Rotations",portOut:"Array Out",objIn:"45",objOut:"53"}]},{name:"Chunks Amount",value:200},{name:"Array length",value:600}]},{objName:"Ops.Gl.TextureEffects.PixelDisplacement_v4",id:"54",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"displaceTex"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"amount X"},{name:"amount Y"},{name:"Wrap index",value:0},{name:"Wrap",value:"Mirror"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Black"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"65",objOut:"54"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"55",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"57",objOut:"55"}]},{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"60",objOut:"55"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"56",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"55",objOut:"56"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"57",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"61",objOut:"57"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"58",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"60",objOut:"58"}]},{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"61",objOut:"58"},{portIn:"Image",portOut:"texture_out",objIn:"84",objOut:"58"},{portIn:"Image",portOut:"texture_out",objIn:"92",objOut:"58"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"59",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"58",objOut:"59"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"60",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"54",objOut:"60"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"61",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"add"},{name:"amount",value:.799},{name:"Image"},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask"},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"62",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"64",objOut:"62"}]},{name:"texture_out",links:[{portIn:"displaceTex",portOut:"texture_out",objIn:"54",objOut:"62"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"63",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"62",objOut:"63"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"64",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image",value:0},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"77",objOut:"64"}]}]},{objName:"Ops.Gl.TextureEffects.EdgeDetection_v4",id:"65",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"screen"},{name:"Amount",value:1},{name:"Strength",value:.4},{name:"Width",value:.01},{name:"Mul Color",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"99",objOut:"65"}]}]},{objName:"Ops.Color.ColorPalettes",id:"66",uiAttribs:{subPatch:0},portsIn:[{name:"Index"},{name:"Smooth",value:true}],portsOut:[{name:"Texture",links:[{portIn:"Image",portOut:"Texture",objIn:"158",objOut:"66"}]},{name:"Color Array"}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"67",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"randArray_0_seed"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarSetNumber_v2",id:"68",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"randArray_1_seed"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"69",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"seedOne"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"68",objOut:"69"},{portIn:"value",portOut:"Value",objIn:"104",objOut:"69"},{portIn:"value",portOut:"Value",objIn:"172",objOut:"69"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"70",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"seedFour"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"73",objOut:"70"},{portIn:"Value",portOut:"Value",objIn:"100",objOut:"70"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"71",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"randArray_2_seed"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"72",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"seedThree"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"71",objOut:"72"},{portIn:"value",portOut:"Value",objIn:"133",objOut:"72"},{portIn:"value",portOut:"Value",objIn:"145",objOut:"72"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"73",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"randArray_3_seed"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"74",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"randArray_0_seed"}],portsOut:[{name:"Value",links:[{portIn:"Random Seed ",portOut:"Value",objIn:"52",objOut:"74"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"75",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"randArray_1_seed"}],portsOut:[{name:"Value",links:[{portIn:"random seed",portOut:"Value",objIn:"51",objOut:"75"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"76",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"randArray_2_seed"}],portsOut:[{name:"Value",links:[{portIn:"Random Seed ",portOut:"Value",objIn:"53",objOut:"76"}]}]},{objName:"Ops.Gl.TextureEffects.Noise.FBMNoise_v2",id:"77",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"add"},{name:"Amount",value:1},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"scale"},{name:"anim"},{name:"scrollX",value:11.44},{name:"scrollY",value:6.57},{name:"repeat",value:1},{name:"aspect",value:1},{name:"Layer 1",value:true},{name:"Layer 2",value:true},{name:"Layer 3",value:true},{name:"Layer 4",value:true},{name:"Tileable",value:false}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Anim.Timer_v2",id:"78",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:.1},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"anim",portOut:"Time",objIn:"77",objOut:"78"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"79",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"81",objOut:"79"}]},{name:"texture_out",links:[{portIn:"Texture 5",portOut:"texture_out",objIn:"87",objOut:"79"},{portIn:"Mask",portOut:"texture_out",objIn:"61",objOut:"79"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"80",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"79",objOut:"80"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"81",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"154",objOut:"81"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"82",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"84",objOut:"82"}]},{name:"texture_out",links:[{portIn:"Texture 1",portOut:"texture_out",objIn:"87",objOut:"82"},{portIn:"Image",portOut:"texture_out",objIn:"81",objOut:"82"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"83",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"82",objOut:"83"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"84",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"85",objOut:"84"}]}]},{objName:"Ops.Gl.TextureEffects.EdgeDetection_v4",id:"85",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Strength",value:10},{name:"Width",value:.1},{name:"Mul Color",value:.05}],portsOut:[{name:"Trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.ColorMap_v2",id:"86",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Gradient"},{name:"Method index",value:0},{name:"Method",value:"Luminance"},{name:"Min",value:0},{name:"Max",value:1},{name:"Position",value:.5}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"153",objOut:"86"}]}]},{objName:"Ops.Gl.TextureEffects.MultiDrawImage",id:"87",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Mask Invert",value:false},{name:"Texture 1"},{name:"Blendmode 1 index",value:0},{name:"Blendmode 1",value:"normal"},{name:"Mask 1",value:0},{name:"Mask Source 1 index",value:0},{name:"Mask Source 1",value:"R"},{name:"Opacity 1 index",value:0},{name:"Opacity 1",value:"Normal"},{name:"Amount 1",value:1},{name:"Texture 2"},{name:"Blendmode 2 index",value:0},{name:"Blendmode 2",value:"color burn"},{name:"Mask 2",value:0},{name:"Mask Source 2 index",value:0},{name:"Mask Source 2",value:"R"},{name:"Opacity 2 index",value:0},{name:"Opacity 2",value:"Normal"},{name:"Amount 2",value:1},{name:"Texture 3"},{name:"Blendmode 3 index",value:0},{name:"Blendmode 3",value:"add"},{name:"Mask 3",value:0},{name:"Mask Source 3 index",value:0},{name:"Mask Source 3",value:"R"},{name:"Opacity 3 index",value:0},{name:"Opacity 3",value:"Normal"},{name:"Amount 3",value:1},{name:"Texture 4"},{name:"Blendmode 4 index",value:0},{name:"Blendmode 4",value:"negation"},{name:"Mask 4",value:0},{name:"Mask Source 4 index",value:0},{name:"Mask Source 4",value:"R"},{name:"Opacity 4 index",value:0},{name:"Opacity 4",value:"Normal"},{name:"Amount 4",value:1},{name:"Texture 5"},{name:"Blendmode 5 index",value:0},{name:"Blendmode 5",value:"multiply invert"},{name:"Mask 5",value:0},{name:"Mask Source 5 index",value:0},{name:"Mask Source 5",value:"R"},{name:"Opacity 5 index",value:0},{name:"Opacity 5",value:"Normal"},{name:"Amount 5",value:.3},{name:"Texture 6"},{name:"Blendmode 6 index",value:0},{name:"Blendmode 6",value:"overlay"},{name:"Mask 6",value:0},{name:"Mask Source 6 index",value:0},{name:"Mask Source 6",value:"R"},{name:"Opacity 6 index",value:0},{name:"Opacity 6",value:"Normal"},{name:"Amount 6",value:.076},{name:"Texture 7",value:0},{name:"Blendmode 7 index",value:0},{name:"Blendmode 7",value:"normal"},{name:"Mask 7",value:0},{name:"Mask Source 7 index",value:0},{name:"Mask Source 7",value:"R"},{name:"Opacity 7 index",value:0},{name:"Opacity 7",value:"Normal"},{name:"Amount 7",value:1},{name:"Texture 8",value:0},{name:"Blendmode 8 index",value:0},{name:"Blendmode 8",value:"normal"},{name:"Mask 8",value:0},{name:"Mask Source 8 index",value:0},{name:"Mask Source 8",value:"R"},{name:"Opacity 8 index",value:0},{name:"Opacity 8",value:"Normal"},{name:"Amount 8",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"86",objOut:"87"}]}]},{objName:"Ops.Trigger.TriggerExtender",id:"88",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"8",objOut:"88"}]}]},{objName:"Ops.Gl.CanvasInfo",id:"89",uiAttribs:{subPatch:0},portsIn:[{name:"Pixel Unit index",value:0},{name:"Pixel Unit",value:"Display"}],portsOut:[{name:"width",value:903},{name:"height",value:867},{name:"Pixel Ratio",value:1},{name:"Aspect Ratio",value:1.041522491349481},{name:"Landscape",value:1}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"90",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"92",objOut:"90"}]},{name:"texture_out",links:[{portIn:"Texture 3",portOut:"texture_out",objIn:"87",objOut:"90"},{portIn:"Texture 2",portOut:"texture_out",objIn:"87",objOut:"90"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"91",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"90",objOut:"91"}]}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"92",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"93",objOut:"92"}]}]},{objName:"Ops.Gl.TextureEffects.ChromaticAberration_v2",id:"93",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Pixel",value:5},{name:"Lens Distort",value:0},{name:"Smooth",value:true},{name:"Mask",value:0}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Vars.VarSetArray_v2",id:"94",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"pixelDisp_amount"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetArray_v2",id:"95",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"pixelDisp_amount"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"96",objOut:"95"}]}]},{objName:"Ops.Array.Array3GetNumbers",id:"96",uiAttribs:{subPatch:0},portsIn:[{name:"Array"},{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"amount X",portOut:"X",objIn:"54",objOut:"96"}]},{name:"Y",links:[{portIn:"amount Y",portOut:"Y",objIn:"54",objOut:"96"}]},{name:"Z",value:-.8337934245355427}]},{objName:"Ops.Array.MapRangeArray",id:"97",uiAttribs:{subPatch:0},portsIn:[{name:"array"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:-5},{name:"new max",value:5},{name:"Easing index",value:0},{name:"Easing",value:"Linear"}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"94",objOut:"97"}]}]},{objName:"Ops.Gl.TextureEffects.BrightnessContrast",id:"98",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"contrast",value:.75},{name:"brightness",value:.665}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"157",objOut:"98"}]}]},{objName:"Ops.Gl.TextureEffects.FXAA",id:"99",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"span index",value:0},{name:"span",value:8},{name:"reduceMin",value:128},{name:"reduceMul",value:8},{name:"use viewport size",value:true},{name:"width",value:0},{name:"height",value:0}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"100",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"noiseTex_z"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"101",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"noiseTex_z"}],portsOut:[{name:"Value",links:[{portIn:"Z",portOut:"Value",objIn:"37",objOut:"101"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"102",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"FBMNoise_0_scale"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"103",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"FBMNoise_0_scale"}],portsOut:[{name:"Value",links:[{portIn:"scale",portOut:"Value",objIn:"77",objOut:"103"}]}]},{objName:"Ops.Math.MapRange",id:"104",uiAttribs:{subPatch:0},portsIn:[{name:"value"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:.2},{name:"new max",value:5},{name:"Easing index",value:0},{name:"Easing",value:"Linear"}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"102",objOut:"104"}]}]},{objName:"Ops.Sidebar.Sidebar",id:"105",uiAttribs:{subPatch:0},portsIn:[{name:"Visible",value:false},{name:"Opacity",value:1},{name:"Default Minimized",value:false},{name:"Minimized Opacity",value:.5},{name:"Show undo button",value:false},{name:"Show Minimize",value:false},{name:"Title",value:"Color Curator"},{name:"Side",value:false}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"120",objOut:"105"}]},{name:"Opfened",value:false}]},{objName:"Ops.Trigger.TriggerReceive",id:"106",uiAttribs:{subPatch:0},portsIn:[{name:"Named Trigger",value:"rightTrig"}],portsOut:[{name:"Triggered",links:[{portIn:"Add Color",portOut:"Triggered",objIn:"130",objOut:"106"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"107",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"colPal_idx"}],portsOut:[{name:"Value",links:[{portIn:"Input Color Palette Index",portOut:"Value",objIn:"130",objOut:"107"}]}]},{objName:"Ops.Sidebar.DropDown_v2",id:"108",uiAttribs:{subPatch:0},portsIn:[{name:"Link"},{name:"Text",value:"Color index"},{name:"Values"},{name:"Default",value:""},{name:"Grey Out",value:false},{name:"Visible",value:true},{name:"Lines",value:1},{name:"Set Default",value:0}],portsOut:[{name:"Children",links:[{portIn:"link",portOut:"Children",objIn:"128",objOut:"108"}]},{name:"Result",value:""},{name:"Index",links:[{portIn:"Value",portOut:"Index",objIn:"115",objOut:"108"}]}]},{objName:"Ops.Sidebar.Button_v2",id:"109",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Delete Color"},{name:"Grey Out",value:false},{name:"Visible",value:true}],portsOut:[{name:"childs",links:[{portIn:"Link",portOut:"childs",objIn:"108",objOut:"109"}]},{name:"Pressed Trigger",links:[{portIn:"Execute",portOut:"Pressed Trigger",objIn:"110",objOut:"109"}]}]},{objName:"Ops.Trigger.TriggerExtender",id:"110",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Remove Color",portOut:"Next",objIn:"130",objOut:"110"}]}]},{objName:"Ops.Sidebar.LocalFileToDataUrl",id:"111",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Load File:"},{name:"Id",value:""},{name:"Visible",value:true},{name:"Grey Out",value:false},{name:"Show Dialog",value:0},{name:"Reset",value:0}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"125",objOut:"111"}]},{name:"Data URL",links:[{portIn:"file",portOut:"Data URL",objIn:"112",objOut:"111"}]}]},{objName:"Ops.Json.AjaxRequest_v2",id:"112",uiAttribs:{subPatch:0},portsIn:[{name:"file",display:"file"},{name:"JsonP",value:false},{name:"headers"},{name:"body",value:""},{name:"HTTP Method index",value:0},{name:"HTTP Method",value:"GET"},{name:"Content-Type",value:"application/json"},{name:"parse json",value:true},{name:"Auto request",value:true},{name:"reload",value:0}],portsOut:[{name:"data",links:[{portIn:"Object In",portOut:"data",objIn:"113",objOut:"112"}]},{name:"response"},{name:"Is Loading",value:false},{name:"Loaded",links:[{portIn:"True",portOut:"Loaded",objIn:"114",objOut:"112"}]}]},{objName:"Ops.Json.GateObject",id:"113",uiAttribs:{subPatch:0},portsIn:[{name:"Object In"},{name:"Pass Through"},{name:"Only Valid Objects",value:false}],portsOut:[{name:"Object Out",links:[{portIn:"Load Color Object",portOut:"Object Out",objIn:"130",objOut:"113"}]}]},{objName:"Ops.Boolean.TriggerBoolean",id:"114",uiAttribs:{subPatch:0},portsIn:[{name:"True"},{name:"false",value:0}],portsOut:[{name:"Result",links:[{portIn:"Pass Through",portOut:"Result",objIn:"113",objOut:"114"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"115",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"selIndex"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"116",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"selIndex"}],portsOut:[{name:"Value",links:[{portIn:"Selected Index",portOut:"Value",objIn:"130",objOut:"116"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"117",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"colIndex"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Sidebar.Button_v2",id:"118",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Add Color"},{name:"Grey Out",value:false},{name:"Visible",value:true}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"109",objOut:"118"}]},{name:"Pressed Trigger",links:[{portIn:"Execute",portOut:"Pressed Trigger",objIn:"119",objOut:"118"}]}]},{objName:"Ops.Trigger.TriggerExtender",id:"119",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Add Color",portOut:"Next",objIn:"130",objOut:"119"}]}]},{objName:"Ops.Sidebar.SidebarText_v2",id:"120",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Don't forget to save the colors before closing the patch!"},{name:"Id",value:""}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"122",objOut:"120"}]}]},{objName:"Ops.Sidebar.Group",id:"121",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Colors"},{name:"Show Title",value:true},{name:"Default Minimized",value:false},{name:"Visible",value:true}],portsOut:[{name:"next"},{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"118",objOut:"121"}]}]},{objName:"Ops.Sidebar.Group",id:"122",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Files"},{name:"Show Title",value:true},{name:"Default Minimized",value:false},{name:"Visible",value:true}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"121",objOut:"122"}]},{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"111",objOut:"122"}]}]},{objName:"Ops.Vars.VarSetObject_v2",id:"123",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"json"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Json.SaveJsonFile",id:"124",uiAttribs:{subPatch:0},portsIn:[{name:"download"},{name:"Filename",value:"ColorCurator_"},{name:"Object"}],portsOut:[]},{objName:"Ops.Sidebar.Button_v2",id:"125",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Download Colors"},{name:"Grey Out",value:false},{name:"Visible",value:true}],portsOut:[{name:"childs"},{name:"Pressed Trigger",links:[{portIn:"download",portOut:"Pressed Trigger",objIn:"124",objOut:"125"}]}]},{objName:"Ops.Vars.VarGetObject_v2",id:"126",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"json"}],portsOut:[{name:"Value",links:[{portIn:"Object",portOut:"Value",objIn:"124",objOut:"126"}]}]},{objName:"Ops.Array.ArrayLength",id:"127",uiAttribs:{subPatch:0},portsIn:[{name:"array"}],portsOut:[{name:"length",links:[{portIn:"Number",portOut:"length",objIn:"129",objOut:"127"}]}]},{objName:"Ops.Sidebar.DisplayValue_v2",id:"128",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Colors"},{name:"Value"}],portsOut:[{name:"childs"}]},{objName:"Ops.String.NumberToString_v2",id:"129",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"128",objOut:"129"}]}]},{objName:"Ops.User.dave_p.ColorCurator",id:"130",uiAttribs:{subPatch:0},portsIn:[{name:"Add Color"},{name:"Remove Color"},{name:"Input Color Palette Index"},{name:"Selected Index"},{name:"Load Color Object"}],portsOut:[{name:"Color Indexes Array",links:[{portIn:"Values",portOut:"Color Indexes Array",objIn:"108",objOut:"130"},{portIn:"array",portOut:"Color Indexes Array",objIn:"127",objOut:"130"}]},{name:"Color Indexes Object",links:[{portIn:"Value",portOut:"Color Indexes Object",objIn:"123",objOut:"130"}]},{name:"Color Index",links:[{portIn:"Value",portOut:"Color Index",objIn:"117",objOut:"130"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"131",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"colPal_idx"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"132",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"colPal_idx"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"66",objOut:"132"}]}]},{objName:"Ops.Math.MapRange",id:"133",uiAttribs:{subPatch:0},portsIn:[{name:"value"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:0},{name:"new max",value:900},{name:"Easing index",value:2},{name:"Easing",value:"Smootherstep"}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"134",objOut:"133"}]}]},{objName:"Ops.Math.Floor",id:"134",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"Value 0",portOut:"Result",objIn:"147",objOut:"134"}]}]},{objName:"Ops.Json.ObjectValues",id:"135",uiAttribs:{subPatch:0},portsIn:[{name:"Object"}],portsOut:[{name:"Num values",links:[{portIn:"new max",portOut:"Num values",objIn:"145",objOut:"135"}]},{name:"Values",links:[{portIn:"array",portOut:"Values",objIn:"136",objOut:"135"}]}]},{objName:"Ops.Array.ArrayGetNumber",id:"136",uiAttribs:{subPatch:0},portsIn:[{name:"array"},{name:"index"}],portsOut:[{name:"value",links:[{portIn:"Value 1",portOut:"value",objIn:"147",objOut:"136"}]}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"137",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"167",objOut:"137"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"152",objOut:"137"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"138",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"137",objOut:"138"}]}]},{objName:"Ops.Gl.TextureEffects.BrightnessContrast",id:"139",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"contrast",value:.8},{name:"brightness",value:.5}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"155",objOut:"139"}]}]},{objName:"Ops.Anim.Timer_v2",id:"140",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:.025},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"time",portOut:"Time",objIn:"150",objOut:"140"},{portIn:"anim",portOut:"Time",objIn:"166",objOut:"140"}]}]},{objName:"Ops.Vars.VarSetArray_v2",id:"141",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"Noise_overlay"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetArray_v2",id:"142",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"Noise_overlay"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"143",objOut:"142"}]}]},{objName:"Ops.Array.Array3GetNumbers",id:"143",uiAttribs:{subPatch:0},portsIn:[{name:"Array"},{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"scrollX",portOut:"X",objIn:"166",objOut:"143"},{portIn:"x",portOut:"X",objIn:"150",objOut:"143"}]},{name:"Y",links:[{portIn:"y",portOut:"Y",objIn:"150",objOut:"143"},{portIn:"scrollY",portOut:"Y",objIn:"166",objOut:"143"}]},{name:"Z",links:[{portIn:"scale",portOut:"Z",objIn:"150",objOut:"143"},{portIn:"value",portOut:"Z",objIn:"169",objOut:"143"}]}]},{objName:"Ops.Gl.RenderAnim_v2",id:"144",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"File Type index",value:0},{name:"File Type",value:"PNG"},{name:"ZIP multiple files",value:false},{name:"Download Files",value:true},{name:"Filename",value:"atmosphericInstability"},{name:"Quality",value:.8},{name:"Duration Type index",value:0},{name:"Duration Type",value:"Frames"},{name:"Duration",value:1},{name:"FPS",value:1},{name:"Transparency",value:false},{name:"Use Canvas Size",value:false},{name:"texture width",value:1920},{name:"texture height",value:1080},{name:"Start",value:0}],portsOut:[{name:"Next",value:0},{name:"Progress",value:2},{name:"Frame",value:2},{name:"Status",value:"Finished"},{name:"Started",value:false},{name:"Data URL"},{name:"Finished",value:0}]},{objName:"Ops.Math.MapRange",id:"145",uiAttribs:{subPatch:0},portsIn:[{name:"value"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:0},{name:"new max"},{name:"Easing index",value:2},{name:"Easing",value:"Smootherstep"}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"146",objOut:"145"}]}]},{objName:"Ops.Math.Floor",id:"146",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"index",portOut:"Result",objIn:"136",objOut:"146"}]}]},{objName:"Ops.Value.ToggleNumber",id:"147",uiAttribs:{subPatch:0},portsIn:[{name:"Use Value 1",value:true},{name:"Value 0"},{name:"Value 1"}],portsOut:[{name:"Out Value",links:[{portIn:"Number",portOut:"Out Value",objIn:"149",objOut:"147"}]}]},{objName:"Ops.Json.AjaxRequest_v2",id:"148",uiAttribs:{subPatch:0},portsIn:[{name:"file",value:"assets/atmosphericInstability_colors.json",display:"file"},{name:"JsonP",value:false},{name:"headers"},{name:"body",value:""},{name:"HTTP Method index",value:0},{name:"HTTP Method",value:"GET"},{name:"Content-Type",value:"application/json"},{name:"parse json",value:true},{name:"Auto request",value:true},{name:"reload",value:0}],portsOut:[{name:"data",links:[{portIn:"Object",portOut:"data",objIn:"135",objOut:"148"}]},{name:"response"},{name:"Is Loading",value:false},{name:"Loaded",value:0}]},{objName:"Ops.Ui.VizNumber",id:"149",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"131",objOut:"149"}]}]},{objName:"Ops.Gl.TextureEffects.Noise.SimplexNoise_v2",id:"150",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Mask",value:0},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"smoothness",value:1},{name:"Harmonics index",value:0},{name:"Harmonics",value:"1"},{name:"scale"},{name:"x"},{name:"y"},{name:"time"},{name:"Offset",value:0},{name:"Offset Multiply",value:1},{name:"Offset X index",value:0},{name:"Offset X",value:"R"},{name:"Offset Y index",value:0},{name:"Offset Y",value:"R"},{name:"Offset Z index",value:1},{name:"Offset Z",value:"R"}],portsOut:[{name:"trigger",links:[{portIn:"Trigger in 0",portOut:"trigger",objIn:"168",objOut:"150"}]}]},{objName:"Ops.Ui.VizTexture",id:"151",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Gradient",portOut:"Texture Out",objIn:"86",objOut:"151"}]},{name:"Info",value:"903 x 867 8bit linear repeat"}]},{objName:"Ops.Ui.VizTexture",id:"152",uiAttribs:{subPatch:0},portsIn:[{name:"Texture In"}],portsOut:[{name:"Texture Out",links:[{portIn:"Texture 4",portOut:"Texture Out",objIn:"87",objOut:"152"}]},{name:"Info",value:"903 x 867 32bit linear repeat"}]},{objName:"Ops.Gl.TextureEffects.Clarity",id:"153",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"amount",value:.5}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"98",objOut:"153"}]}]},{objName:"Ops.Gl.TextureEffects.FastBlur_v2",id:"154",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Passes",value:1},{name:"Clamp",value:true},{name:"direction index",value:0},{name:"direction",value:"both"},{name:"Mask",value:0},{name:"Mask Invert",value:false}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.FastBlur_v2",id:"155",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Passes",value:3},{name:"Clamp",value:true},{name:"direction index",value:0},{name:"direction",value:"both"},{name:"Mask",value:0},{name:"Mask Invert",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"156",objOut:"155"}]}]},{objName:"Ops.Gl.TextureEffects.FXAA",id:"156",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"span index",value:0},{name:"span",value:8},{name:"reduceMin",value:128},{name:"reduceMul",value:8},{name:"use viewport size",value:true},{name:"width",value:0},{name:"height",value:0}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"157",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"158",objOut:"157"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"151",objOut:"157"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Gl.TextureEffects.DrawImage_v3",id:"158",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Image"},{name:"Premultiplied",value:false},{name:"Alpha Mask",value:false},{name:"removeAlphaSrc",value:false},{name:"Mask",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:false},{name:"Aspect Ratio",value:false},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:false},{name:"flip x",value:false},{name:"flip y",value:false},{name:"Transform",value:false},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"159",objOut:"158"}]}]},{objName:"Ops.Gl.TextureEffects.ScrollTexture",id:"159",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"amountX"},{name:"amountY",value:0},{name:"Mask",value:0},{name:"Repeat",value:true}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"161",objOut:"159"}]}]},{objName:"Ops.Anim.Timer_v2",id:"160",uiAttribs:{subPatch:0},portsIn:[{name:"Speed",value:.01},{name:"Play",value:true},{name:"Reset",value:0},{name:"Sync to timeline",value:false}],portsOut:[{name:"Time",links:[{portIn:"amountX",portOut:"Time",objIn:"159",objOut:"160"}]}]},{objName:"Ops.Gl.TextureEffects.FastBlur_v2",id:"161",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Passes",value:3},{name:"Clamp",value:false},{name:"direction index",value:0},{name:"direction",value:"both"},{name:"Mask",value:0},{name:"Mask Invert",value:false}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.Gl.Textures.NoiseTexture",id:"162",uiAttribs:{subPatch:0},portsIn:[{name:"Width",value:2048},{name:"Height",value:2048},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Color",value:false},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"Seed",value:0},{name:"Channel R",value:true},{name:"Min R",value:0},{name:"Max R",value:1},{name:"Channel G",value:true},{name:"Min G",value:0},{name:"Max G",value:1},{name:"Channel B",value:true},{name:"Min B",value:0},{name:"Max B",value:1}],portsOut:[{name:"Texture"}]},{objName:"Ops.Gl.TextureEffects.Noise.Noise_v2",id:"163",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Amount",value:1},{name:"Animated",value:true},{name:"RGB",value:false},{name:"Normalize",value:0},{name:"Multiply",value:0}],portsOut:[{name:"Next",value:0}]},{objName:"Ops.Gl.TextureEffects.ImageCompose_v3",id:"164",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Base Texture",value:0},{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Pixel Format index",value:0},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"163",objOut:"164"}]},{name:"texture_out",links:[{portIn:"Texture 6",portOut:"texture_out",objIn:"87",objOut:"164"}]},{name:"Aspect Ratio",value:1.041522491349481},{name:"Texture Width",value:903},{name:"Texture Height",value:867}]},{objName:"Ops.Trigger.TriggerExtender",id:"165",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"}],portsOut:[{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"164",objOut:"165"}]}]},{objName:"Ops.Gl.TextureEffects.Noise.FBMNoise_v2",id:"166",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"scale"},{name:"anim"},{name:"scrollX"},{name:"scrollY"},{name:"repeat",value:1},{name:"aspect",value:1},{name:"Layer 1",value:true},{name:"Layer 2",value:true},{name:"Layer 3",value:true},{name:"Layer 4",value:true},{name:"Tileable",value:false}],portsOut:[{name:"trigger",links:[{portIn:"Trigger in 1",portOut:"trigger",objIn:"168",objOut:"166"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"167",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"150",objOut:"167"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"166",objOut:"167"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Trigger.SwitchTrigger",id:"168",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger Index"},{name:"Trigger in 0"},{name:"Trigger in 1"},{name:"Trigger in 2",value:0},{name:"Trigger in 3",value:0},{name:"Trigger in 4",value:0},{name:"Trigger in 5",value:0},{name:"Trigger in 6",value:0},{name:"Trigger in 7",value:0},{name:"Trigger in 8",value:0},{name:"Trigger in 9",value:0},{name:"Trigger in 10",value:0},{name:"Trigger in 11",value:0},{name:"Trigger in 12",value:0},{name:"Trigger in 13",value:0},{name:"Trigger in 14",value:0},{name:"Trigger in 15",value:0}],portsOut:[{name:"Trigger out",links:[{portIn:"render",portOut:"Trigger out",objIn:"139",objOut:"168"}]}]},{objName:"Ops.Math.MapRange",id:"169",uiAttribs:{subPatch:0},portsIn:[{name:"value"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:.1},{name:"new max",value:2},{name:"Easing index",value:0},{name:"Easing",value:"Linear"}],portsOut:[{name:"result",links:[{portIn:"scale",portOut:"result",objIn:"166",objOut:"169"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"170",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"Noise_overlay_idx"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Math.Floor",id:"171",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"170",objOut:"171"}]}]},{objName:"Ops.Math.MapRange",id:"172",uiAttribs:{subPatch:0},portsIn:[{name:"value"},{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:0},{name:"new max",value:2},{name:"Easing index",value:2},{name:"Easing",value:"Smootherstep"}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"171",objOut:"172"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"173",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"Noise_overlay_idx"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"167",objOut:"173"},{portIn:"Trigger Index",portOut:"Value",objIn:"168",objOut:"173"}]}]}],users:[],userOps:[],tags:[],_id:"62ea6e471cd29b87848654d8",name:"new project",userId:"5c17ca121b93ac1418476716",created:"2022-08-03T12:47:03.412Z",updated:"2022-08-15T09:30:43.044Z",log:[],__v:118,shortId:"UtILz9",buildInfo:{core:{timestamp:1658229186222,created:"2022-07-19T11:13:06.222Z",git:{branch:"master",commit:"819fc0e7c02646be982b7338326b610a383cd8f6",date:"2022-07-19T11:09:39.000Z",message:"corelib"}},ui:{timestamp:1658229196319,created:"2022-07-19T11:13:16.319Z",git:{branch:"master",commit:"cde4fa72579470c06fa2ad7390223a8b7a061095",date:"2022-06-29T13:18:31.000Z",message:"idiot sandwitch"}},host:"cables.gl"},opsHash:"2e2d9ecb384d808c9f838f2fb6ba8cb3c4fc29bf",ui:{timeLineLength:20,bookmarks:[],viewBoxesGl:{0:{x:4377.70746425771,y:361.1439755814803,z:1178.5968377534725}},renderer:{w:903,h:867,s:1}},updatedByUser:"dave_p",cachedUsername:"dave_p",views:1,statsAdmin:{filenameScreenshots:["_screenshots/screenshot.png","_screenshots/screenshot_1659531828240.png","_screenshots/screenshot_1659532107441.png","_screenshots/screenshot_1659532287886.png","_screenshots/screenshot_1659532840294.png","_screenshots/screenshot_1659532936837.png","_screenshots/screenshot_1659533063869.png","_screenshots/screenshot_1659533265433.png","_screenshots/screenshot_1659533503163.png","_screenshots/screenshot_1659533566935.png","_screenshots/screenshot_1659533651388.png","_screenshots/screenshot_1659533697274.png","_screenshots/screenshot_1659533744349.png","_screenshots/screenshot_1659533783869.png","_screenshots/screenshot_1659533880247.png","_screenshots/screenshot_1659892789935.png","_screenshots/screenshot_1659892986898.png","_screenshots/screenshot_1659893826123.png","_screenshots/screenshot_1659893915896.png","_screenshots/screenshot_1659894079044.png","_screenshots/screenshot_1659894302977.png","_screenshots/screenshot_1659894688403.png","_screenshots/screenshot_1659896828861.png","_screenshots/screenshot_1659896912985.png","_screenshots/screenshot_1659897058657.png","_screenshots/screenshot_1659956648898.png","_screenshots/screenshot_1659971410972.png","_screenshots/screenshot_1660036871215.png","_screenshots/screenshot_1660048756379.png","_screenshots/screenshot_1660048890102.png","_screenshots/screenshot_1660049148870.png","_screenshots/screenshot_1660049233696.png","_screenshots/screenshot_1660049255114.png","_screenshots/screenshot_1660049306083.png","_screenshots/screenshot_1660049979691.png","_screenshots/screenshot_1660050294942.png","_screenshots/screenshot_1660050416199.png","_screenshots/screenshot_1660050645769.png","_screenshots/screenshot_1660050735715.png","_screenshots/screenshot_1660051358802.png","_screenshots/screenshot_1660051453948.png","_screenshots/screenshot_1660051846694.png","_screenshots/screenshot_1660051881538.png","_screenshots/screenshot_1660051926026.png","_screenshots/screenshot_1660052025465.png","_screenshots/screenshot_1660052250209.png","_screenshots/screenshot_1660052362007.png","_screenshots/screenshot_1660052417422.png","_screenshots/screenshot_1660052481085.png","_screenshots/screenshot_1660123091307.png","_screenshots/screenshot_1660123096123.png","_screenshots/screenshot_1660123380722.png","_screenshots/screenshot_1660123409134.png","_screenshots/screenshot_1660123921225.png","_screenshots/screenshot_1660124336374.png","_screenshots/screenshot_1660124456197.png","_screenshots/screenshot_1660124673217.png","_screenshots/screenshot_1660124753582.png","_screenshots/screenshot_1660124929723.png","_screenshots/screenshot_1660125426003.png","_screenshots/screenshot_1660125743286.png","_screenshots/screenshot_1660125817087.png","_screenshots/screenshot_1660126461312.png","_screenshots/screenshot_1660126518009.png","_screenshots/screenshot_1660126897756.png","_screenshots/screenshot_1660127103856.png","_screenshots/screenshot_1660127529794.png","_screenshots/screenshot_1660127544570.png","_screenshots/screenshot_1660127979479.png","_screenshots/screenshot_1660128299930.png","_screenshots/screenshot_1660128394929.png","_screenshots/screenshot_1660130898660.png","_screenshots/screenshot_1660131083183.png","_screenshots/screenshot_1660131107943.png","_screenshots/screenshot_1660131530092.png","_screenshots/screenshot_1660131603209.png","_screenshots/screenshot_1660131671895.png","_screenshots/screenshot_1660131867681.png","_screenshots/screenshot_1660132022113.png","_screenshots/screenshot_1660132163942.png","_screenshots/screenshot_1660132315856.png","_screenshots/screenshot_1660241757618.png","_screenshots/screenshot_1660241815479.png","_screenshots/screenshot_1660241939925.png","_screenshots/screenshot_1660242097341.png","_screenshots/screenshot_1660242303451.png","_screenshots/screenshot_1660242407507.png","_screenshots/screenshot_1660242646272.png","_screenshots/screenshot_1660243131081.png","_screenshots/screenshot_1660243318706.png","_screenshots/screenshot_1660243700054.png","_screenshots/screenshot_1660243755797.png","_screenshots/screenshot_1660243796065.png","_screenshots/screenshot_1660244019531.png","_screenshots/screenshot_1660244316441.png","_screenshots/screenshot_1660244345814.png","_screenshots/screenshot_1660244381155.png","_screenshots/screenshot_1660244687003.png","_screenshots/screenshot_1660244737555.png","_screenshots/screenshot_1660244771405.png","_screenshots/screenshot_1660244786957.png","_screenshots/screenshot_1660244797701.png","_screenshots/screenshot_1660244827609.png","_screenshots/screenshot_1660244863237.png","_screenshots/screenshot_1660245082124.png","_screenshots/screenshot_1660245205697.png","_screenshots/screenshot_1660245269620.png","_screenshots/screenshot_1660245318101.png","_screenshots/screenshot_1660245328188.png","_screenshots/screenshot_1660245355151.png","_screenshots/screenshot_1660250098709.png","_screenshots/screenshot_converted.jpg","_screenshots/screenshot_converted.webp"],filenameExports:[],filenameAssets:["atmosphericInstability_colors.json"],hasOldScreenshots:false,hasOldExports:false,sizeScreenshots:39644.126953125,sizeExports:0,sizeAssets:.2373046875},exports:1};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["UtILz9"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Api=Ops.Api||{};Ops.Anim=Ops.Anim||{};Ops.Json=Ops.Json||{};Ops.Math=Ops.Math||{};Ops.User=Ops.User||{};Ops.Vars=Ops.Vars||{};Ops.Array=Ops.Array||{};Ops.Color=Ops.Color||{};Ops.Value=Ops.Value||{};Ops.String=Ops.String||{};Ops.Boolean=Ops.Boolean||{};Ops.Devices=Ops.Devices||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Trigger=Ops.Trigger||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Shader=Ops.Gl.Shader||{};Ops.Api.FxHash=Ops.Api.FxHash||{};Ops.Gl.Textures=Ops.Gl.Textures||{};Ops.User.dave_p=Ops.User.dave_p||{};Ops.Devices.Mouse=Ops.Devices.Mouse||{};Ops.Gl.TextureEffects=Ops.Gl.TextureEffects||{};Ops.Gl.TextureEffects.Noise=Ops.Gl.TextureEffects.Noise||{};Ops.Gl.MainLoop=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const t=r.inValue("FPS Limit",0),n=r.outTrigger("trigger"),i=r.outNumber("width"),a=r.outNumber("height"),s=r.inValueBool("Reduce FPS not focussed",true),o=r.inValueBool("Reduce FPS loading"),l=r.inValueBool("Clear",true),u=r.inValueBool("ClearAlpha",true),c=r.inValueBool("Fullscreen Button",false),h=r.inValueBool("Active",true),d=r.inValueBool("Hires Displays",false),f=r.inSwitch("Pixel Unit",["Display","CSS"],"Display");r.onAnimFrame=x;d.onChange=function(){if(d.get())r.patch.cgl.pixelDensity=window.devicePixelRatio;else r.patch.cgl.pixelDensity=1;r.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout();f.setUiAttribs({greyout:!d.get()})};h.onChange=function(){r.patch.removeOnAnimFrame(r);if(h.get()){r.setUiAttrib({extendTitle:""});r.onAnimFrame=x;r.patch.addOnAnimFrame(r);r.log("adding again!")}else{r.setUiAttrib({extendTitle:"Inactive"})}};const p=r.patch.cgl;let m=0;let g=0;if(!r.patch.cgl)r.uiAttr({error:"No webgl cgl context"});const v=vec3.create();vec3.set(v,0,0,0);const b=vec3.create();vec3.set(b,0,0,-2);c.onChange=E;setTimeout(E,100);let _=null;let F=true;let C=true;window.addEventListener("blur",()=>{F=false});window.addEventListener("focus",()=>{F=true});document.addEventListener("visibilitychange",()=>{C=!document.hidden});B();f.onChange=()=>{i.set(0);a.set(0)};function A(){if(o.get()&&r.patch.loading.getProgress()<1)return 5;if(s.get()){if(!C)return 10;if(!F)return 30}return t.get()}function E(){function e(){if(_)_.style.display="block"}function t(){if(_)_.style.display="none"}r.patch.cgl.canvas.addEventListener("mouseleave",t);r.patch.cgl.canvas.addEventListener("mouseenter",e);if(c.get()){if(!_){_=document.createElement("div");const n=r.patch.cgl.canvas.parentElement;if(n)n.appendChild(_);_.addEventListener("mouseenter",e);_.addEventListener("click",function(e){if(CABLES.UI&&!e.shiftKey)gui.cycleFullscreen();else p.fullScreen()})}_.style.padding="10px";_.style.position="absolute";_.style.right="5px";_.style.top="5px";_.style.width="20px";_.style.height="20px";_.style.cursor="pointer";_.style["border-radius"]="40px";_.style.background="#444";_.style["z-index"]="9999";_.style.display="none";_.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 490 490" style="width:20px;height:20px;" xml:space="preserve" width="512px" height="512px"><g><path d="M173.792,301.792L21.333,454.251v-80.917c0-5.891-4.776-10.667-10.667-10.667C4.776,362.667,0,367.442,0,373.333V480     c0,5.891,4.776,10.667,10.667,10.667h106.667c5.891,0,10.667-4.776,10.667-10.667s-4.776-10.667-10.667-10.667H36.416     l152.459-152.459c4.093-4.237,3.975-10.99-0.262-15.083C184.479,297.799,177.926,297.799,173.792,301.792z" fill="#FFFFFF"/><path d="M480,0H373.333c-5.891,0-10.667,4.776-10.667,10.667c0,5.891,4.776,10.667,10.667,10.667h80.917L301.792,173.792     c-4.237,4.093-4.354,10.845-0.262,15.083c4.093,4.237,10.845,4.354,15.083,0.262c0.089-0.086,0.176-0.173,0.262-0.262     L469.333,36.416v80.917c0,5.891,4.776,10.667,10.667,10.667s10.667-4.776,10.667-10.667V10.667C490.667,4.776,485.891,0,480,0z" fill="#FFFFFF"/><path d="M36.416,21.333h80.917c5.891,0,10.667-4.776,10.667-10.667C128,4.776,123.224,0,117.333,0H10.667     C4.776,0,0,4.776,0,10.667v106.667C0,123.224,4.776,128,10.667,128c5.891,0,10.667-4.776,10.667-10.667V36.416l152.459,152.459     c4.237,4.093,10.99,3.975,15.083-0.262c3.992-4.134,3.992-10.687,0-14.82L36.416,21.333z" fill="#FFFFFF"/><path d="M480,362.667c-5.891,0-10.667,4.776-10.667,10.667v80.917L316.875,301.792c-4.237-4.093-10.99-3.976-15.083,0.261     c-3.993,4.134-3.993,10.688,0,14.821l152.459,152.459h-80.917c-5.891,0-10.667,4.776-10.667,10.667s4.776,10.667,10.667,10.667     H480c5.891,0,10.667-4.776,10.667-10.667V373.333C490.667,367.442,485.891,362.667,480,362.667z" fill="#FFFFFF"/></g></svg>'}else{if(_){_.style.display="none";_.remove();_=null}}}r.onDelete=function(){p.gl.clearColor(0,0,0,0);p.gl.clear(p.gl.COLOR_BUFFER_BIT|p.gl.DEPTH_BUFFER_BIT)};function x(e){if(!h.get())return;if(p.aborted||p.canvas.clientWidth===0||p.canvas.clientHeight===0)return;const t=performance.now();r.patch.config.fpsLimit=A();if(p.canvasWidth==-1){p.setCanvas(r.patch.config.glCanvasId);return}if(p.canvasWidth!=i.get()||p.canvasHeight!=a.get()){let e=1;if(f.get()=="CSS")e=r.patch.cgl.pixelDensity;i.set(p.canvasWidth/e);a.set(p.canvasHeight/e)}if(CABLES.now()-g>1e3){CGL.fpsReport=CGL.fpsReport||[];if(r.patch.loading.getProgress()>=1&&g!==0)CGL.fpsReport.push(m);m=0;g=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;p.renderStart(p,v,b);if(l.get()){p.gl.clearColor(0,0,0,1);p.gl.clear(p.gl.COLOR_BUFFER_BIT|p.gl.DEPTH_BUFFER_BIT)}n.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(p);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}p.renderEnd(p);if(u.get()){p.gl.clearColor(1,1,1,1);p.gl.colorMask(false,false,false,true);p.gl.clear(p.gl.COLOR_BUFFER_BIT);p.gl.colorMask(true,true,true,true)}if(!p.frameStore.phong)p.frameStore.phong={};m++;r.patch.cgl.profileData.profileMainloopMs=performance.now()-t}function B(){setTimeout(()=>{if(r.patch.getOpsByObjName(r.name).length>1){r.setUiError("multimainloop","there should only be one mainloop op!");r.patch.addEventListener("onOpDelete",B)}else r.setUiError("multimainloop",null,1)},500)}};Ops.Gl.MainLoop.prototype=new CABLES.Op;CABLES.OPS["b0472a1d-db16-4ba6-8787-f300fbdc77bb"]={f:Ops.Gl.MainLoop,objName:"Ops.Gl.MainLoop"};Ops.Gl.TextureEffects.Noise.Noise_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={noise_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float time;\n\n#ifdef HAS_MULMASK\n    UNI sampler2D texMul;\n#endif\n\n{{CGL.BLENDMODES3}}\n{{MODULES_HEAD}}\n\n{{CGL.RANDOM_TEX}}\n\nvoid main()\n{\n    vec4 rnd;\n\n    #ifdef RGB\n        rnd=vec4(cgl_random3(texCoord.xy+vec2(time)),1.0);\n    #else\n        float r=cgl_random(texCoord.xy+vec2(time));\n        rnd=vec4( r,r,r,1.0 );\n    #endif\n\n    vec4 base=texture(tex,texCoord);\n    vec4 col=rnd;//( _blend(base.rgb,rnd.rgb) ,1.0);\n\n    #ifdef NORMALIZE\n        col.rgb=(col.rgb-0.5)*2.0;\n    #endif\n\n    #ifdef HAS_MULMASK\n        col.rgb*=texture(texMul,texCoord).rgb;\n    #endif\n\n    outColor=cgl_blendPixel(base,col,amount);\n    // outColor=vec4( mix( col.rgb, base.rgb ,1.0-base.a*amount),1.0);\n}"};const n=e.inTrigger("Render"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=CGL.TextureEffect.AddBlendAlphaMask(e),a=e.inValueSlider("Amount",1),s=e.inValueBool("Animated",true),o=e.inValueBool("RGB",false),l=e.inValueBool("Normalize",false),u=e.inTexture("Multiply"),c=e.outTrigger("Next");const h=e.patch.cgl,d=new CGL.Shader(h,e.name),f=new CGL.Uniform(d,"f","amount",a),p=new CGL.Uniform(d,"f","time",1),m=new CGL.Uniform(d,"t","tex",0),g=new CGL.Uniform(d,"t","texMul",1);d.setSource(d.getDefaultVertexShader(),t.noise_frag);CGL.TextureEffect.setupBlending(e,d,r,a,i);e.toWorkPortsNeedToBeLinked(n);u.onChange=l.onChange=o.onChange=function(){d.toggleDefine("HAS_MULMASK",u.get());d.toggleDefine("RGB",o.get());d.toggleDefine("NORMALIZE",l.get())};n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;if(s.get())p.setValue(e.patch.freeTimer.get()/1e3%100);else p.setValue(0);h.pushShader(d);h.setTexture(0,h.currentTextureEffect.getCurrentSourceTexture().tex);if(u.get())h.setTexture(1,u.get().tex);h.currentTextureEffect.bind();h.currentTextureEffect.finish();h.popShader();c.trigger()}};Ops.Gl.TextureEffects.Noise.Noise_v2.prototype=new CABLES.Op;CABLES.OPS["b1d9aacc-dc52-43a6-a00f-414f08768800"]={f:Ops.Gl.TextureEffects.Noise.Noise_v2,objName:"Ops.Gl.TextureEffects.Noise.Noise_v2"};Ops.Gl.TextureEffects.ImageCompose_v3=function(){CABLES.Op.apply(this,arguments);const n=this;const e={imgcomp_frag:"IN vec2 texCoord;\nUNI vec4 bgColor;\nUNI sampler2D tex;\n\nvoid main()\n{\n\n    #ifndef USE_TEX\n        outColor=bgColor;\n    #endif\n    #ifdef USE_TEX\n        outColor=texture(tex,texCoord);\n    #endif\n\n\n\n}\n"};const r=n.patch.cgl,t=n.inTrigger("Render"),i=n.inTexture("Base Texture"),a=n.inSwitch("Size",["Auto","Manual"],"Auto"),s=n.inValueInt("Width",640),o=n.inValueInt("Height",480),l=n.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),u=n.inValueSelect("Wrap",["clamp to edge","repeat","mirrored repeat"],"repeat"),c=n.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),h=n.inValueSlider("R",0),d=n.inValueSlider("G",0),f=n.inValueSlider("B",0),p=n.inValueSlider("A",0),m=n.outTrigger("Next"),g=n.outTexture("texture_out",CGL.Texture.getEmptyTexture(r)),v=n.outNumber("Aspect Ratio"),b=n.outNumber("Texture Width"),_=n.outNumber("Texture Height");n.setPortGroup("Texture Size",[a,s,o]);n.setPortGroup("Texture Parameters",[u,l,c]);h.setUiAttribs({colorPick:true});n.setPortGroup("Color",[h,d,f,p]);const F=[0,0,0,0];let C=null;let A=null;let E=true;let x=false;let B=null;let D=null;let y=null;u.onChange=l.onChange=c.onChange=L;i.onLinkChanged=a.onChange=V;t.onTriggered=n.preRender=R;V();function O(){if(C)C.delete();if(A)A.delete();C=new CGL.TextureEffect(r,{isFloatingPointTexture:T()});A=new CGL.Texture(r,{name:"image_compose_v2_"+n.id,isFloatingPointTexture:T(),filter:I(),wrap:S(),width:w(),height:N()});C.setSourceTexture(A);b.set(w());_.set(N());v.set(w()/N());g.set(CGL.Texture.getEmptyTexture(r));E=false;V()}function I(){if(l.get()=="nearest")return CGL.Texture.FILTER_NEAREST;else if(l.get()=="linear")return CGL.Texture.FILTER_LINEAR;else if(l.get()=="mipmap")return CGL.Texture.FILTER_MIPMAP}function S(){if(u.get()=="repeat")return CGL.Texture.WRAP_REPEAT;else if(u.get()=="mirrored repeat")return CGL.Texture.WRAP_MIRRORED_REPEAT;else if(u.get()=="clamp to edge")return CGL.Texture.WRAP_CLAMP_TO_EDGE}function T(){x=c.get()==CGL.Texture.PFORMATSTR_RGBA32F;return x}function w(){if(i.get()&&a.get()=="Auto")return i.get().width;if(a.get()=="Auto")return r.getViewPort()[2];return Math.ceil(s.get())}function N(){if(i.get()&&a.get()=="Auto")return i.get().height;else if(a.get()=="Auto")return r.getViewPort()[3];else return Math.ceil(o.get())}function L(){E=true}function k(){if((w()!=A.width||N()!=A.height||A.isFloatingPoint()!=T()||A.filter!=I()||A.wrap!=S())&&(w()!==0&&N()!==0)){O();C.setSourceTexture(A);g.set(CGL.Texture.getEmptyTexture(r));g.set(A);M()}}function M(){let e=null;if(a.get()=="Manual"){e=null}else if(a.get()=="Auto"){if(i.get())e="Input Texture";else e="Canvas Size";e+=": "+w()+" x "+N()}let t=false;t=a.uiAttribs.info!=e;a.setUiAttribs({info:e});if(t)n.refreshParams()}function P(){if(B)B.toggleDefine("USE_TEX",i.isLinked())}function V(){h.setUiAttribs({greyout:i.isLinked()});f.setUiAttribs({greyout:i.isLinked()});d.setUiAttribs({greyout:i.isLinked()});p.setUiAttribs({greyout:i.isLinked()});s.setUiAttribs({greyout:a.get()=="Auto"});o.setUiAttribs({greyout:a.get()=="Auto"});s.setUiAttribs({hideParam:a.get()!="Manual"});o.setUiAttribs({hideParam:a.get()!="Manual"});if(A)if(T()&&I()==CGL.Texture.FILTER_MIPMAP)n.setUiError("fpmipmap","Don't use mipmap and 32bit at the same time, many systems do not support this.");else n.setUiError("fpmipmap",null);M();P()}n.preRender=()=>{R()};function U(){if(!B){B=new CGL.Shader(r,"copytextureshader");B.setSource(B.getDefaultVertexShader(),e.imgcomp_frag);D=new CGL.Uniform(B,"t","tex",0);y=new CGL.Uniform(B,"4f","bgColor",h,d,f,p);P()}r.pushShader(B);r.currentTextureEffect.bind();if(i.get())r.setTexture(0,i.get().tex);r.currentTextureEffect.finish();r.popShader()}function R(){if(!C||E)O();const e=r.getViewPort();F[0]=e[0];F[1]=e[1];F[2]=e[2];F[3]=e[3];r.pushBlend(false);k();const t=r.currentTextureEffect;r.currentTextureEffect=C;r.currentTextureEffect.imgCompVer=3;r.currentTextureEffect.width=s.get();r.currentTextureEffect.height=o.get();C.setSourceTexture(A);C.startEffect(i.get()||CGL.Texture.getEmptyTexture(r,x),true);U();m.trigger();g.set(CGL.Texture.getEmptyTexture(r));g.set(C.getCurrentSourceTexture());C.endEffect();r.setViewPort(F[0],F[1],F[2],F[3]);r.popBlend(false);r.currentTextureEffect=t}};Ops.Gl.TextureEffects.ImageCompose_v3.prototype=new CABLES.Op;CABLES.OPS["e890a050-11b7-456e-b09b-d08cd9c1ee41"]={f:Ops.Gl.TextureEffects.ImageCompose_v3,objName:"Ops.Gl.TextureEffects.ImageCompose_v3"};Ops.Sequence=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.inTrigger("exe"),n=a.inTriggerButton("Clean up connections");const r=[],s=[],i=16;let o=null;t.onTriggered=u;n.onTriggered=c;n.setUiAttribs({hidePort:true});n.setUiAttribs({hideParam:true});for(let t=0;t<i;t++){const h=a.outTrigger("trigger "+t);s.push(h);h.onLinkChanged=l;if(t<i-1){let e=a.inTrigger("exe "+t);e.onTriggered=u;r.push(e)}}function l(){clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<s.length;e++)if(s[e].links.length>1)t=true;n.setUiAttribs({hideParam:!t});if(a.isCurrentUiOp())a.refreshParams()},60)}function u(){for(let e=0;e<s.length;e++)s[e].trigger()}function c(){let r=0;for(let n=0;n<s.length;n++){let t=[];if(s[n].links.length>1)for(let e=1;e<s[n].links.length;e++){while(s[r].links.length>0)r++;t.push(s[n].links[e]);const i=s[n].links[e].getOtherPort(s[n]);a.patch.link(a,"trigger "+r,i.parent,i.name);r++}for(let e=0;e<t.length;e++)t[e].remove()}l()}};Ops.Sequence.prototype=new CABLES.Op;CABLES.OPS["a466bc1f-06e9-4595-8849-bffb9fe22f99"]={f:Ops.Sequence,objName:"Ops.Sequence"};Ops.Gl.TextureEffects.DrawImage_v3=function(){CABLES.Op.apply(this,arguments);const r=this;const e={drawimage_frag:"#ifdef HAS_TEXTURES\n    IN vec2 texCoord;\n    UNI sampler2D tex;\n    UNI sampler2D image;\n#endif\n\n#ifdef TEX_TRANSFORM\n    IN mat3 transform;\n#endif\n// UNI float rotate;\n\n{{CGL.BLENDMODES}}\n\n#ifdef HAS_TEXTUREALPHA\n   UNI sampler2D imageAlpha;\n#endif\n\nUNI float amount;\n\n#ifdef ASPECT_RATIO\n    UNI float aspectTex;\n    UNI float aspectPos;\n#endif\n\nvoid main()\n{\n    vec4 blendRGBA=vec4(0.0,0.0,0.0,1.0);\n\n    #ifdef HAS_TEXTURES\n        vec2 tc=texCoord;\n\n        #ifdef TEX_FLIP_X\n            tc.x=1.0-tc.x;\n        #endif\n        #ifdef TEX_FLIP_Y\n            tc.y=1.0-tc.y;\n        #endif\n\n        #ifdef ASPECT_RATIO\n            #ifdef ASPECT_AXIS_X\n                tc.y=(1.0-aspectPos)-(((1.0-aspectPos)-tc.y)*aspectTex);\n            #endif\n            #ifdef ASPECT_AXIS_Y\n                tc.x=(1.0-aspectPos)-(((1.0-aspectPos)-tc.x)/aspectTex);\n            #endif\n        #endif\n\n        #ifdef TEX_TRANSFORM\n            vec3 coordinates=vec3(tc.x, tc.y,1.0);\n            tc=(transform * coordinates ).xy;\n        #endif\n\n        blendRGBA=texture(image,tc);\n\n        vec3 blend=blendRGBA.rgb;\n        vec4 baseRGBA=texture(tex,texCoord);\n        vec3 base=baseRGBA.rgb;\n\n\n        #ifdef PREMUL\n            blend.rgb = (blend.rgb) + (base.rgb * (1.0 - blendRGBA.a));\n        #endif\n\n        vec3 colNew=_blend(base,blend);\n\n\n\n\n        #ifdef REMOVE_ALPHA_SRC\n            blendRGBA.a=1.0;\n        #endif\n\n        #ifdef HAS_TEXTUREALPHA\n            vec4 colImgAlpha=texture(imageAlpha,tc);\n            float colImgAlphaAlpha=colImgAlpha.a;\n\n            #ifdef ALPHA_FROM_LUMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef ALPHA_FROM_INV_UMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=1.0-(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef INVERT_ALPHA\n                colImgAlphaAlpha=clamp(colImgAlphaAlpha,0.0,1.0);\n                colImgAlphaAlpha=1.0-colImgAlphaAlpha;\n            #endif\n\n            blendRGBA.a=colImgAlphaAlpha*blendRGBA.a;\n        #endif\n    #endif\n\n    float am=amount;\n\n    #ifdef CLIP_REPEAT\n        if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n        {\n            // colNew.rgb=vec3(0.0);\n            am=0.0;\n        }\n    #endif\n\n    #ifdef ASPECT_RATIO\n        #ifdef ASPECT_CROP\n            if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n            {\n                colNew.rgb=base.rgb;\n                am=0.0;\n            }\n\n        #endif\n    #endif\n\n\n\n    #ifndef PREMUL\n        blendRGBA.rgb=mix(colNew,base,1.0-(am*blendRGBA.a));\n        blendRGBA.a=clamp(baseRGBA.a+(blendRGBA.a*am),0.,1.);\n    #endif\n\n    #ifdef PREMUL\n        // premultiply\n        // blendRGBA.rgb = (blendRGBA.rgb) + (baseRGBA.rgb * (1.0 - blendRGBA.a));\n        blendRGBA=vec4(\n            mix(colNew.rgb,base,1.0-(am*blendRGBA.a)),\n            blendRGBA.a*am+baseRGBA.a\n            );\n    #endif\n\n    #ifdef ALPHA_MASK\n    blendRGBA.a=baseRGBA.a;\n    #endif\n\n    outColor=blendRGBA;\n}\n\n\n\n\n\n\n\n",drawimage_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\n\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\n// OUT vec3 norm;\n\n#ifdef TEX_TRANSFORM\n    UNI float posX;\n    UNI float posY;\n    UNI float scaleX;\n    UNI float scaleY;\n    UNI float rotate;\n    OUT mat3 transform;\n#endif\n\nvoid main()\n{\n   texCoord=attrTexCoord;\n//   norm=attrVertNormal;\n\n   #ifdef TEX_TRANSFORM\n        vec3 coordinates=vec3(attrTexCoord.x, attrTexCoord.y,1.0);\n        float angle = radians( rotate );\n        vec2 scale= vec2(scaleX,scaleY);\n        vec2 translate= vec2(posX,posY);\n\n        transform = mat3(   scale.x * cos( angle ), scale.x * sin( angle ), 0.0,\n            - scale.y * sin( angle ), scale.y * cos( angle ), 0.0,\n            - 0.5 * scale.x * cos( angle ) + 0.5 * scale.y * sin( angle ) - 0.5 * translate.x*2.0 + 0.5,  - 0.5 * scale.x * sin( angle ) - 0.5 * scale.y * cos( angle ) - 0.5 * translate.y*2.0 + 0.5, 1.0);\n   #endif\n\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"};const t=r.inTrigger("render"),n=CGL.TextureEffect.AddBlendSelect(r,"blendMode"),i=r.inValueSlider("amount",1),a=r.inTexture("Image"),s=r.inValueBool("Premultiplied",false),o=r.inValueBool("Alpha Mask",false),l=r.inValueBool("removeAlphaSrc",false),u=r.inTexture("Mask"),c=r.inValueSelect("Mask Src",["alpha channel","luminance","luminance inv"],"luminance"),h=r.inValueBool("Invert alpha channel"),d=r.inValueBool("Aspect Ratio",false),f=r.inValueSelect("Stretch Axis",["X","Y"],"X"),p=r.inValueSlider("Position",0),m=r.inValueBool("Crop",false),g=r.outTrigger("trigger");n.set("normal");const v=r.patch.cgl;const b=new CGL.Shader(v,"drawimage");u.onLinkChanged=_;r.setPortGroup("Mask",[u,c,h]);r.setPortGroup("Aspect Ratio",[d,p,m,f]);function _(){if(u.isLinked()){l.setUiAttribs({greyout:true});c.setUiAttribs({greyout:false});h.setUiAttribs({greyout:false})}else{l.setUiAttribs({greyout:false});c.setUiAttribs({greyout:true});h.setUiAttribs({greyout:true})}}r.toWorkPortsNeedToBeLinked(a);b.setSource(e.drawimage_vert,e.drawimage_frag);const F=new CGL.Uniform(b,"t","tex",0),C=new CGL.Uniform(b,"t","image",1),A=new CGL.Uniform(b,"t","imageAlpha",2),E=new CGL.Uniform(b,"f","aspectTex",1),x=new CGL.Uniform(b,"f","aspectPos",p);d.onChange=m.onChange=f.onChange=B;function B(){b.removeDefine("ASPECT_AXIS_X");b.removeDefine("ASPECT_AXIS_Y");b.removeDefine("ASPECT_CROP");p.setUiAttribs({greyout:!d.get()});m.setUiAttribs({greyout:!d.get()});f.setUiAttribs({greyout:!d.get()});if(d.get()){b.define("ASPECT_RATIO");if(m.get())b.define("ASPECT_CROP");if(f.get()=="X")b.define("ASPECT_AXIS_X");if(f.get()=="Y")b.define("ASPECT_AXIS_Y")}else{b.removeDefine("ASPECT_RATIO");if(m.get())b.define("ASPECT_CROP");if(f.get()=="X")b.define("ASPECT_AXIS_X");if(f.get()=="Y")b.define("ASPECT_AXIS_Y")}}c.set("alpha channel");const D=r.inValueBool("flip x");const y=r.inValueBool("flip y");let O=r.inValueBool("Transform");let I=r.inValueSlider("Scale X",1);let S=r.inValueSlider("Scale Y",1);let T=r.inValue("Position X",0);let w=r.inValue("Position Y",0);let N=r.inValue("Rotation",0);const L=r.inValueBool("Clip Repeat",false);const k=new CGL.Uniform(b,"f","scaleX",I);const M=new CGL.Uniform(b,"f","scaleY",S);const P=new CGL.Uniform(b,"f","posX",T);const V=new CGL.Uniform(b,"f","posY",w);const U=new CGL.Uniform(b,"f","rotate",N);O.onChange=R;function R(){b.toggleDefine("TEX_TRANSFORM",O.get());I.setUiAttribs({greyout:!O.get()});S.setUiAttribs({greyout:!O.get()});T.setUiAttribs({greyout:!O.get()});w.setUiAttribs({greyout:!O.get()});N.setUiAttribs({greyout:!O.get()})}CGL.TextureEffect.setupBlending(r,b,n,i);const G=new CGL.Uniform(b,"f","amount",i);t.onTriggered=z;L.onChange=u.onChange=s.onChange=o.onChange=h.onChange=y.onChange=D.onChange=l.onChange=c.onChange=j;R();_();B();j();function j(){b.toggleDefine("REMOVE_ALPHA_SRC",l.get());b.toggleDefine("ALPHA_MASK",o.get());b.toggleDefine("CLIP_REPEAT",L.get());b.toggleDefine("HAS_TEXTUREALPHA",u.get()&&u.get().tex);b.toggleDefine("TEX_FLIP_X",D.get());b.toggleDefine("TEX_FLIP_Y",y.get());b.toggleDefine("INVERT_ALPHA",h.get());b.toggleDefine("ALPHA_FROM_LUMINANCE",c.get()=="luminance");b.toggleDefine("ALPHA_FROM_INV_UMINANCE",c.get()=="luminance_inv");b.toggleDefine("PREMUL",s.get())}function z(){if(!CGL.TextureEffect.checkOpInEffect(r))return;const e=a.get();if(e&&e.tex&&i.get()>0){v.pushShader(b);v.currentTextureEffect.bind();const t=v.currentTextureEffect.getCurrentSourceTexture();v.setTexture(0,t.tex);if(t&&e){if(e.textureType!=t.textureType&&(e.textureType!=CGL.Texture.TYPE_FLOAT||t.textureType!=CGL.Texture.TYPE_FLOAT))r.setUiError("textypediff","Drawing 32bit texture into an 8 bit can result in data/precision loss",1);else r.setUiError("textypediff",null)}const n=1/(v.currentTextureEffect.getWidth()/v.currentTextureEffect.getHeight())*(e.width/e.height);E.setValue(n);v.setTexture(1,e.tex);if(u.get()&&u.get().tex){v.setTexture(2,u.get().tex)}v.pushBlendMode(CGL.BLEND_NONE,true);v.currentTextureEffect.finish();v.popBlendMode();v.popShader()}g.trigger()}};Ops.Gl.TextureEffects.DrawImage_v3.prototype=new CABLES.Op;CABLES.OPS["8f6b2f15-fcb0-4597-90c0-e5173f2969fe"]={f:Ops.Gl.TextureEffects.DrawImage_v3,objName:"Ops.Gl.TextureEffects.DrawImage_v3"};Ops.Gl.Meshes.FullscreenRectangle=function(){CABLES.Op.apply(this,arguments);const e=this;const t={shader_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\n\nvoid main()\n{\n    outColor= texture(tex,texCoord);\n}\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n   texCoord=vec2(attrTexCoord.x,(1.0-attrTexCoord.y));\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const n=e.inTrigger("render"),r=e.inSwitch("Scale",["Stretch","Fit"],"Stretch"),i=e.inValueBool("Flip Y"),a=e.inValueBool("Flip X"),s=e.inTexture("Texture"),o=e.outTrigger("trigger");const l=e.patch.cgl;let u=null;let c=new CGL.Geometry("fullscreen rectangle");let h=0,d=0,f=0,p=0,m=0;a.onChange=E;i.onChange=E;const g=new CGL.Shader(l,"fullscreenrectangle");g.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);g.setSource(t.shader_vert,t.shader_frag);g.fullscreenRectUniform=new CGL.Uniform(g,"t","tex",0);g.aspectUni=new CGL.Uniform(g,"f","aspectTex",0);let v=false;let b=true;let _=false;let F=[];n.onTriggered=A;e.toWorkPortsNeedToBeLinked(n);s.onChange=function(){b=true};function C(){let e=s.get();if(e)v=true;else v=false}e.preRender=function(){C();g.bind();if(u)u.render(g);A()};r.onChange=()=>{_=r.get()=="Fit"};function A(){if(l.getViewPort()[2]!=p||l.getViewPort()[3]!=m||!u)x();if(b)C();l.pushPMatrix();mat4.identity(l.pMatrix);mat4.ortho(l.pMatrix,0,p,m,0,-10,1e3);l.pushModelMatrix();mat4.identity(l.mMatrix);l.pushViewMatrix();mat4.identity(l.vMatrix);if(_&&s.get()){const n=s.get().width/s.get().height;let e=m;let t=m*n;if(t>p){e=p*1/n;t=p}F[0]=l.getViewPort()[0];F[1]=l.getViewPort()[1];F[2]=l.getViewPort()[2];F[3]=l.getViewPort()[3];l.setViewPort((p-t)/2,(m-e)/2,t,e)}if(v){if(s.get())l.setTexture(0,s.get().tex);u.render(g)}else{u.render(l.getShader())}l.gl.clear(l.gl.DEPTH_BUFFER_BIT);l.popPMatrix();l.popModelMatrix();l.popViewMatrix();if(_&&s.get())l.setViewPort(F[0],F[1],F[2],F[3]);o.trigger()}function E(){u=null}function x(){const e=l.getViewPort();if(e[2]==p&&e[3]==m&&u)return;let t=0,n=0;p=e[2];m=e[3];c.vertices=new Float32Array([t+p,n+m,0,t,n+m,0,t+p,n,0,t,n,0]);let r=null;if(i.get())r=new Float32Array([1,0,0,0,1,1,0,1]);else r=new Float32Array([1,1,0,1,1,0,0,0]);if(a.get()){r[0]=0;r[2]=1;r[4]=0;r[6]=1}c.setTexCoords(r);c.verticesIndices=new Uint16Array([2,1,0,3,1,2]);c.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);c.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0]);c.biTangents==new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0]);if(!u)u=new CGL.Mesh(l,c);else u.setGeom(c)}};Ops.Gl.Meshes.FullscreenRectangle.prototype=new CABLES.Op;CABLES.OPS["255bd15b-cc91-4a12-9b4e-53c710cbb282"]={f:Ops.Gl.Meshes.FullscreenRectangle,objName:"Ops.Gl.Meshes.FullscreenRectangle"};Ops.Trigger.TriggerExtender=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};var n=e.inTriggerButton("Execute");var r=e.outTrigger("Next");n.onTriggered=function(){r.trigger()}};Ops.Trigger.TriggerExtender.prototype=new CABLES.Op;CABLES.OPS["7ef594f3-4907-47b0-a2d3-9854eda1679d"]={f:Ops.Trigger.TriggerExtender,objName:"Ops.Trigger.TriggerExtender"};Ops.Api.FxHash.FxHash=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};if(!CABLES.fakefxhash&&!window.fxhash||CABLES.fakefxhash){CABLES.fakefxhash=true}const n=!CABLES.fakefxhash,a="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";const s=e.inString("Hash",""),r=e.inTriggerButton("Randomize Hash"),i=e.outString("fxhash"),o=e.outNumber("fxrand 1"),l=e.outNumber("fxrand 2"),u=e.outNumber("fxrand 3"),c=e.outNumber("fxrand 4"),h=e.outArray("Random Numbers"),d=e.outBoolNum("fxhash environment",n);s.onChange=m;let f=false;m();r.onTriggered=()=>{s.set(p());e.refreshParams()};function p(){let t="";const n=a.length-1;for(let e=0;e<51;e++){t+=a[Math.round(Math.random()*n)]}return t}function m(){if(n&&f)return;if(!n){window.fxhash=s.get()||p();let t=e=>[...e].reduce((e,t)=>e*a.length+a.indexOf(t)|0,0);let e=fxhash.slice(2);let n=new RegExp(".{"+(fxhash.length/4|0)+"}","g");let r=e.match(n).map(e=>t(e));let i=(t,n,r,i)=>()=>{t|=0;n|=0;r|=0;i|=0;let e=(t+n|0)+i|0;i=i+1|0;t=n^n>>>9;n=r+(r<<3)|0;r=r<<21|r>>>11;r=r+e|0;return(e>>>0)/4294967296};window.fxrand=i(...r)}f=true;i.set(window.fxhash);o.set(0);l.set(0);u.set(0);c.set(0);o.set(fxrand());l.set(fxrand());u.set(fxrand());c.set(fxrand());const t=[];for(let e=0;e<1e3;e++)t.push(fxrand());h.set(t)}};Ops.Api.FxHash.FxHash.prototype=new CABLES.Op;CABLES.OPS["090355fe-6ad9-457c-8192-9e306a9fe1eb"]={f:Ops.Api.FxHash.FxHash,objName:"Ops.Api.FxHash.FxHash"};Ops.Gl.TextureEffects.SkewStretchImage_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={invert_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float stretchTopX;\nUNI float stretchBotX;\nUNI float stretchLeft;\nUNI float stretchRight;\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n    vec2 tc=texCoord;\n\n    #ifdef SMOOTHSTEP\n        tc.y=smoothstep(0.,1.,tc.y);\n        tc.x=smoothstep(0.,1.,tc.x);\n    #endif\n\n    vec2 tcnorm=texCoord;\n\n    tcnorm-=0.5;\n    tcnorm*=2.0;\n\n    tcnorm.x=mix(tcnorm.x*stretchBotX,tcnorm.x,tc.y);\n    tcnorm.x=mix(tcnorm.x*stretchTopX,tcnorm.x,1.0-tc.y);\n\n    tcnorm.y=mix(tcnorm.y*stretchLeft,tcnorm.y,tc.x);\n    tcnorm.y=mix(tcnorm.y*stretchRight,tcnorm.y,1.0-tc.x);\n\n    tc=tcnorm/2.0+0.5;\n\n    col=texture(tex,tc);\n\n    #ifdef CLAMP\n        if(tc.x<0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0) col=vec4(0.0,0.0,0.0,0.0);\n    #endif\n\n    vec4 base=texture(tex,texCoord);\n    base.a=0.0;\n\n    outColor=cgl_blendPixel(base,col,amount);\n}\n"};const n=e.inTrigger("render"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=e.inValueSlider("Amount",1),a=e.inBool("Clamp",true),s=e.outTrigger("trigger");const o=e.patch.cgl;const l=new CGL.Shader(o,"skewstrechimage");l.setSource(l.getDefaultVertexShader(),t.invert_frag);const u=new CGL.Uniform(l,"t","tex",0);const c=new CGL.Uniform(l,"f","amount",i);l.addUniformFrag("f","stretchTopX",e.inFloat("Stretch Top",1));l.addUniformFrag("f","stretchBotX",e.inFloat("Stretch Bottom",1));l.addUniformFrag("f","stretchLeft",e.inFloat("Stretch Left",1));l.addUniformFrag("f","stretchRight",e.inFloat("Stretch Right",1));CGL.TextureEffect.setupBlending(e,l,r,i);a.onChange=h;h();function h(){l.toggleDefine("CLAMP",a.get())}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;o.pushShader(l);o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);o.currentTextureEffect.finish();o.popShader();s.trigger()}};Ops.Gl.TextureEffects.SkewStretchImage_v2.prototype=new CABLES.Op;CABLES.OPS["665bbc0c-2fd7-4683-a1df-e57d8f17da93"]={f:Ops.Gl.TextureEffects.SkewStretchImage_v2,objName:"Ops.Gl.TextureEffects.SkewStretchImage_v2"};Ops.Gl.TextureEffects.BarrelDistortion_v3=function(){CABLES.Op.apply(this,arguments);const t=this;const e={barreldistort_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float intensity;\n\n{{CGL.BLENDMODES3}}\n\n// adapted from https://www.shadertoy.com/view/MlSXR3\n\nvec2 brownConradyDistortion(vec2 uv)\n{\n// positive values of K1 give barrel distortion, negative give pincushion\n    float barrelDistortion1 = intensity*10.; // K1 in text books\n    float barrelDistortion2 = 0.; // K2 in text books\n    float r2 = uv.x*uv.x + uv.y*uv.y;\n    uv *= 1.0 + barrelDistortion1 * r2 + barrelDistortion2 * r2 * r2;\n\n    // tangential distortion (due to off center lens elements)\n    // is not modeled in this function, but if it was, the terms would go here\n    return uv;\n}\n\nvoid main()\n{\n    vec2 tc=brownConradyDistortion(texCoord-0.5)+0.5;\n    vec4 col=texture(tex,texCoord);\n    vec4 base=texture(tex,tc);\n\n    col.a=0.0;\n    outColor=cgl_blendPixel(col,base,amount);\n}"};const n=t.inTrigger("render"),r=CGL.TextureEffect.AddBlendSelect(t,"Blend Mode","normal"),i=t.inValueSlider("Amount",1),a=t.inValue("Intensity",10),s=t.outTrigger("Trigger");const o=t.patch.cgl;const l=new CGL.Shader(o,t.name);l.setSource(l.getDefaultVertexShader(),e.barreldistort_frag);const u=new CGL.Uniform(l,"t","tex",0),c=new CGL.Uniform(l,"f","intensity",0),h=new CGL.Uniform(l,"f","amount",i);CGL.TextureEffect.setupBlending(t,l,r,i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t,3))return;let e=o.currentTextureEffect.getCurrentSourceTexture();c.setValue(a.get()*(1/e.width));o.pushShader(l);o.currentTextureEffect.bind();o.setTexture(0,e.tex);o.currentTextureEffect.finish();o.popShader();s.trigger()}};Ops.Gl.TextureEffects.BarrelDistortion_v3.prototype=new CABLES.Op;CABLES.OPS["d5efa9e4-d552-42f8-a345-d49e5e861602"]={f:Ops.Gl.TextureEffects.BarrelDistortion_v3,objName:"Ops.Gl.TextureEffects.BarrelDistortion_v3"};Ops.Gl.TextureEffects.Noise.PixelNoise_v3=function(){CABLES.Op.apply(this,arguments);const e=this;const t={pixelnoise2_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float numX;\nUNI float numY;\nUNI float addX;\nUNI float addY;\nUNI float addZ;\nUNI float seed2;\nUNI float minIn;\nUNI float maxIn;\n\nfloat random(vec2 co)\n{\n    float r=fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * (5.711+(mod(addZ+5711.210,57111.0))));\n\n    #ifdef LOOP\n        r=abs(r-0.5)*2.0;\n    #endif\n\n    return r;\n}\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n    vec2 seed=vec2(0.0);\n\n    #ifndef CENTER\n        seed=vec2(floor( texCoord.x*numX+addX),floor( texCoord.y*numY+addY));\n    #endif\n    #ifdef CENTER\n        seed=vec2(floor( (texCoord.x-0.5)*numX+addX),floor( (texCoord.y-0.5)*numY+addY));\n    #endif\n\n    float r,g,b;\n\n    #ifndef RGB\n        r=g=b=random( seed + 0.5711 + seed2 );\n    #endif\n\n    #ifdef RGB\n        r=random( seed+0.5711 + seed2);\n        g=random( seed+0.5712 + seed2);\n        b=random( seed+0.5713 + seed2);\n    #endif\n\n    vec4 rnd = clamp( vec4( r,g,b,1.0 ),vec4(minIn), vec4(maxIn) );\n\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blendPixel(base,rnd,amount);\n\n}"};const n=e.inTrigger("Render"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=CGL.TextureEffect.AddBlendAlphaMask(e),a=e.inValueSlider("Amount",1),s=e.inValueBool("Loop",false),o=e.inValueBool("RGB",false),l=e.inValue("Minimum value",0),u=e.inValue("Maximum value",1),c=e.inValue("Num X",10),h=e.inValue("Num Y",10),d=e.inValue("X",0),f=e.inValue("Y",0),p=e.inValue("Z",0),m=e.inValue("Seed",0),g=e.inBool("Centered",false),v=e.outTrigger("Next");e.setPortGroup("Look",[o,s,l,u]);e.setPortGroup("Position",[d,f,p]);e.setPortGroup("Scaling",[c,h]);const b=e.patch.cgl;const _=new CGL.Shader(b,e.name);_.setSource(_.getDefaultVertexShader(),t.pixelnoise2_frag);const F=new CGL.Uniform(_,"f","amount",a),C=new CGL.Uniform(_,"f","time",1),A=new CGL.Uniform(_,"t","tex",0),E=new CGL.Uniform(_,"f","numX",c),x=new CGL.Uniform(_,"f","numY",h),B=new CGL.Uniform(_,"f","addX",d),D=new CGL.Uniform(_,"f","addY",f),y=new CGL.Uniform(_,"f","addZ",p),O=new CGL.Uniform(_,"f","seed2",m),I=new CGL.Uniform(_,"f","minIn",l),S=new CGL.Uniform(_,"f","maxIn",u);s.onChange=function(){if(s.get())_.define("LOOP");else _.removeDefine("LOOP")};o.onChange=function(){if(o.get())_.define("RGB");else _.removeDefine("RGB")};g.onChange=function(){_.toggleDefine("CENTER",g.get())};CGL.TextureEffect.setupBlending(e,_,r,a,i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;b.pushShader(_);b.currentTextureEffect.bind();b.setTexture(0,b.currentTextureEffect.getCurrentSourceTexture().tex);b.currentTextureEffect.finish();b.popShader();v.trigger()}};Ops.Gl.TextureEffects.Noise.PixelNoise_v3.prototype=new CABLES.Op;CABLES.OPS["01ad08b6-dea4-4765-984c-3885c9c6520f"]={f:Ops.Gl.TextureEffects.Noise.PixelNoise_v3,objName:"Ops.Gl.TextureEffects.Noise.PixelNoise_v3"};Ops.Devices.Mouse.Mouse_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueBool("Active",true),r=e.inValueBool("relative"),i=e.inValueBool("normalize"),a=e.inValueBool("flip y",true),s=e.inValueSelect("Area",["Canvas","Document","Parent Element"],"Canvas"),o=e.inBool("right click prevent default",true),l=e.inValueBool("Touch support",true),u=e.inValueBool("smooth"),c=e.inValueFloat("smoothSpeed",20),h=e.inValueFloat("multiply",1),d=e.outNumber("x",0),f=e.outNumber("y",0),p=e.outValueBool("button down"),m=e.outTrigger("click"),g=e.outTrigger("Button Up"),v=e.outTrigger("click right"),b=e.outValueBool("mouseOver"),_=e.outNumber("button");e.setPortGroup("Behavior",[r,i,a,s,o,l]);e.setPortGroup("Smoothing",[u,c,h]);let F=0;const C=e.patch.cgl;let A=null;function E(n,r){if(i.get()){let e=C.canvas.width/C.pixelDensity;let t=C.canvas.height/C.pixelDensity;if(A==document.body){e=A.clientWidth/C.pixelDensity;t=A.clientHeight/C.pixelDensity}d.set(((n||0)/e*2-1)*h.get());f.set(((r||0)/t*2-1)*h.get())}else{d.set((n||0)*h.get());f.set((r||0)*h.get())}}u.onChange=function(){if(u.get())F=setInterval(k,5);else if(F)clearTimeout(F)};let x,B;let D=0,y=0;i.onChange=function(){O=0;I=0;E(O,I)};var O=C.canvas.width/2;var I=C.canvas.height/2;D=O;y=I;d.set(O);f.set(I);let S=0;let T=0;let w=0;let N=0;Z();s.onChange=Z;let L=0;function k(){L=c.get();if(L<=0)L=.01;const e=Math.abs(O-D);const t=Math.round(e/L,0);D=D<O?D+t:D-t;const n=Math.abs(I-y);const r=Math.round(n/L,0);y=y<I?y+r:y-r;E(D,y)}function M(e){p.set(false);b.set(true);L=c.get()}function P(e){_.set(e.which);p.set(true)}function V(e){_.set(0);p.set(false);g.trigger()}function U(e){v.trigger();if(o.get())e.preventDefault()}function R(e){m.trigger()}function G(e){S=0;T=0;L=100;b.set(false);p.set(false)}r.onChange=function(){w=0;N=0};function j(e){if(!r.get()){if(s.get()!="Document"){w=e.offsetX;N=e.offsetY}else{w=e.clientX;N=e.clientY}if(u.get()){O=w;if(a.get())I=A.clientHeight-N;else I=N}else{if(a.get())E(w,A.clientHeight-N);else E(w,N)}}else{if(S!=0&&T!=0){w=e.offsetX-S;N=e.offsetY-T}else{}S=e.offsetX;T=e.offsetY;O+=w;I+=N;if(I>460)I=460}}function z(e){b.set(true);j(e)}function X(e){if(event.touches&&event.touches.length>0)j(e.touches[0])}function W(e){p.set(true);if(e.touches&&e.touches.length>0)P(e.touches[0])}function H(e){p.set(false);V()}l.onChange=function(){Y();Z()};function Y(){if(!A)return;A.removeEventListener("touchend",H);A.removeEventListener("touchstart",W);A.removeEventListener("touchmove",X);A.removeEventListener("click",R);A.removeEventListener("mousemove",z);A.removeEventListener("mouseleave",G);A.removeEventListener("mousedown",P);A.removeEventListener("mouseup",V);A.removeEventListener("mouseenter",M);A.removeEventListener("contextmenu",U);A=null}function Z(){if(A||!n.get())Y();if(!n.get())return;A=C.canvas;if(s.get()=="Document")A=document.body;if(s.get()=="Parent Element")A=C.canvas.parentElement;if(l.get()){A.addEventListener("touchend",H);A.addEventListener("touchstart",W);A.addEventListener("touchmove",X)}A.addEventListener("mousemove",z);A.addEventListener("mouseleave",G);A.addEventListener("mousedown",P);A.addEventListener("mouseup",V);A.addEventListener("mouseenter",M);A.addEventListener("contextmenu",U);A.addEventListener("click",R)}n.onChange=function(){if(A)Y();if(n.get())Z()};e.onDelete=function(){Y()};Z()};Ops.Devices.Mouse.Mouse_v2.prototype=new CABLES.Op;CABLES.OPS["9fa3fc46-3147-4e3a-8ee8-a93ea9e8786e"]={f:Ops.Devices.Mouse.Mouse_v2,objName:"Ops.Devices.Mouse.Mouse_v2"};Ops.Vars.VarSetNumber_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueFloat("Value",0);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",n,e.varName)};Ops.Vars.VarSetNumber_v2.prototype=new CABLES.Op;CABLES.OPS["b5249226-6095-4828-8a1c-080654e192fa"]={f:Ops.Vars.VarSetNumber_v2,objName:"Ops.Vars.VarSetNumber_v2"};Ops.Vars.VarSetArray_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"array",n,e.varName)};Ops.Vars.VarSetArray_v2.prototype=new CABLES.Op;CABLES.OPS["8088290f-45d4-4312-b4ca-184d34ca4667"]={f:Ops.Vars.VarSetArray_v2,objName:"Ops.Vars.VarSetArray_v2"};Ops.Vars.VarGetArray_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.outArray("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"array",e.varName,n)};Ops.Vars.VarGetArray_v2.prototype=new CABLES.Op;CABLES.OPS["afa79294-aa9c-43bc-a49a-cade000a1de5"]={f:Ops.Vars.VarGetArray_v2,objName:"Ops.Vars.VarGetArray_v2"};Ops.Array.MapRangeArray=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.outArray("result"),r=e.inArray("array"),p=e.inValueFloat("old min"),m=e.inValueFloat("old max"),g=e.inValueFloat("new min"),v=e.inValueFloat("new max"),i=e.inValueSelect("Easing",["Linear","Smoothstep","Smootherstep"],"Linear");e.setPortGroup("Input Range",[p,m]);e.setPortGroup("Output Range",[g,v]);let b=0;let _=0;i.onChange=function(){if(i.get()==="Smoothstep"){b=1}else if(i.get()==="Smootherstep"){b=2}else{b=0}a()};function a(){const e=r.get();if(!e||e.length===0){n.set([]);return}const a=Array(e.length);for(let i=0;i<e.length;i++){let r=e[i];if(r>=Math.max(m.get(),p.get())){a[i]=v.get()}else if(r<=Math.min(m.get(),p.get())){a[i]=g.get()}else{const s=g.get();const o=v.get();const l=p.get();const u=m.get();let e=false;const c=Math.min(l,u);const h=Math.max(l,u);if(c!==l)e=true;let t=false;const d=Math.min(s,o);const f=Math.max(s,o);if(d!==s)t=true;let n=0;if(e){n=(h-r)*(f-d)/(h-c)}else{n=(r-c)*(f-d)/(h-c)}if(t){_=f-n}else{_=n+d}if(b===0){a[i]=_}else if(b===1){r=Math.max(0,Math.min(1,(_-s)/(o-s)));a[i]=s+r*r*(3-2*r)*(o-s)}else if(b===2){r=Math.max(0,Math.min(1,(_-s)/(o-s)));a[i]=s+r*r*r*(r*(r*6-15)+10)*(o-s)}}}n.set(a)}r.set(null);p.set(0);m.set(1);g.set(-1);v.set(1);r.onChange=a;p.onChange=a;m.onChange=a;g.onChange=a;v.onChange=a;n.set(null);a()};Ops.Array.MapRangeArray.prototype=new CABLES.Op;CABLES.OPS["20f921bf-adc2-45fb-b387-834af4f5e19b"]={f:Ops.Array.MapRangeArray,objName:"Ops.Array.MapRangeArray"};Ops.User.dave_p.Array4GetNumbers=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("Array"),r=e.inValueInt("Index"),i=e.outValue("X"),a=e.outValue("Y"),s=e.outValue("Z"),o=e.outValue("W");n.onChange=r.onChange=l;function l(){let e=n.get();if(!e){i.set(0);a.set(0);s.set(0);o.set(0);return}let t=Math.min(e.length-4,r.get()*4);if(e){i.set(e[t+0]);a.set(e[t+1]);s.set(e[t+2]);o.set(e[t+3])}}};Ops.User.dave_p.Array4GetNumbers.prototype=new CABLES.Op;Ops.Gl.TextureEffects.PixelDisplacement_v4=function(){CABLES.Op.apply(this,arguments);const e=this;const t={pixeldisplace3_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D displaceTex;\nUNI float amountX;\nUNI float amountY;\nUNI float amount;\n\n{{CGL.BLENDMODES3}}\n\nvec3 getOffset(vec3 offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nfloat getOffset(float offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nvoid main()\n{\n    vec3 offset=texture(displaceTex,texCoord).rgb;\n    float x,y;\n\n    #ifdef INPUT_REDGREEN\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_RED\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.r*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_GREEN\n        offset=getOffset(offset);\n        x=offset.g*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_BLUE\n        offset=getOffset(offset);\n        x=offset.b*amountX+texCoord.x;\n        y=offset.b*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_LUMINANCE\n        float o=dot(vec3(0.2126,0.7152,0.0722), offset);\n        o=getOffset(o);\n        x=o*amountX+texCoord.x;\n        y=o*amountY+texCoord.y;\n    #endif\n    #ifdef WRAP_CLAMP\n        x=clamp(x,0.0,1.0);\n        y=clamp(y,0.0,1.0);\n    #endif\n    #ifdef WRAP_REPEAT\n        x=mod(x,1.0);\n        y=mod(y,1.0);\n    #endif\n    #ifdef WRAP_MIRROR\n        float mx=mod(x,2.0);\n        float my=mod(y,2.0);\n        x=abs((floor(mx)-fract(mx)));\n        y=abs((floor(my)-fract(my)));\n    #endif\n\n\n\n    vec4 col=texture(tex,vec2(x,y));\n    vec4 base=texture(tex,texCoord);\n\n    base.a=0.0;\n\n    outColor=cgl_blendPixel(base,col,amount);\n}\n"};const n=e.inTrigger("render"),r=e.inTexture("displaceTex"),i=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),a=e.inValueSlider("Amount",1),s=e.inValueSlider("amount X",.2),o=e.inValueSlider("amount Y",.2),l=e.inSwitch("Wrap",["Mirror","Clamp","Repeat"],"Mirror"),u=e.inValueSelect("Input",["Luminance","RedGreen","Red","Green","Blue"],"Luminance"),c=e.inSwitch("Zero Displace",["Grey","Black"],"Grey"),h=e.outTrigger("trigger");e.setPortGroup("Axis Displacement Strength",[s,o]);e.setPortGroup("Modes",[l,u]);e.toWorkPortsNeedToBeLinked(r);const d=e.patch.cgl,f=new CGL.Shader(d,e.name);f.setSource(f.getDefaultVertexShader(),t.pixeldisplace3_frag);const p=new CGL.Uniform(f,"t","tex",0),m=new CGL.Uniform(f,"t","displaceTex",1),g=new CGL.Uniform(f,"f","amountX",s),v=new CGL.Uniform(f,"f","amountY",o),b=new CGL.Uniform(f,"f","amount",a);c.onChange=_;l.onChange=F;u.onChange=C;F();C();_();CGL.TextureEffect.setupBlending(e,f,i,a);function _(){f.removeDefine("ZERO_BLACK");f.removeDefine("ZERO_GREY");f.define("ZERO_"+(c.get()+"").toUpperCase())}function F(){f.removeDefine("WRAP_CLAMP");f.removeDefine("WRAP_REPEAT");f.removeDefine("WRAP_MIRROR");f.define("WRAP_"+(l.get()+"").toUpperCase())}function C(){f.removeDefine("INPUT_LUMINANCE");f.removeDefine("INPUT_REDGREEN");f.removeDefine("INPUT_RED");f.define("INPUT_"+(u.get()+"").toUpperCase())}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;if(r.get()){d.pushShader(f);d.currentTextureEffect.bind();d.setTexture(0,d.currentTextureEffect.getCurrentSourceTexture().tex);if(r.get())d.setTexture(1,r.get().tex);d.currentTextureEffect.finish();d.popShader()}h.trigger()}};Ops.Gl.TextureEffects.PixelDisplacement_v4.prototype=new CABLES.Op;CABLES.OPS["c00f79f2-0505-4b4f-b0bf-10ef7875dd87"]={f:Ops.Gl.TextureEffects.PixelDisplacement_v4,objName:"Ops.Gl.TextureEffects.PixelDisplacement_v4"};Ops.Gl.TextureEffects.ScrollTexture=function(){CABLES.Op.apply(this,arguments);const e=this;const t={scroll_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amountX;\nUNI float amountY;\n\n#ifdef HAS_MASK\n    UNI sampler2D texMask;\n#endif\n\nvoid main()\n{\n    float amX=amountX;\n    float amY=amountY;\n\n    #ifdef HAS_MASK\n        vec4 m=texture(texMask,texCoord);\n\n\n        amX*=(m.r-0.5)*2.0;\n        amY*=(m.g-0.5)*2.0;\n    #endif\n\n    vec4 col=vec4(0.0,0.0,0.0,1.0);\n    float x=mod(texCoord.x+amX,1.0);\n    float y=mod(texCoord.y+amY,1.0);\n\n\n    #ifdef NO_REPEAT\n        x=texCoord.x+amX*0.1;\n        y=texCoord.y+amY*0.1;\n    #endif\n\n    col=texture(tex,vec2(x,y));\n\n    #ifdef NO_REPEAT\n        if(x>1.0 || x<0.0 || y>1.0 || y<0.0) col=vec4(0.0,0.0,0.0,0.0);\n    #endif\n    outColor= col;\n}"};const n=e.inTrigger("render"),r=e.outTrigger("trigger"),i=e.inValue("amountX"),a=e.inValue("amountY"),s=e.inTexture("Mask"),o=e.inValueBool("Repeat",true);o.onChange=p;const l=e.patch.cgl;const u=new CGL.Shader(l,e.name);u.setSource(u.getDefaultVertexShader(),t.scroll_frag);const c=new CGL.Uniform(u,"t","tex",0),h=new CGL.Uniform(u,"f","amountX",i),d=new CGL.Uniform(u,"f","amountY",a),f=new CGL.Uniform(u,"t","texMask",1);p();s.onChange=function(){if(s.get())u.define("MASK");else u.removeDefine("MASK")};function p(){if(!o.get())u.define("NO_REPEAT");else u.removeDefine("NO_REPEAT")}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;l.pushShader(u);l.currentTextureEffect.bind();l.setTexture(0,l.currentTextureEffect.getCurrentSourceTexture().tex);if(s.get())l.setTexture(1,s.get().tex);l.currentTextureEffect.finish();l.popShader();r.trigger()}};Ops.Gl.TextureEffects.ScrollTexture.prototype=new CABLES.Op;CABLES.OPS["9b151d99-7888-4948-81c7-cd23b334e8d4"]={f:Ops.Gl.TextureEffects.ScrollTexture,objName:"Ops.Gl.TextureEffects.ScrollTexture"};Ops.Anim.Timer_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const r=e.inValue("Speed",1),n=e.inValueBool("Play",true),i=e.inTriggerButton("Reset"),a=e.inValueBool("Sync to timeline",false),s=e.outValue("Time");e.setPortGroup("Controls",[n,i,r]);const o=new CABLES.Timer;let l=null;let u=0;let c=false;n.onChange=h;h();function h(){if(n.get()){o.play();e.patch.addOnAnimFrame(e)}else{o.pause();e.patch.removeOnAnimFrame(e)}}i.onTriggered=d;function d(){u=0;l=null;o.setTime(0);s.set(0)}a.onChange=function(){c=a.get();n.setUiAttribs({greyout:c});i.setUiAttribs({greyout:c})};e.onAnimFrame=function(e){if(o.isPlaying()){if(CABLES.overwriteTime!==undefined){s.set(CABLES.overwriteTime*r.get())}else if(c){s.set(e*r.get())}else{o.update();const t=o.get();if(l===null){l=t;return}const n=Math.abs(t-l);l=t;u+=n*r.get();if(u!=u)u=0;s.set(u)}}}};Ops.Anim.Timer_v2.prototype=new CABLES.Op;CABLES.OPS["aac7f721-208f-411a-adb3-79adae2e471a"]={f:Ops.Anim.Timer_v2,objName:"Ops.Anim.Timer_v2"};Ops.Vars.VarGetNumber_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};var n=e.outValue("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"number",e.varName,n)};Ops.Vars.VarGetNumber_v2.prototype=new CABLES.Op;CABLES.OPS["421f5b52-c0fa-47c4-8b7a-012b9e1c864a"]={f:Ops.Vars.VarGetNumber_v2,objName:"Ops.Vars.VarGetNumber_v2"};Ops.Array.ArrayCeil=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("In"),r=e.outArray("Result");var i=[];r.set(i);n.onChange=function(){var e=n.get();if(!e){r.set(null);return}if(i.length!=e.length)i.length=e.length;if(i.length!=e.length)i.length=e.length;for(var t=0;t<e.length;t++){i[t]=Math.ceil(e[t])}r.set(null);r.set(i)}};Ops.Array.ArrayCeil.prototype=new CABLES.Op;CABLES.OPS["a21f03eb-e5a5-44e2-bc0d-a76359ed1cf1"]={f:Ops.Array.ArrayCeil,objName:"Ops.Array.ArrayCeil"};Ops.Array.Array3GetNumbers=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("Array",3),r=e.inValueInt("Index"),i=e.outNumber("X"),a=e.outNumber("Y"),s=e.outNumber("Z");n.onChange=r.onChange=o;function o(){let e=n.get();if(!e){i.set(0);a.set(0);s.set(0);return}let t=Math.min(e.length-3,r.get()*3);if(e){i.set(e[t+0]);a.set(e[t+1]);s.set(e[t+2])}}};Ops.Array.Array3GetNumbers.prototype=new CABLES.Op;CABLES.OPS["56882cc4-c40d-4dc0-bf7c-db1b5a7acad0"]={f:Ops.Array.Array3GetNumbers,objName:"Ops.Array.Array3GetNumbers"};Ops.Ui.VizTexture=function(){CABLES.Op.apply(this,arguments);const e=this;const A={viztex_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI samplerCube cubeMap;\nUNI float width;\nUNI float height;\nUNI float type;\n\nfloat LinearizeDepth(float d,float zNear,float zFar)\n{\n    float z_n = 2.0 * d - 1.0;\n    return 2.0 * zNear / (zFar + zNear - z_n * (zFar - zNear));\n}\n\nvoid main()\n{\n    vec4 col=vec4(vec3(0.),0.0);\n\n    vec4 colTex=texture2D(tex,texCoord);\n\n    if(type==0.0)\n    {\n    }\n\n    if(type==1.0)\n    {\n        vec4 depth=vec4(0.);\n        vec2 localST=texCoord;\n        localST.y = 1. - localST.y;\n\n        localST.t = mod(localST.t*3.,1.);\n        localST.s = mod(localST.s*4.,1.);\n\n        #ifdef WEBGL2\n            #define texCube texture\n        #endif\n        #ifdef WEBGL1\n            #define texCube textureCube\n        #endif\n\n//         //Due to the way my depth-cubeMap is rendered, objects to the -x,y,z side is projected to the positive x,y,z side\n//         //Inside where top/bottom is to be drawn?\n        if (texCoord.s*4.> 1. && texCoord.s*4.<2.)\n        {\n            //Bottom (-y) quad\n            if (texCoord.t*3. < 1.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-1.,-localST.t*2.+1.);//Due to the (arbitrary) way I choose as up in my depth-viewmatrix, i her emultiply the latter coordinate with -1\n                depth = texCube(cubeMap, dir);\n            }\n            //top (+y) quad\n            else if (texCoord.t*3. > 2.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,1.,localST.t*2.-1.);//Get lower y texture, which is projected to the +y part of my cubeMap\n                depth = texCube(cubeMap, dir);\n            }\n            else//Front (-z) quad\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-localST.t*2.+1.,1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n//         //If not, only these ranges should be drawn\n        else if (texCoord.t*3. > 1. && texCoord.t*3. < 2.)\n        {\n            if (texCoord.x*4. < 1.)//left (-x) quad\n            {\n                vec3 dir=vec3(-1.,-localST.t*2.+1.,localST.s*2.-1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else if (texCoord.x*4. < 3.)//right (+x) quad (front was done above)\n            {\n                vec3 dir=vec3(1,-localST.t*2.+1.,-localST.s*2.+1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else //back (+z) quad\n            {\n                vec3 dir=vec3(-localST.s*2.+1.,-localST.t*2.+1.,-1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n        colTex = vec4(vec3(depth),1.);\n    }\n\n    if(type==2.0)\n    {\n       float near = 0.1;\n       float far = 50.;\n       float depth = LinearizeDepth(colTex.r, near, far);\n       colTex.rgb = vec3(depth);\n    }\n\n\n    outColor = mix(col,colTex,colTex.a);\n}\n\n",viztex_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nOUT vec2 texCoord;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\nvoid main()\n{\n    texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);\n    vec4 pos = vec4( vPosition, 1. );\n    mat4 mvMatrix=viewMatrix * modelMatrix;\n    gl_Position = projMatrix * mvMatrix * pos;\n}"};const E=e.inTexture("Texture In"),t=e.outTexture("Texture Out"),x=e.outString("Info");e.setUiAttrib({height:150,resizable:true});E.onChange=()=>{t.set(CGL.Texture.getEmptyTexture(e.patch.cgl));t.set(E.get())};e.renderVizLayer=(n,r)=>{const e=E;const t=5;const i=t+1;const a=CABLES.UI.uiProfiler.start("previewlayer texture");const s=e.parent.patch.cgl;if(!this._emptyCubemap)this._emptyCubemap=CGL.Texture.getEmptyCubemapTexture(s);e.parent.patch.cgl.profileData.profileTexPreviews++;const o=e.get()||CGL.Texture.getEmptyTexture(s);if(!this._mesh){const F=new CGL.Geometry("preview op rect");F.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];F.texCoords=[1,1,0,1,1,0,0,0];F.verticesIndices=[0,1,2,3,1,2];this._mesh=new CGL.Mesh(s,F)}if(!this._shader){this._shader=new CGL.Shader(s,"glpreviewtex");this._shader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);this._shader.setSource(A.viztex_vert,A.viztex_frag);this._shaderTexUniform=new CGL.Uniform(this._shader,"t","tex",t);this._shaderTexCubemapUniform=new CGL.Uniform(this._shader,"tc","cubeMap",i);this._shaderTexUniformW=new CGL.Uniform(this._shader,"f","width",o.width);this._shaderTexUniformH=new CGL.Uniform(this._shader,"f","height",o.height);this._shaderTypeUniform=new CGL.Uniform(this._shader,"f","type",0)}s.pushPMatrix();const l=[o.width,o.height];const u=e.parent.patch.cgl.canvasWidth>l[0]&&e.parent.patch.cgl.canvasHeight>l[1];if(u){mat4.ortho(s.pMatrix,0,e.parent.patch.cgl.canvasWidth,e.parent.patch.cgl.canvasHeight,0,.001,11)}else mat4.ortho(s.pMatrix,-1,1,1,-1,.001,11);const c=s.getTexture(t);const h=s.getTexture(i);let d=0;if(!o)return;if(o.cubemap)d=1;if(o.textureType==CGL.Texture.TYPE_DEPTH)d=2;if(d==0||d==2){s.setTexture(t,o.tex);s.setTexture(i,this._emptyCubemap.cubemap,s.gl.TEXTURE_CUBE_MAP)}else if(d==1){s.setTexture(i,o.cubemap,s.gl.TEXTURE_CUBE_MAP)}this._shaderTypeUniform.setValue(d);let f=[e.parent.patch.cgl.canvasWidth,e.parent.patch.cgl.canvasHeight];s.gl.clearColor(0,0,0,0);s.gl.clear(s.gl.COLOR_BUFFER_BIT|s.gl.DEPTH_BUFFER_BIT);s.pushModelMatrix();if(u){f=l;mat4.translate(s.mMatrix,s.mMatrix,[l[0]/2,l[1]/2,0]);mat4.scale(s.mMatrix,s.mMatrix,[l[0]/2,l[1]/2,0])}this._mesh.render(this._shader);s.popModelMatrix();if(d==0)s.setTexture(t,c);if(d==1)s.setTexture(i,h);s.popPMatrix();s.resetViewPort();const p=[r.width,r.height];const m=false;if(!m){if(o.width>o.height)p[1]=r.width*l[1]/l[0];else{p[1]=r.width*(l[1]/l[0]);if(p[1]>r.height){const C=r.height/p[1];p[0]*=C;p[1]*=C}}}const g=p[0]>l[0]&&p[1]>l[1];n.imageSmoothingEnabled=!u||!g;if(!n.imageSmoothingEnabled){n.fillStyle="#ffffff";n.fillRect(r.x,r.y-10,10,10);n.fillStyle="#000000";n.fillRect(r.x,r.y-10,5,5);n.fillRect(r.x+5,r.y-10+5,5,5)}let v=10*r.width/r.height;let b=r.height/10;let _=r.width/v;for(let t=0;t<v;t++)for(let e=0;e<10;e++){if((t+e)%2==0)n.fillStyle="#333333";else n.fillStyle="#393939";n.fillRect(r.x+_*t,r.y+b*e,_,b)}if(l[1]==1)n.drawImage(s.canvas,0,0,f[0],f[1],r.x,r.y,r.width,r.height*5);if(l[0]==1)n.drawImage(s.canvas,0,0,f[0],f[1],r.x,r.y,r.width*5,r.height);else n.drawImage(s.canvas,0,0,f[0],f[1],r.x+(r.width-p[0])/2,r.y+(r.height-p[1])/2,p[0],p[1]);if(e.get()&&e.get().getInfoOneLine)x.set(e.get().getInfoOneLine());else x.set("unknown");s.gl.clearColor(0,0,0,0);s.gl.clear(s.gl.COLOR_BUFFER_BIT|s.gl.DEPTH_BUFFER_BIT);a.finish()}};Ops.Ui.VizTexture.prototype=new CABLES.Op;CABLES.OPS["4ea2d7b0-ca74-45db-962b-4d1965ac20c0"]={f:Ops.Ui.VizTexture,objName:"Ops.Ui.VizTexture"};Ops.Gl.TextureEffects.WaveformGradient_v3=function(){CABLES.Op.apply(this,arguments);const e=this;const t={waveform_v2_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float uFreq;\nUNI float uOffset;\nUNI float uPow;\nUNI float uRotate;\nUNI float amount;\n\nUNI float r;\nUNI float g;\nUNI float b;\n\n{{CGL.BLENDMODES3}}\n\n#define PI 3.14159265359\n#define TAU (2.0 * PI)\n\nvoid pR(inout vec2 p, float a)\n{\n    float s = sin(a),c=cos(a); p *= mat2(c,s,-s,c);\n}\n\nfloat pModMirror1(inout float p, float size) {\n\tfloat halfsize = size * 0.5;\n\tfloat c = floor((p + halfsize)/size);\n\tp = mod(p + halfsize,size) - halfsize;\n\tp *= mod(c, 2.0) * 2.0 - 1.0;\n\treturn c;\n}\n\nvoid main()\n{\n    vec2 uv = texCoord;\n    float v = 0.0;\n\n    uv -= 0.5;\n    pR(uv,TAU * uRotate);\n    uv += 0.5 + uOffset;\n\n    uv.x *= uFreq;\n\n    #ifdef MODE_SINE\n        uv.x += 0.5;\n        pModMirror1(uv.x,1.0);\n        v = pow(cos(PI * uv.x / 2.0),uPow);\n    #endif\n\n    #ifdef MODE_SAW\n        uv.x = mod(uv.x,1.0);\n        v = pow(min(cos(PI * uv.x /2.0),1.0 - abs(uv.x)),uPow);\n    #endif\n\n    #ifdef MODE_TRI\n        uv.x += 0.5;\n        pModMirror1(uv.x,1.0);\n        uv.x = -abs(uv.x);\n        uv.x = fract(uv.x);\n        v = pow(uv.x,uPow);\n    #endif\n\n    #ifdef MODE_SQR\n        pModMirror1(uv.x,1.0);\n        uv.x = -abs(uv.x);\n        uv.x = fract(uv.x);\n        v = step(uv.x,uPow);\n    #endif\n\n    vec4 col = vec4(vec3(r,g,b),1.0);\n    vec4 base = texture(tex,texCoord);\n\n    outColor = cgl_blendPixel(base,col,v*amount);\n}\n"};const n=e.inTrigger("render"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=CGL.TextureEffect.AddBlendAlphaMask(e),a=e.inValueSlider("Amount",1),s=e.inValueSelect("Mode",["Sine","Sawtooth","Triangle","Square"],"Sine"),o=e.inValue("Frequency",4),l=e.inValue("Pow factor",6),u=e.inValue("Offset",0),c=e.inFloatSlider("Rotate",0),h=e.inValueSlider("r",1),d=e.inValueSlider("g",1),f=e.inValueSlider("b",1),p=e.outTrigger("trigger");e.setPortGroup("Waveform",[s,o,l,u,c]);e.setPortGroup("Color",[h,d,f]);h.setUiAttribs({colorPick:true});const m=e.patch.cgl;const g=new CGL.Shader(m,e.name);g.setSource(g.getDefaultVertexShader(),t.waveform_v2_frag);const v=new CGL.Uniform(g,"t","tex",0),b=new CGL.Uniform(g,"f","uFreq",o),_=new CGL.Uniform(g,"f","uOffset",u),F=new CGL.Uniform(g,"f","uPow",l),C=new CGL.Uniform(g,"f","uRotate",c),A=new CGL.Uniform(g,"f","amount",a),E=new CGL.Uniform(g,"f","r",h),x=new CGL.Uniform(g,"f","g",d),B=new CGL.Uniform(g,"f","b",f);CGL.TextureEffect.setupBlending(e,g,r,a,i);s.onChange=D;D();function D(){g.toggleDefine("MODE_SAW",s.get()=="Sawtooth");g.toggleDefine("MODE_SINE",s.get()=="Sine");g.toggleDefine("MODE_TRI",s.get()=="Triangle");g.toggleDefine("MODE_SQR",s.get()=="Square")}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;m.pushShader(g);m.currentTextureEffect.bind();m.setTexture(0,m.currentTextureEffect.getCurrentSourceTexture().tex);m.currentTextureEffect.finish();m.popShader();p.trigger()}};Ops.Gl.TextureEffects.WaveformGradient_v3.prototype=new CABLES.Op;CABLES.OPS["4821a510-58ed-4557-8ec2-7bc245c5113a"]={f:Ops.Gl.TextureEffects.WaveformGradient_v3,objName:"Ops.Gl.TextureEffects.WaveformGradient_v3"};Ops.Gl.Textures.CopyTexture=function(){CABLES.Op.apply(this,arguments);const e=this;const t={copytexture_frag:"UNI float a;\nUNI sampler2D tex;\n\n#ifdef TEX_MASK\nUNI sampler2D texMask;\n#endif\n\nIN vec2 texCoord;\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n    #ifdef TEX_MASK\n        col.a=texture(texMask,texCoord).r;\n    #endif\n\n\n    #ifdef GREY_R\n        col.rgb=vec3(col.r);\n    #endif\n\n    #ifdef GREY_G\n        col.rgb=vec3(col.g);\n    #endif\n\n    #ifdef GREY_B\n        col.rgb=vec3(col.b);\n    #endif\n\n    #ifdef GREY_A\n        col.rgb=vec3(col.a);\n    #endif\n\n    #ifdef GREY_LUMI\n        col.rgb=vec3( dot(vec3(0.2126,0.7152,0.0722), col.rgb) );\n    #endif\n\n\n    #ifdef INVERT_A\n        col.a=1.0-col.a;\n    #endif\n\n    #ifdef INVERT_R\n        col.r=1.0-col.r;\n    #endif\n\n    #ifdef INVERT_G\n        col.g=1.0-col.g;\n    #endif\n\n    #ifdef INVERT_B\n        col.b=1.0-col.b;\n    #endif\n\n    #ifdef ALPHA_1\n        col.a=1.0;\n    #endif\n\n\n\n\n    outColor= col;\n}"};const n=e.inTriggerButton("render"),r=e.inTexture("Texture"),i=e.inTexture("Alpha Mask"),a=e.inValueBool("use original size",true),s=e.inValueInt("width",640),o=e.inValueInt("height",360),l=e.inSwitch("filter",["nearest","linear","mipmap"],"linear"),u=e.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),c=e.inValueBool("HDR"),h=e.inSwitch("Alpha Mask Source",["A","1"],"A"),d=e.inSwitch("Convert Greyscale",["Off","R","G","B","A","Luminance"],"Off"),f=e.inBool("Invert R",false),p=e.inBool("Invert G",false),m=e.inBool("Invert B",false),g=e.inBool("Invert A",false),v=e.outTrigger("trigger"),b=e.outTexture("texture_out",null),_=e.outValue("Aspect Ratio");h.setUiAttribs({hidePort:true});d.setUiAttribs({hidePort:true});f.setUiAttribs({hidePort:true});p.setUiAttribs({hidePort:true});m.setUiAttribs({hidePort:true});let F=null;const C=e.patch.cgl;let A=null;let E=null;let x=null;let B=true;let D=2,y=2;const O=[0,0,0,0];let I=true;e.setPortGroup("Size",[a,s,o]);const S=new CGL.Shader(C,"copytexture");S.setSource(S.getDefaultVertexShader(),t.copytexture_frag);const T=new CGL.Uniform(S,"t","tex",0);let w=new CGL.Uniform(S,"t","texMask",1);let N=CGL.Texture.FILTER_LINEAR;let L=CGL.Texture.WRAP_CLAMP_TO_EDGE;h.onChange=d.onChange=f.onChange=p.onChange=m.onChange=u.onChange=l.onChange=c.onChange=i.onChange=M;n.onLinkChanged=r.onLinkChanged=r.onChange=()=>{if(!r.get()||r.get()==CGL.Texture.getEmptyTexture(C))b.set(CGL.Texture.getEmptyTexture(C));M()};n.onTriggered=R;V();function k(){if(E)E.delete();if(x){x.delete();x=null}E=new CGL.TextureEffect(C,{isFloatingPointTexture:c.get(),clear:false});if(!x||x.width!=Math.floor(s.get())||x.height!=Math.floor(o.get())||x.wrap!=L||x.isFloatingPoint()!=c.get()){if(x)x.delete();x=new CGL.Texture(C,{name:"copytexture_"+e.id,isFloatingPointTexture:c.get(),filter:N,wrap:L,width:Math.floor(s.get()),height:Math.floor(o.get())})}E.setSourceTexture(x);b.set(null);I=false}function M(){G();if(n.links.length===0){I=true;e.patch.cgl.off(F);F=e.patch.cgl.on("beginFrame",()=>{e.patch.cgl.off(F);if(B)P();if(!E)e.log("has no effect");if(!r.get())e.log("has no intexture");R()})}}function P(){if(!r.get()||r.get()==CGL.Texture.getEmptyTexture(C))return;if(!E)k();if(a.get()){D=r.get().width;y=r.get().height}else{D=Math.floor(s.get());y=Math.floor(o.get())}if((D!=x.width||y!=x.height)&&(D!==0&&y!==0)){o.set(y);s.set(D);x.filter=N;x.setSize(D,y);_.set(D/y);E.setSourceTexture(x)}if(b.get()&&N!=CGL.Texture.FILTER_NEAREST){if(!b.get().isPowerOfTwo())e.setUiError("hintnpot","texture dimensions not power of two! - texture filtering when scaling will not work on ios devices.",0);else e.setUiError("hintnpot",null,0)}else e.setUiError("hintnpot",null,0);B=false}function V(){s.setUiAttribs({greyout:a.get()});o.setUiAttribs({greyout:a.get()})}function U(){B=true;M()}a.onChange=function(){V();if(a.get()){s.onChange=null;o.onChange=null}else{s.onChange=U;o.onChange=U}P()};function R(){if(!r.get()||r.get()==CGL.Texture.getEmptyTexture(C)){A=null;v.trigger();return}else if(!E||I||A!=r.get()){k()}const e=C.getViewPort();O[0]=e[0];O[1]=e[1];O[2]=e[2];O[3]=e[3];P();A=r.get();const t=C.currentTextureEffect;C.currentTextureEffect=E;E.setSourceTexture(x);E.startEffect();C.pushShader(S);C.currentTextureEffect.bind();C.setTexture(0,r.get().tex);if(i.get())C.setTexture(1,i.get().tex);C.pushBlend(false);C.currentTextureEffect.finish();C.popShader();C.popBlend();b.set(E.getCurrentSourceTexture());E.endEffect();C.setViewPort(O[0],O[1],O[2],O[3]);C.currentTextureEffect=t;C.setTexture(0,CGL.Texture.getEmptyTexture(C).tex);v.trigger()}function G(){S.toggleDefine("TEX_MASK",i.get());S.toggleDefine("GREY_R",d.get()==="R");S.toggleDefine("GREY_G",d.get()==="G");S.toggleDefine("GREY_B",d.get()==="B");S.toggleDefine("GREY_A",d.get()==="A");S.toggleDefine("GREY_LUMI",d.get()==="Luminance");S.toggleDefine("ALPHA_1",h.get()==="1");S.toggleDefine("ALPHA_A",h.get()==="A");S.toggleDefine("INVERT_R",f.get());S.toggleDefine("INVERT_G",p.get());S.toggleDefine("INVERT_B",m.get());S.toggleDefine("INVERT_A",g.get());if(u.get()=="repeat")L=CGL.Texture.WRAP_REPEAT;else if(u.get()=="mirrored repeat")L=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(u.get()=="clamp to edge")L=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(l.get()=="nearest")N=CGL.Texture.FILTER_NEAREST;else if(l.get()=="linear")N=CGL.Texture.FILTER_LINEAR;else if(l.get()=="mipmap")N=CGL.Texture.FILTER_MIPMAP;if(S.needsRecompile()){I=true}if(x&&(x.width!=Math.floor(s.get())||x.height!=Math.floor(o.get())||x.wrap!=L||x.isFloatingPoint()!=c.get())){I=true}}};Ops.Gl.Textures.CopyTexture.prototype=new CABLES.Op;CABLES.OPS["18a6d1f4-a7f8-4a3e-ab1d-0c2d2efe3861"]={f:Ops.Gl.Textures.CopyTexture,objName:"Ops.Gl.Textures.CopyTexture"};Ops.Gl.Meshes.Rectangle_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("render"),r=e.outTrigger("trigger"),A=e.inValue("width",1),E=e.inValue("height",1),x=e.inSwitch("pivot x",["left","center","right"]),B=e.inSwitch("pivot y",["top","center","bottom"]),D=e.inValueInt("num columns",1),y=e.inValueInt("num rows",1),O=e.inSwitch("axis",["xy","xz"],"xy"),i=e.inValueBool("Active",true),I=e.outObject("geometry",null,"geometry");I.ignoreValueSerialize=true;const S=e.patch.cgl;O.set("xy");x.set("center");B.set("center");e.setPortGroup("Pivot",[x,B]);e.setPortGroup("Size",[A,E]);e.setPortGroup("Structure",[D,y]);e.toWorkPortsNeedToBeLinked(n);const T=new CGL.Geometry("rectangle");let w=null;let N=false;O.onChange=x.onChange=B.onChange=A.onChange=E.onChange=y.onChange=D.onChange=a;s();function a(){N=true}e.preRender=n.onTriggered=function(){if(!CGL.TextureEffect.checkOpNotInTextureEffect(e))return;if(N)s();if(i.get()&&w)w.render(S.getShader());r.trigger()};function s(){let e=A.get();let t=parseFloat(E.get());let n=0;let r=0;if(typeof e=="string")e=parseFloat(e);if(typeof t=="string")t=parseFloat(t);if(x.get()=="center")n=0;else if(x.get()=="right")n=-e/2;else if(x.get()=="left")n=+e/2;if(B.get()=="center")r=0;else if(B.get()=="top")r=-t/2;else if(B.get()=="bottom")r=+t/2;const i=[];const a=[];const s=[];const o=[];const l=[];const u=[];const c=Math.round(y.get());const h=Math.round(D.get());const d=e/h;const f=t/c;let p,m,g;g=O.get();for(m=0;m<=c;m++){for(p=0;p<=h;p++){i.push(p*d-A.get()/2+n);if(g=="xz")i.push(0);i.push(m*f-E.get()/2+r);if(g=="xy")i.push(0);a.push(p/h);a.push(1-m/c);if(g=="xz"){s.push(0,1,0);o.push(1,0,0);l.push(0,0,1)}else if(g=="xy"){s.push(0,0,1);o.push(-1,0,0);l.push(0,-1,0)}}}for(p=0;p<h;p++){for(m=0;m<c;m++){const v=p+(h+1)*m;const b=v;const _=v+1;const F=v+h+1;const C=v+1+h+1;u.push(b);u.push(F);u.push(_);u.push(_);u.push(F);u.push(C)}}T.clear();T.vertices=i;T.texCoords=a;T.verticesIndices=u;T.vertexNormals=s;T.tangents=o;T.biTangents=l;if(h*c>64e3)T.unIndex();if(!w)w=new CGL.Mesh(S,T);else w.setGeom(T);I.set(null);I.set(T);N=false}e.onDelete=function(){if(w)w.dispose()}};Ops.Gl.Meshes.Rectangle_v2.prototype=new CABLES.Op;CABLES.OPS["fc5718d6-11a5-496e-8f16-1c78b1a2824c"]={f:Ops.Gl.Meshes.Rectangle_v2,objName:"Ops.Gl.Meshes.Rectangle_v2"};Ops.Gl.MeshInstancer_v4=function(){CABLES.Op.apply(this,arguments);const e=this;const t={instancer_body_frag:"#ifdef COLORIZE_INSTANCES\n    #ifdef BLEND_MODE_MULTIPLY\n        col.rgb *= frag_instColor.rgb;\n        col.a *= frag_instColor.a;\n    #endif\n\n    #ifdef BLEND_MODE_ADD\n        col.rgb += frag_instColor.rgb;\n        col.a += frag_instColor.a;\n    #endif\n\n    #ifdef BLEND_MODE_NONE\n        col.rgb = frag_instColor.rgb;\n        col.a = frag_instColor.a;\n    #endif\n#endif\n",instancer_body_vert:"\n\n#ifdef HAS_TEXCOORDS\ntexCoord=(texCoord*instTexCoords.zw)+instTexCoords.xy;\n#endif\n\nmMatrix*=instMat;\npos.xyz*=MOD_scale;\n\n#ifdef HAS_COLORS\nfrag_instColor=instColor;\n#endif\n#ifndef HAS_COLORS\nfrag_instColor=vec4(1.0);\n#endif\n\n",instancer_head_frag:"IN vec4 frag_instColor;\n",instancer_head_vert:"\nIN vec4 instColor;\nIN mat4 instMat;\nIN vec4 instTexCoords;\nOUT mat4 instModelMat;\nOUT vec4 frag_instColor;\n\n#define INSTANCING"};const n=e.inTrigger("exe"),r=e.inObject("geom",null,"geometry"),i=e.inValue("Scale",1),a=e.inValueBool("Limit Instances",false),s=e.inValueInt("Limit",100),u=e.inArray("positions",3),c=e.inArray("Scale Array",3),h=e.inArray("Rotations",3),d=e.inSwitch("Rotation Type",["Euler","Quaternions"],"Euler"),o=e.inSwitch("Material blend mode",["Multiply","Add","Normal"],"Multiply"),f=e.inArray("Colors",4),p=e.inArray("TexCoords",2),l=e.outTrigger("Trigger Out"),m=e.outValue("Num");e.setPortGroup("Limit Number of Instances",[s,a]);e.setPortGroup("Parameters",[c,h,u,d]);e.toWorkPortsNeedToBeLinked(r);e.toWorkPortsNeedToBeLinked(n);r.ignoreValueSerialize=true;const g=e.patch.cgl;const v=mat4.create();let b=new Float32Array(1),_=new Float32Array(1),F=new Float32Array(1),C=null,A=true,E=0,x=true,B=true,D=true;const y=new CGL.ShaderModifier(g,e.name);y.addModule({name:"MODULE_VERTEX_POSITION",title:e.name,priority:-2,srcHeadVert:t.instancer_head_vert,srcBodyVert:t.instancer_body_vert});y.addModule({name:"MODULE_COLOR",priority:-2,title:e.name,srcHeadFrag:t.instancer_head_frag,srcBodyFrag:t.instancer_body_frag});y.addUniformVert("f","MOD_scale",i);let O=true;o.onChange=()=>{O=true};a.onChange=N;n.onTriggered=L;n.onLinkChanged=function(){if(!n.isLinked())T()};N();h.onChange=c.onChange=u.onChange=d.onChange=function(){D=true;A=true};p.onChange=function(){B=true;A=true;O=true};f.onChange=function(){x=true;A=true;O=true};function I(){x=true,D=true;A=true}function S(){y.toggleDefine("COLORIZE_INSTANCES",f.get());y.toggleDefine("TEXCOORDS_INSTANCES",p.get());y.toggleDefine("BLEND_MODE_MULTIPLY",o.get()==="Multiply");y.toggleDefine("BLEND_MODE_ADD",o.get()==="Add");y.toggleDefine("BLEND_MODE_NONE",o.get()==="Normal");O=false}r.onChange=function(){if(C)C.dispose();if(!r.get()){C=null;return}C=new CGL.Mesh(g,r.get());I()};function T(){}function w(){if(!C)return;let e=u.get();if(!e)e=[0,0,0];E=Math.floor(e.length/3);if(O)S();const n=f.get();const r=p.get();const i=c.get();const a=d.get()=="Quaternions";let t=3;if(a)t=4;h.setUiAttribs({stride:t});if(b.length!=E*16)b=new Float32Array(E*16);if(_.length!=E*4){x=true;_=new Float32Array(E*4)}if(F.length!=E*4){B=true;F=new Float32Array(E*4)}const s=h.get();for(let t=0;t<E;t++){mat4.identity(v);mat4.translate(v,v,[e[t*3],e[t*3+1],e[t*3+2]]);if(s){if(a){const o=mat4.create();const l=[s[t*4+0],s[t*4+1],s[t*4+2],s[t*4+3]];quat.normalize(l,l);mat4.fromQuat(o,l);mat4.mul(v,v,o)}else{mat4.rotateX(v,v,s[t*3+0]*CGL.DEG2RAD);mat4.rotateY(v,v,s[t*3+1]*CGL.DEG2RAD);mat4.rotateZ(v,v,s[t*3+2]*CGL.DEG2RAD)}}if(x&&n){_[t*4+0]=n[t*4+0];_[t*4+1]=n[t*4+1];_[t*4+2]=n[t*4+2];_[t*4+3]=n[t*4+3]}if(B&&r){F[t*4+0]=r[t*4+0];F[t*4+1]=r[t*4+1];F[t*4+2]=r[t*4+2];F[t*4+3]=r[t*4+3]}if(i&&i.length>t)mat4.scale(v,v,[i[t*3],i[t*3+1],i[t*3+2]]);else mat4.scale(v,v,[1,1,1]);for(let e=0;e<16;e++)b[t*16+e]=v[e]}C.numInstances=E;if(D)C.addAttribute("instMat",b,16);if(x)C.addAttribute("instColor",_,4,{instanced:true});if(B)C.addAttribute("instTexCoords",F,4,{instanced:true});y.toggleDefine("HAS_TEXCOORDS",r);y.toggleDefine("HAS_COLORS",n);x=false;A=false}function N(){s.setUiAttribs({greyout:!a.get()})}function L(){if(!C)return;if(A)w();y.bind();if(a.get())C.numInstances=Math.min(E,s.get());else C.numInstances=E;m.set(this.name,C.numInstances);if(C.numInstances>0)C.render(g.getShader());l.trigger();y.unbind()}};Ops.Gl.MeshInstancer_v4.prototype=new CABLES.Op;CABLES.OPS["322d8c8d-851b-481d-9bee-ec1cf7d57a35"]={f:Ops.Gl.MeshInstancer_v4,objName:"Ops.Gl.MeshInstancer_v4"};Ops.Gl.Render2Texture=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};const a=i.patch.cgl;const t=i.inTrigger("render"),n=i.inValueBool("use viewport size",true),r=i.inValueInt("texture width",512),s=i.inValueInt("texture height",512),o=i.inBool("Auto Aspect",false),l=i.inSwitch("filter",["nearest","linear","mipmap"],"linear"),u=i.inSwitch("Wrap",["Clamp","Repeat","Mirror"],"Repeat"),c=i.inSwitch("MSAA",["none","2x","4x","8x"],"none"),h=i.outTrigger("trigger"),d=i.outTexture("texture"),f=i.outTexture("textureDepth"),p=i.inValueBool("HDR"),m=i.inValueBool("Depth",true),g=i.inValueBool("Clear",true);let v=null;let b=true;d.set(CGL.Texture.getEmptyTexture(a));i.setPortGroup("Size",[n,r,s,o]);const _=[0,0,0,0];p.setUiAttribs({title:"Pixelformat Float 32bit"});p.onChange=m.onChange=g.onChange=l.onChange=u.onChange=c.onChange=C;n.onChange=F;t.onTriggered=i.preRender=A;F();function F(){r.setUiAttribs({greyout:n.get()});s.setUiAttribs({greyout:n.get()});o.setUiAttribs({greyout:n.get()})}function C(){b=true}function A(){const e=a.getViewPort();_[0]=e[0];_[1]=e[1];_[2]=e[2];_[3]=e[3];if(!v||b){if(v)v.delete();let n=CGL.Texture.WRAP_REPEAT;if(u.get()=="Clamp")n=CGL.Texture.WRAP_CLAMP_TO_EDGE;else if(u.get()=="Mirror")n=CGL.Texture.WRAP_MIRRORED_REPEAT;let r=CGL.Texture.FILTER_NEAREST;if(l.get()=="nearest")r=CGL.Texture.FILTER_NEAREST;else if(l.get()=="linear")r=CGL.Texture.FILTER_LINEAR;else if(l.get()=="mipmap")r=CGL.Texture.FILTER_MIPMAP;if(p.get()&&l.get()=="mipmap")i.setUiError("fpmipmap","Don't use mipmap and HDR at the same time, many systems do not support this.");else i.setUiError("fpmipmap",null);if(a.glVersion>=2){let e=true;let t=4;if(c.get()=="none"){t=0;e=false}if(c.get()=="2x")t=2;if(c.get()=="4x")t=4;if(c.get()=="8x")t=8;v=new CGL.Framebuffer2(a,8,8,{name:"render2texture "+i.id,isFloatingPointTexture:p.get(),multisampling:e,wrap:n,filter:r,depth:m.get(),multisamplingSamples:t,clear:g.get()})}else{v=new CGL.Framebuffer(a,8,8,{isFloatingPointTexture:p.get(),clear:g.get()})}f.set(v.getTextureDepth());b=false}if(n.get()){r.set(a.getViewPort()[2]);s.set(a.getViewPort()[3])}if(v.getWidth()!=Math.ceil(r.get())||v.getHeight()!=Math.ceil(s.get())){v.setSize(Math.max(1,Math.ceil(r.get())),Math.max(1,Math.ceil(s.get())))}v.renderStart(a);if(o.get())mat4.perspective(a.pMatrix,45,r.get()/s.get(),.1,1e3);h.trigger();v.renderEnd(a);a.setViewPort(_[0],_[1],_[2],_[3]);d.set(CGL.Texture.getEmptyTexture(i.patch.cgl));d.set(v.getTextureColor())}};Ops.Gl.Render2Texture.prototype=new CABLES.Op;CABLES.OPS["d01fa820-396c-4cb5-9d78-6b14762852af"]={f:Ops.Gl.Render2Texture,objName:"Ops.Gl.Render2Texture"};Ops.Trigger.TriggerOnce=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTriggerButton("Exec"),r=e.inTriggerButton("Reset"),i=e.outTrigger("Next");var a=e.outValue("Was Triggered");var s=false;e.toWorkPortsNeedToBeLinked(n);r.onTriggered=function(){s=false;a.set(s)};n.onTriggered=function(){if(s)return;s=true;i.trigger();a.set(s)}};Ops.Trigger.TriggerOnce.prototype=new CABLES.Op;CABLES.OPS["cf3544e4-e392-432b-89fd-fcfb5c974388"]={f:Ops.Trigger.TriggerOnce,objName:"Ops.Trigger.TriggerOnce"};Ops.Gl.Shader.BasicMaterial_v3=function(){CABLES.Op.apply(this,arguments);const e=this;const t={basicmaterial_frag:"{{MODULES_HEAD}}\n\nIN vec2 texCoord;\n\n#ifdef VERTEX_COLORS\nIN vec4 vertCol;\n#endif\n\n#ifdef HAS_TEXTURES\n    IN vec2 texCoordOrig;\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D tex;\n    #endif\n    #ifdef HAS_TEXTURE_OPACITY\n        UNI sampler2D texOpacity;\n   #endif\n#endif\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n    vec4 col=color;\n\n\n    #ifdef HAS_TEXTURES\n        vec2 uv=texCoord;\n\n        #ifdef CROP_TEXCOORDS\n            if(uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0) discard;\n        #endif\n\n        #ifdef HAS_TEXTURE_DIFFUSE\n            col=texture(tex,uv);\n\n            #ifdef COLORIZE_TEXTURE\n                col.r*=color.r;\n                col.g*=color.g;\n                col.b*=color.b;\n            #endif\n        #endif\n        col.a*=color.a;\n        #ifdef HAS_TEXTURE_OPACITY\n            #ifdef TRANSFORMALPHATEXCOORDS\n                uv=texCoordOrig;\n            #endif\n            #ifdef ALPHA_MASK_IALPHA\n                col.a*=1.0-texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_ALPHA\n                col.a*=texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_LUMI\n                col.a*=dot(vec3(0.2126,0.7152,0.0722), texture(texOpacity,uv).rgb);\n            #endif\n            #ifdef ALPHA_MASK_R\n                col.a*=texture(texOpacity,uv).r;\n            #endif\n            #ifdef ALPHA_MASK_G\n                col.a*=texture(texOpacity,uv).g;\n            #endif\n            #ifdef ALPHA_MASK_B\n                col.a*=texture(texOpacity,uv).b;\n            #endif\n            // #endif\n        #endif\n    #endif\n\n    {{MODULE_COLOR}}\n\n    #ifdef DISCARDTRANS\n        if(col.a<0.2) discard;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        col*=vertCol;\n    #endif\n\n    outColor = col;\n}\n",basicmaterial_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN float attrVertIndex;\n\n{{MODULES_HEAD}}\n\nOUT vec3 norm;\nOUT vec2 texCoord;\nOUT vec2 texCoordOrig;\n\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\n#ifdef HAS_TEXTURES\n    UNI float diffuseRepeatX;\n    UNI float diffuseRepeatY;\n    UNI float texOffsetX;\n    UNI float texOffsetY;\n#endif\n\n#ifdef VERTEX_COLORS\n    in vec4 attrVertColor;\n    out vec4 vertCol;\n\n#endif\n\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    mat4 mvMatrix;\n\n    norm=attrVertNormal;\n    texCoordOrig=attrTexCoord;\n    texCoord=attrTexCoord;\n    #ifdef HAS_TEXTURES\n        texCoord.x=texCoord.x*diffuseRepeatX+texOffsetX;\n        texCoord.y=(1.0-texCoord.y)*diffuseRepeatY+texOffsetY;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        vertCol=attrVertColor;\n    #endif\n\n    vec4 pos = vec4(vPosition, 1.0);\n\n    #ifdef BILLBOARD\n       vec3 position=vPosition;\n       mvMatrix=viewMatrix*modelMatrix;\n\n       gl_Position = projMatrix * mvMatrix * vec4((\n           position.x * vec3(\n               mvMatrix[0][0],\n               mvMatrix[1][0],\n               mvMatrix[2][0] ) +\n           position.y * vec3(\n               mvMatrix[0][1],\n               mvMatrix[1][1],\n               mvMatrix[2][1]) ), 1.0);\n    #endif\n\n    {{MODULE_VERTEX_POSITION}}\n\n    #ifndef BILLBOARD\n        mvMatrix=viewMatrix * mMatrix;\n    #endif\n\n\n    #ifndef BILLBOARD\n        // gl_Position = projMatrix * viewMatrix * modelMatrix * pos;\n        gl_Position = projMatrix * mvMatrix * pos;\n    #endif\n}\n"};const n=e.inTrigger("render");const r=e.outTrigger("trigger");const i=e.outObject("shader",null,"shader");i.ignoreValueSerialize=true;e.toWorkPortsNeedToBeLinked(n);const a=e.patch.cgl;const s=new CGL.Shader(a,"basicmaterialnew");s.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);s.setSource(t.basicmaterial_vert,t.basicmaterial_frag);i.set(s);n.onTriggered=y;const o=e.inValueSlider("r",Math.random());const l=e.inValueSlider("g",Math.random());const u=e.inValueSlider("b",Math.random());const c=e.inValueSlider("a",1);o.setUiAttribs({colorPick:true});const h=s.addUniformFrag("4f","color",o,l,u,c);s.uniformColorDiffuse=h;const d=e.inTexture("texture");let f=null;d.onChange=I;const p=e.inValueBool("colorizeTexture",false);const m=e.inValueBool("Vertex Colors",false);const g=e.inTexture("textureOpacity");let v=null;const b=e.inSwitch("Alpha Mask Source",["Luminance","R","G","B","A","1-A"],"Luminance");b.setUiAttribs({greyout:true});g.onChange=O;const _=e.inValueBool("Opacity TexCoords Transform",false);const F=e.inValueBool("Discard Transparent Pixels");const C=e.inValue("diffuseRepeatX",1),A=e.inValue("diffuseRepeatY",1),E=e.inValue("Tex Offset X",0),x=e.inValue("Tex Offset Y",0),B=e.inBool("Crop TexCoords",false);s.addUniformFrag("f","diffuseRepeatX",C);s.addUniformFrag("f","diffuseRepeatY",A);s.addUniformFrag("f","texOffsetX",E);s.addUniformFrag("f","texOffsetY",x);const D=e.inValueBool("billboard",false);b.onChange=D.onChange=F.onChange=_.onChange=B.onChange=m.onChange=p.onChange=S;e.setPortGroup("Color",[o,l,u,c]);e.setPortGroup("Color Texture",[d,m,p]);e.setPortGroup("Opacity",[g,b,F,_]);e.setPortGroup("Texture Transform",[C,A,E,x,B]);O();I();e.preRender=function(){s.bind();y()};function y(){if(!s)return;a.pushShader(s);s.popTextures();if(f&&d.get())s.pushTexture(f,d.get());if(v&&g.get())s.pushTexture(v,g.get());r.trigger();a.popShader()}function O(){if(g.get()){if(v!==null)return;s.removeUniform("texOpacity");s.define("HAS_TEXTURE_OPACITY");if(!v)v=new CGL.Uniform(s,"t","texOpacity");b.setUiAttribs({greyout:false});_.setUiAttribs({greyout:false})}else{s.removeUniform("texOpacity");s.removeDefine("HAS_TEXTURE_OPACITY");v=null;b.setUiAttribs({greyout:true});_.setUiAttribs({greyout:true})}S()}function I(){if(d.get()){if(!s.hasDefine("HAS_TEXTURE_DIFFUSE"))s.define("HAS_TEXTURE_DIFFUSE");if(!f)f=new CGL.Uniform(s,"t","texDiffuse");C.setUiAttribs({greyout:false});A.setUiAttribs({greyout:false});E.setUiAttribs({greyout:false});x.setUiAttribs({greyout:false});p.setUiAttribs({greyout:false})}else{s.removeUniform("texDiffuse");s.removeDefine("HAS_TEXTURE_DIFFUSE");f=null;C.setUiAttribs({greyout:true});A.setUiAttribs({greyout:true});E.setUiAttribs({greyout:true});x.setUiAttribs({greyout:true});p.setUiAttribs({greyout:true})}}function S(){s.toggleDefine("VERTEX_COLORS",m.get());s.toggleDefine("CROP_TEXCOORDS",B.get());s.toggleDefine("COLORIZE_TEXTURE",p.get());s.toggleDefine("TRANSFORMALPHATEXCOORDS",_.get());s.toggleDefine("DISCARDTRANS",F.get());s.toggleDefine("BILLBOARD",D.get());s.toggleDefine("ALPHA_MASK_ALPHA",b.get()=="A");s.toggleDefine("ALPHA_MASK_IALPHA",b.get()=="1-A");s.toggleDefine("ALPHA_MASK_LUMI",b.get()=="Luminance");s.toggleDefine("ALPHA_MASK_R",b.get()=="R");s.toggleDefine("ALPHA_MASK_G",b.get()=="G");s.toggleDefine("ALPHA_MASK_B",b.get()=="B")}};Ops.Gl.Shader.BasicMaterial_v3.prototype=new CABLES.Op;CABLES.OPS["ec55d252-3843-41b1-b731-0482dbd9e72b"]={f:Ops.Gl.Shader.BasicMaterial_v3,objName:"Ops.Gl.Shader.BasicMaterial_v3"};Ops.Array.RandomNumbersArray3_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const a=e.inValueInt("numValues",100),s=e.inValueFloat("Min",-1),o=e.inValueFloat("Max",1),l=e.inValueFloat("random seed"),u=e.inValueBool("Last == First"),c=e.inValueBool("Integer",false),h=e.outArray("values",null,3),d=e.outNumber("Total points"),f=e.outNumber("Array length");e.setPortGroup("Value Range",[s,o]);e.setPortGroup("",[l,u]);h.ignoreValueSerialize=true;u.onChange=o.onChange=s.onChange=a.onChange=l.onChange=c.onChange=n;const p=[];n();function n(){Math.randomSeed=l.get();const t=c.get();const n=p.length=Math.max(0,Math.floor(Math.abs((a.get()||0)*3)));if(n===0){h.set(null);d.set(0);f.set(0);return}const r=s.get();const i=o.get();for(let e=0;e<n;e+=3){if(!t){p[e+0]=Math.seededRandom()*(i-r)+r;p[e+1]=Math.seededRandom()*(i-r)+r;p[e+2]=Math.seededRandom()*(i-r)+r}else{p[e+0]=Math.floor(Math.seededRandom()*(i-r+1)+r);p[e+1]=Math.floor(Math.seededRandom()*(i-r+1)+r);p[e+2]=Math.floor(Math.seededRandom()*(i-r+1)+r)}}if(u.get()&&n>3){p[n-3+0]=p[0];p[n-3+1]=p[1];p[n-3+2]=p[2]}h.set(null);h.set(p);d.set(n/3);f.set(n)}};Ops.Array.RandomNumbersArray3_v2.prototype=new CABLES.Op;CABLES.OPS["45b2113a-1ca0-41d8-8d90-db3e394b669c"]={f:Ops.Array.RandomNumbersArray3_v2,objName:"Ops.Array.RandomNumbersArray3_v2"};Ops.Array.RandomArrays=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const c=t.inValueInt("Num Values",100);const h=t.inSwitch("Mode",["A","AB","ABC","ABCD"],"A");const d=t.inValueFloat("Random Seed ",0);const f=t.inBool("Integer",false);const p=t.outArray("Array Out");const n=["A","B","C","D"];const m=n.map(function(e){return{min:t.inValueFloat("Min "+e,-1),max:t.inValueFloat("Max "+e,1)}});for(let e=0;e<m.length;e+=1){const i=m[e];const a=Object.keys(i);t.setPortGroup("Value Range "+n[e],a.map(function(e){return i[e]}));if(e>0)a.forEach(function(e){i[e].setUiAttribs({greyout:true})})}h.onChange=function(){const e=h.get();const t=h.uiAttribs.values;p.setUiAttribs({stride:h.get().length});const i=t.indexOf(e);m.forEach(function(n,r){const e=Object.keys(n);e.forEach(function(e,t){if(r<=i)n[e].setUiAttribs({greyout:false});else n[e].setUiAttribs({greyout:true})})});r()};const g=t.outNumber("Chunks Amount");const v=t.outNumber("Array length");p.ignoreValueSerialize=true;c.onChange=d.onChange=f.onChange=r;const b=[];r();function r(){const n=[];const e=h.get();const t=h.uiAttribs.values;const r=t.indexOf(e);Math.randomSeed=d.get();const i=r+1;const a=Math.floor(Math.abs(c.get()*i));n.length=a;const s=a/i;const o=f.get();for(let t=0;t<i;t+=1){const e=m[t];const l=e.max.get();const u=e.min.get();b[t]=[u,l]}for(let t=0;t<s;t+=1){for(let e=0;e<i;e+=1){const u=b[e][0];const l=b[e][1];const r=t*i+e;if(o)n[r]=Math.floor(Math.seededRandom()*(l+1-u)+u);else n[r]=Math.seededRandom()*(l-u)+u}}p.set(null);p.set(n);g.set(n.length/i);v.set(n.length)}m.forEach(function(n){Object.keys(n).forEach(function(e){const t=n[e];t.onChange=r})})};Ops.Array.RandomArrays.prototype=new CABLES.Op;CABLES.OPS["8a9fa2c6-c229-49a9-9dc8-247001539217"]={f:Ops.Array.RandomArrays,objName:"Ops.Array.RandomArrays"};Ops.Gl.TextureEffects.EdgeDetection_v4=function(){CABLES.Op.apply(this,arguments);const e=this;const t={edgedetect_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float width;\nUNI float strength;\nUNI float texWidth;\nUNI float texHeight;\nUNI float mulColor;\n\nconst vec4 lumcoeff = vec4(0.299,0.587,0.114, 0.);\n\nvec3 desaturate(vec3 color)\n{\n    return vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n}\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n    // vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n    // float pixelX=0.27/texWidth;\n    // float pixelY=0.27/texHeight;\n    float pixelX=(width+0.01)*4.0/texWidth;\n    float pixelY=(width+0.01)*4.0/texHeight;\n\nvec2 tc=texCoord;\n// #ifdef OFFSETPIXEL\n    tc.x+=1.0/texWidth*0.5;\n    tc.y+=1.0/texHeight*0.5;\n// #endif\n    // col=texture(tex,texCoord);\n\n    float count=1.0;\n    vec4 base=texture(tex,texCoord);\n\n\tvec4 horizEdge = vec4( 0.0 );\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y - pixelY ) ) * 1.0;\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y     ) ) * 2.0;\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y + pixelY ) ) * 1.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y - pixelY ) ) * 1.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y     ) ) * 2.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y + pixelY ) ) * 1.0;\n\tvec4 vertEdge = vec4( 0.0 );\n\tvertEdge -= texture( tex, vec2( tc.x - pixelX, tc.y - pixelY ) ) * 1.0;\n\tvertEdge -= texture( tex, vec2( tc.x    , tc.y - pixelY ) ) * 2.0;\n\tvertEdge -= texture( tex, vec2( tc.x + pixelX, tc.y - pixelY ) ) * 1.0;\n\tvertEdge += texture( tex, vec2( tc.x - pixelX, tc.y + pixelY ) ) * 1.0;\n\tvertEdge += texture( tex, vec2( tc.x    , tc.y + pixelY ) ) * 2.0;\n\tvertEdge += texture( tex, vec2( tc.x + pixelX, tc.y + pixelY ) ) * 1.0;\n\n\thorizEdge*=base.a;\n\tvertEdge*=base.a;\n\n\n\tvec3 edge = sqrt((horizEdge.rgb/count * horizEdge.rgb/count) + (vertEdge.rgb/count * vertEdge.rgb/count));\n\n    edge=desaturate(edge);\n    edge*=strength;\n\n    if(mulColor>0.0) edge*=texture( tex, texCoord ).rgb*mulColor*4.0;\n    edge=max(min(edge,1.0),0.0);\n\n    //blend section\n    vec4 col=vec4(edge,base.a);\n\n    outColor=cgl_blendPixel(base,col,amount*base.a);\n}\n\n"};const n=e.inTrigger("Render"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=e.inValueSlider("Amount",1),a=e.inFloat("Strength",4),s=e.inValueSlider("Width",.1),o=e.inValueSlider("Mul Color",0),l=e.outTrigger("Trigger");const u=e.patch.cgl;const c=new CGL.Shader(u,e.name);c.setSource(c.getDefaultVertexShader(),t.edgedetect_frag);const h=new CGL.Uniform(c,"t","tex",0),d=new CGL.Uniform(c,"f","amount",i),f=new CGL.Uniform(c,"f","strength",a),p=new CGL.Uniform(c,"f","width",s),m=new CGL.Uniform(c,"f","texWidth",128),g=new CGL.Uniform(c,"f","texHeight",128),v=new CGL.Uniform(c,"f","mulColor",o);CGL.TextureEffect.setupBlending(e,c,r,i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;u.pushShader(c);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);m.setValue(u.currentTextureEffect.getCurrentSourceTexture().width);g.setValue(u.currentTextureEffect.getCurrentSourceTexture().height);u.currentTextureEffect.finish();u.popShader();l.trigger()}};Ops.Gl.TextureEffects.EdgeDetection_v4.prototype=new CABLES.Op;CABLES.OPS["0240e26e-b86d-43b2-8c72-6795bb86dc76"]={f:Ops.Gl.TextureEffects.EdgeDetection_v4,objName:"Ops.Gl.TextureEffects.EdgeDetection_v4"};Ops.Color.ColorPalettes=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inValueInt("Index",0);const r=t.outTexture("Texture");const a=t.inValueBool("Smooth");const s=t.outArray("Color Array");let o=document.createElement("canvas");o.id="canvas_"+CABLES.generateUUID();o.width=5;o.height=8;o.style.display="none";let i=document.getElementsByTagName("body")[0];i.appendChild(o);let l=o.getContext("2d");n.onChange=a.onChange=m;let u=[];u.length=5*3;let c=null;m();function h(e){return parseInt(p(e).substring(0,2),16)}function d(e){return parseInt(p(e).substring(2,4),16)}function f(e){return parseInt(p(e).substring(4,6),16)}function p(e){return e.charAt(0)=="#"?e.substring(1,7):e}function m(){t.patch.cgl.addNextFrameOnceCallback(g)}function g(){let i=Math.round(n.get())*5;if(i>=v.length-5)i=0;if(i<0)i=0;if(i!=i)i=0;for(let r=0;r<5;r++){let e=h(v[i+r]);let t=d(v[i+r]);let n=f(v[i+r]);u[r*3+0]=e/255;u[r*3+1]=t/255;u[r*3+2]=n/255;l.fillStyle="rgb("+e+","+t+","+n+")";l.fillRect(o.width/5*r,0,o.width/5,o.height)}let e=CGL.Texture.FILTER_NEAREST;if(a.get())e=CGL.Texture.FILTER_LINEAR;if(c==e&&r.get())r.get().initTexture(o,e);else r.set(new CGL.Texture.createFromImage(t.patch.cgl,o,{filter:e}));s.set(null);s.set(u);r.get().unpackAlpha=false;c=e}t.onDelete=function(){o.remove()};const v=["#E6E2AF","#A7A37E","#EFECCA","#046380","002F2F","#468966","#FFF0A5","#FFB03B","#B64926","8E2800","#FCFFF5","#D1DBBD","#91AA9D","#3E606F","193441","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#105B63","#FFFAD5","#FFD34E","#DB9E36","BD4932","#225378","#1695A3","#ACF0F2","#F3FFE2","EB7F00","#2C3E50","#E74C3C","#ECF0F1","#3498DB","2980B9","#000000","#263248","#7E8AA2","#FFFFFF","FF9800","#004358","#1F8A70","#BEDB39","#FFE11A","FD7400","#DC3522","#D9CB9E","#374140","#2A2C2B","1E1E20","#7D8A2E","#C9D787","#FFFFFF","#FFC0A9","FF8598","#B9121B","#4C1B1B","#F6E497","#FCFAE1","BD8D46","#2E0927","#D90000","#FF2D00","#FF8C00","04756F","#595241","#B8AE9C","#FFFFFF","#ACCFCC","8A0917","#10222B","#95AB63","#BDD684","#E2F0D6","F6FFE0","#F6F792","#333745","#77C4D3","#DAEDE2","EA2E49","#703030","#2F343B","#7E827A","#E3CDA4","C77966","#2F2933","#01A2A6","#29D9C2","#BDF271","FFFFA6","#D8CAA8","#5C832F","#284907","#382513","363942","#FFF8E3","#CCCC9F","#33332D","#9FB4CC","DB4105","#85DB18","#CDE855","#F5F6D4","#A7C520","493F0B","#04BFBF","#CAFCD8","#F7E967","#A9CF54","588F27","#292929","#5B7876","#8F9E8B","#F2E6B6","412A22","#332532","#644D52","#F77A52","#FF974F","A49A87","#405952","#9C9B7A","#FFD393","#FF974F","F54F29","#2B3A42","#3F5765","#BDD4DE","#EFEFEF","FF530D","#962D3E","#343642","#979C9C","#F2EBC7","348899","#96CA2D","#B5E655","#EDF7F2","#4BB5C1","7FC6BC","#1C1D21","#31353D","#445878","#92CDCF","EEEFF7","#3E454C","#2185C5","#7ECEFD","#FFF6E5","FF7F66","#00585F","#009393","#FFFCC4","#F0EDBB","FF3800","#B4AF91","#787746","#40411E","#32331D","C03000","#63A69F","#F2E1AC","#F2836B","#F2594B","CD2C24","#88A825","#35203B","#911146","#CF4A30","ED8C2B","#F2385A","#F5A503","#E9F1DF","#4AD9D9","36B1BF","#CFC291","#FFF6C5","#A1E8D9","#FF712C","695D46","#FF5335","#B39C85","#306E73","#3B424D","1D181F","#000000","#333333","#FF358B","#01B0F0","AEEE00","#E8E595","#D0A825","#40627C","#26393D","FFFAE4","#E7E8D1","#D3CEAA","#FBF7E4","#424242","8E001C","#354242","#ACEBAE","#FFFF9D","#C9DE55","7D9100","#2F2933","#01A2A6","#29D9C2","#BDF271","FFFFA6","#DDDCC5","#958976","#611427","#1D2326","6A6A61","#6C6E58","#3E423A","#417378","#A4CFBE","F4F7D9","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#6B0C22","#D9042B","#F4CB89","#588C8C","011C26","#304269","#91BED4","#D9E8F5","#FFFFFF","F26101","#96CEB4","#FFEEAD","#FF6F69","#FFCC5C","AAD8B0","#B0CC99","#677E52","#B7CA79","#F6E8B1","89725B","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#16193B","#35478C","#4E7AC7","#7FB2F0","ADD5F7","#00261C","#044D29","#168039","#45BF55","96ED89","#36362C","#5D917D","#A8AD80","#E6D4A7","825534","#F9E4AD","#E6B098","#CC4452","#723147","31152B","#2C3E50","#FC4349","#D7DADB","#6DBCDB","FFFFFF","#002635","#013440","#AB1A25","#D97925","EFE7BE","#FF8000","#FFD933","#CCCC52","#8FB359","192B33","#272F32","#9DBDC6","#FFFFFF","#FF3D2E","DAEAEF","#B8ECD7","#083643","#B1E001","#CEF09D","476C5E","#002F32","#42826C","#A5C77F","#FFC861","C84663","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#5A1F00","#D1570D","#FDE792","#477725","A9CC66","#5E0042","#2C2233","#005869","#00856A","8DB500","#52656B","#FF3B77","#CDFF00","#FFFFFF","B8B89F","#801637","#047878","#FFB733","#F57336","C22121","#730046","#BFBB11","#FFC200","#E88801","C93C00","#24221F","#363F45","#4B5F6D","#5E7C88","FEB41C","#E64661","#FFA644","#998A2F","#2C594F","002D40","#C24704","#D9CC3C","#FFEB79","#A0E0A9","00ADA7","#484A47","#C1CE96","#ECEBF0","#687D77","353129","#588C7E","#F2E394","#F2AE72","#D96459","8C4646","#BAB293","#A39770","#EFE4BD","#A32500","2B2922","#6A7059","#FDEEA7","#9BCC93","#1A9481","003D5C","#174C4F","#207178","#FF9666","#FFE184","F5E9BE","#D5FBFF","#9FBCBF","#647678","#2F3738","59D8E6","#DB5800","#FF9000","#F0C600","#8EA106","59631E","#450003","#5C0002","#94090D","#D40D12","FF1D23","#211426","#413659","#656F8C","#9BBFAB","F2EFDF","#EA6045","#F8CA4D","#F5E5C0","#3F5666","2F3440","#F2F2F2","#C6E070","#91C46C","#287D7D","1C344D","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#705B35","#C7B07B","#E8D9AC","#FFF6D9","570026","#F7F2B2","#ADCF4F","#84815B","#4A1A2C","8E3557","#1A1F2B","#30395C","#4A6491","#85A5CC","D0E4F2","#25064D","#36175E","#553285","#7B52AB","9768D1","#004056","#2C858D","#74CEB7","#C9FFD5","FFFFCB","#CFCA4C","#FCF5BF","#9FE5C2","#5EB299","745A33","#776045","#A8C545","#DFD3B6","#FFFFFF","0092B2","#CC3910","#F1F2C0","#CCC59E","#8FA68E","332F29","#FF6600","#C13B00","#5E6D70","#424E4F","1B1D1E","#690011","#BF0426","#CC2738","#F2D99C","E5B96F","#1B1D26","#425955","#778C7A","#F1F2D8","BFBD9F","#F6B1C3","#F0788C","#DE264C","#BC0D35","A20D1E","#597533","#332F28","#61B594","#E6DEA5","C44E18","#3FB8AF","#7FC7AF","#DAD8A7","#FF9E9D","FF3D7F","#0F2D40","#194759","#296B73","#3E8C84","D8F2F0","#42282F","#74A588","#D6CCAD","#DC9C76","D6655A","#002A4A","#17607D","#FFF1CE","#FF9311","D64700","#003056","#04518C","#00A1D9","#47D9BF","F2D03B","#13140F","#D4FF00","#E4FFE6","#68776C","00D6DD","#FCFAD0","#A1A194","#5B605F","#464646","A90641","#289976","#67CC8E","#B1FF91","#FFE877","FF5600","#302B1D","#3F522B","#737D26","#A99E46","D9CB84","#56626B","#6C9380","#C0CA55","#F07C6C","AD5472","#32450C","#717400","#DC8505","#EC5519","BE2805","#C7B773","#E3DB9A","#F5FCD0","#B1C2B3","778691","#E83A25","#FFE9A3","#98CC96","#004563","191B28","#3399CC","#67B8DE","#91C9E8","#B4DCED","E8F8FF","#1A212C","#1D7872","#71B095","#DEDBA7","D13F32","#7D2A35","#CC9258","#917A56","#B4BA6C","FEFFC2","#E7E9D1","#D3D4AA","#FCFAE6","#444444","901808","#FFFFFF","#AEAEAE","#E64C66","#2D3E50","1BBC9B","#E0FFB3","#61C791","#31797D","#2A2F36","F23C55","#EB5937","#1C1919","#403D3C","#456F74","D3CBBD","#E6DD00","#8CB302","#008C74","#004C66","332B40","#14A697","#F2C12E","#F29D35","#F27649","F25252","#261822","#40152A","#731630","#CC1E2C","FF5434","#261F27","#FEE169","#CDD452","#F9722E","C9313D","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#2F3837","#C5C7B6","#FFF8D3","#4C493E","222028","#E3CBAC","#9C9985","#C46D3B","#788880","324654","#3F0B1B","#7A1631","#CF423C","#FC7D49","FFD462","#14212B","#293845","#4F6373","#8F8164","D9D7AC","#98A89E","#BAC0AC","#FAFAC6","#FF4411","D40015","#FEFFFF","#3C3F36","#9FB03E","#EBE9DC","72918B","#CC6B32","#FFAB48","#FFE7AD","#A7C9AE","888A63","#262526","#404040","#8C8979","#F2F2F2","F60A20","#00305A","#004B8D","#0074D9","#4192D9","7ABAF2","#0C273D","#54D0ED","#FFFEF1","#70B85D","2C5E2E","#4C1B33","#EFE672","#98A942","#2D6960","141D14","#2F3540","#666A73","#F2EDE4","#D9D1C7","8C8681","#0D1F30","#3B6670","#8BADA3","#F0E3C0","DB6C0F","#FFBC67","#DA727E","#AC6C82","#685C79","455C7B","#092140","#024959","#F2C777","#F24738","BF2A2A","#133463","#365FB7","#799AE0","#F4EFDC","BA9B65","#C4D4CB","#55665E","#30282A","#542733","E84167","#CDDEC6","#4DAAAB","#1E4F6A","#2A423C","93A189","#EF5411","#FA5B0F","#FF6517","#FF6D1F","FF822E","#41434A","#6E9489","#DEDCC3","#F2F1E9","877963","#292929","#2BBFBD","#F2B33D","#F29B30","F22E2E","#F2385A","#F5A503","#E9F1DF","#56D9CD","3AA1BF","#D5F8B4","#A6E3A8","#8A9A85","#7E566B","422335","#3CBAC8","#93EDD4","#F3F5C4","#F9CB8F","F19181","#979926","#38CCB5","#EEFF8E","#FFD767","CC2A09","#404040","#024959","#037E8C","#F2EFDC","F24C27","#94B34D","#D3FF82","#363D52","#121D2B","111B1C","#282E33","#25373A","#164852","#495E67","FF3838","#313732","#8AA8B0","#DEDEDE","#FFFFFF","F26101","#FFFFFF","#E5E1D1","#52616D","#2C343B","C44741","#FFF6B8","#ABCCA7","#403529","#7A5E2F","A68236","#4F1025","#C5003E","#D9FF5B","#78AA00","15362D","#49404F","#596166","#D1FFCD","#A9BD8B","948A54","#FF2151","#FF7729","#FFAD29","#FFEBCA","1AB58A","#73603D","#BF8A49","#F2CA80","#5E5A59","0D0D0D","#3D4C53","#70B7BA","#F1433F","#E7E1D4","FFFFFF","#006D8D","#008A6E","#549E39","#8AB833","C0CF3A","#BDDFB3","#2BAA9C","#2F2E2E","#0F2625","465F3F","#F2F2F2","#BF0404","#8C0303","#590202","400101","#76A19A","#272123","#A68D60","#B0C5BB","D9593D","#0E3D59","#88A61B","#F29F05","#F25C05","D92525","#C1E1ED","#76C7C6","#273D3B","#131A19","E35C14","#2D112C","#530031","#820233","#CA293E","EF4339","#AF7575","#EFD8A1","#BCD693","#AFD7DB","3D9CA8","#D74B4B","#DCDDD8","#475F77","#354B5E","FFFFFF","#FFF6C9","#C8E8C7","#A4DEAB","#85CC9F","499E8D","#229396","#8BA88F","#C7C5A7","#F0DFD0","F23C3C","#57385C","#A75265","#EC7263","#FEBE7E","FFEDBC","#96526B","#D17869","#EBAD60","#F5CF66","8BAB8D","#0D1C33","#17373C","#2B6832","#4F9300","A1D700","#1B2B32","#37646F","#A3ABAF","#E1E7E8","B22E2F","#C5D9B2","#53A194","#572C2C","#3D2324","695A3B","#425957","#81AC8B","#F2E5A2","#F89883","D96666","#002E40","#2A5769","#FFFFFF","#FABD4A","FA9600","#FFFEFC","#E2E3DF","#515B5E","#2E3233","CAF200","#FFF0A3","#B8CC6E","#4B6000","#E4F8FF","004460","#3B596A","#427676","#3F9A82","#A1CD73","ECDB60","#F2E6CE","#8AB39F","#606362","#593325","1D1D1F","#212B40","#C2E078","#FFFFFF","#BADCDD","547B97","#0B3C4D","#0E5066","#136480","#127899","1A8BB3","#222130","#464D57","#D4E8D3","#FFFCFB","ED8917","#B33600","#FF8A00","#FFC887","#CC5400","B31E00","#012530","#28544B","#ACBD86","#FFD6A0","FF302C","#2E95A3","#50B8B4","#C6FFFA","#E2FFA8","D6E055","#112F41","#068587","#4FB99F","#F2B134","ED553B","#202B30","#4E7178","#4FA9B8","#74C0CF","F1F7E2","#302B2F","#696153","#FFA600","#9BB58F","FFD596","#458C6B","#F2D8A7","#D9A86C","#D94436","A62424","#22475E","#75B08A","#F0E797","#FF9D84","FF5460","#FFAA5C","#DA727E","#AC6C82","#685C79","455C7B","#686E75","#9BAAC1","#82787B","#E4F1DB","AAC19B","#F0C755","#E2AD3B","#BF5C00","#901811","5C110F","#FFFBDC","#BFBCA5","#7F7D6E","#3F3E37","E5E2C6","#BEBEBE","#F1E4D8","#594735","#94C7BA","D8F1E4","#1B1E26","#F2EFBD","#B6D051","#70A99A","2F6D7A","#F7E4A2","#A7BD5B","#DC574E","#8DC7B8","ED9355","#70E8CB","#FFE9C7","#FF5B5B","#545454","2D2D2F","#17111A","#321433","#660C47","#B33467","CCBB51","#2B2E2E","#595855","#A2ABA5","#CAE6E8","313F54","#023B47","#295E52","#F2E085","#FCAB55","EE7F38","#302C29","#D1D1BC","#A7C4BB","#6C8C84","466964","#212629","#067778","#49B8A8","#85EDB6","D9E5CD","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#35262D","#FFFBFF","#E8ECED","#A4B7BB","76A0B0","#61E8D2","#FCEEB9","#302F25","#704623","BBE687","#E1E6B9","#C4D7A4","#ABC8A4","#375D3B","183128","#C98B2F","#803C27","#C56520","#E1B41B","807916","#A3D9B0","#93BF9E","#F2F0D5","#8C8474","40362E","#524656","#CF4747","#EA7A58","#E4DCCB","A6C4BC","#5C2849","#A73E5C","#EC4863","#FFDA66","1FCECB","#0EEAFF","#15A9FA","#1B76FF","#1C3FFD","2C1DFF","#010000","#393845","#9B96A3","#5C0009","940315","#468071","#FFE87A","#FFCA53","#FF893B","E62738","#404040","#024959","#037E8C","#F2EFDC","F24C27","#FF765E","#C2AE8B","#FCCF65","#FFE5C6","B7BDC4","#003647","#00717D","#F2D8A7","#A4A66A","515932","#FAFAC0","#C4BE90","#8C644C","#594D37","293033","#2B3A42","#3F5765","#BDD4DE","#EFEFEF","E74C3C","#3B3B3B","#A8877E","#FFA49D","#FF7474","FF476C","#0A3A4A","#196674","#33A6B2","#9AC836","D0E64B","#FFA340","#38001C","#571133","#017A74","00C2BA","#DCEBDD","#A0D5D6","#789AA1","#304345","AD9A27","#588C7E","#F2E394","#F2AE72","#D96459","8C4646","#F0E6B1","#B5D6AA","#99A37A","#70584B","3D3536","#2F400D","#8CBF26","#A8CA65","#E8E5B0","419184","#010712","#13171F","#1C1F26","#24262D","961227","#403F33","#6E755F","#AFC2AA","#FFDEA1","E64C10","#C74029","#FAE8CD","#128085","#385052","F0AD44","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#E0401C","#E6B051","#272F30","#F7EDB7","9E2B20","#FFE2C5","#FFEEDD","#FFDDAA","#FFC484","FFDD99","#FFFFE4","#F2E5BD","#B9BF8E","#A69F7C","8C6865","#5C8A2D","#AFD687","#FFFFFF","#00C3A9","008798","#4F3130","#FF1F3D","#5BE3E3","#FDFFF1","8B9698","#D23600","#D95100","#DE6D00","#EE8900","FCA600","#FFFFFA","#A1A194","#5B605F","#464646","FF6600","#F34A53","#FAE3B4","#AAC789","#437356","1E4147","#2A7A8C","#176273","#063540","#E6D9CF","403D3A","#21455B","#567D8C","#A59E8C","#8C8372","F2F2F2","#012340","#026873","#83A603","#BBBF45","F2F0CE","#FDFF98","#A7DB9E","#211426","#6B073B","DA8C25","#002F36","#142426","#D1B748","#EDDB43","FFFD84","#420000","#600000","#790000","#931111","BF1616","#3C989E","#5DB5A4","#F4CDA5","#F57A82","ED5276","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#F5ECD9","#2BACB5","#B4CCB9","#E84D5B","3B3B3B","#A5EB3C","#60C21E","#159E31","#53DB50","C5FFCB","#263138","#406155","#7C9C71","#DBC297","FF5755","#0A111F","#263248","#7E8AA2","#E3E3E3","C73226","#003B59","#00996D","#A5D900","#F2E926","FF930E","#00A19A","#04BF9D","#F2E85C","#F53D54","404040","#324152","#47535E","#796466","#C1836A","DEA677","#036F73","#84CDC2","#FEF2D8","#F18C79","EF504F","#174040","#888C65","#D9CA9C","#D98162","A65858","#56797F","#87A0A4","#FCFBDC","#F2DDB6","A6937C","#A8BAA9","#FFF5CF","#DBCDAD","#B39C7D","806854","#60655F","#AB9675","#FFE0C9","#D4CCBA","CF8442","#BDDFB3","#009D57","#2C372E","#0F2925","465F3F","#3E3947","#735360","#D68684","#F1B0B0","EBD0C4","#0A7B83","#2AA876","#FFD265","#F19C65","CE4D45","#FFFFFF","#F4921E","#858585","#C5D2DB","3E6B85","#11151E","#212426","#727564","#B9AA81","690C07","#000000","#910000","#CBB370","#FFFBF1","21786C","#F78F00","#C43911","#75003C","#37154A","0F2459","#003354","#91BED4","#D9E8F5","#FFFFFF","F26101","#3DA8A4","#7ACCBE","#FFFFF7","#FF99A1","FF5879","#64C733","#F0F0F0","#3E879E","#57524D","36302B","#343844","#2AB69D","#E65848","#FDC536","FCF2D7","#E34517","#F5FF53","#B4E85E","#00BD72","0B4239","#A84B3A","#FF9F67","#233138","#FFF7F5","4C646B","#59535E","#FAEEFF","#F1BAF3","#5D4970","372049","#FF6F22","#D9984F","#FFE8A9","#3E4237","32948A","#5D7370","#7FA6A1","#B8D9B8","#D6EDBD","FFF5BC","#FFBE00","#FFDC00","#FFD10F","#FFDE20","E8CA00","#003840","#005A5B","#007369","#008C72","02A676","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#BA2F1D","#FFF8A4","#F5E67F","#264A59","1E2C30","#222526","#FFBB6E","#F28D00","#D94F00","80203B","#EBD096","#D1B882","#5D8A66","#1A6566","21445B","#F00807","#5F6273","#A4ABBF","#CCC9D1","E2E1E9","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#152737","#2B4E69","#799AA5","#FFFFF0","682321","#C44C51","#FFB6B8","#FFEFB6","#A2B5BF","5F8CA3","#5ADED4","#4DAAAB","#26596A","#163342","6C98A1","#FF5B2B","#B1221C","#34393E","#8CC6D7","FFDA8C","#3D4D4D","#99992E","#E6E666","#F2FFBF","800033","#242424","#437346","#97D95C","#D9FF77","E9EB9B","#FFEBB0","#FFB05A","#F84322","#C33A1A","9F3818","#4D2B2F","#E57152","#E8DE67","#FFEFC3","C0CCAB","#A82221","#DB5E31","#EDA23E","#F2CB67","BFB840","#3B3140","#BFB8A3","#F2E0C9","#F2B9AC","D97E7E","#43464D","#9197A6","#D3DCF2","#7690CF","48577D","#EFDFBB","#9EBEA6","#335D6A","#D64F2A","7A8A7F","#000001","#313634","#C7CECF","#5C0402","941515","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#F5F4E1","#D6C9B5","#B4AA97","#D44917","82877A","#19162B","#1C425C","#6ABDC4","#F0E4C5","D6C28F","#00132B","#7F9DB0","#C5E2ED","#FFFFFF","F95900","#1F3642","#6D968D","#B6CCB8","#FFE2B3","56493F","#08A689","#82BF56","#C7D93D","#E9F2A0","F2F2F2","#DE3961","#A4E670","#FFFFDC","#B3EECC","00ADA7","#849972","#D9D094","#A6A23E","#4F2F1D","8F5145","#F41C54","#FF9F00","#FBD506","#A8BF12","00AAB5","#00585F","#009393","#F5F3DC","#454445","FF5828","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#140B04","#332312","#B59D75","#E3D2B4","FFF7EA","#ED3B3B","#171F26","#77B59C","#F2E7B1","635656","#46594B","#A6977C","#D9B384","#734F30","260B01","#CCB8A3","#FF8FB1","#FFF5EA","#4E382F","B29882","#B70000","#FFFFFF","#FFCA3D","#94C4F4","0092B3","#053B44","#06736C","#A53539","#B9543C","EAD075","#E8C1B9","#FFB3AB","#FFCAB8","#E8B69C","FFCEAB","#E7F2DF","#69043B","#59023B","#231E2D","161726","#E82B1E","#E5DEAF","#A0B688","#557A66","453625","#F1E6D4","#BA3D49","#791F33","#9F9694","E3E1DC","#CED59F","#F1EDC0","#B1BEA4","#647168","282828","#2C3E50","#E74C3C","#ECF0F1","#3498DB","646464","#DE7047","#FFDE8D","#FFFFFF","#CDDE47","528540","#8EAB99","#40232B","#D95829","#D97338","DEC085","#E9662C","#EBAF3C","#00AC65","#068894","2B2B2B","#46483C","#A0AA8F","#EBE3CB","#FFFFFF","F26101","#170F0E","#290418","#505217","#FFD372","FFF1AF","#263545","#C4273C","#D7DADB","#6DBCDB","FFFFFF","#DCFAC0","#B1E1AE","#85C79C","#56AE8B","00968B","#075807","#097609","#70AF1A","#B9D40B","E5EB0B","#521000","#712800","#744E1D","#879666","F1D98C","#261F26","#3F3B40","#6C7367","#BFBF8A","F2E086","#2C3E50","#FC4349","#D7DADB","#6DBCDB","FFFFFF","#506D7D","#94CCB9","#FFECA7","#FFB170","F07D65","#3F4036","#8DA681","#F2E1C2","#BF2806","8C1D04","#990700","#CC542E","#FF964F","#FFCB7C","787730","#195073","#7F8C1F","#EE913F","#F2E5BD","9FD7C7","#1B3E59","#F2F0F0","#FFAC00","#BF0404","730202","#EA6045","#F8CA4D","#F5E5C0","#3F5666","2F3440","#F95759","#FDA099","#FFFFFF","#D9F3CB","8AC2B0","#265573","#386D73","#81A68A","#9FBF8F","D4D9B0","#E1DA36","#FFEA1B","#6FE4DA","#1DB0BC","007BBC","#013859","#185E65","#F9CC7F","#F15C25","9E1617","#36CC7C","#D6FFBE","#94D794","#228765","77A668","#94201F","#D4421F","#478A80","#D9E061","F08835","#F16233","#00B5B5","#F0F0F0","#3E4651","5C6D7E","#2E806C","#76CC99","#E0FFED","#FF5F3A","D2413C","#00393B","#00766C","#44A18E","#E5EDB6","F6695B","#734854","#F2F2E9","#D9D7C5","#A69580","736766","#03497E","#0596D5","#9DEBFC","#8D7754","FEB228","#F0E14C","#FFBB20","#FA7B12","#E85305","59CC0D","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#00557C","#186D94","#3488AD","#81C1DC","BBE5F3","#DEE8D7","#918773","#420A1A","#240001","4D493A","#FFFFFF","#CAC535","#97AF25","#158471","41342C","#041F3D","#0B2E41","#165751","#448C61","9AC16D","#FA8C01","#FF6405","#577700","#082400","A0A600","#78C0F9","#FFDDCE","#FFFFFF","#FFDBE6","FE86A4","#351330","#CC2A41","#E7CAA4","#759A8A","524549","#02151A","#043A47","#087891","#C8C8C8","B31D14","#F34A53","#FAE3B4","#AAC789","#437356","1E4147","#58838C","#DAD7C7","#BF996B","#BF5841","A61C1C","#556354","#E68F0D","#8C948A","#495450","42423F","#323640","#5B6470","#8C94A1","#BDC7D6","DFE2FF","#FF0000","#FF950B","#2FA88C","#DEEB00","4B2C04","#0F3D48","#174C5B","#366774","#ECECE7","E96151","#3DBB7E","#A3CD39","#FBAC1D","#F96C1E","EE4036","#23363B","#A44F3F","#F8983D","#8D9151","BBC946","#4B5657","#969481","#D2C9B0","#F4E3C1","B6B835","#E8980C","#B1F543","#F2FF00","#FF5E00","59BBAB","#849696","#FEFFFB","#232D33","#17384D","FF972C","#555555","#7BB38E","#F4F1D7","#F8AB65","F15C4C","#1D3C42","#67BFAD","#F2EC99","#F2C48D","F25050","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#B8E1F2","#249AA7","#ABD25E","#F8C830","F1594A","#FDEDD0","#BCF1ED","#FF634D","#FD795B","FFF0AA","#FFFFFF","#E5E1D1","#52616D","#2C343B","C44741","#FFFFF1","#D5FF9B","#8FB87F","#5A7B6C","374E5A","#010340","#0E1E8C","#0003C7","#1510F0","1441F7","#002A4A","#17607D","#FFF1CE","#FF9311","E33200","#871E31","#CCC097","#9E9D7B","#687061","262626","#F16663","#F48D6C","#F2E07B","#8ABE9B","4A6D8B","#001F11","#204709","#0C8558","#FFD96A","FF4533","#1D1626","#F2E0BD","#BFAA8F","#8C786C","594C4C","#685D47","#913420","#1E2729","#C1D9C5","FEEFB1","#1D7561","#FC8448","#FF4138","#A8282B","38141B","#BF0633","#FF484E","#FF9273","#D1D0B4","E5ECED","#8E9E63","#E6DBB0","#F5EED7","#C4BCA0","176573","#665446","#809994","#AECCB6","#DEF2C4","E6683F","#3D0D26","#660A3E","#891C56","#B0276F","C93482","#082136","#00294D","#004B8D","#0068C4","2998FF","#3C4631","#9A746F","#F8A2AB","#F1C6B3","EAE9C0","#FF534E","#FFD7AC","#BED194","#499989","176785","#006D80","#BDA44D","#3C2000","#84CECC","78A419","#352C2B","#3C555C","#9E9657","#FFEBCD","CD5510","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#523631","#D1BE91","#605E3A","#4D462F","592F39","#18293B","#5B5A56","#F2DEA0","#D0B580","FFFBFF","#C8DBB6","#ECEBB7","#CCC68A","#B8B165","827A5D ","#7DA88C","#EBE9A0","#BED24B","#859132","35323C","#E8574C","#F27B29","#E6A51B","#D9CC3C","399977","#324032","#B7C22C","#FFFFE1","#22A8B5","2A3F42","#B3A589","#FFB896","#FFF9B1","#9AB385","11929E","#272433","#343F4F","#3D6066","#77994D","B2D249","#250701","#6D4320","#B0925F","#E7DEC0","82ABB8","#023550","#028A9E","#04BFBF","#EFEFEF","FF530D","#594732","#40342A","#7A422E","#D4CA9A","EDE5AE","#013C4D","#BA5B22","#DB913C","#F0B650","FAD46B","#143840","#5C6B63","#A69E89","#E0C297","D96523","#3FB8AF","#7FC7AF","#DAD8A7","#FFB38B","FF3F34","#CA3995","#F58220","#FFDF05","#BED73D","61BC46","#FFE1D0","#FFBFB4","#FF837E","#FF4242","BF1616","#C4EEFF","#7BA32D","#094201","#A41717","C48726","#001325","#187072","#90BD90","#D7D8A2","F2E4C2","#1A4F63","#068587","#6FB07F","#FCB03C","FC5B3F","#97B350","#333230","#736D61","#BAAB90","FFE5BA","#403D33","#807966","#CCC2A3","#8C0000","590000","#5F8A42","#86AD59","#F6FAA1","#F28410","D66011","#BF355D","#ED8168","#FAB66A","#F2DC86","83BFA1","#E1F03E","#FFBA14","#DB3A0F","#A1003D","630024","#212226","#45433F","#687067","#BDBB99","F0EAC3","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#293B47","#5F7A87","#FFFFFF","#CBFF48","00ADA9","#282A33","#697371","#FFE7A6","#F5BA52","FA8000","#0C304A","#2B79A1","#F3F4F1","#85A71E","BFD841","#008B83","#4DAE83","#A0AE79","#FFE499","FF665E","#5D7359","#E0D697","#D6AA5C","#8C5430","661C0E","#324452","#97BDBF","#F2DFBB","#F28705","BF3604","#EEEFB9","#6ACFAE","#369C93","#232928","B03831","#332F45","#015770","#2A8782","#9FD6AE","FFFED2","#2B2830","#5C504F","#ABAB8E","#D9D7A3","C7BE88","#DC941B","#EDC266","#B6952C","#E1D3A6","E9A119","#00305A","#00448D","#0074D9","#4192D9","7ABAF2","#344459","#485F73","#5DA6A6","#A9D9CB","F2EAD0","#060719","#4D1B2F","#9E332E","#EB6528","FC9D1C","#96CEB4","#FFEEAD","#FF6F69","#FFCC5C","AAD8B0","#05F2F2","#04BFBF","#EEF1D9","#A60201","7E100E","#E6F1F5","#636769","#AAB3B6","#6E7476","4B4E50","#DA0734","#F1A20D","#4AABB1","#FCF3E7","3F1833","#202D44","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#CC3B37","#398899","#FFFCE8","#FF857F","CCC1A3","#5DBEA9","#EFEDDF","#EF7247","#4E3F35","D1CBBA","#FFC62D","#E49400","#DD5200","#EFE38A","91B166","#B67D14","#F2921F","#F0B23E","#A62409","441208","#C71B1B","#D6BA8A","#017467","#E08F23","0B0D0C","#474143","#A69E9D","#E7E2DA","#FFFFFF","E7E8E7","#435772","#2DA4A8","#FEAA3A","#FD6041","CF2257","#6DD19D","#99E89D","#D0E8A1","#FFF9C0","D40049","#FAF1D5","#DEC9AC","#CCA18B","#11282D","A5C4BB","#000000","#141414","#1C1919","#1A1716","24201F","#D5D8DD","#5CA2BE","#135487","#2A4353","989DA4","#73161E","#BF0F30","#BFB093","#037F8C","0A2140","#195962","#F56F6C","#FFFFFF","#252932","191C21","#F8EFB6","#FEBAC5","#6CD1EA","#FACFD7","C2EAE9","#91D6BC","#768C6A","#755F31","#B37215","FFBA4B","#F2E6BB","#DD4225","#202724","#63BD99","F8FDD8","#762B1B","#807227","#CCBF7A","#FFEF98","60B0A1","#707864","#C1D74E","#F5FF7C","#DFE6B4","A6B89C","#FFF3D2","#97B48F","#E87657","#FF9B6F","E8D495","#33262E","#733230","#CC5539","#E6D27F","86A677","#122430","#273E45","#FFFCE2","#EBD2B5","E63531","#30394F","#FF434C","#6ACEEB","#EDE8DF","FFFBED","#0A3A4A","#196A73","#32A6A6","#A1BF36","C8D94A","#FFF7CC","#CCC28F","#70995C","#33664D","142933","#43464D","#9197A6","#D3DCF2","#7690CF","48577D","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#B52841","#FFC051","#FF8939","#E85F4D","590051","#473C35","#A36D5C","#9C968B","#D9CEAD","8A866A","#DB4C39","#2D3638","#109489","#44D487","D0DB86","#6F8787","#AEC2AE","#E6DFAE","#B0B57B","888F51","#C8385A","#FFCF48","#ECEABE","#1FCECB","1CA9C9","#42282E","#75A48B","#D9CFB0","#DC9B74","D6665A","#362F2D","#4C4C4C","#94B73E","#B5C0AF","FAFDF2","#98293A","#B14A58","#C86C6B","#DE9D76","EFC77F","#C1D301","#76AB01","#0E6A00","#083500","042200","#453F22","#7A6B26","#CCAD5C","#A1191F","4E1716","#541E32","#8E3557","#88A33E","#C2BD86","F7F2B2","#2B1B2E","#54344D","#FFFFD6","#B89E95","6E444F","#6EC1A5","#9FBEA6","#F5D3A3","#FF9F88","FB7878","#2F252C","#D3CCB2","#99AD93","#6E6751","5C3122","#BE333F","#F2E9CE","#C8C5B1","#939F88","307360","#F0F1F2","#232625","#647362","#B3D929","D2D9B8","#FA2B31","#FFBF1F","#FFF146","#ABE319","00C481","#09455C","#527E7C","#F5FFCC","#E0EB6E","C4D224","#F2DA91","#F2B950","#F29D35","#D96704","BF4904","#A2CFA5","#E0E7AB","#F5974E","#E96B56","D24344","#150033","#310D42","#5C2445","#AB6946","FFCE4C","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#FF2468","#E0D4B1","#FFFFE3","#00A5A6","005B63","#65A683","#218777","#3F585F","#47384D","F53357","#000623","#28475C","#4A6C74","#8BA693","F0E3C0","#E65322","#D19552","#B8BF73","#B6DB83","FFF991","#112F41","#068587","#6FB07F","#FCB03C","FC5B3F","#C89B41","#A16B2B","#77312B","#1C2331","152C52","#C24366","#D9C099","#FFF8D8","#A8E0BA","00ADA7","#CC0000","#006600","#FFFFEC","#9C9178","6C644F","#3D0319","#720435","#C1140E","#FC5008","32241B","#CFC7A4","#5A9E94","#005275","#002344","A38650","#FFEBC3","#CC3A00","#FF3600","#FF851B","800C00","#EFC164","#F3835D","#F35955","#286275","00434C","#E9F29D","#B7C29D","#878E8F","#67617A","51456B","#445859","#03A696","#49C4BE","#F1F2E4","FF7746","#FA726C","#FFD794","#BAD174","#3BA686","5F6F8C","#4D2B1F","#635D61","#7992A2","#97BFD5","BFDCF5","#CC4D00","#E6CF73","#668059","#264D4D","00CCB3","#4385F5","#DC4437","#FCBE1F","#109D59","FFFFFF","#271F2E","#A4A680","#F2EBC9","#D9B166","A66B38","#0B2C3C","#FF6666","#DADFE1","#FFFFFF","444444","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#302B26","#A6B827","#EDE9DD","#98D3D4","594E7A","#4B0505","#720707","#BFB694","#004659","00292B","#B52C38","#EBD1B0","#536682","#D9964B","DE6846","#F2F1DF","#F2B705","#F2C84B","#BF820F","734002","#26140C","#3D2216","#784E3D","#AB8574","D6BCB1","#26221D","#8C2C0F","#E6E5B8","#BFB38D","402D1F","#1F8181","#F2BC79","#F28972","#BF1B39","730240","#002635","#013440","#AB1A25","#D97925","EFE7BE","#8EC447","#FFFFFF","#96D3D4","#636466","2D2D2E","#2D1E1E","#4B3C37","#96A576","#CDE196","FFFFBE","#F06060","#FA987D","#F7F2CB","#72CCA7","10A296","#1D8281","#44BF87","#FBD258","#F29A3F","DB634F","#DEDE91","#EF9950","#F34E52","#C91452","492449","#6D8EAD","#1F3447","#1A0B07","#362416","CFCDB4","#00CD73","#008148","#2D9668","#3ECD8E","004E2C","#3D8080","#628282","#858383","#A38282","C28080","#475159","#839795","#B2BDB7","#CCC9C0","F2F2F2","#0E6870","#C6B599","#C65453","#FFDDB4","EDAA7D","#CEF0B7","#A8DBA8","#79BD9A","#3B8686","0B486B","#292C44","#FF5349","#F0F0F1","#18CDCA","4F80E1","#272A2B","#383737","#473B39","#692B28","940500","#D6C274","#DB9E46","#25706B","#3D2423","AB362E","#FFA68F","#FF4867","#FFF9C8","#B5EBB9","18B29D","#A1A16A","#727D59","#366353","#133C40","03212E","#D45354","#A9DC3A","#2FCAD8","#818B85","CDCDC1","#F14B6A","#3D3C3E","#22BDAF","#BAD7D4","F4F4F4","#FFE2C5","#FFEEDD","#FFDDAA","#FFC484","FFDD99","#9FFF4A","#1ABF93","#087363","#004040","2F1933","#FFDB97","#B28F4E","#FFFDFB","#466CB2","97BBFF","#991C00","#E09A25","#FFFCDB","#008B83","262B30","#44281A","#00ACAE","#F5EFD5","#F37606","EE4717","#FF5952","#FCEEC9","#96D6D9","#4FAAC9","176075","#5C4B51","#8CBEB2","#F2EBBF","#A5C88F","EF847B","#105F73","#F7F3B2","#C6CC33","#F28322","CC5404","#137072","#56B292","#B7F5AB","#FBFFC0","BF223D","#E3F23E","#6C821C","#A6A53F","#E0E0AC","33302E","#00215E","#003CAA","#1967F7","#5E4000","AA7400","#273A3D","#54695C","#AD9970","#FFBF87","FF8F60","#FFAA00","#C2B93E","#808F5D","#576157","302F30","#BE1405","#F2DCAC","#AABEAA","#736E41","413C2D","#6B1229","#C76A61","#FAB99A","#F7D9B5","CCB1A7","#2D9993","#58B3A3","#83BFA3","#B0D9A8","FFFCB6","#334D5C","#45B29D","#EFC94C","#E27A3F","DF5A49","#F30B55","#010326","#012840","#54717F","F2E6CE","#2A3411","#73662C","#BC9847","#FFDFB2","6B0031","#637D74","#403D3A","#8C3B3B","#AB6937","D4A960","#010A26","#011640","#B6D6F2","#FFFFFF","E83338","#924847","#EB986C","#E4C678","#9C7885","372C2C","#022440","#3F95AA","#4EC6DE","#EAE2DF","F7572F","#2B1D2E","#323657","#076473","#54B087","D6F567","#052229","#004043","#BCC373","#E3FF55","D0D90C","#4C514A","#907A62","#879796","#755854","B09880","#1D2939","#1CAF9A","#FFFFFF","#EE4F4B","D1DC48","#004B67","#41CCB4","#FFEA95","#FF7C5D","C70151","#C0272D","#FCFBE7","#9FD3DA","#008C9A","05484F","#213130","#FF5E3D","#C9C83E","#FDFFF1","559398","#B1E4FC","#366D78","#39D5F1","#FFFFFF","D9FF03","#DECE6C","#FCF9B6","#BFE3B5","#5D826E","262E2B","#520A17","#668F91","#F5E6AC","#AB8E5B","52301C","#2D3032","#DD5F18","#FBA922","#F7F7F7","404333","#0C2538","#2B434F","#638270","#BCC98E","EDE059","#E85066","#F28E76","#E6CEB0","#5A8C81","382837","#BF2633","#A6242F","#D9CEAD","#C0B18F","011C26","#002A4A","#17607D","#FFF1CE","#FF9311","E33200","#0A8B91","#485956","#C4B98F","#FFF9BC","EEDF2E","#B89A7B","#9BBAAC","#F2D649","#D95D50","DBDBDB","#BD7938","#8D4421","#643001","#532700","3A1C00","#E1E6FA","#C4D7ED","#ABC8E2","#375D81","183152","#2E4259","#F7483B","#ECF0F1","#03C8FA","737373","#364656","#5D6B74","#94A4A5","#F2F5E9","FF8C31","#3E5916","#93A605","#F28705","#F25C05","E5EFFA","#248077","#74AD8D","#C82754","#F7BB21","F9E2B7","#20736A","#8BD9CA","#B1D95B","#93A651","403E34","#D74B4B","#DCDDD8","#475F77","#354B5E","FFFFFF","#252F33","#415C4F","#869C80","#93C2CC","CEEAEE","#012840","#79C7D9","#9BF2EA","#497358","9DBF8E","#EE7E94","#F8B4C4","#C7CAC9","#D8505C","41424","#282828","#505050","#FFFFFF","#2DCEDB","F20000","#004358","#1F8A70","#BEDB39","#FF5347","FD7400","#470C3B","#802F56","#C0576F","#E38679","FFBD83","#573328","#B05A3A","#FF8548","#29332E","0F1B1C","#461F2D","#E1FFBB","#BAD47F","#849C23","52533F","#333A40","#4C5E5E","#ADD0E5","#CDE4FF","729EBF","#DE5605","#F7A035","#B1DEB5","#EFECCA","65ABA6","#76D6D2","#F9E270","#EF6F56","#F4EED8","596B56","#403E3F","#F2F2F2","#D9D9D9","#9DAABB","8C8C8C","#059E9A","#F4F2ED","#F5A243","#DB3E3B","585857","#FFBF41","#EE8943","#C02221","#FFF4D3","249CA9","#024E76","#39A6B2","#FCE138","#F5B824","F08106","#FF0067","#FF3D6A","#E7FF04","#9CFF00","56FF00","#003540","#0D3F40","#487360","#8FA671","F2D795","#FF493C","#FFFFFF","#B3ECEF","#31C4F5","ADEB41","#244358","#4A8B87","#7CBCAE","#F0D4AF","C5252B","#EA5930","#F8AF1E","#F5E5C0","#097380","372560","#A1DBB2","#FEE5AD","#FACA66","#F7A541","F45D4C","#2C4A47","#6C9A7F","#BB523D","#C89D11","81810B","#F0F1F2","#232625","#647362","#FF5629","D2D9B8","#7C9B5F","#B8D197","#E3FFF3","#9BDEC7","568F84","#E54E45","#DBC390","#F2F2EF","#13A3A5","403833","#77A7FB","#E57368","#FBCB43","#34B67A","FFFFFF","#001A2E","#8F0000","#FFFFFF","#8A874B","41594F","#312F40","#49A69C","#EFEAC5","#E89063","BF5656","#047C8C","#018B8D","#F3BF81","#F49B78","F1706D","#00303E","#7096AD","#C1D1DE","#FFF9EF","EC4911","#2D6891","#70A0BF","#F5EEDC","#DC4C1A","F0986C","#040002","#3D1309","#E8B96A","#BC5D15","5C0F00","#8B929C","#5E6070","#514454","#3B313D","FF2479","#142D58","#447F6E","#E1B65B","#C8782A","9E3E17","#22104D","#2D1E5E","#483A85","#7067AB","A49CFA","#919C86","#9E373E","#2B2E36","#D1B993","C45A3B","#332F45","#015770","#2A8782","#9FD6AE","FFFED2","#37C78F","#FEE293","#FF4D38","#CC2249","380C2A","#47282C","#8C8468","#C9B37F","#DBDAB7","C4C49C","#14191A","#2D2B21","#A69055","#CCB287","FFB88C","#F5E3CD","#696158","#B6A898","#877D71","504A43","#005151","#009393","#F56200","#454445","969692","#D95F47","#FFF2C1","#80A894","#106153","072C36","#9E352C","#E6E8A9","#93C28C","#2E5A5C","2B2623","#03013A","#334A94","#6B9EDF","#83C3F2","99E6FF","#372A26","#4D4D4D","#6DA0A7","#9ED5A8","C7F5FF","#03658C","#022E40","#F2B705","#F28705","F25C05","#FF3B16","#E87826","#E8BA4A","#80A272","003045","#00748E","#E3DFBB","#F4BA4D","#E3753C","DA3B3A","#25401E","#56732C","#84A63C","#B8D943","EAF2AC","#449BB5","#043D5D","#EB5055","#68C39F","FFFCF5","#108F97","#FF8B6B","#FFE39F","#16866D","103636","#1A4F63","#068F86","#6FD57F","#FCB03C","FC5B3F","#381C19","#472E29","#948658","#F0E99A","362E29","#D7E8F7","#BBD0E3","#9CB7CF","#6A8BAB","375D81","#0F1C28","#136972","#67BFA7","#F3CF5B","F07444","#FFFFFF","#4EA9A0","#969514","#FE9C03","FCDE8E","#2F2D30","#656566","#65537A","#51386E","2A2333","#4C2916","#F05A28","#FBAF3F","#38B449","FFFFFF","#132537","#006C80","#EBCAB8","#FE8315","FA3113","#ECEEE1","#A8DACF","#F05B4F","#D8403A","221E1F","#00305A","#004B8C","#0074D9","#4192D9","7ABAF2","#72CF3F","#85FF00","#23E000","#2FB81B","00FF1C","#45CEEF","#FFF5A5","#FFD4DA","#99D2E4","D8CAB4","#FF5B00","#A1716C","#728296","#439AAB","00CABD","#EB6C2D","#D9C8A2","#939C80","#496158","232F38","#D94214","#FFF2C1","#80A894","#52736B","093844","#4D1B2F","#9E332E","#EB6528","#FC9D1C","FFCA50","#FFEEB0","#9AE8A4","#C7C12D","#F76245","ED1C43","#FFFAED","#D4DBFF","#879AC9","#242942","FF8800","#022840","#013440","#517360","#9DA67C","F2DC99","#331A0F","#519994","#BA4B3C","#EEDDAA","789F63","#577867","#EDCE82","#D68644","#AB3229","662845","#435A66","#88A6AF","#F5F2EB","#D9CDB8","424342","#FF8840","#958D4F","#737B55","#595540","513E38","#9D805A","#EBC99D","#FFE6C5","#9DCEEA","4B809E","#272D40","#364659","#55736D","#9DBF8E","D0D991","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#98C000","#3D4C53","#EA2E49","#FFE11A","0CDBE8","#A20E30","#E93C4F","#DCDCD4","#ADBCC3","2D4255","#1C2640","#263357","#384C80","#4E6AB3","5979CD","#D94214","#FFF2C1","#80A894","#52736B","093844","#3B596A","#427676","#3F9A82","#A1CD73","ECDB60","#1E1E1F","#424143","#67666A","#807F83","CBC9CF","#E04946","#3BA686","#B6D15D","#FFD495","FA847E","#FFEBB0","#FFB05A","#F84322","#C33A1A","9F3818","#FFA136","#FF814A","#E6635A","#785D6B","534557","#CDCF91","#EBEACC","#D6D5B8","#6D7D80","41545E","#011526","#011C40","#4E8DA6","#F2EA79","F2B33D","#353230","#3F4E51","#7B8F70","#99B2BE","F6F4EA","#063559","#0D8C7F","#8FBF4D","#F2D13E","D95929","#158000","#199900","#20BF00","#24D900","29FF00","#0B0D0E","#137074","#7EB7A3","#F1DDBB","EC6766","#02151A","#043A47","#087891","#C8C8C8","B31D14","#59361F","#5C992E","#A3CC52","#E6E673","FF5933","#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","83AF9B","#4B1E18","#F9E5C2","#BBB082","#829993","4F5D4E","#032843","#1F595B","#508C6D","#71A670","A6DB89","#191724","#4C4547","#8C594E","#D18952","FDB157","#191919","#182828","#60702D","#AAB232","E6FA87","#212A3F","#434F5B","#F2F2F2","#8AB839","2E2E2E","#004158","#026675","#038B8B","#F1EEC9","F09979","#023059","#3F7EA6","#F2F2F2","#D99E32","BF5E0A","#F21E52","#FFFFFF","#3D3B42","#0C6F73","63CFD4","#452743","#E7635E","#F8E9A8","#89E0AD","00928C","#FAAD63","#D1714D","#785E48","#39403B","3D1C24","#4C0016","#FFF7EB","#DCCEA7","#A17345","104F53","#BF2431","#F24150","#2A4557","#3B848C","EFF2E4","#3B3013","#8F6031","#E88833","#9C0C0A","FDF3C1","#1E2422","#88BEB1","#FF006D","#DAFFFF","718A94","#F1F4F7","#AF9F7B","#775E43","#40413C","251C17","#00182E","#0C6BA1","#D4D6D4","#FFFDEB","FF7500","#FFAB4A","#CCBAAB","#1E2129","#3D5E6E","47A3A3","#66B3A7","#C0D4B6","#EEF0BD","#F0563D","2C2F3B","#332525","#907465","#EDC5B5","#878C6D","63674A","#F04C16","#DBDBD0","#EDBD1F","#4CB09C","313B4A","#2B211D","#611C26","#C5003E","#8EB7A8","F1E4B7","#1A1F2B","#30395C","#4A6491","#85A5CC","D0E4F2","#03497E","#0596D5","#9DEBFC","#999999","FE4B28","#2F4159","#465E73","#88A649","#F2ECE4","D98841","#323A46","#22282F","#EB4A33","#FFFFFF","E9F0F5","#2C3E50","#FC4349","#6DBCDB","#D7DADB","FFFFFF","#F29727","#E05723","#B0382F","#982E4B","713045","#4D584A","#465943","#428552","#3E754E","4C694B","#47191C","#59574B","#829690","#B5B09A","E1E3CB","#1D5123","#B1C661","#FFDA68","#FE9257","F64448","#59323C","#260126","#F2EEB3","#BFAF80","8C6954","#4E0805","#9E0522","#FFF4D4","#B8C591","447622","#424862","#FB9A63","#BFC4D5","#F6FBF4","FEBC98","#FF2468","#E0D4B1","#FFFFE3","#00A5A6","005B63","#1C2F40","#4C6173","#8094A6","#D9D1BA","F2E9D8","#DFD7B7","#EB7707","#5C5445","#3B2323","9CBFC7","#262E3B","#9C8878","#CFCAAA","#FBF8FF","992435","#FFBC67","#DA727E","#AC6C82","#685C79","455C7B","#404A69","#516C8A","#8AC0DE","#FFFFFF","FFAC00","#485B61","#4B8C74","#74C476","#A4E66D","CFFC83","#A31180","#C42795","#DE52B4","#EA88CE","FFBFE5","#E64D2E","#FFF5F1","#7893AD","#576B9C","2D2A52","#BF0436","#8C0327","#590219","#F2CBA1","8C674C","#CF5B6F","#FFF8C8","#CAD9B1","#8FB3A0","648991","#341D44","#744D90","#BB8CDD","#3E4417","88904D","#00293E","#003D4E","#006269","#00918F","00BAB5","#43212E","#D9666F","#F2D57E","#A9A688","516057","#2A3B30","#ABFFD1","#EBFFF5","#9DFEFF","273B40","#A63343","#E65159","#F5E9DB","#F4F7CF","BAD984","#1BA68C","#54BFAC","#F2EDA7","#F2E530","D94625","#1A2A40","#3F7369","#F2DEA0","#CE5251","EA895E","#1E9382","#70A758","#EFF1C2","#F0563D","2E313D","#A991E8","#FFB4BB","#ACF7FF","#A2E891","FFEDAE","#225B66","#17A3A5","#8DBF67","#FCCB5F","FC6E59","#282624","#BFB7AA","#403D39","#807A71","ABA398","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#440008","#605521","#988432","#D9A54E","9E3711","#649670","#36291E","#69AD6C","#92E67C","C5FF84","#42342C","#738076","#B2B39B","#DFE5E1","294359","#1A3838","#3F7A51","#82A352","#D1C062","FFBE59","#7D8C22","#B3BF67","#F2E49B","#D9DFF4","6791BF","#8A7D6D","#2D2D38","#E86E48","#FFFFE8","9CC9C9","#CFC949","#FFF5BF","#A9E6C4","#6AB39F","665841","#A1172D","#FDFFBA","#A7DB9E","#275C57","1F1B19","#FF6C0D","#F29E00","#E6C10F","#44996F","216273","#2C3E50","#FA4248","#D7DADB","#6DBCDB","FFFFFF","#627369","#99B397","#E2F2C6","#91CCAD","376266","#04496E","#66CAFF","#A3FC7E","#70D44A","2C6B0F","#1BA68C","#97BF3F","#F2ECD8","#F2B035","F2522E","#A2D9B1","#7CBF9E","#F2F1B9","#8C8575","193741","#024959","#037E8C","#F2EFDC","#E74C30","363636","#212625","#9CA6A2","#D0D9D6","#BF0404","C2C6AF","#00FFFF","#00FF00","#FFFF00","#FF5100","FF007C","#212629","#CDCF19","#FFF77D","#96C4AB","CF2A56","#CFF9FF","#BFC7BB","#787051","#332730","57324F","#98CACB","#FDEFBE","#F0542B","#736E5B","ABA68E","#F2F1EB","#BFB9A4","#262222","#802A30","8C0303","#65356B","#AB434F","#C76347","#FFA24C","519183","#78BF82","#A4D17C","#CFD96C","#EBD464","FFD970","#806265","#FFA256","#F7DD77","#E0D054","ABA73C","#8F323C","#123943","#80BDDB","#4189AB","C98127","#683820","#8C9A89","#E7D6A2","#BEAA65","9A8234","#021B21","#032C36","#065F73","#E8DFD6","FF2A1D","#2D6C73","#3FA693","#B4D9CB","#9ABF49","C6D93B","#141F26","#2B4040","#405950","#A69E86","F2D9BB","#4A8279","#003330","#610400","#003B06","02730F","#69B5E1","#D4E4F5","#EAF2F8","#BEDBED","000000","#893660","#EF7261","#68D693","#A0D7E2","299CA8","#073A59","#2D9AA6","#F2E2DC","#F23322","A61B1B","#2A3A48","#3E6372","#B2D4DC","#FAFAFF","FF6900","#F3BD8D","#F1A280","#BE6D6B","#704A5B","3E263C","#1C2742","#3C91C7","#5A9ABE","#95C5DE","E0EEFB","#426261","#465A59","#577573","#739A97","9AC1C0","#002A4A","#17607D","#FFF1CE","#FF9311","D64700","#589373","#BFBD99","#F2D6B3","#C2512F","241E1E","#1F518B","#1488C8","#F7E041","#E2413E","B5292A","#549494","#E85649","#232C2E","#E6E8D2","706558","#392133","#FFECBE","#D9D098","#C4AB6D","AB7D3A","#F0F0F0","#1C1C1C","#A2FDF5","#1CCDC7","27EDDF","#011526","#025959","#027353","#03A678","03A696","#004358","#1F8A70","#BEDB39","#FFE11A","FD7400","#37465D","#F2F2F2","#9DC02E","#779324","051A37","#580022","#AA2C30","#FFBE8D","#487B80","011D24","#F9F9F9","#03A678","#E9EDEB","#F44647","00707F","#800000","#BF0000","#E2D6C2","#F6EDD8","FFFFFF","#F7F6AF","#1B2124","#D62822","#97D6A6","468263","#432852","#992255","#FF3D4C","#28656E","00968F","#444344","#52BBB2","#2B344D","#EE5555","F8F7EE","#45334A","#796B7D","#CCC4B0","#FFF1B5","FFA3A3","#5A4B53","#9C3C58","#DE2B5B","#D86A41","D2A825","#14151C","#0C242B","#297059","#84D66E","D1FB7A","#272D40","#364659","#55736D","#9DBF8E","D0D991","#23A38F","#B7C11E","#EFF1C2","#F0563D","2E313D","#2E064D","#80176B","#B356A1","#59580B","FFFF00","#CC3333","#FF9D33","#F7F7F0","#3EBBA7","00747A","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","BD6060","#0D3E58","#1C848C","#19C0C2","#F3EDD6","DA6260","#022629","#2A5945","#FAFFED","#E6DCC0","B3371C","#F4FAC7","#7BAD8D","#FFB159","#F77F45","C2454E","#A2C1C6","#86B1B7","#AECBAD","#CFDCB0","D6E1D1","#B0DAFF","#325B80","#64B7FF","#586D80","5092CC","#0F808C","#6C8C26","#F2A71B","#F26A1B","D91818","#FFBC6C","#FE9F6C","#BD716E","#74495F","3B2C4D","#FF4D41","#F2931F","#E6CA21","#91B321","1E8C65","#302821","#453629","#5C4837","#8A735F","BDA895","#415457","#5F7B7F","#9ACCAF","#E6EBC4","F9F7C8","#474143","#A69E9D","#E7E2DA","#FFFFFF","E7E8E7","#805939","#BD9962","#E6CD7D","#578072","2D4B4D","#03588C","#1763A6","#419CA6","#54BF83","8DBF41","#00CCFF","#A1FCFF","#040438","#004878","C9FAFF","#534C64","#B7DECF","#F0F3D7","#7E858C","D96557","#7F7364","#CBB08E","#CBC1B7","#789DCB","646F7F","#5C2849","#A73E5C","#EC7263","#FE9551","FFD285","#FF0012","#FF7D00","#FFD900","#5BE300","0084B0","#F24C32","#F29471","#FCDFA6","#36B898","3D7585","#083157","#0A6C87","#459C97","#92CCA5","C9F0B1","#DC941B","#EDC266","#B6952C","#E1D3A6","E9A119","#323836","#BAD1B5","#DBE8CF","#F0F7E8","FFFEF5","#081724","#589494","#8EBBB4","#D0DCD0","F5EED2","#50781C","#9CAD1C","#EAF7E6","#40A5DE","0B5191","#537F79","#78A68F","#CBD49C","#FED457","CB252A","#F23C13","#CBAB78","#FFFFFF","#898373","1F1C17","#450003","#5C0002","#94090D","#D40D12","FFED75","#0770A2","#82D9F7","#FEFEFE","#AEC844","F36622","#30394F","#FF434C","#6ACEEB","#EDE8DF","0E6569","#FF6B6B","#556270","#C7F464","#4ECDC4","EDC8BB","#D9B500","#FFED9C","#BFCC85","#748F74","454545","#452E32","#A34B1B","#B5A187","#EDDF9A","A7CC31","#2C2B33","#596664","#909980","#CCC08D","FF8A00","#C21F1F","#FFFFFC","#E34446","#FFFFDB","E36D6F","#282828","#00AAB5","#C1C923","#F41C54","F5F0F0","#3A3F40","#202627","#151B1E","#EFF4FF","41444D","#DEBB73","#4D0017","#010000","#4D0F30","9A002F","#EB9328","#FFA754","#FFD699","#FFF5DC","4FA6B3","#025E73","#037F8C","#D9D59A","#D9BD6A","590202","#636266","#E0CEA4","#E8A579","#7D6855","42403E","#FF0000","#FF4000","#FF7F00","#FFBF00","FFFF00","#FFFFFF","#74ADA6","#1E5E6F","#241B1F","68A81E","#5A0532","#FF6745","#FFC861","#9DAE64","27404A","#ACCBBC","#467847","#E8E4C1","#A60303","730202","#5C4B51","#8CBEB2","#F2EBBF","#F3B562","F06060","#0D2557","#93A8C9","#FFFFFF","#F5DED5","558D96","#F53C4A","#565157","#10CFC8","#F2EEE7","F5D662","#FFD97B","#E65029","#A60027","#660033","191C26","#595408","#A6800D","#A66D03","#A63F03","730C02","#2E031F","#590424","#8C072B","#BF0A2B","DEEFC5","#E0C882","#A6874E","#BFA169","#D9B779","F2D399","#D88681","#A67673","#746566","#535A5D","324F54","#FC297D","#FB607A","#FDA286","#FDC188","FEE78A","#FFECA1","#B3B27F","#4C5E52","#2F3436","FFBE2C","#D93312","#B3AB82","#45735F","#394D47","2C3233","#324143","#6595A3","#C8E3E8","#FCFFED","B6C28B","#477984","#FEF5EB","#C03C44","#EEAA4D","313E4A","#334D5C","#45B29D","#EFC94C","#E27A3F","DF4949","#630B11","#33322F","#2A2927","#1E1D1C","000000","#D94214","#FFF2C1","#80A894","#52736B","093844","#051E21","#00302D","#856434","#F28C28","FFAD4E","#D7DADD","#DDDEE3","#E1E1E9","#EDEFF4","F2F3F8","#BF495E","#41A693","#F2EC9B","#D9CF48","D9583B","#067072","#14A589","#DECFA6","#BAAE8C","F94B06","#423A38","#47B8C8","#E7EEE2","#BDB9B1","D7503E","#730324","#DFE3E6","#B4C4D4","#8BA2BD","456382","#537374","#F9BD7F","#EBD7A5","#ADC9A5","5C9E99","#88B59E","#B6DEC8","#39464D","#C04229","ABD1AB","#11A7FC","#95D127","#F2E415","#FF8638","EE3551","#212640","#5D718C","#4B95A6","#60BFBF","EFF2D8","#D8A64D","#9B5422","#351411","#5B0D0D","991C11","#53324F","#668D6E","#F2E0A0","#F19B7A","F0756E","#DFE0AF","#A4BAA2","#569492","#41505E","383245","#7BBADE","#93DE7F","#FFED5D","#F29E4A","FF7050","#133800","#1B4F1B","#398133","#5C9548","93E036","#D9D7AD","#91A685","#FF6A00","#37485C","1C232E","#008767","#FFB27A","#FF6145","#AB2141","5E1638","#727B7F","#CCEAEA","#7A7556","#2E2125","44CACC","#FFFFED","#FF2C38","#FF9A3A","#FFF040","67D9FF","#007148","#60A859","#9BDA6A","#C7F774","F9FFEF","#092740","#45698B","#90B0CC","#F1FAFF","8FD36F","#E2FFA0","#7D8076","#FAFFED","#C2CCBE","8F7D70","#00736A","#00BC9F","#F1EEC7","#FEA301","F2561A","#26282E","#AD5138","#F7F7F7","#DDDAE0","8594AE","#1A191F","#35352F","#484042","#4E5252","E64D38","#49454A","#E69B02","#FAF4C6","#B1D631","324052","#5F1A2B","#1D2834","#6F8B78","#E4D49E","C96466","#012D3D","#38AD9E","#FFEB9E","#FF6867","D0DBED","#0D1F36","#104954","#1E9C89","#38CC85","60EB7B","#8C4E03","#9FA66A","#F2EC94","#F23005","8B0F03","#000001","#20201F","#E2E2E4","#590402","B80000","#344059","#465973","#F2D272","#A69460","595139","#33454C","#608F85","#B6E5CB","#8BAF95","54584E","#FBFEF6","#B7BFA4","#687F70","#1A3841","BF3847","#D7E836","#86FFC7","#FFB048","#E8366C","593BFF","#34A9FF","#5982DB","#665EB8","#684682","632E62","#004056","#2C858D","#74CEB7","#C9FFD5","FFFFCB","#BFB978","#84945C","#516967","#4D3130","281B24","#103B73","#20638C","#3786A6","#4EABBF","EBEFF2","#9FB1BF","#1D2D63","#1C5357","#1F6E56","196331","#FFEBBA","#C3BD91","#88947B","#4C3F3F","2A2727","#347373","#4EA6A6","#91D9D9","#FFFFFD","F2E205","#828948","#EFDFC2","#006971","#DC533E","840000","#000137","#29003F","#79003D","#D04D14","F89801","#370005","#4B0005","#5F0005","#730005","870005","#C3AE8D","#F25260","#2D5F73","#6BADC9","8FCED6","#9E1B36","#F7EDBA","#E69B3D","#EB3355","3D241D","#1D8281","#44BF87","#FBD258","#F29A3F","DB634F","#035C75","#1B808C","#31A6A8","#F3F1BC","F3AD14","#FF7500","#665130","#EBB643","#CEDAA8","668E84","#384D3A","#3E6653","#728053","#A68357","D97C71","#012326","#17455C","#E1CAAB","#FE8333","FA4913","#1A2944","#2DA7C7","#56ACBA","#98C4C9","CBD5D2","#BF3542","#CDC5BA","#EBE3D6","#3C3C3C","2E2E2E","#231921","#695F74","#BEB4CB","#EBEBF0","D2DCEB","#34373F","#686C75","#F3E9D0","#BEB7A7","8E867C","#661510","#D9351A","#F2C76F","#BF9727","204D3F","#3CFFEE","#24AABC","#356781","#2C3D51","1C1F24","#DA3537","#FFFCC4","#00585F","#6A6A61","2A2C2B","#AE3135","#D1AF87","#8C826B","#3D3C33","F2F0CE","#FF0894","#FF5E9F","#FF91A7","#FFB5CA","F5F0BA","#99878D","#323232","#646464","#7E4A5C","372129","#3FB8AF","#7FC7AF","#DAD8A7","#FFB38B","FF3F34","#402B3C","#6AA6A6","#D9CCA7","#F2B263","F26835","#6AA690","#F2BC1B","#F2DC99","#F29057","BF1F1F","#F4FAC7","#7BAD8D","#FFB158","#F77F45","C2454E","#E5533C","#F5E346","#93D06D","#50AC6A","227864","#39588A","#A9BDD7","#FFFFFF","#FFEADD","FFD0BB","#B0B595","#615F4F","#828567","#91A380","EAFFCD","#00427F","#0066BD","#66B5CC","#F0E4C5","D6C28F","#FF6313","#F9E4B3","#C29689","#74474B","45232E","#00585F","#009393","#FFFCC4","#C7C49B","EB0A00","#091840","#44A2FF","#F7F7EA","#B3CC63","4C6620","#5CBBE3","#FCF1BC","#5C8182","#383A47","B4F257","#9E9E9E","#E5E1D1","#E0393D","#253746","425563","#4D9453","#FFFFB1","#ADDE4E","#FF9D27","A62A16","#B70046","#FF850B","#FFEBC5","#109679","675A4C","#363636","#0599B0","#A4BD0A","#FFA615","FF2E00","#7D8077","#BBBFB2","#FAFFED","#E82A33","E3DEBC","#FD9F44","#FC5C65","#007269","#03A679","FAF0B9","#134B57","#81A489","#F1D8B5","#F2A054","C04D31","#946E49","#394042","#EDDBAC","#872A0C","BA8E3A","#404040","#024959","#037E8C","#FFFFFF","F24C27","#2A3342","#163C6E","#4E5F61","#E6A015","EDE7BE","#445060","#829AB5","#849E91","#C14543","D6D5D1","#8A9126","#B7BF5E","#FFE9C4","#F5B776","F58E45","#9B2D1E","#3C3A28","#78A080","#9BCD9E","FFFFAE","#FF6138","#FFFF9D","#BEEB9F","#79BD8F","00A388","#990000","#FF6600","#FF9900","#996633","CC9966","#DCE6DA","#B8CCBB","#98B3A5","#7A9994","62858C","#0B1C29","#3B7C8F","#73A5A3","#98C1B7","F0EBD2","#F6CB51","#E25942","#13A89E","#3F4953","F2E7DA","#282F36","#FFFEFC","#BDA21D","#BFBC5B","D2E098","#8C182D","#DE7140","#FCB95A","#FAE285","6A7349","#6B9100","#FFE433","#FF841F","#E03D19","A6001C","#FFEAA7","#D9D697","#9FC49F","#718C6A","543122","#CFF09E","#A8DBA8","#79BD9A","#3B8686","0B486B","#0C2233","#065471","#0A91AB","#FFC045","F2F2F2","#BEE8E0","#373C40","#2E2621","#73320B","FF5E00","#1B2C35","#A3BFC6","#FF005D","#222A30","293A42","#FF8400","#3B4044","#494948","#E6E1D8","F7F2E9","#6A482D","#518C86","#F6BF3D","#EF7C27","BF2424","#261C2B","#292B39","#226468","#608D80","829D8F","#B2AD9A","#110E00","#363226","#A9A695","ECE9D8","#1B1B26","#26394D","#286480","#13B3BF","A3FF57","#F2C2A7","#F5E5C5","#593D28","#422C21","93DEDB","#001028","#033140","#1E5A5B","#7BA78C","EBEDC6","#544E6E","#808CB0","#ABD1D9","#D9FFF7","DDF556","#323A45","#596677","#758194","#FFFFFF","E74C3C","#45291A","#AB926D","#DBD1BC","#4999C3","5FCBEC","#6B151D","#2E1615","#A8553A","#DB8F5A","F2C18E","#000623","#28475C","#4A6C74","#8BA693","F0E3B1","#60807B","#81B37A","#BCCC5F","#FFEE65","E64964","#FFFFFA","#A1A194","#5B605F","#464646","FF6600","#1E1B17","#577270","#9C9A79","#C7BDA1","580E0C","#452F27","#5E504A","#6B6865","#9BBAB2","B0FFED","#1B5257","#F7F6C3","#F28159","#CC5850","4F1C2E","#FAA51B","#BF511F","#2C445E","#2F6D82","5EE4EB","#BF3952","#59364A","#556D73","#D9D1A9","D95F5F","#024959","#037E8C","#F2EFDC","#E74C30","363636","#221A26","#544759","#A197A6","#F27405","D93D04","#C4A44A","#E6D399","#9AB8A9","#7C8A7F","4E4B44","#FFFEC8","#B1BF99","#5B604D","#39382B","26181E","#4E3C51","#21A68D","#3BBF9A","#F2E8B6","F25749","#102144","#1B325E","#254580","#3C63B0","5D8AEA","#2A3A48","#3E6372","#B2D4DC","#FAFAFF","FF4B00","#FFF1BF","#F20058","#FFAEAC","#000001","7D7A96","#FDFFC6","#F2F096","#FF0080","#DE0049","521218","#5B0E00","#FBB500","#FBD864","#807D1A","59233C","#1E1E1F","#424143","#67666A","#807F83","CBC9CF","#3C3658","#3EC8B7","#7CD0B4","#B9D8B1","F7E0AE","#FFFFFF","#99B75F","#D5DD98","#EBF4DB","D8D8D8","#248A8A","#C9FA58","#F9E555","#FAAC38","F2572A","#086B63","#77A490","#E2D8C1","#BFAE95","7C7159","#5C4B51","#8CBEB2","#F2EBBF","#A5C88F","EF847B","#17162F","#89346D","#C76058","#FFB248","E8C475","#6E8F4A","#65D9C5","#F2E7B6","#EDA430","AB3E2C","#30394F","#FF434C","#6ACEEB","#EDE8DF","0E6569","#8E1B13","#F9E4B3","#849689","#46464A","29232E","#686B30","#AB9A52","#E8BA67","#D68F4F","BA512E","#E54E45","#DBC390","#F2F2EF","#13A3A5","403833","#65BA99","#59A386","#F1DDBB","#D6C4A6","E74C3C","#A6FFBC","#4ACFAF","#00A995","#006161","003D4C","#33271E","#8B7653","#C8D9A0","#FDEE9D","233331","#048789","#503D2E","#D44D27","#E2A72E","EFEBC8","#E5FF1E","#A9D943","#75A660","#698070","494D4B","#2DEBA2","#91F57F","#EBAA69","#E70049","2B0027","#990000","#336699","#DDDDDD","#999999","333333","#F13A4B","#3D3C3E","#22BDAF","#F4F4F4","D7D7D7","#F53A59","#001D2D","#15A88C","#B7D9C8","F3F5F4"]};Ops.Color.ColorPalettes.prototype=new CABLES.Op;CABLES.OPS["31d33a1e-9a0a-49f7-8bc8-9e83ab71e23e"]={f:Ops.Color.ColorPalettes,objName:"Ops.Color.ColorPalettes"};Ops.Gl.TextureEffects.Noise.FBMNoise_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={fbmnoise_frag:"UNI sampler2D tex;\nUNI float anim;\n\nUNI float scale;\nUNI float repeat;\n\nUNI float scrollX;\nUNI float scrollY;\n\nUNI float amount;\n\nUNI bool layer1;\nUNI bool layer2;\nUNI bool layer3;\nUNI bool layer4;\nUNI vec3 color;\nUNI float aspect;\n\nIN vec2 texCoord;\n\n\n{{CGL.BLENDMODES3}}\n\n// csdcsdcds\n// adapted from warp shader by inigo quilez/iq\n// License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n\n// See here for a tutorial on how to make this: http://www.iquilezles.org/www/articles/warp/warp.htm\n\nconst mat2 m = mat2( 0.80,  0.60, -0.60,  0.80 );\n\nfloat noise( in vec2 x )\n{\n\treturn sin(1.5*x.x)*sin(1.5*x.y);\n}\n\nfloat fbm4( vec2 p )\n{\n    float f = 0.0;\n    f += 0.5000*noise( p ); p = m*p*2.02;\n    f += 0.2500*noise( p ); p = m*p*2.03;\n    f += 0.1250*noise( p ); p = m*p*2.01;\n    f += 0.0625*noise( p );\n    return f/0.9375;\n}\n\nfloat fbm6( vec2 p )\n{\n    float f = 0.0;\n    f += 0.500000*(0.5+0.5*noise( p )); p = m*p*2.02;\n    f += 0.250000*(0.5+0.5*noise( p )); p = m*p*2.03;\n    f += 0.125000*(0.5+0.5*noise( p )); p = m*p*2.01;\n    f += 0.062500*(0.5+0.5*noise( p )); p = m*p*2.04;\n    f += 0.031250*(0.5+0.5*noise( p )); p = m*p*2.01;\n    f += 0.015625*(0.5+0.5*noise( p ));\n    return f/0.96875;\n}\n\nvoid main()\n{\n    vec2 tc=texCoord;\n\t#ifdef DO_TILEABLE\n\t    tc=abs(texCoord-0.5);\n\t#endif\n\n    vec2 p=(tc-0.5)*scale;\n\n    p.y/=aspect;\n    vec2 q = vec2( fbm4( p + vec2(0.3+scrollX,0.20+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,1.3+scrollY) ) );\n\n    vec2 q2 = vec2( fbm4( p + vec2(2.0+scrollX,1.0+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,1.3+scrollY) ) );\n\n    vec2 q3 = vec2( fbm4( p + vec2(9.0+scrollX,4.0+scrollY) ),\n                   fbm4( p + vec2(3.1+scrollX,4.3+scrollY) ) );\n\n    float v= fbm4( ( p + 4.0*q +anim*0.1)*repeat);\n    float v2= fbm4( (p + 4.0*q2 +anim*0.1)*repeat );\n\n    float v3= fbm6( (p + 4.0*q3 +anim*0.1)*repeat );\n    float v4= fbm6( (p + 4.0*q2 +anim*0.1)*repeat );\n\n    vec4 base=texture(tex,texCoord);\n\n    vec4 finalColor;\n    float colVal=0.0;\n    float numLayers=0.0;\n\n    if(layer1)\n    {\n        colVal+=v;\n        numLayers++;\n    }\n\n    if(layer2)\n    {\n        colVal+=v2;\n        numLayers++;\n    }\n\n    if(layer3)\n    {\n        colVal+=v3;\n        numLayers++;\n    }\n\n    if(layer4)\n    {\n        colVal+=v4;\n        numLayers++;\n    }\n\n    finalColor=vec4( color*vec3(colVal/numLayers),1.0);\n\n    outColor = cgl_blendPixel(base,finalColor,amount);\n}\n"};const n=e.inTrigger("render"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),i=e.inValueSlider("Amount",1),a=CGL.TextureEffect.AddBlendAlphaMask(e),s=e.inValueSlider("r",1),o=e.inValueSlider("g",1),l=e.inValueSlider("b",1),u=e.outTrigger("trigger");s.setUiAttribs({colorPick:true});const c=e.patch.cgl;const h=new CGL.Shader(c,"fbmnoise");h.setSource(h.getDefaultVertexShader(),t.fbmnoise_frag);const d=new CGL.Uniform(h,"t","tex",0),f=new CGL.Uniform(h,"f","scale",e.inValue("scale",2)),p=new CGL.Uniform(h,"f","anim",e.inValue("anim",0)),m=new CGL.Uniform(h,"f","scrollX",e.inValue("scrollX",9)),g=new CGL.Uniform(h,"f","scrollY",e.inValue("scrollY",0)),v=new CGL.Uniform(h,"f","repeat",e.inValue("repeat",1)),b=new CGL.Uniform(h,"f","aspect",e.inValue("aspect",1)),_=new CGL.Uniform(h,"b","layer1",e.inValueBool("Layer 1",true)),F=new CGL.Uniform(h,"b","layer2",e.inValueBool("Layer 2",true)),C=new CGL.Uniform(h,"b","layer3",e.inValueBool("Layer 3",true)),A=new CGL.Uniform(h,"b","layer4",e.inValueBool("Layer 4",true)),E=new CGL.Uniform(h,"3f","color",s,o,l),x=new CGL.Uniform(h,"f","amount",i);const B=e.inValueBool("Tileable",false);B.onChange=D;CGL.TextureEffect.setupBlending(e,h,r,i,a);function D(){h.toggleDefine("DO_TILEABLE",B.get())}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;c.pushShader(h);c.currentTextureEffect.bind();b.set(c.currentTextureEffect.getCurrentSourceTexture().width/c.currentTextureEffect.getCurrentSourceTexture().height);c.setTexture(0,c.currentTextureEffect.getCurrentSourceTexture().tex);c.currentTextureEffect.finish();c.popShader();u.trigger()}};Ops.Gl.TextureEffects.Noise.FBMNoise_v2.prototype=new CABLES.Op;CABLES.OPS["9422eeab-b6c5-47d1-8737-d5c43dc137a3"]={f:Ops.Gl.TextureEffects.Noise.FBMNoise_v2,objName:"Ops.Gl.TextureEffects.Noise.FBMNoise_v2"};Ops.Gl.TextureEffects.ColorMap_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={colormap_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D gradient;\nUNI float pos;\nUNI float amount;\nUNI float vmin;\nUNI float vmax;\n\n{{CGL.BLENDMODES3}}\n\n\nfloat lumi(vec3 color)\n{\n   return vec3(dot(vec3(0.2126,0.7152,0.0722), color)).r;\n}\n\nvoid main()\n{\n    vec4 base=texture(tex,texCoord);\n    float a=base.a;\n\n    base=clamp(base,vmin,vmax);\n\n    #ifdef METH_LUMI\n        vec4 color=texture(gradient,vec2(lumi(base.rgb),pos));\n    #endif\n\n    #ifdef METH_CHANNELS\n        vec4 color=vec4(1.0);\n        color.r=texture(gradient,vec2(base.r,pos)).r;\n        color.g=texture(gradient,vec2(base.g,pos)).g;\n        color.b=texture(gradient,vec2(base.b,pos)).b;\n    #endif\n\n    base.a=color.a=a;\n\n\n    outColor=cgl_blendPixel(base,color,amount);\n\n}\n"};let n=e.inTrigger("render");let r=e.outTrigger("trigger");const i=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const a=e.inValueSlider("Amount",1);let s=e.inTexture("Gradient");let o=e.inSwitch("Method",["Luminance","Channels"],"Luminance");let l=e.inFloatSlider("Min",0);let u=e.inFloatSlider("Max",1);let c=e.inValueSlider("Position",.5);e.setPortGroup("Vertical Position",[l,u,c]);let h=e.patch.cgl;let d=new CGL.Shader(h,e.name);d.define("METH_LUMI");d.setSource(d.getDefaultVertexShader(),t.colormap_frag);var f=new CGL.Uniform(d,"t","tex",0);var f=new CGL.Uniform(d,"t","gradient",1);let p=new CGL.Uniform(d,"f","pos",c);let m=new CGL.Uniform(d,"f","vmin",l);let g=new CGL.Uniform(d,"f","vmax",u);let v=new CGL.Uniform(d,"f","amount",a);CGL.TextureEffect.setupBlending(e,d,i,a);o.onChange=()=>{d.toggleDefine("METH_LUMI",o.get()=="Luminance");d.toggleDefine("METH_CHANNELS",o.get()=="Channels")};n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;if(!s.get())return;h.pushShader(d);h.currentTextureEffect.bind();h.setTexture(0,h.currentTextureEffect.getCurrentSourceTexture().tex);h.setTexture(1,s.get().tex);h.currentTextureEffect.finish();h.popShader();r.trigger()}};Ops.Gl.TextureEffects.ColorMap_v2.prototype=new CABLES.Op;CABLES.OPS["440c1675-122d-411f-b848-16c60b677120"]={f:Ops.Gl.TextureEffects.ColorMap_v2,objName:"Ops.Gl.TextureEffects.ColorMap_v2"};Ops.Gl.TextureEffects.MultiDrawImage=function(){CABLES.Op.apply(this,arguments);const n=this;const t={invert_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D tex1;\nUNI sampler2D tex2;\nUNI sampler2D tex3;\nUNI sampler2D tex4;\nUNI sampler2D tex5;\nUNI sampler2D tex6;\nUNI sampler2D tex7;\nUNI sampler2D tex8;\n\n\nUNI sampler2D texMask1;\nUNI sampler2D texMask2;\nUNI sampler2D texMask3;\nUNI sampler2D texMask4;\nUNI sampler2D texMask5;\nUNI sampler2D texMask6;\nUNI sampler2D texMask7;\nUNI sampler2D texMask8;\n\nUNI float amount1;\nUNI float amount2;\nUNI float amount3;\nUNI float amount4;\nUNI float amount5;\nUNI float amount6;\nUNI float amount7;\nUNI float amount8;\n\n{{BLENDCODE}}\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n\n    #ifdef USE_TEX_1\n        vec4 col1=texture(tex1,texCoord);\n        col=cgl_blend1(col,col1,amount1);\n    #endif\n    #ifdef USE_TEX_2\n        vec4 col2=texture(tex2,texCoord);\n        col=cgl_blend2(col,col2,amount2);\n    #endif\n    #ifdef USE_TEX_3\n        vec4 col3=texture(tex3,texCoord);\n        col=cgl_blend3(col,col3,amount3);\n    #endif\n    #ifdef USE_TEX_4\n        vec4 col4=texture(tex4,texCoord);\n        col=cgl_blend4(col,col4,amount4);\n    #endif\n    #ifdef USE_TEX_5\n        vec4 col5=texture(tex5,texCoord);\n        col=cgl_blend5(col,col5,amount5);\n    #endif\n    #ifdef USE_TEX_6\n        vec4 col6=texture(tex6,texCoord);\n        col=cgl_blend6(col,col6,amount6);\n    #endif\n    #ifdef USE_TEX_7\n        vec4 col7=texture(tex7,texCoord);\n        col=cgl_blend7(col,col7,amount7);\n    #endif\n    #ifdef USE_TEX_8\n        vec4 col8=texture(tex8,texCoord);\n        col=cgl_blend8(col,col8,amount8);\n    #endif\n\n    outColor=col;\n\n}\n"};const r=["normal","lighten","darken","multiply","multiply invert","average","add","substract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight"];const e=n.inTrigger("render"),i=n.inBool("Mask Invert",false),a=n.outTrigger("trigger");const s=8,o=n.patch.cgl,l=new CGL.Shader(o,n.name),u=[],c=[],h=[],d=[],f=[],p=[];let m=true;for(let e=0;e<s;e++){const _=n.inTexture("Texture "+(e+1));const F=n.inDropDown("Blendmode "+(e+1),r,"normal");const C=n.inTexture("Mask "+(e+1));const A=n.inSwitch("Mask Source "+(e+1),["R","R inv","A","A inv"],"R");const E=n.inSwitch("Opacity "+(e+1),["Normal","Prev A","Prev R"],"Normal");const x=n.inValueSlider("Amount "+(e+1),1);F.onChange=E.onChange=A.onChange=C.onLinkChanged=_.onLinkChanged=()=>{m=true};p.push(_);d.push(C);h.push(E);c.push(F);u.push(x);f.push(A);n.setPortGroup("Image "+(e+1),[_,F,x,E,C,A]);new CGL.Uniform(l,"t","tex"+(e+1),e*2+1);new CGL.Uniform(l,"t","texMask"+(e+1),e*2+2);new CGL.Uniform(l,"f","amount"+(e+1),x)}const g=new CGL.Uniform(l,"t","tex",0);function v(){let n="";let r="";for(let t=0;t<s;t++){let e=p[t].isLinked();u[t].setUiAttribs({greyout:!e});c[t].setUiAttribs({greyout:!e});h[t].setUiAttribs({greyout:!e});if(e){n+="#define USE_TEX_"+(t+1)+"".endl();r+=b(t+1,c[t].get(),h[t].get(),d[t].get(),f[t].get())}}let e=n.endl()+t.invert_frag;e=e.replace("{{BLENDCODE}}",r);l.setSource(l.getDefaultVertexShader(),e);m=false}function b(e,t,n,r,i){let a=""+"vec3 _blend"+e+"(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl();if(t=="multiply")a+="       colNew=base*blend;".endl();else if(t=="multiply invert")a+="       colNew=base* vec3(1.0)-blend;".endl();else if(t=="average")a+="       colNew=((base + blend) / 2.0);".endl();else if(t=="add")a+="       colNew=min(base + blend, vec3(1.0));".endl();else if(t=="substract")a+="       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl();else if(t=="difference")a+="       colNew=abs(base - blend);".endl();else if(t=="negation")a+="       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl();else if(t=="exclusion")a+="       colNew=(base + blend - 2.0 * base * blend);".endl();else if(t=="lighten")a+="       colNew=max(blend, base);".endl();else if(t=="darken")a+="       colNew=min(blend, base);".endl();else if(t=="overlay"){a+=""+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()}else if(t=="screen"){a+=""+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()}else if(t=="softlight"){a+=""+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()}else if(t=="hardlight"){a+=""+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()}else if(t=="color dodge"){a+=""+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()}else if(t=="color burn"){a+=""+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()}a+=""+"   return colNew;".endl()+"}".endl()+"vec4 cgl_blend"+e+"(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"float a=(amount*newColor.a);".endl();if(n==="Prev A")a+="a*=oldColor.a;";if(n==="Prev R")a+="a*=oldColor.r;";a=a+"vec4 col = vec4( _blend"+e+"(oldColor.rgb, newColor.rgb), 1.0);".endl()+"col = vec4( mix( col.rgb,oldColor.rgb, col.a * 1.0-amount), 1.0);".endl();if(r)if(i==="R")a=a+"newColor.a *= texture(texMask"+e+",texCoord).r;".endl();else if(i==="R inv")a=a+"newColor.a *= 1.0-texture(texMask"+e+",texCoord).r;".endl();else if(i==="A")a=a+"newColor.a *= texture(texMask"+e+",texCoord).a;".endl();else if(i==="A inv")a=a+"newColor.a *= 1.0-texture(texMask"+e+",texCoord).a;".endl();a=a+"col = vec4( mix( oldColor,col, newColor.a));".endl()+"return col;".endl()+"}".endl().endl();return a}e.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(n))return;if(m)v();o.pushShader(l);o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);let t=1;for(let e=0;e<p.length;e++){if(p[e].get()){o.setTexture(e*2+1,p[e].get().tex);t++}if(d[e].get()){o.setTexture(e*2+2,d[e].get().tex);t++}}if(t>o.maxTextureUnits)n.setUiError("manytex","Too many textures bound");else n.setUiError("manytex",null);o.pushBlendMode(CGL.BLEND_NONE,true);o.currentTextureEffect.finish();o.popBlendMode();o.popShader();a.trigger()}};Ops.Gl.TextureEffects.MultiDrawImage.prototype=new CABLES.Op;CABLES.OPS["4df51ead-c46c-471d-ac5e-1872219a3174"]={f:Ops.Gl.TextureEffects.MultiDrawImage,objName:"Ops.Gl.TextureEffects.MultiDrawImage"};Ops.Gl.CanvasInfo=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.outNumber("width"),r=t.outNumber("height"),i=t.inSwitch("Pixel Unit",["Display","CSS"],"Display"),a=t.outNumber("Pixel Ratio"),s=t.outNumber("Aspect Ratio"),o=t.outBool("Landscape");let l=t.patch.cgl;l.on("resize",u);i.onChange=u;u();function u(){let e=1;if(i.get()=="CSS")e=t.patch.cgl.pixelDensity;r.set(l.canvasHeight/e);n.set(l.canvasWidth/e);a.set(t.patch.cgl.pixelDensity);s.set(l.canvasWidth/l.canvasHeight);o.set(l.canvasWidth>l.canvasHeight?1:0)}};Ops.Gl.CanvasInfo.prototype=new CABLES.Op;CABLES.OPS["94e499e5-b4ee-4861-ab48-6ab5098b2cc3"]={f:Ops.Gl.CanvasInfo,objName:"Ops.Gl.CanvasInfo"};Ops.Gl.TextureEffects.ChromaticAberration_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={chromatic_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float pixel;\nUNI float onePixel;\nUNI float amount;\nUNI float lensDistort;\n\n#ifdef MASK\nUNI sampler2D texMask;\n#endif\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n   vec4 base=texture(tex,texCoord);\n   vec4 col=texture(tex,texCoord);\n\n   vec2 tc=texCoord;;\n   float pix = pixel;\n   if(lensDistort>0.0)\n   {\n       float dist = distance(texCoord, vec2(0.5,0.5));\n       tc-=0.5;\n       tc *=smoothstep(-0.9,1.0*lensDistort,1.0-dist);\n       tc+=0.5;\n   }\n\n    #ifdef MASK\n        vec4 m=texture(texMask,texCoord);\n        pix*=m.r*m.a;\n    #endif\n\n    #ifdef SMOOTH\n    #ifdef WEBGL2\n        float numSamples=round(pix/onePixel/4.0+1.0);\n        col.r=0.0;\n        col.b=0.0;\n\n        for(float off=0.0;off<numSamples;off++)\n        {\n            float diff=(pix/numSamples)*off;\n            col.r+=texture(tex,vec2(tc.x+diff,tc.y)).r/numSamples;\n            col.b+=texture(tex,vec2(tc.x-diff,tc.y)).b/numSamples;\n        }\n    #endif\n    #endif\n\n    #ifndef SMOOTH\n        col.r=texture(tex,vec2(tc.x+pix,tc.y)).r;\n        col.b=texture(tex,vec2(tc.x-pix,tc.y)).b;\n    #endif\n\n   outColor= cgl_blendPixel(base,col,amount);\n\n}\n"};const n=t.inTrigger("render"),r=CGL.TextureEffect.AddBlendSelect(t,"Blend Mode","normal"),i=t.inValueSlider("Amount",1),a=t.inValue("Pixel",5),s=t.inValueSlider("Lens Distort",0),o=t.inValueBool("Smooth",false),l=t.inTexture("Mask"),u=t.outTrigger("trigger");const c=t.patch.cgl;const h=new CGL.Shader(c,"chromatic");CGL.TextureEffect.setupBlending(t,h,r,i);h.setSource(h.getDefaultVertexShader(),e.chromatic_frag);const d=new CGL.Uniform(h,"t","tex",0),f=new CGL.Uniform(h,"f","pixel",0),p=new CGL.Uniform(h,"f","onePixel",0),m=new CGL.Uniform(h,"t","texMask",1),g=new CGL.Uniform(h,"f","amount",i),v=new CGL.Uniform(h,"f","lensDistort",s);o.onChange=function(){if(o.get())h.define("SMOOTH");else h.removeDefine("SMOOTH")};l.onChange=function(){if(l.get())h.define("MASK");else h.removeDefine("MASK")};n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t,3))return;var e=c.currentTextureEffect.getCurrentSourceTexture();f.setValue(a.get()*(1/e.width));p.setValue(1/e.width);c.pushShader(h);c.currentTextureEffect.bind();c.setTexture(0,e.tex);if(l.get())c.setTexture(1,l.get().tex);c.currentTextureEffect.finish();c.popShader();u.trigger()}};Ops.Gl.TextureEffects.ChromaticAberration_v2.prototype=new CABLES.Op;CABLES.OPS["07701f81-1a98-44c0-b1ef-592db3cbb5d3"]={f:Ops.Gl.TextureEffects.ChromaticAberration_v2,objName:"Ops.Gl.TextureEffects.ChromaticAberration_v2"};Ops.Gl.TextureEffects.BrightnessContrast=function(){CABLES.Op.apply(this,arguments);const e=this;const t={brightness_contrast_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float amountbright;\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n    col=texture(tex,texCoord);\n\n    // apply contrast\n    col.rgb = ((col.rgb - 0.5) * max(amount*2.0, 0.0))+0.5;\n\n    // apply brightness\n    col.rgb *= amountbright*2.0;\n\n    outColor = col;\n}"};const n=e.inTrigger("render"),r=e.inValueSlider("contrast",.5),i=e.inValueSlider("brightness",.5),a=e.outTrigger("trigger");const s=e.patch.cgl;const o=new CGL.Shader(s,"brightnesscontrast");o.setSource(o.getDefaultVertexShader(),t.brightness_contrast_frag);const l=new CGL.Uniform(o,"t","tex",0);const u=new CGL.Uniform(o,"f","amount",r);const c=new CGL.Uniform(o,"f","amountbright",i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;if(!s.currentTextureEffect.getCurrentSourceTexture())return;if(!CGL.TextureEffect.checkOpInEffect(e))return;s.pushShader(o);s.currentTextureEffect.bind();s.setTexture(0,s.currentTextureEffect.getCurrentSourceTexture().tex);s.currentTextureEffect.finish();s.popShader();a.trigger()}};Ops.Gl.TextureEffects.BrightnessContrast.prototype=new CABLES.Op;CABLES.OPS["54b89199-c594-4dff-bc48-82d6c7a55e8a"]={f:Ops.Gl.TextureEffects.BrightnessContrast,objName:"Ops.Gl.TextureEffects.BrightnessContrast"};Ops.Gl.TextureEffects.FXAA=function(){CABLES.Op.apply(this,arguments);const e=this;const t={fxaa_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float FXAA_SPAN_MAX;\nUNI float FXAA_REDUCE_MUL;\nUNI float FXAA_REDUCE_MIN;\nUNI float width;\nUNI float height;\n\nvec4 getColorFXAA(vec2 coord)\n{\n    vec2 invtexsize=vec2(1.0/width,1.0/height);\n\n    float step=1.0;\n\n    vec3 rgbNW = texture(tex, coord.xy + (vec2(-step, -step)*invtexsize )).xyz;\n    vec3 rgbNE = texture(tex, coord.xy + (vec2(+step, -step)*invtexsize )).xyz;\n    vec3 rgbSW = texture(tex, coord.xy + (vec2(-step, +step)*invtexsize )).xyz;\n    vec3 rgbSE = texture(tex, coord.xy + (vec2(+step, +step)*invtexsize )).xyz;\n    vec3 rgbM  = texture(tex, coord.xy).xyz;\n\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot( rgbM, luma);\n\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n\n    dir = min(vec2(FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\n          max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin))*invtexsize ;\n\n    vec3 rgbA = (1.0/2.0) * (\n                texture(tex, coord.xy + dir * (1.0/3.0 - 0.5)).xyz +\n                texture(tex, coord.xy + dir * (2.0/3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n                texture(tex, coord.xy + dir * (0.0/3.0 - 0.5)).xyz +\n                texture(tex, coord.xy + dir * (3.0/3.0 - 0.5)).xyz);\n    float lumaB = dot(rgbB, luma);\n\n    vec4 color=texture(tex,coord).rgba;\n\n    if((lumaB < lumaMin) || (lumaB > lumaMax)){\n      color.xyz=rgbA;\n    } else {\n      color.xyz=rgbB;\n    }\n    return color;\n}\n\nvoid main()\n{\n   vec4 col=vec4(1.0,0.0,0.0,1.0);\n   outColor= getColorFXAA(texCoord);\n}"};let n=e.inTrigger("render");let r=e.outTrigger("trigger");let i=e.inValueSelect("span",[0,2,4,8,16,32,64]);let a=e.inValueFloat("reduceMin");let s=e.inValueFloat("reduceMul");let o=e.inValueBool("use viewport size",true);let l=e.inValueInt("width");let u=e.inValueInt("height");let c=e.patch.cgl;let h=new CGL.Shader(c,e.name);h.setSource(h.getDefaultVertexShader(),t.fxaa_frag);let d=new CGL.Uniform(h,"t","tex",0);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;c.pushShader(h);if(c.getViewPort()[2]!=l.get()||c.getViewPort()[3]!=u.get()){b()}c.currentTextureEffect.bind();c.setTexture(0,c.currentTextureEffect.getCurrentSourceTexture().tex);c.currentTextureEffect.finish();c.popShader();r.trigger()};let f=new CGL.Uniform(h,"f","FXAA_SPAN_MAX",0);let p=new CGL.Uniform(h,"f","FXAA_REDUCE_MUL",0);let m=new CGL.Uniform(h,"f","FXAA_REDUCE_MIN",0);i.onChange=function(){f.setValue(parseInt(i.get(),10))};let g=new CGL.Uniform(h,"f","width",0);let v=new CGL.Uniform(h,"f","height",0);function b(){if(o.get()){let e=c.getViewPort()[2];let t=c.getViewPort()[3];g.setValue(e);v.setValue(t)}else{g.setValue(l.get());v.setValue(u.get())}}l.onChange=b;u.onChange=b;o.onChange=b;e.onResize=b;i.set(8);s.onChange=function(){p.setValue(1/s.get())};a.onChange=function(){m.setValue(1/a.get())};s.set(8);a.set(128)};Ops.Gl.TextureEffects.FXAA.prototype=new CABLES.Op;CABLES.OPS["3e679c17-f050-4bc8-bfe5-5b9190e7ce40"]={f:Ops.Gl.TextureEffects.FXAA,objName:"Ops.Gl.TextureEffects.FXAA"};Ops.Math.MapRange=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const d=e.inValueFloat("value",0),f=e.inValueFloat("old min",0),p=e.inValueFloat("old max",1),m=e.inValueFloat("new min",-1),g=e.inValueFloat("new max",1),n=e.inValueSelect("Easing",["Linear","Smoothstep","Smootherstep"],"Linear"),v=e.outValue("result",0);e.setPortGroup("Input Range",[f,p]);e.setPortGroup("Output Range",[m,g]);let b=0;let _=0;d.onChange=f.onChange=p.onChange=m.onChange=g.onChange=r;r();n.onChange=function(){if(n.get()=="Smoothstep")b=1;else if(n.get()=="Smootherstep")b=2;else b=0};function r(){const e=m.get();const t=g.get();const n=f.get();const r=p.get();let i=d.get();if(i>=Math.max(r,n)){v.set(t);return}else if(i<=Math.min(r,n)){v.set(e);return}let a=false;const s=Math.min(n,r);const o=Math.max(n,r);if(s!=n)a=true;let l=false;const u=Math.min(e,t);const c=Math.max(e,t);if(u!=e)l=true;let h=0;if(a)h=(o-i)*(c-u)/(o-s);else h=(i-s)*(c-u)/(o-s);if(l)_=c-h;else _=h+u;if(b===0){v.set(_)}else if(b==1){i=Math.max(0,Math.min(1,(_-e)/(t-e)));v.set(e+i*i*(3-2*i)*(t-e))}else if(b==2){i=Math.max(0,Math.min(1,(_-e)/(t-e)));v.set(e+i*i*i*(i*(i*6-15)+10)*(t-e))}}};Ops.Math.MapRange.prototype=new CABLES.Op;CABLES.OPS["2617b407-60a0-4ff6-b4a7-18136cfa7817"]={f:Ops.Math.MapRange,objName:"Ops.Math.MapRange"};Ops.Sidebar.Sidebar=function(){CABLES.Op.apply(this,arguments);const s=this;const n={style_css:" /*\n * SIDEBAR\n  http://danielstern.ca/range.css/#/\n  https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-progress-value\n */\n\n.sidebar-icon-undo\n{\n    width:10px;\n    height:10px;\n    background-image: url(\"data:image/svg+xml;charset=utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='grey' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 7v6h6'/%3E%3Cpath d='M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13'/%3E%3C/svg%3E\");\n    background-size: 19px;\n    background-repeat: no-repeat;\n    top: -19px;\n    margin-top: -7px;\n}\n\n.icon-chevron-down {\n    top: 2px;\n    right: 9px;\n}\n\n.iconsidebar-chevron-up,.sidebar__close-button {\n\tbackground-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n}\n\n.iconsidebar-minimizebutton {\n    background-position: 98% center;\n    background-repeat: no-repeat;\n}\n\n.sidebar-cables-right\n{\n    right: 15px;\n    left: initial !important;\n}\n\n.sidebar-cables {\n    --sidebar-color: #07f78c;\n    --sidebar-width: 220px;\n    --sidebar-border-radius: 10px;\n    --sidebar-monospace-font-stack: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n    --sidebar-hover-transition-time: .2s;\n\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    border-radius: var(--sidebar-border-radius);\n    z-index: 100000;\n    color: #BBBBBB;\n    width: var(  --sidebar-width);\n    max-height: 100%;\n    box-sizing: border-box;\n    overflow-y: auto;\n    overflow-x: hidden;\n    font-size: 13px;\n    font-family: Arial;\n    line-height: 1em; /* prevent emojis from breaking height of the title */\n}\n\n.sidebar-cables::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar-cables::-webkit-scrollbar {\n    background-color: transparent;\n    --cables-scrollbar-width: 8px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-track {\n    background-color: transparent;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-thumb {\n    background-color: #333333;\n    border-radius: 4px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables--closed {\n    width: auto;\n}\n\n.sidebar__close-button {\n    background-color: #222;\n    /*-webkit-user-select: none;  */\n    /*-moz-user-select: none;     */\n    /*-ms-user-select: none;      */\n    /*user-select: none;          */\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    /*color: #CCCCCC;*/\n    height: 2px;\n    /*border-bottom:20px solid #222;*/\n\n    /*box-sizing: border-box;*/\n    /*padding-top: 2px;*/\n    /*text-align: center;*/\n    /*cursor: pointer;*/\n    /*border-radius: 0 0 var(--sidebar-border-radius) var(--sidebar-border-radius);*/\n    /*opacity: 1.0;*/\n    /*transition: opacity 0.3s;*/\n    /*overflow: hidden;*/\n}\n\n.sidebar__close-button-icon {\n    display: inline-block;\n    /*opacity: 0;*/\n    width: 20px;\n    height: 20px;\n    /*position: relative;*/\n    /*top: -1px;*/\n\n\n}\n\n.sidebar--closed {\n    width: auto;\n    margin-right: 20px;\n}\n\n.sidebar--closed .sidebar__close-button {\n    margin-top: 8px;\n    margin-left: 8px;\n    padding:10px;\n\n    height: 25px;\n    width:25px;\n    border-radius: 50%;\n    cursor: pointer;\n    opacity: 0.3;\n    background-repeat: no-repeat;\n    background-position: center center;\n    transform:rotate(180deg);\n}\n\n.sidebar--closed .sidebar__group\n{\n    display:none;\n\n}\n.sidebar--closed .sidebar__close-button-icon {\n    background-position: 0px 0px;\n}\n\n.sidebar__close-button:hover {\n    background-color: #111111;\n    opacity: 1.0 !important;\n}\n\n/*\n * SIDEBAR ITEMS\n */\n\n.sidebar__items {\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5;*/\n    background-color: #222;\n    padding-bottom: 20px;\n}\n\n.sidebar--closed .sidebar__items {\n    /* max-height: 0; */\n    height: 0;\n    display: none;\n    pointer-interactions: none;\n}\n\n.sidebar__item__right {\n    float: right;\n}\n\n/*\n * SIDEBAR GROUP\n */\n\n.sidebar__group {\n    /*background-color: #1A1A1A;*/\n    overflow: hidden;\n    box-sizing: border-box;\n    animate: height;\n    /*background-color: #151515;*/\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5s; */\n--sidebar-group-header-height: 33px;\n}\n\n.sidebar__group-items\n{\n    padding-top: 15px;\n    padding-bottom: 15px;\n}\n\n.sidebar__group--closed {\n    /* max-height: 13px; */\n    height: var(--sidebar-group-header-height);\n}\n\n.sidebar__group-header {\n    box-sizing: border-box;\n    color: #EEEEEE;\n    background-color: #151515;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n\n    /*height: 100%;//var(--sidebar-group-header-height);*/\n\n    padding-top: 7px;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    position: relative;\n}\n\n.sidebar__group-header:hover {\n  background-color: #111111;\n}\n\n.sidebar__group-header-title {\n  /*float: left;*/\n  overflow: hidden;\n  padding: 0 15px;\n  padding-top:5px;\n  padding-bottom:10px;\n  font-weight:bold;\n}\n\n.sidebar__group-header-undo {\n    float: right;\n    overflow: hidden;\n    padding-right: 15px;\n    padding-top:5px;\n    font-weight:bold;\n  }\n\n.sidebar__group-header-icon {\n    width: 17px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    position: absolute;\n    background-size: cover;\n\n    /* icon open */\n    /* feather icon: chevron up */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n    top: 4px;\n    right: 5px;\n    opacity: 0.0;\n    transition: opacity 0.3;\n}\n\n.sidebar__group-header:hover .sidebar__group-header-icon {\n    opacity: 1.0;\n}\n\n/* icon closed */\n.sidebar__group--closed .sidebar__group-header-icon {\n    /* feather icon: chevron down */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);\n    top: 4px;\n    right: 5px;\n}\n\n/*\n * SIDEBAR ITEM\n */\n\n.sidebar__item\n{\n    box-sizing: border-box;\n    padding: 7px;\n    padding-left:15px;\n    padding-right:15px;\n\n    overflow: hidden;\n    position: relative;\n}\n\n.sidebar__item-label {\n    display: inline-block;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    width: calc(50% - 7px);\n    margin-right: 7px;\n    margin-top: 2px;\n    text-overflow: ellipsis;\n    /* overflow: hidden; */\n}\n\n.sidebar__item-value-label {\n    font-family: var(--sidebar-monospace-font-stack);\n    display: inline-block;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    max-width: 60%;\n}\n\n.sidebar__item-value-label::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar__item + .sidebar__item,\n.sidebar__item + .sidebar__group,\n.sidebar__group + .sidebar__item,\n.sidebar__group + .sidebar__group {\n    /*border-top: 1px solid #272727;*/\n}\n\n/*\n * SIDEBAR ITEM TOGGLE\n */\n\n/*.sidebar__toggle */\n.icon_toggle{\n    cursor: pointer;\n}\n\n.sidebar__toggle-input {\n    --sidebar-toggle-input-color: #CCCCCC;\n    --sidebar-toggle-input-color-hover: #EEEEEE;\n    --sidebar-toggle-input-border-size: 2px;\n    display: inline;\n    float: right;\n    box-sizing: border-box;\n    border-radius: 50%;\n    cursor: pointer;\n    --toggle-size: 11px;\n    margin-top: 2px;\n    background-color: transparent !important;\n    border: var(--sidebar-toggle-input-border-size) solid var(--sidebar-toggle-input-color);\n    width: var(--toggle-size);\n    height: var(--toggle-size);\n    transition: background-color var(--sidebar-hover-transition-time);\n    transition: border-color var(--sidebar-hover-transition-time);\n}\n.sidebar__toggle:hover .sidebar__toggle-input {\n    border-color: var(--sidebar-toggle-input-color-hover);\n}\n\n.sidebar__toggle .sidebar__item-value-label {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    max-width: calc(50% - 12px);\n}\n.sidebar__toggle-input::after { clear: both; }\n\n.sidebar__toggle--active .icon_toggle\n{\n\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjMDZmNzhiIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzA2Zjc4YiIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjMDZmNzhiIiBzdHJva2U9IiMwNmY3OGIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwNmY3OGIiIHN0cm9rZT0iIzA2Zjc4YiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    opacity: 1;\n    transform: rotate(0deg);\n}\n\n\n.icon_toggle\n{\n    float: right;\n    width:40px;\n    height:18px;\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjYWFhYWFhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjYWFhYWFhIiBzdHJva2U9IiNhYWFhYWEiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhYWFhYWEiIHN0cm9rZT0iI2FhYWFhYSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    background-size: 50px 37px;\n    background-position: -6px -10px;\n    transform: rotate(180deg);\n    opacity: 0.4;\n}\n\n\n\n/*.sidebar__toggle--active .sidebar__toggle-input {*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    background-color: var(--sidebar-toggle-input-color);*/\n/*}*/\n/*.sidebar__toggle--active .sidebar__toggle-input:hover*/\n/*{*/\n/*    background-color: var(--sidebar-toggle-input-color-hover);*/\n/*    border-color: var(--sidebar-toggle-input-color-hover);*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    transition: border-color var(--sidebar-hover-transition-time);*/\n/*}*/\n\n/*\n * SIDEBAR ITEM BUTTON\n */\n\n.sidebar__button {}\n\n.sidebar__button-input {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    min-height: 24px;\n    background-color: transparent;\n    color: #CCCCCC;\n    box-sizing: border-box;\n    padding-top: 3px;\n    text-align: center;\n    border-radius: 125px;\n    border:2px solid #555;\n    cursor: pointer;\n    padding-bottom: 3px;\n}\n\n.sidebar__button-input.plus, .sidebar__button-input.minus {\n    display: inline-block;\n    min-width: 20px;\n}\n\n.sidebar__button-input:hover {\n  background-color: #333;\n  border:2px solid var(--sidebar-color);\n}\n\n/*\n * VALUE DISPLAY (shows a value)\n */\n\n.sidebar__value-display {}\n\n/*\n * SLIDER\n */\n\n.sidebar__slider {\n    --sidebar-slider-input-height: 3px;\n}\n\n.sidebar__slider-input-wrapper {\n    width: 100%;\n\n    margin-top: 8px;\n    position: relative;\n}\n\n.sidebar__slider-input {\n    -webkit-appearance: none;\n    appearance: none;\n    margin: 0;\n    width: 100%;\n    height: var(--sidebar-slider-input-height);\n    background: #555;\n    cursor: pointer;\n    outline: 0;\n\n    -webkit-transition: .2s;\n    transition: background-color .2s;\n    border: none;\n}\n\n.sidebar__slider-input:focus, .sidebar__slider-input:hover {\n    border: none;\n}\n\n.sidebar__slider-input-active-track {\n    user-select: none;\n    position: absolute;\n    z-index: 11;\n    top: 0;\n    left: 0;\n    background-color: var(--sidebar-color);\n    pointer-events: none;\n    height: var(--sidebar-slider-input-height);\n    max-width: 100%;\n}\n\n/* Mouse-over effects */\n.sidebar__slider-input:hover {\n    /*background-color: #444444;*/\n}\n\n/*.sidebar__slider-input::-webkit-progress-value {*/\n/*    background-color: green;*/\n/*    color:green;*/\n\n/*    }*/\n\n/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */\n\n.sidebar__slider-input::-moz-range-thumb\n{\n    position: absolute;\n    height: 15px;\n    width: 15px;\n    z-index: 900 !important;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: var(--sidebar-color) !important;\n    user-select: none;\n\n}\n\n.sidebar__slider-input::-webkit-slider-thumb\n{\n    position: relative;\n    appearance: none;\n    -webkit-appearance: none;\n    user-select: none;\n    height: 15px;\n    width: 15px;\n    display: block;\n    z-index: 900 !important;\n    border: 0;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: #777 !important;\n}\n\n.sidebar__slider-input:hover ::-webkit-slider-thumb {\n    background-color: #EEEEEE !important;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb {*/\n\n/*    width: 0 !important;*/\n/*    height: var(--sidebar-slider-input-height);*/\n/*    background: #EEEEEE;*/\n/*    cursor: pointer;*/\n/*    border-radius: 0 !important;*/\n/*    border: none;*/\n/*    outline: 0;*/\n/*    z-index: 100 !important;*/\n/*}*/\n\n.sidebar__slider-input::-moz-range-track {\n    background-color: transparent;\n    z-index: 11;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb:hover {*/\n  /* background-color: #EEEEEE; */\n/*}*/\n\n\n/*.sidebar__slider-input-wrapper:hover .sidebar__slider-input-active-track {*/\n/*    background-color: #EEEEEE;*/\n/*}*/\n\n/*.sidebar__slider-input-wrapper:hover .sidebar__slider-input::-moz-range-thumb {*/\n/*    background-color: #fff !important;*/\n/*}*/\n\n/*.sidebar__slider-input-wrapper:hover .sidebar__slider-input::-webkit-slider-thumb {*/\n/*    background-color: #EEEEEE;*/\n/*}*/\n\n.sidebar__slider input[type=text] {\n    box-sizing: border-box;\n    /*background-color: #333333;*/\n    text-align: right;\n    color: #BBBBBB;\n    display: inline-block;\n    background-color: transparent !important;\n\n    width: 40%;\n    height: 18px;\n    outline: none;\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__slider input[type=text]:active,\n.sidebar__slider input[type=text]:focus,\n.sidebar__slider input[type=text]:hover {\n\n    color: #EEEEEE;\n}\n\n/*\n * TEXT / DESCRIPTION\n */\n\n.sidebar__text .sidebar__item-label {\n    width: auto;\n    display: block;\n    max-height: none;\n    margin-right: 0;\n    line-height: 1.1em;\n}\n\n/*\n * SIDEBAR INPUT\n */\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: 50%;\n    height: 18px;\n    outline: none;\n    border: none;\n    border-radius: 0;\n    border:1px solid #666;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__text-input textarea:focus::placeholder {\n  color: transparent;\n}\n\n.sidebar__color-picker .sidebar__item-label\n{\n    width:45%;\n}\n\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text]:active,\n.sidebar__text-input input[type=text]:focus,\n.sidebar__text-input input[type=text]:hover {\n    background-color: transparent;\n    color: #EEEEEE;\n}\n\n.sidebar__text-input textarea\n{\n    margin-top:10px;\n    height:60px;\n    width:100%;\n}\n\n/*\n * SIDEBAR SELECT\n */\n\n\n\n .sidebar__select {}\n .sidebar__select-select {\n    color: #BBBBBB;\n    /*-webkit-appearance: none;*/\n    /*-moz-appearance: none;*/\n    appearance: none;\n    /*box-sizing: border-box;*/\n    width: 50%;\n    /*height: 20px;*/\n    background-color: #333333;\n    /*background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);*/\n    background-repeat: no-repeat;\n    background-position: right center;\n    background-size: 16px 16px;\n    margin: 0;\n    /*padding: 0 2 2 6px;*/\n    border-radius: 5px;\n    border: 1px solid #777;\n    background-color: #444;\n    cursor: pointer;\n    outline: none;\n    padding-left: 5px;\n\n }\n\n.sidebar__select-select:hover,\n.sidebar__select-select:active,\n.sidebar__select-select:active {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\n/*\n * COLOR PICKER\n */\n\n\n .sidebar__color-picker input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: calc(50% - 21px); /* 50% minus space of picker circle */\n    height: 18px;\n    outline: none;\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    margin-right: 7px;\n}\n\n.sidebar__color-picker input[type=text]:active,\n.sidebar__color-picker input[type=text]:focus,\n.sidebar__color-picker input[type=text]:hover {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\ndiv.sidebar__color-picker-color-input,\n.sidebar__color-picker input[type=color],\n.sidebar__palette-picker input[type=color] {\n    display: inline-block;\n    border-radius: 100%;\n    height: 14px;\n    width: 14px;\n\n    padding: 0;\n    border: none;\n    /*border:2px solid red;*/\n    border-color: transparent;\n    outline: none;\n    background: none;\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    position: relative;\n    top: 3px;\n}\n.sidebar__color-picker input[type=color]:focus,\n.sidebar__palette-picker input[type=color]:focus {\n    outline: none;\n}\n.sidebar__color-picker input[type=color]::-moz-color-swatch,\n.sidebar__palette-picker input[type=color]::-moz-color-swatch {\n    border: none;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch-wrapper,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch-wrapper {\n    padding: 0;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch {\n    border: none;\n    border-radius: 100%;\n}\n\n/*\n * Palette Picker\n */\n.sidebar__palette-picker .sidebar__palette-picker-color-input.first {\n    margin-left: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input.last {\n    margin-right: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input {\n    margin: 0 4px;\n}\n\n.sidebar__palette-picker .circlebutton {\n    width: 14px;\n    height: 14px;\n    border-radius: 1em;\n    display: inline-block;\n    top: 3px;\n    position: relative;\n}\n\n/*\n * Preset\n */\n.sidebar__item-presets-preset\n{\n    padding:4px;\n    cursor:pointer;\n    padding-left:8px;\n    padding-right:8px;\n    margin-right:4px;\n    background-color:#444;\n}\n\n.sidebar__item-presets-preset:hover\n{\n    background-color:#666;\n}\n\n.sidebar__greyout\n{\n    background: #222;\n    opacity: 0.8;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1000;\n    right: 0;\n    top: 0;\n}\n\n.sidebar_tabs\n{\n    background-color: #151515;\n    padding-bottom: 0px;\n}\n\n.sidebar_switchs\n{\n    float: right;\n}\n\n.sidebar_tab\n{\n    float:left;\n    background-color: #151515;\n    border-bottom:1px solid transparent;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_tab_active\n{\n    background-color: #272727;\n    color:white;\n}\n\n.sidebar_tab:hover\n{\n    border-bottom:1px solid #777;\n    color:white;\n}\n\n\n.sidebar_switch\n{\n    float:left;\n    background-color: #444;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_switch:last-child\n{\n    border-top-right-radius: 7px;\n    border-bottom-right-radius: 7px;\n}\n\n.sidebar_switch:first-child\n{\n    border-top-left-radius: 7px;\n    border-bottom-left-radius: 7px;\n}\n\n\n.sidebar_switch_active\n{\n    background-color: #999;\n    color:white;\n}\n\n.sidebar_switch:hover\n{\n    color:white;\n}\n"};const r="cables-sidebar-style";const i="cables-sidebar-dynamic-style";const o="sidebar-cables";const l="sidebar"+CABLES.uuid();const u="sidebar__items";const c="sidebar__close-button";const a="";const h="";let d=null;let e=null;let f=null;const t=s.inValueBool("Visible",true);const p=s.inValueSlider("Opacity",1);const m=s.inValueBool("Default Minimized");const g=s.inValueSlider("Minimized Opacity",.5);const v=s.inValueBool("Show undo button",false);const b=s.inValueBool("Show Minimize",false);const _=s.inString("Title","Sidebar");const F=s.inValueBool("Side");const C=s.outObject("childs");C.setUiAttribs({title:"Children"});const A=s.outBool("Opfened");A.setUiAttribs({title:"Opened"});let E=document.querySelector("."+l);if(!E){E=N()}const x=E.querySelector("."+u);C.set({parentElement:x,parentOp:s});I();M();w();t.onChange=T;p.onChange=S;m.onChange=I;g.onChange=B;v.onChange=y;s.onDelete=P;function B(){w()}b.onChange=D;function D(e){if(!e||e.uiAttribs)e=document.querySelector(".sidebar-cables .sidebar__group-header");if(!e)return;const t=document.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(b.get()){e.classList.add("iconsidebar-chevron-up");e.classList.add("iconsidebar-minimizebutton");if(t)t.style.marginRight="20px"}else{e.classList.remove("iconsidebar-chevron-up");e.classList.remove("iconsidebar-minimizebutton");if(t)t.style.marginRight="initial"}}F.onChange=function(){if(F.get())E.classList.add("sidebar-cables-right");else E.classList.remove("sidebar-cables-right")};function y(){const e=document.querySelector(".sidebar-cables .sidebar__group-header");if(e){O(e)}}function O(e){if(e){const t=document.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(t){if(!v.get()){t.remove()}}else{if(v.get()){const n=document.createElement("span");n.classList.add("sidebar__group-header-undo");n.classList.add("sidebar-icon-undo");n.addEventListener("click",function(e){e.stopPropagation();const t=document.querySelectorAll(".sidebar-cables .sidebar__reloadable");const n=document.createEvent("MouseEvents");n.initEvent("dblclick",true,true);t.forEach(e=>{e.dispatchEvent(n)})});e.appendChild(n)}}}D(e)}function I(){if(!d){return}if(m.get()){E.classList.add("sidebar--closed");if(t.get()){A.set(false)}}else{E.classList.remove("sidebar--closed");if(t.get()){A.set(true)}}}function S(){const e=p.get();E.style.opacity=e}function T(){if(t.get()){E.style.display="block";if(!E.classList.contains("sidebar--closed")){A.set(true)}}else{E.style.display="none";A.set(false)}}F.onChanged=function(){};function w(){const e=document.querySelectorAll("."+i);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}const t=document.createElement("style");t.classList.add(i);let n=".sidebar--closed .sidebar__close-button { ";n+="opacity: "+g.get();n+="}";const r=document.createTextNode(n);t.appendChild(r);document.body.appendChild(t)}function N(){const e=document.createElement("div");e.classList.add(o);e.classList.add(l);const t=s.patch.cgl.canvas.parentElement;const n=document.createElement("div");n.classList.add("sidebar__group");e.appendChild(n);const r=document.createElement("div");r.classList.add("sidebar__group-header");e.appendChild(r);const i=document.createElement("span");i.classList.add("sidebar__group-header-title");f=document.createElement("span");f.classList.add("sidebar__group-header-title-text");f.innerHTML=_.get();i.appendChild(f);r.appendChild(i);O(r);D(r);n.appendChild(r);e.appendChild(n);n.addEventListener("click",k);if(!t){s.warn("[sidebar] no canvas parentelement found...");return}t.appendChild(e);const a=document.createElement("div");a.classList.add(u);e.appendChild(a);d=document.createElement("div");d.classList.add(c);d.addEventListener("click",k);e.appendChild(d);return e}_.onChange=function(){if(f)f.innerHTML=_.get()};function L(e){}function k(e){e.stopPropagation();if(!E){s.logError("Sidebar could not be closed...");return}E.classList.toggle("sidebar--closed");const t=e.target;let n=a;if(E.classList.contains("sidebar--closed")){n=h;A.set(false)}else{A.set(true)}}function M(){const e=document.querySelectorAll("."+r);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}const t=document.createElement("style");t.innerHTML=n.style_css;t.classList.add(r);document.body.appendChild(t)}function P(){V(E)}function V(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}};Ops.Sidebar.Sidebar.prototype=new CABLES.Op;CABLES.OPS["5a681c35-78ce-4cb3-9858-bc79c34c6819"]={f:Ops.Sidebar.Sidebar,objName:"Ops.Sidebar.Sidebar"};Ops.Trigger.TriggerReceive=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const t=r.outTrigger("Triggered");r.varName=r.inValueSelect("Named Trigger",[],"",true);a();r.patch.addEventListener("namedTriggersChanged",a);let n=null;function i(){t.trigger()}function a(){if(CABLES.UI){let t=[];let n=r.patch.namedTriggers;for(let e in n)t.push(e);r.varName.uiAttribs.values=t}}r.varName.onChange=function(){if(n){let e=r.patch.namedTriggers[n];let t=e.indexOf(i);if(t!=-1)e.splice(t,1)}r.setTitle(">"+r.varName.get());r.patch.namedTriggers[r.varName.get()]=r.patch.namedTriggers[r.varName.get()]||[];let e=r.patch.namedTriggers[r.varName.get()];e.push(i);n=r.varName.get();s();r.patch.emitEvent("opTriggerNameChanged",r,r.varName.get())};r.on("uiParamPanel",s);function s(){if(!r.varName.get()){r.setUiError("unknowntrigger","unknown trigger")}else r.setUiError("unknowntrigger",null)}};Ops.Trigger.TriggerReceive.prototype=new CABLES.Op;CABLES.OPS["0816c999-f2db-466b-9777-2814573574c5"]={f:Ops.Trigger.TriggerReceive,objName:"Ops.Trigger.TriggerReceive"};Ops.Sidebar.DropDown_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("Link");const r=t.inString("Text","Value");const i=t.inArray("Values");const a=t.inString("Default","");const s=t.inBool("Grey Out",false);const o=t.inBool("Visible",true);const l=t.inInt("Lines",1);const u=t.inTriggerButton("Set Default");u.onTriggered=S;const c=t.outObject("Children");const h=t.outString("Result",a.get());const d=t.outNumber("Index");const f=document.createElement("div");f.addEventListener("dblclick",function(){h.set(a.get());const e=g.querySelectorAll("option");e.forEach(function(e,t){if(e.value.trim()===a.get()){e.selected=true;d.set(t)}else{e.removeAttribute("selected")}})});f.dataset.op=t.id;f.classList.add("cablesEle");f.classList.add("sidebar__item");f.classList.add("sidebar__select");f.classList.add("sidebar__reloadable");const p=document.createElement("div");p.classList.add("sidebar__item-label");const m=document.createTextNode(r.get());p.appendChild(m);f.appendChild(p);const g=document.createElement("select");g.classList.add("sidebar__select-select");f.appendChild(g);g.addEventListener("input",A);const v=document.createElement("div");v.classList.add("sidebar__greyout");f.appendChild(v);v.style.display="none";s.onChange=function(){v.style.display=s.get()?"block":"none"};o.onChange=function(){f.style.display=o.get()?"block":"none"};n.onChange=B;r.onChange=x;a.onChange=E;t.onDelete=O;i.onChange=_;let b=[];l.onChange=()=>{g.setAttribute("size",l.get())};t.onLoaded=function(){h.set(a.get())};function _(){while(g.lastChild){g.removeChild(g.lastChild)}b=i.get();const r=a.get();if(b){b.forEach(function(e){const t=document.createElement("option");t.setAttribute("value",e);if(e===r||e===h.get()){t.setAttribute("selected","")}const n=document.createTextNode(e);t.appendChild(n);g.appendChild(t)})}else{h.set("")}d.set(0);C()}let F=0;function C(e){const t=g.querySelectorAll("option");let n=null;t.forEach(function(e,t){if(e.value.trim()===h.get()){n=e;F=t}e.removeAttribute("selected")});if(e){const r=a.get()+"".trim();t.forEach(function(e,t){if(e.value.trim()===r){n=e;F=t}e.removeAttribute("selected")})}if(n)n.setAttribute("selected","");d.set(F)}function A(e){h.set(e.target.value);d.set(b.indexOf(e.target.value));C()}function E(){const e=a.get();h.set(e);g.value=e;C()}function x(){const e=r.get();p.textContent=e;if(CABLES.UI){t.setTitle("Dropdown: "+e)}}function B(){c.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(f);c.set(e)}else{if(f.parentElement){f.parentElement.removeChild(f)}}}function D(e){if(e){e.style.display="block"}C()}function y(e){if(e){e.style.display="none"}}function O(){I(f)}function I(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}function S(){a.set(g.value);if(CABLES.UI&&t.isCurrentUiOp()){gui.opParams.show(t)}}};Ops.Sidebar.DropDown_v2.prototype=new CABLES.Op;CABLES.OPS["7b3f93d6-4de1-41fd-aa26-e74c8285c662"]={f:Ops.Sidebar.DropDown_v2,objName:"Ops.Sidebar.DropDown_v2"};Ops.Sidebar.Button_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("link");const r=t.inString("Text","Button");const i=t.outObject("childs");const a=t.outTrigger("Pressed Trigger");const s=t.inBool("Grey Out",false);const o=t.inBool("Visible",true);const l=document.createElement("div");l.dataset.op=t.id;l.classList.add("cablesEle");l.classList.add("sidebar__item");l.classList.add("sidebar--button");const u=document.createElement("div");u.classList.add("sidebar__button-input");l.appendChild(u);u.addEventListener("click",d);const c=document.createTextNode(r.get());u.appendChild(c);t.toWorkNeedsParent("Ops.Sidebar.Sidebar");n.onChange=p;r.onChange=f;t.onDelete=v;const h=document.createElement("div");h.classList.add("sidebar__greyout");l.appendChild(h);h.style.display="none";s.onChange=function(){h.style.display=s.get()?"block":"none"};o.onChange=function(){l.style.display=o.get()?"block":"none"};function d(){a.trigger()}function f(){const e=r.get();u.textContent=e;if(CABLES.UI){t.setTitle("Button: "+e)}}function p(){i.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(l);i.set(e)}else{if(l.parentElement){l.parentElement.removeChild(l)}}}function m(e){if(e){e.style.display="block"}}function g(e){if(e){e.style.display="none"}}function v(){b(l)}function b(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.Button_v2.prototype=new CABLES.Op;CABLES.OPS["5e9c6933-0605-4bf7-8671-a016d917f327"]={f:Ops.Sidebar.Button_v2,objName:"Ops.Sidebar.Button_v2"};Ops.Sidebar.LocalFileToDataUrl=function(){CABLES.Op.apply(this,arguments);const n=this;const e={};const t=n.inObject("link");const r=n.inString("Text","Select File:");const i=n.inValueString("Id","");const a=n.inBool("Visible",true);const s=n.inBool("Grey Out",false);const o=n.inTriggerButton("Show Dialog");const l=n.inTriggerButton("Reset");const u=n.outObject("childs");const c=n.outString("Data URL");c.ignoreValueSerialize=true;const h=document.createElement("div");h.dataset.op=n.id;h.classList.add("cablesEle");h.classList.add("sidebar__item");h.classList.add("sidebar__text");const d=document.createElement("div");d.classList.add("sidebar__item-label");const f=document.createTextNode(r.get());d.appendChild(f);h.appendChild(d);const p=document.createElement("input");p.type="file";p.id="file";p.name="file";p.style["background-color"]="transparent";p.style.width="90%";p.style.display="none";const m=document.createElement("div");m.style.cursor="pointer";m.style.position="absolute";m.style.right="10px";m.style["margin-top"]="15px";m.innerHTML="&nbsp;&nbsp;✕";const g=document.createElement("div");g.classList.add("sidebar__button-input");g.innerHTML="Choose File";g.onclick=()=>{p.click()};o.onTriggered=()=>{g.click()};g.style["margin-top"]="10px";g.style.width="80%";h.appendChild(m);h.appendChild(g);h.appendChild(p);const v=document.createElement("img");p.addEventListener("change",F,false);const b=document.createElement("div");b.classList.add("sidebar__greyout");h.appendChild(b);b.style.display="none";s.onChange=function(){b.style.display=s.get()?"block":"none"};a.onChange=function(){h.style.display=a.get()?"block":"none"};function _(){p.value="";c.set("")}l.onTriggered=_;m.addEventListener("click",_);function F(e){const t=new FileReader;t.onabort=function(e){n.log("File read cancelled")};t.onload=function(e){c.set(e.target.result)};if(e.target.files[0])t.readAsDataURL(e.target.files[0]);else c.set("")}t.onChange=E;r.onChange=A;i.onChange=C;n.onDelete=D;n.toWorkNeedsParent("Ops.Sidebar.Sidebar");function C(){h.id=i.get()}function A(){const e=r.get();d.textContent=e}function E(){u.set(null);const e=t.get();if(e&&e.parentElement){e.parentElement.appendChild(h);u.set(e)}else{if(h.parentElement){h.parentElement.removeChild(h)}}}function x(e){if(e){e.style.display="block"}}function B(e){if(e){e.style.display="none"}}function D(){y(h)}function y(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.LocalFileToDataUrl.prototype=new CABLES.Op;CABLES.OPS["c99d271e-aa5e-4a9d-a4d3-4c5137c189e8"]={f:Ops.Sidebar.LocalFileToDataUrl,objName:"Ops.Sidebar.LocalFileToDataUrl"};Ops.Json.AjaxRequest_v2=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};const a=i.inUrl("file"),s=i.inValueBool("JsonP",false),o=i.inObject("headers",{}),l=i.inStringEditor("body",""),u=i.inDropDown("HTTP Method",["GET","POST","PUT","DELETE","PATCH","HEAD","CONNECT","OPTIONS","TRACE"],"GET"),c=i.inString("Content-Type","application/json"),h=i.inBool("parse json",true),d=i.inBool("Auto request",true),t=i.inTriggerButton("reload"),f=i.outObject("data"),p=i.outString("response"),m=i.outValue("Is Loading",false),g=i.outTrigger("Loaded");a.setUiAttribs({title:"URL"});t.setUiAttribs({buttonTitle:"trigger request"});f.ignoreValueSerialize=true;p.ignoreValueSerialize=true;d.onChange=a.onChange=s.onChange=o.onChange=u.onChange=h.onChange=function(){r(false)};t.onTriggered=function(){r(true)};let v=0;let n=0;function r(e=false){clearTimeout(n);n=setTimeout(function(){b(null,e)},100)}i.onFileChanged=function(e){if(a.get()&&a.get().indexOf(e)>-1)b(true)};function b(e,t=false){if(!d.get()&&!t)return;if(!a.get())return;i.patch.loading.finished(v);v=i.patch.loading.start("jsonFile",""+a.get());m.set(true);i.setUiAttrib({extendTitle:CABLES.basename(a.get())});i.setUiError("jsonerr",null);let n=CABLES.ajax;if(s.get())n=CABLES.jsonp;let r=i.patch.getFilePath(a.get());if(e)r+="?rnd="+CABLES.generateUUID();i.patch.loading.addAssetLoadingTask(()=>{const e=l.get();n(r,(e,t,n)=>{if(e){i.patch.loading.finished(v);m.set(false);i.logError(e);return}try{let e=t;f.set(null);if(typeof e==="string"&&h.get()){e=JSON.parse(t);f.set(e)}p.set(null);p.set(t);i.uiAttr({error:null});i.patch.loading.finished(v);g.trigger();m.set(false)}catch(e){i.logError(e);i.setUiError("jsonerr","Problem while loading json:<br/>"+e);i.patch.loading.finished(v);m.set(false)}},u.get(),e&&e.length>0?e:null,c.get(),null,o.get()||{})})}};Ops.Json.AjaxRequest_v2.prototype=new CABLES.Op;CABLES.OPS["e0879058-5505-4dc4-b9ff-47a3d3c8a71a"]={f:Ops.Json.AjaxRequest_v2,objName:"Ops.Json.AjaxRequest_v2"};Ops.Json.GateObject=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inObject("Object In"),r=e.inValueBool("Pass Through",false),i=e.inValueBool("Only Valid Objects",false),a=e.outObject("Object Out");n.onChange=r.onChange=s;n.changeAlways=true;function s(){if(!n.get()&&i.get())return;if(r.get())a.set(n.get())}};Ops.Json.GateObject.prototype=new CABLES.Op;CABLES.OPS["95e04331-49d6-42da-81d8-5a75261ab22f"]={f:Ops.Json.GateObject,objName:"Ops.Json.GateObject"};Ops.Boolean.TriggerBoolean=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};var n=e.inTriggerButton("True");var r=e.inTriggerButton("false");var i=e.outValueBool("Result");n.onTriggered=function(){i.set(true)};r.onTriggered=function(){i.set(false)}};Ops.Boolean.TriggerBoolean.prototype=new CABLES.Op;CABLES.OPS["31f65abe-9d6c-4ba6-a291-ef2de41d2087"]={f:Ops.Boolean.TriggerBoolean,objName:"Ops.Boolean.TriggerBoolean"};Ops.Sidebar.SidebarText_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("link");const r=t.inString("Text","Value");const i=t.inValueString("Id","");const a=t.outObject("childs");const s=document.createElement("div");s.dataset.op=t.id;s.classList.add("cablesEle");s.classList.add("sidebar__item");s.classList.add("sidebar__text");const o=document.createElement("div");o.classList.add("sidebar__item-label");const l=document.createElement("div");o.appendChild(l);s.appendChild(o);n.onChange=h;r.onChange=c;i.onChange=u;t.onDelete=p;t.toWorkNeedsParent("Ops.Sidebar.Sidebar");function u(){s.id=i.get()}function c(){const e=r.get();o.innerHTML=e;if(CABLES.UI){if(e&&typeof e==="string"){t.setTitle("Text: "+e.substring(0,10))}else{t.setTitle("Text")}}}function h(){a.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(s);a.set(e)}else{if(s.parentElement){s.parentElement.removeChild(s)}}}function d(e){if(e){e.style.display="block"}}function f(e){if(e){e.style.display="none"}}function p(){m(s)}function m(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.SidebarText_v2.prototype=new CABLES.Op;CABLES.OPS["cc591cc3-ff23-4817-907c-e5be7d5c059d"]={f:Ops.Sidebar.SidebarText_v2,objName:"Ops.Sidebar.SidebarText_v2"};Ops.Sidebar.Group=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};let n=t.inObject("link");let r=t.inString("Text","Group");const i=t.inBool("Show Title",true);let a=t.inValueBool("Default Minimized");const s=t.inBool("Visible",true);let o=t.outObject("next");let l=t.outObject("childs");s.onChange=function(){u.style.display=s.get()?"block":"none"};var u=document.createElement("div");u.dataset.op=t.id;u.classList.add("sidebar__group");m();let c=document.createElement("div");c.classList.add("sidebar__group-header");c.classList.add("cablesEle");u.appendChild(c);c.addEventListener("click",g);let h=document.createElement("div");h.classList.add("sidebar__group-header-title");c.appendChild(h);let d=document.createElement("span");d.textContent=r.get();d.classList.add("sidebar__group-header-title-text");h.appendChild(d);let f=document.createElement("span");f.classList.add("sidebar__group-header-icon");f.classList.add("iconsidebar-chevron-up");h.appendChild(f);let p=document.createElement("div");p.classList.add("sidebar__group-items");u.appendChild(p);t.toWorkPortsNeedToBeLinked(n);n.onChange=b;r.onChange=v;a.onChange=m;t.onDelete=C;i.onChange=()=>{if(i.get())c.style.display="block";else c.style.display="none"};function m(){if(a.get()){u.classList.add("sidebar__group--closed")}else{u.classList.remove("sidebar__group--closed")}}function g(e){e.stopPropagation();u.classList.toggle("sidebar__group--closed")}function v(){let e=r.get();d.textContent=e;if(CABLES.UI){t.setTitle("Group: "+e)}}function b(){l.set(null);let e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(u);l.set({parentElement:p,parentOp:t});o.set(e)}else{if(u.parentElement){u.parentElement.removeChild(u)}}}function _(e){if(e){e.style.display="block"}}function F(e){if(e){e.style.display="none"}}function C(){A(u)}function A(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.Group.prototype=new CABLES.Op;CABLES.OPS["86ea2333-b51c-48ed-94c2-8b7b6e9ff34c"]={f:Ops.Sidebar.Group,objName:"Ops.Sidebar.Group"};Ops.Vars.VarSetObject_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inObject("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"object",n,e.varName)};Ops.Vars.VarSetObject_v2.prototype=new CABLES.Op;CABLES.OPS["c7608375-5b45-4bca-87ef-d0c5e970779a"]={f:Ops.Vars.VarSetObject_v2,objName:"Ops.Vars.VarSetObject_v2"};Ops.Json.SaveJsonFile=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTriggerButton("download"),r=e.inString("Filename","jsonexport"),i=e.inObject("Object");n.onTriggered=function(){const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i.get(),null,2));const t=document.createElement("a");t.setAttribute("href",e);t.setAttribute("download",r.get()+".json");t.click();t.remove()}};Ops.Json.SaveJsonFile.prototype=new CABLES.Op;CABLES.OPS["04596a28-9563-4f42-8756-2d2a831baa60"]={f:Ops.Json.SaveJsonFile,objName:"Ops.Json.SaveJsonFile"};Ops.Vars.VarGetObject_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.outObject("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"object",e.varName,n)};Ops.Vars.VarGetObject_v2.prototype=new CABLES.Op;CABLES.OPS["321419d9-69c7-4310-a327-93d310bc2b8e"]={f:Ops.Vars.VarGetObject_v2,objName:"Ops.Vars.VarGetObject_v2"};Ops.Array.ArrayLength=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("array"),r=e.outNumber("length");r.ignoreValueSerialize=true;function i(){let e=0;if(n.get())e=n.get().length;else e=-1;r.set(e)}n.onChange=i};Ops.Array.ArrayLength.prototype=new CABLES.Op;CABLES.OPS["ea508405-833d-411a-86b4-1a012c135c8a"]={f:Ops.Array.ArrayLength,objName:"Ops.Array.ArrayLength"};Ops.Sidebar.DisplayValue_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("link");const r=t.inString("Text","Value");const i=t.inString("Value","");const a=t.outObject("childs");const s=document.createElement("div");s.dataset.op=t.id;s.classList.add("cablesEle");s.classList.add("sidebar__item");s.classList.add("sidebar__value-display");const o=document.createElement("div");o.classList.add("sidebar__item-label");const l=document.createTextNode(r.get());o.appendChild(l);s.appendChild(o);const u=document.createElement("div");u.textContent=i.get();u.classList.add("sidebar__item-value-label");s.appendChild(u);n.onChange=d;r.onChange=h;i.onChange=c;t.onDelete=m;function c(){u.textContent=i.get()}function h(){const e=r.get();o.textContent=e;if(CABLES.UI){t.setTitle("Value: "+e)}}function d(){a.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(s);a.set(e)}else{if(s.parentElement){s.parentElement.removeChild(s)}}}function f(e){if(e){e.style.display="block"}}function p(e){if(e){e.style.display="none"}}function m(){g(s)}function g(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.DisplayValue_v2.prototype=new CABLES.Op;CABLES.OPS["3dd9927e-0d34-4442-8a8a-0ab843aee6e3"]={f:Ops.Sidebar.DisplayValue_v2,objName:"Ops.Sidebar.DisplayValue_v2"};Ops.String.NumberToString_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValue("Number"),r=e.outString("Result");n.onChange=i;i();function i(){r.set(String(n.get()||0))}};Ops.String.NumberToString_v2.prototype=new CABLES.Op;CABLES.OPS["5c6d375a-82db-4366-8013-93f56b4061a9"]={f:Ops.String.NumberToString_v2,objName:"Ops.String.NumberToString_v2"};Ops.User.dave_p.ColorCurator=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("Add Color"),r=e.inTrigger("Remove Color"),i=e.inInt("Input Color Palette Index",0),a=e.inInt("Selected Index",0),s=e.inObject("Load Color Object");const o=e.outArray("Color Indexes Array"),l=e.outObject("Color Indexes Object"),u=e.outNumber("Color Index");var c=0;var h=[];a.onChange=d;s.onChange=f;function d(){u.set(h[a.get()])}function f(){h=Object.values(s.get());o.set(h);l.set(s.get())}n.onTriggered=function(){if(h.includes(i.get())){return}else{h.unshift(i.get());o.set(null);o.set(h);l.set(null);l.set(Object.assign({},h));c++}};r.onTriggered=function(){h.splice(a.get(),1);o.set(null);o.set(h);l.set(null);l.set(Object.assign({},h))}};Ops.User.dave_p.ColorCurator.prototype=new CABLES.Op;Ops.Math.Floor=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValue("Number");const r=e.outValue("Result");n.onChange=i;function i(){r.set(Math.floor(n.get()))}};Ops.Math.Floor.prototype=new CABLES.Op;CABLES.OPS["0c77617c-b688-4b55-addf-2cbcaabf98af"]={f:Ops.Math.Floor,objName:"Ops.Math.Floor"};Ops.Json.ObjectValues=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inObject("Object"),r=e.outValue("Num values"),i=e.outArray("Values");n.onChange=()=>{const e=n.get();if(!e){r.set(0);i.set([]);return}const t=Object.values(e);r.set(t.length);i.set(t)}};Ops.Json.ObjectValues.prototype=new CABLES.Op;CABLES.OPS["32ff73f5-7947-42b0-83fa-e079af7beb5c"]={f:Ops.Json.ObjectValues,objName:"Ops.Json.ObjectValues"};Ops.Array.ArrayGetNumber=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("array"),r=e.inValueInt("index"),i=e.outNumber("value");n.ignoreValueSerialize=true;r.onChange=n.onChange=a;function a(){if(n.get()){let e=n.get()[r.get()];if(isNaN(e)){i.set(0);return}i.set(e)}}};Ops.Array.ArrayGetNumber.prototype=new CABLES.Op;CABLES.OPS["d1189078-70cf-437d-9a37-b2ebe89acdaf"]={f:Ops.Array.ArrayGetNumber,objName:"Ops.Array.ArrayGetNumber"};Ops.Gl.RenderAnim_v2=function(){CABLES.Op.apply(this,arguments);const o=this;const e={};const t=o.inTrigger("Render"),l=o.outTrigger("Next"),u=o.inDropDown("File Type",["PNG","JPG","WebP","WebM"],"PNG"),n=o.inBool("ZIP multiple files",false),c=o.inBool("Download Files",true),r=o.inString("Filename","cables"),h=o.inFloatSlider("Quality",.8),i=o.inSwitch("Duration Type",["Seconds","Frames"],"Seconds"),a=o.inInt("Duration",1),s=o.inInt("FPS",30),d=o.inValueBool("Transparency",false),f=o.inValueBool("Use Canvas Size",true),p=o.inValueInt("texture width",512),m=o.inValueInt("texture height",512),g=o.inTriggerButton("Start"),v=o.outNumber("Progress",0),b=o.outNumber("Frame",0),_=o.outString("Status","Waiting"),F=o.outBool("Started"),C=o.outString("Data URL"),A=o.outTrigger("Finished");o.setPortGroup("File",[u,n,c,r,h]);o.setPortGroup("Size",[f,p,m]);o.setPortGroup("Timing",[s,i,a]);C.ignoreValueSerialize=true;t.onTriggered=j;let E=false;let x=0;const B=true;let D=30;let y=31;const O=false;let I=CABLES.shortId();let S=false;const T=[];let w=-1;let N=0;let L="";let k=null;let M=o.patch.cgl.canvasWidth;let P=o.patch.cgl.canvasHeight;u.onChange=V;f.onChange=U;V();U();n.onChange=()=>{k=null};function V(){h.setUiAttribs({greyout:u.get()=="PNG"})}function U(){p.setUiAttribs({greyout:f.get()});m.setUiAttribs({greyout:f.get()})}g.onTriggered=function(){L=r.get();o.log("pref",L);T.length=0;_.set("Starting");D=s.get();y=a.get()*D;if(i.get()=="Frames")y=a.get();I=CABLES.shortId();R();if(n.get())k=new JSZip;if(!f.get()){M=CABLES.patch.cgl.canvasWidth;P=CABLES.patch.cgl.canvasHeight;o.patch.cgl.setSize(p.get()/CABLES.patch.cgl.pixelDensity,m.get()/CABLES.patch.cgl.pixelDensity);o.patch.cgl.updateSize()}if(y==0){x=0;E=true}else{x=-20;E=true;w=-9999}};function R(){if(y>=0){N=Math.max(0,x*(1/D));o.patch.timer.setTime(N);CABLES.overwriteTime=N;o.patch.freeTimer.setTime(N)}}function G(){E=false;CABLES.overwriteTime=undefined;_.set("Finished")}function j(){F.set(E);if(!E){l.trigger();return}const e=CABLES.internalNow;if(E){CABLES.internalNow=function(){return N*1e3};R()}if(w==x){l.trigger();return}w=x;let t=x/y;if(t<0)t=0;v.set(t);b.set(x);l.trigger();CABLES.internalNow=e;S=false;if(x>y){o.log("FINISHED...");o.log("ffmpeg -y -framerate 30 -f image2 -i "+L+"_%d.png  -b 9999k -vcodec mpeg4 "+I+".mp4");if(!f.get()){o.patch.cgl.setSize(M,P);o.patch.cgl.updateSize()}if(k){k.generateAsync({type:"blob"}).then(function(e){const t=document.createElement("a");t.download=L+".zip";t.href=URL.createObjectURL(e);if(c.get()){t.click()}G();if(C.isLinked()){z(e,e=>{C.set(e);A.trigger()})}else{C.set(null);A.trigger()}})}else if(u.get()=="WebM"){try{_.set("Creating Video File from frames");o.log("webm frames",T.length);const i=Whammy.fromImageArray(T,D);const a=window.URL.createObjectURL(i);const s=document.createElement("a");s.setAttribute("download",L+".webm");s.setAttribute("href",a);document.body.appendChild(s);if(c.get()){s.click()}G();if(C.isLinked()){z(i,e=>{C.set(e);A.trigger()})}else{C.set(null);A.trigger()}}catch(e){o.logError(e)}T.length=0}else G();return}let n="image/png";let r="png";if(u.get()=="JPG"){n="image/jpeg";r="jpg"}else if(u.get()=="WebP"){n="image/webp";r="webp"}if(x>0){_.set("Rendering Frame "+x+" of "+y);o.log("Rendering Frame "+x+" of "+y,N);if(u.get()=="WebM"){T.push(o.patch.cgl.canvas.toDataURL("image/webp",h.get()*.999));x++;R()}else{o.log("screenshotting frame...",x);o.patch.cgl.screenShot(n=>{if(n){if(k){let e=L+"_"+x+"."+r;k.file(e,n,{base64:false});x++;R()}else{let e=L+"_"+I+"_"+x+"."+r;const t=document.createElement("a");t.download=e;t.href=URL.createObjectURL(n);setTimeout(()=>{if(C.isLinked()){z(n,e=>{C.set(e)})}else{C.set(null)}if(c.get()){t.click()}x++;R()},200)}}else{o.log("screenshot: no blob")}},!d.get(),n,h.get())}}else{_.set("Prerendering...");o.log("pre ",x,N);o.patch.cgl.screenShot(e=>{x++;R()})}}function z(e,t){let n=new FileReader;n.onload=function(e){t(e.target.result)};n.readAsDataURL(e)}};Ops.Gl.RenderAnim_v2.prototype=new CABLES.Op;CABLES.OPS["c05e54a3-3ed5-4941-a412-01134f53f0ac"]={f:Ops.Gl.RenderAnim_v2,objName:"Ops.Gl.RenderAnim_v2"};Ops.Value.ToggleNumber=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueBool("Use Value 1",false),r=e.inValue("Value 0",0),i=e.inValue("Value 1",1),a=e.outNumber("Out Value",0);r.onChange=i.onChange=n.onChange=s;function s(){const e=n.get();if(e){a.set(i.get())}else{a.set(r.get())}}};Ops.Value.ToggleNumber.prototype=new CABLES.Op;CABLES.OPS["400eea7d-5a68-4dda-a94d-2bb2ee7c2331"]={f:Ops.Value.ToggleNumber,objName:"Ops.Value.ToggleNumber"};Ops.Ui.VizNumber=function(){CABLES.Op.apply(this,arguments);const n=this;const e={};const r=n.inFloat("Number",0);const i=n.outNumber("Result");n.setUiAttrib({widthOnlyGrow:true});r.onChange=()=>{let t=r.get();if(n.patch.isEditorMode()){let e="";if(t===null)e="null";else if(t===undefined)e="undefined";else{e=""+Math.round(t*1e4)/1e4;if(e[0]!="-")e=" "+e}n.setUiAttribs({extendTitle:e})}i.set(t)}};Ops.Ui.VizNumber.prototype=new CABLES.Op;CABLES.OPS["2b60d12d-2884-4ad0-bda4-0caeb6882f5c"]={f:Ops.Ui.VizNumber,objName:"Ops.Ui.VizNumber"};Ops.Gl.TextureEffects.Noise.SimplexNoise_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={simplexnoise_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float smoothness;\nUNI float scale;\nUNI float seed;\nUNI float x;\nUNI float y;\nUNI float time;\nUNI float aspect;\nUNI float harmonics;\n\n#ifdef HAS_TEX_OFFSETMAP\n    UNI sampler2D texOffsetZ;\n    UNI float offMul;\n#endif\n\n\n#ifdef HAS_TEX_MASK\n    UNI sampler2D texMask;\n#endif\n\n\n\n{{CGL.BLENDMODES3}}\n\nvoid FAST32_hash_3D(    vec3 gridcell,\n                        vec3 v1_mask,       //  user definable v1 and v2.  ( 0s and 1s )\n                        vec3 v2_mask,\n                        out vec4 hash_0,\n                        out vec4 hash_1,\n                        out vec4 hash_2 )       //  generates 3 random numbers for each of the 4 3D cell corners.  cell  corners:  v0=0,0,0  v3=1,1,1  the other two are user definable\n{\n    //    gridcell is assumed to be an integer coordinate\n\n    //  TODO:   these constants need tweaked to find the best possible noise.\n    //          probably requires some kind of brute force computational searching or something....\n    const vec2 OFFSET = vec2( 50.0, 161.0 );\n    const float DOMAIN = 69.0;\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\n\n    //  truncate the domain\n    gridcell.xyz = gridcell.xyz - floor(gridcell.xyz * ( 1.0 / DOMAIN )) * DOMAIN;\n    vec3 gridcell_inc1 = step( gridcell, vec3( DOMAIN - 1.5 ) ) * ( gridcell + 1.0 );\n\n    //  compute x*x*y*y for the 4 corners\n    vec4 P = vec4( gridcell.xy, gridcell_inc1.xy ) + OFFSET.xyxy;\n    P *= P;\n    vec4 V1xy_V2xy = mix( P.xyxy, P.zwzw, vec4( v1_mask.xy, v2_mask.xy ) );     //  appl y mask for v1 and v2\n    P = vec4( P.x, V1xy_V2xy.xz, P.z ) * vec4( P.y, V1xy_V2xy.yw, P.w );\n\n    //  get the lowz and highz mods\n    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell.zzz * ZINC.xyz ) );\n    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell_inc1.zzz * ZINC.xyz ) );\n\n    //  appl mask for v1 and v2 mod values\n    v1_mask = ( v1_mask.z < 0.5 ) ? lowz_mods : highz_mods;\n    v2_mask = ( v2_mask.z < 0.5 ) ? lowz_mods : highz_mods;\n\n    //  compute the final hash\n    hash_0 = fract( P * vec4( lowz_mods.x, v1_mask.x, v2_mask.x, highz_mods.x ) );\n    hash_1 = fract( P * vec4( lowz_mods.y, v1_mask.y, v2_mask.y, highz_mods.y ) );\n    hash_2 = fract( P * vec4( lowz_mods.z, v1_mask.z, v2_mask.z, highz_mods.z ) );\n}\n\n\n//\n//  Given an arbitrary 3D point this calculates the 4 vectors from the corners of the simplex pyramid to the point\n//  It also returns the integer grid index information for the corners\n//\nvoid Simplex3D_GetCornerVectors(    vec3 P,                 //  input point\n                                    out vec3 Pi,            //  integer grid index for the origin\n                                    out vec3 Pi_1,          //  offsets for the 2nd and 3rd corners.  ( the 4th = Pi + 1.0 )\n                                    out vec3 Pi_2,\n                                    out vec4 v1234_x,       //  vectors from the 4 corners to the intput point\n                                    out vec4 v1234_y,\n                                    out vec4 v1234_z )\n{\n    //\n    //  Simplex math from Stefan Gustavsons and Ian McEwans work at...\n    //  http://github.com/ashima/webgl-noise\n    //\n\n    //  simplex math constants\n    const float SKEWFACTOR = 1.0/3.0;\n    const float UNSKEWFACTOR = 1.0/6.0;\n    const float SIMPLEX_CORNER_POS = 0.5;\n    const float SIMPLEX_PYRAMID_HEIGHT = 0.70710678118654752440084436210485;    // sqrt( 0.5 )  height of simplex pyramid.\n\n    P *= SIMPLEX_PYRAMID_HEIGHT;        // scale space so we can have an approx feature size of 1.0  ( optional )\n\n    //  Find the vectors to the corners of our simplex pyramid\n    Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );\n    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    Pi_1 = min( g.xyz, l.zxy );\n    Pi_2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\n    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\n    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\n\n    //  pack them into a parallel-friendly arrangement\n    v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\n    v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\n    v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\n}\n\n//\n//  Calculate the weights for the 3D simplex surflet\n//\nvec4 Simplex3D_GetSurfletWeights(   vec4 v1234_x,\n                                    vec4 v1234_y,\n                                    vec4 v1234_z )\n{\n    //  perlins original implementation uses the surlet falloff formula of (0.6-x*x)^4.\n    //  This is buggy as it can cause discontinuities along simplex faces.  (0.5-x*x)^3 solves this and gives an almost identical curve\n\n    //  evaluate surflet. f(x)=(0.5-x*x)^3\n    vec4 surflet_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\n    surflet_weights = max(0.5 - surflet_weights, 0.0);      //  0.5 here represents the closest distance (squared) of any simplex pyramid corner to any of its planes.  ie, SIMPLEX_PYRAMID_HEIGHT^2\n    return surflet_weights*surflet_weights*surflet_weights;\n}\n\n\n\n//\n//  SimplexPerlin3D  ( simplex gradient noise )\n//  Perlin noise over a simplex (tetrahedron) grid\n//  Return value range of -1.0->1.0\n//  http://briansharpe.files.wordpress.com/2012/01/simplexperlinsample.jpg\n//\n//  Implementation originally based off Stefan Gustavsons and Ian McEwans work at...\n//  http://github.com/ashima/webgl-noise\n//\nfloat SimplexPerlin3D(vec3 P)\n{\n    //  calculate the simplex vector and index math\n    vec3 Pi;\n    vec3 Pi_1;\n    vec3 Pi_2;\n    vec4 v1234_x;\n    vec4 v1234_y;\n    vec4 v1234_z;\n    Simplex3D_GetCornerVectors( P, Pi, Pi_1, Pi_2, v1234_x, v1234_y, v1234_z );\n\n    //  generate the random vectors\n    //  ( various hashing methods listed in order of speed )\n    vec4 hash_0;\n    vec4 hash_1;\n    vec4 hash_2;\n    FAST32_hash_3D( Pi, Pi_1, Pi_2, hash_0, hash_1, hash_2 );\n    //SGPP_hash_3D( Pi, Pi_1, Pi_2, hash_0, hash_1, hash_2 );\n    hash_0 -= 0.49999;\n    hash_1 -= 0.49999;\n    hash_2 -= 0.49999;\n\n    //  evaluate gradients\n    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\n\n    //  Normalization factor to scale the final result to a strict 1.0->-1.0 range\n    //  x = sqrt( 0.75 ) * 0.5\n    //  NF = 1.0 / ( x * ( ( 0.5 * x*x ) ^ 3 ) * 2.0 )\n    //  http://briansharpe.wordpress.com/2012/01/13/simplex-noise/#comment-36\n     float FINAL_NORMALIZATION = 37.837227241611314102871574478976*smoothness;\n\n    //  sum with the surflet and return\n    return dot( Simplex3D_GetSurfletWeights( v1234_x, v1234_y, v1234_z ), grad_results ) * FINAL_NORMALIZATION;\n}\n\nvoid main()\n{\n    vec2 p=vec2(texCoord.x-0.5,texCoord.y-0.5);\n\n    p.x*=aspect;\n    p=p*scale;\n\n    p=vec2(p.x+0.5-x,p.y+0.5-y);\n\n    vec3 offset;\n    #ifdef HAS_TEX_OFFSETMAP\n        vec4 offMap=texture(texOffsetZ,texCoord);\n\n        #ifdef OFFSET_X_R\n            offset.x=offMap.r;\n        #endif\n        #ifdef OFFSET_X_G\n            offset.x=offMap.g;\n        #endif\n        #ifdef OFFSET_X_B\n            offset.x=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Y_R\n            offset.y=offMap.r;\n        #endif\n        #ifdef OFFSET_Y_G\n            offset.y=offMap.g;\n        #endif\n        #ifdef OFFSET_Y_B\n            offset.y=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Z_R\n            offset.z=offMap.r;\n        #endif\n        #ifdef OFFSET_Z_G\n            offset.z=offMap.g;\n        #endif\n        #ifdef OFFSET_Z_B\n            offset.z=offMap.b;\n        #endif\n\n        offset*=offMul;\n    #endif\n\n    float v=SimplexPerlin3D(vec3(p.x,p.y,time)+offset)*0.5+0.5;\n\n\n    if (harmonics >= 2.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*2.3+offset) * 0.5;\n    if (harmonics >= 3.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*4.2+offset) * 0.25;\n    if (harmonics >= 4.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*8.1+offset) * 0.125;\n    if (harmonics >= 5.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*16.7+offset) * 0.0625;\n\n\n\n    //blend section\n    vec4 col=vec4(v,v,v,1.0);\n\n    vec4 base=texture(tex,texCoord);\n\n    // outColor=cgl_blend(base,col,amount);\n\n\n    float str=1.0;\n    #ifdef HAS_TEX_MASK\n        str=texture(texMask,texCoord).r;\n    #endif\n\n    outColor=cgl_blendPixel(base,col,amount*str);\n\n}"};const n=e.inTrigger("render"),r=e.inTexture("Mask"),i=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),a=e.inValueSlider("Amount",1),s=CGL.TextureEffect.AddBlendAlphaMask(e),o=e.inValue("smoothness",1),l=e.inSwitch("Harmonics",["1","2","3","4","5"],"1"),u=e.inValue("scale",7),c=e.outTrigger("trigger"),h=e.inValue("x"),d=e.inValue("y"),f=e.inValue("time",0);const p=e.inTexture("Offset"),m=e.inFloat("Offset Multiply",1),g=e.inSwitch("Offset X",["None","R","G","B"],"None"),v=e.inSwitch("Offset Y",["None","R","G","B"],"None"),b=e.inSwitch("Offset Z",["None","R","G","B"],"R");e.setPortGroup("Offset Map",[p,b,v,g,m]);const _=e.patch.cgl;const F=new CGL.Shader(_,e.name);F.setSource(F.getDefaultVertexShader(),t.simplexnoise_frag);const C=new CGL.Uniform(F,"t","tex",0),A=new CGL.Uniform(F,"t","texOffsetZ",1),E=new CGL.Uniform(F,"t","texMask",2),x=new CGL.Uniform(F,"f","amount",a),B=new CGL.Uniform(F,"f","smoothness",o),D=new CGL.Uniform(F,"f","scale",u),y=new CGL.Uniform(F,"f","x",h),O=new CGL.Uniform(F,"f","y",d),I=new CGL.Uniform(F,"f","aspect",1),S=new CGL.Uniform(F,"f","time",f),T=new CGL.Uniform(F,"f","offMul",m),w=new CGL.Uniform(F,"f","harmonics",0);l.onChange=()=>{w.setValue(parseFloat(l.get()))};CGL.TextureEffect.setupBlending(e,F,i,a,s);g.onChange=v.onChange=b.onChange=r.onChange=p.onChange=N;N();function N(){F.toggleDefine("HAS_TEX_OFFSETMAP",p.get());F.toggleDefine("HAS_TEX_MASK",r.get());F.toggleDefine("OFFSET_X_R",g.get()=="R");F.toggleDefine("OFFSET_X_G",g.get()=="G");F.toggleDefine("OFFSET_X_B",g.get()=="B");F.toggleDefine("OFFSET_Y_R",v.get()=="R");F.toggleDefine("OFFSET_Y_G",v.get()=="G");F.toggleDefine("OFFSET_Y_B",v.get()=="B");F.toggleDefine("OFFSET_Z_R",b.get()=="R");F.toggleDefine("OFFSET_Z_G",b.get()=="G");F.toggleDefine("OFFSET_Z_B",b.get()=="B");g.setUiAttribs({greyout:!p.isLinked()});v.setUiAttribs({greyout:!p.isLinked()});b.setUiAttribs({greyout:!p.isLinked()});m.setUiAttribs({greyout:!p.isLinked()})}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;_.pushShader(F);_.currentTextureEffect.bind();I.setValue(_.currentTextureEffect.aspectRatio);_.setTexture(0,_.currentTextureEffect.getCurrentSourceTexture().tex);if(p.get())_.setTexture(1,p.get().tex);if(r.get())_.setTexture(2,r.get().tex);_.currentTextureEffect.finish();_.popShader();c.trigger()}};Ops.Gl.TextureEffects.Noise.SimplexNoise_v2.prototype=new CABLES.Op;CABLES.OPS["0f4a8d04-89b0-437a-9da8-b4098772d250"]={f:Ops.Gl.TextureEffects.Noise.SimplexNoise_v2,objName:"Ops.Gl.TextureEffects.Noise.SimplexNoise_v2"};Ops.Gl.TextureEffects.Clarity=function(){CABLES.Op.apply(this,arguments);const e=this;const t={clarity_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float pX,pY;\n\nvec3 desaturate(vec4 color)\n{\n    vec3 c= vec3(dot(vec3(0.2126,0.7152,0.0722), color.rgb));\n    return c;\n}\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n    vec3 gray=desaturate(col);\n    vec3 m=smoothstep(0.2,0.5,gray)*smoothstep(0.75,0.5,gray);\n    vec4 col2=vec4(1.0);\n\n    col2.rgb = ((col.rgb - 0.5) * max(( vec3(amount)*m+0.5)*2.0, 0.0))+0.5;\n\n    outColor= col2;\n}\n\n\n"};const n=e.inTrigger("Render");const r=e.outTrigger("Trigger");const i=e.inValueSlider("amount",.5);const a=e.patch.cgl;const s=new CGL.Shader(a,e.name);s.setSource(s.getDefaultVertexShader(),t.clarity_frag);const o=new CGL.Uniform(s,"t","tex",0);const l=new CGL.Uniform(s,"f","amount",i);n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;a.pushShader(s);a.currentTextureEffect.bind();a.setTexture(0,a.currentTextureEffect.getCurrentSourceTexture().tex);a.currentTextureEffect.finish();a.popShader();r.trigger()}};Ops.Gl.TextureEffects.Clarity.prototype=new CABLES.Op;CABLES.OPS["37d66c32-5594-4509-bba0-0ba2cbb706d8"]={f:Ops.Gl.TextureEffects.Clarity,objName:"Ops.Gl.TextureEffects.Clarity"};Ops.Gl.TextureEffects.FastBlur_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={blur_frag:"\nUNI sampler2D tex;\n#ifdef USE_MASK\n    UNI sampler2D texMask;\n#endif\nUNI float amount;\nUNI float pass;\n\nIN vec2 texCoord;\n\nUNI float dirX;\nUNI float dirY;\nUNI float width;\nUNI float height;\n\nIN vec2 coord0;\nIN vec2 coord1;\nIN vec2 coord2;\nIN vec2 coord3;\nIN vec2 coord4;\nIN vec2 coord5;\nIN vec2 coord6;\n\n#ifdef HAS_MASK\n    UNI sampler2D imageMask;\n#endif\n\nvoid main()\n{\n    vec4 color = vec4(0.0);\n\n    #ifdef USE_MASK\n        #ifdef MASK_INVERT\n            if(texture(texMask,texCoord).r<0.5)\n            {\n                outColor= texture(tex, texCoord);\n                return;\n            }\n        #endif\n\n        #ifndef MASK_INVERT\n            if(texture(texMask,texCoord).r>0.5)\n            {\n                outColor= texture(tex, texCoord);\n                return;\n            }\n        #endif\n    #endif\n\n    color += texture(tex, coord0) * 0.06927096443792478;\n    color += texture(tex, coord1) * 0.1383328848652136;\n    color += texture(tex, coord2) * 0.21920904690397863;\n    color += texture(tex, coord3) * 0.14637421;\n    color += texture(tex, coord4) * 0.21920904690397863;\n    color += texture(tex, coord5) * 0.1383328848652136;\n    color += texture(tex, coord6) * 0.06927096443795711;\n\n    outColor= color;\n}",blur_vert:"\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\nUNI mat4 modelMatrix;\n\nUNI float pass;\nUNI float dirX;\nUNI float dirY;\nUNI float width;\nUNI float height;\n\nOUT vec2 coord0;\nOUT vec2 coord1;\nOUT vec2 coord2;\nOUT vec2 coord3;\nOUT vec2 coord4;\nOUT vec2 coord5;\nOUT vec2 coord6;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    {{MODULE_VERTEX_POSITION}}\n\n    vec2 dir=vec2(dirX,dirY);\n    vec2 res=vec2( (1.) / width , (1.) / height )*dir;\n\n    coord3= attrTexCoord;\n\n    coord0= attrTexCoord + (-3.0368997744118595 * res);\n    coord1= attrTexCoord + (-2.089778445362373 * res);\n    coord2= attrTexCoord + (-1.2004366090034069 * res);\n    coord4= attrTexCoord + (1.2004366090034069 * res);\n    coord5= attrTexCoord + (2.089778445362373* res);\n    coord6= attrTexCoord + (3.0368997744118595 * res);\n\n    #ifdef CLAMP\n        coord0=clamp(coord0,0.0,1.0);\n        coord1=clamp(coord1,0.0,1.0);\n        coord2=clamp(coord2,0.0,1.0);\n        coord3=clamp(coord3,0.0,1.0);\n        coord4=clamp(coord4,0.0,1.0);\n        coord5=clamp(coord5,0.0,1.0);\n        coord6=clamp(coord6,0.0,1.0);\n    #endif\n\n    gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const n=e.inTrigger("render"),r=e.outTrigger("trigger"),i=e.inFloat("Passes",3),a=e.inBool("Clamp",false),s=e.inDropDown("direction",["both","vertical","horizontal"],"both"),o=e.inTexture("Mask"),l=e.inBool("Mask Invert",false);const u=e.patch.cgl;const c=new CGL.Shader(u,"fastblur");e.setPortGroup("Mask",[o,l]);c.setSource(t.blur_vert,t.blur_frag);const h=new CGL.Uniform(c,"t","tex",0),d=new CGL.Uniform(c,"f","dirX",0),f=new CGL.Uniform(c,"f","dirY",0),p=new CGL.Uniform(c,"f","width",0),m=new CGL.Uniform(c,"f","height",0),g=new CGL.Uniform(c,"f","pass",0),v=new CGL.Uniform(c,"f","amount",i.get()),b=new CGL.Uniform(c,"t","texMask",1);i.onChange=()=>{v.setValue(i.get())};let _=0;s.onChange=()=>{if(s.get()=="both")_=0;if(s.get()=="horizontal")_=1;if(s.get()=="vertical")_=2};a.onChange=()=>{c.toggleDefine("CLAMP",a.get())};l.onChange=o.onChange=F;F();function F(){c.toggleDefine("USE_MASK",o.isLinked());c.toggleDefine("MASK_INVERT",l.get());l.setUiAttribs({greyout:!o.isLinked()})}n.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;p.setValue(u.currentTextureEffect.getCurrentSourceTexture().width);m.setValue(u.currentTextureEffect.getCurrentSourceTexture().height);const t=i.get();if(o.get())u.setTexture(1,o.get().tex);for(let e=0;e<t;e++){u.pushShader(c);g.setValue(e/t);if(_===0||_==2){u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);d.setValue(0);f.setValue(1+e*e);u.currentTextureEffect.finish()}if(_===0||_==1){u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);d.setValue(1+e*e);f.setValue(0);u.currentTextureEffect.finish()}u.popShader()}r.trigger()}};Ops.Gl.TextureEffects.FastBlur_v2.prototype=new CABLES.Op;CABLES.OPS["61ed277f-d096-43b2-9de8-dc87fb3a9169"]={f:Ops.Gl.TextureEffects.FastBlur_v2,objName:"Ops.Gl.TextureEffects.FastBlur_v2"};Ops.Gl.Textures.NoiseTexture=function(){CABLES.Op.apply(this,arguments);const p=this;const e={};const m=p.inValueInt("Width",256),g=p.inValueInt("Height",256),v=p.inSwitch("Filter",["nearest","linear"],"nearest"),b=p.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"repeat"),_=p.inValueBool("Color",false),F=p.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),C=p.inFloat("Seed",0),A=p.inBool("Channel R",true),E=p.inFloat("Min R",0),x=p.inFloat("Max R",1),B=p.inBool("Channel G",true),D=p.inFloat("Min G",0),y=p.inFloat("Max G",1),O=p.inBool("Channel B",true),I=p.inFloat("Min B",0),S=p.inFloat("Max B",1),T=p.outTexture("Texture");const w=p.patch.cgl;C.onChange=m.onChange=g.onChange=F.onChange=E.onChange=x.onChange=D.onChange=y.onChange=I.onChange=S.onChange=A.onChange=O.onChange=B.onChange=v.onChange=b.onChange=_.onChange=t;t();function t(){const e=F.get()==CGL.Texture.PFORMATSTR_RGBA32F;if(!e){if(E.get()<0||E.get()>1||D.get()<0||D.get()>1||I.get()<0||I.get()>1)p.setUiError("nonfprange","non floating point textures have to be between 0 and 1");else p.setUiError("nonfprange",null)}else p.setUiError("nonfprange",null);D.setUiAttribs({greyout:!_.get()});y.setUiAttribs({greyout:!_.get()});I.setUiAttribs({greyout:!_.get()});S.setUiAttribs({greyout:!_.get()});let t=Math.ceil(m.get());let n=Math.ceil(g.get());if(t<1)t=1;if(n<1)n=1;let r;const i=t*4*n;const a=E.get();const s=x.get()-a;const o=D.get();const l=y.get()-o;const u=I.get();const c=S.get()-u;Math.randomSeed=C.get();if(e){r=new Float32Array(i);if(_.get()){for(let e=0;e<i;e+=4){r[e+0]=a+Math.seededRandom()*s;r[e+1]=o+Math.seededRandom()*l;r[e+2]=u+Math.seededRandom()*c;r[e+3]=1}}else{for(let t=0;t<i;t+=4){let e=a+Math.seededRandom()*s;r[t+0]=r[t+1]=r[t+2]=e;r[t+3]=1}}}else{r=new Uint8Array(i);if(_.get()){for(let e=0;e<i;e+=4){r[e+0]=(a+Math.seededRandom()*s)*255;r[e+1]=(o+Math.seededRandom()*l)*255;r[e+2]=(u+Math.seededRandom()*c)*255;r[e+3]=255}}else{for(let e=0;e<i;e+=4){r[e+0]=r[e+1]=r[e+2]=(a+Math.seededRandom()*s)*255;r[e+3]=255}}}if(!A.get())for(let e=0;e<i;e+=4)r[e+0]=0;if(!B.get())for(let e=0;e<i;e+=4)r[e+1]=0;if(!O.get())for(let e=0;e<i;e+=4)r[e+2]=0;let h=CGL.Texture.FILTER_NEAREST;if(v.get()=="linear")h=CGL.Texture.FILTER_LINEAR;let d=CGL.Texture.WRAP_REPEAT;if(b.get()=="mirrored repeat")d=CGL.Texture.WRAP_MIRRORED_REPEAT;if(b.get()=="clamp to edge")d=CGL.Texture.WRAP_CLAMP_TO_EDGE;let f=new CGL.Texture(w,{isFloatingPointTexture:e});f.initFromData(r,t,n,h,d);T.set(CGL.Texture.getEmptyTexture(p.patch.cgl,e));T.set(f)}};Ops.Gl.Textures.NoiseTexture.prototype=new CABLES.Op;CABLES.OPS["b781bc6b-b2cf-44fe-80eb-a840e430d27d"]={f:Ops.Gl.Textures.NoiseTexture,objName:"Ops.Gl.Textures.NoiseTexture"};Ops.Trigger.RouteTrigger=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=24;const r=t.inTriggerButton("Execute");const i=t.inValueInt("Switch Value");const a=t.outTrigger("Next Trigger");const s=t.outValue("Switched Value");const o=[];for(let e=0;e<n;e++){o[e]=t.outTrigger("Trigger "+e)}const l=t.outTrigger("Default Trigger");function u(){const e=Math.round(i.get());if(e>=0&&e<n){s.set(e);o[e].trigger()}else{s.set(-1);l.trigger()}a.trigger()}r.onTriggered=u};Ops.Trigger.RouteTrigger.prototype=new CABLES.Op;CABLES.OPS["44ceb5d8-b040-4722-b189-a6fb8172517d"]={f:Ops.Trigger.RouteTrigger,objName:"Ops.Trigger.RouteTrigger"};Ops.Trigger.SwitchTrigger=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=16;const r=t.inValueInt("Trigger Index",0),i=[],a=t.outTrigger("Trigger out");for(let e=0;e<n;e++){const o=t.inTrigger("Trigger in "+e);o.onTriggered=function(){s(e)};i.onChange=function(){s(e)};i.push(o)}function s(e){const t=Math.min(Math.max(r.get(),0),15);if(e==t)a.trigger()}};Ops.Trigger.SwitchTrigger.prototype=new CABLES.Op;CABLES.OPS["aee29293-0c4f-404d-b724-484bbb57361e"]={f:Ops.Trigger.SwitchTrigger,objName:"Ops.Trigger.SwitchTrigger"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});window.Whammy=function(){function r(t,n){const e=m(t);const r=3e4;const i=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:_(e.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:e.width,id:176},{data:e.height,id:186}]}]}]},{id:475249515,data:[]}]}];const a=i[1];const s=a.data[2];let o=0;let l=0;while(o<t.length){const h={id:187,data:[{data:Math.round(l),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};s.data.push(h);const d=[];let e=0;do{d.push(t[o]);e+=t[o].duration;o++}while(o<t.length&&e<r);var u=0;const f={id:524531317,data:[{data:Math.round(l),id:231}].concat(d.map(function(e){const t=b({discardable:0,frame:e.data.slice(e.data.indexOf("*")-3),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(u)});u+=e.duration;return{data:t,id:163}}))};a.data.push(f);l+=e}let c=0;for(let e=0;e<a.data.length;e++){if(e>=3){s.data[e-3].data[1].data[1].data=c}const p=g([a.data[e]],n);c+=p.size||p.byteLength||p.length;if(e!=2){a.data[e]=p}}return g(i,n)}function m(t){let n=t[0].width,r=t[0].height,i=t[0].duration;for(let e=1;e<t.length;e++){if(t[e].width!=n)throw"Frame "+(e+1)+" has a different width";if(t[e].height!=r)throw"Frame "+(e+1)+" has a different height";if(t[e].duration<0||t[e].duration>32767)throw"Frame "+(e+1)+" has a weird duration (must be between 0 and 32767)";i+=t[e].duration}return{duration:i,width:n,height:r}}function h(e){const t=[];while(e>0){t.push(e&255);e>>=8}return new Uint8Array(t.reverse())}function d(t,n){const r=new Uint8Array(n);for(let e=n-1;e>=0;e--){r[e]=t&255;t>>=8}return r}function f(t){const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++){n[e]=t.charCodeAt(e)}return n}function p(t){const n=[];const e=t.length%8?new Array(1+8-t.length%8).join("0"):"";t=e+t;for(let e=0;e<t.length;e+=8){n.push(parseInt(t.substr(e,8),2))}return new Uint8Array(n)}function g(n,r){const i=[];for(let t=0;t<n.length;t++){if(!("id"in n[t])){i.push(n[t]);continue}let e=n[t].data;if(typeof e=="object")e=g(e,r);if(typeof e=="number")e="size"in n[t]?d(e,n[t].size):p(e.toString(2));if(typeof e=="string")e=f(e);if(e.length){var a=a}const s=e.size||e.byteLength||e.length;const o=Math.ceil(Math.ceil(Math.log(s)/Math.log(2))/8);const l=s.toString(2);const u=new Array(o*7+7+1-l.length).join("0")+l;const c=new Array(o).join("0")+"1"+u;i.push(h(n[t].id));i.push(p(c));i.push(e)}if(r){const e=v(i);return new Uint8Array(e)}else{return new Blob(i,{type:"video/webm"})}}function v(t,n){if(n==null){n=[]}for(let e=0;e<t.length;e++){if(typeof t[e]=="object"){v(t[e],n)}else{n.push(t[e])}}return n}function u(t){let n="";const e=t.length%8?new Array(1+8-t.length%8).join("0"):"";t=e+t;for(let e=0;e<t.length;e+=8){n+=String.fromCharCode(parseInt(t.substr(e,8),2))}return n}function c(n){let r="";for(let t=0;t<n.length;t++){let e=n[t].data;if(typeof e=="object")e=c(e);if(typeof e=="number")e=u(e.toString(2));const i=e.length;const a=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8);const s=i.toString(2);const o=new Array(a*7+7+1-s.length).join("0")+s;const l=new Array(a).join("0")+"1"+o;r+=u(n[t].id.toString(2))+u(l)+e}return r}function b(e){let t=0;if(e.keyframe)t|=128;if(e.invisible)t|=8;if(e.lacing)t|=e.lacing<<1;if(e.discardable)t|=1;if(e.trackNum>127){throw"TrackNumber > 127 not supported"}const n=[e.trackNum|128,e.timecode>>8,e.timecode&255,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame;return n}function i(e){const t=e.RIFF[0].WEBP[0];const n=t.indexOf("*");for(var r=0,i=[];r<4;r++)i[r]=t.charCodeAt(n+3+r);let a,s,o,l,u;u=i[1]<<8|i[0];a=u&16383;s=u>>14;u=i[3]<<8|i[2];o=u&16383;l=u>>14;return{width:a,height:o,data:t,riff:e}}function s(e){let t=0;const n={};while(t<e.length){const r=e.substr(t,4);n[r]=n[r]||[];if(r=="RIFF"||r=="LIST"){const i=parseInt(e.substr(t+4,4).split("").map(function(e){const t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2);const a=e.substr(t+4+4,i);t+=4+4+i;n[r].push(s(a))}else if(r=="WEBP"){n[r].push(e.substr(t+8));t=e.length}else{n[r].push(e.substr(t+4));t=e.length}}return n}function _(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}function e(e,t){this.frames=[];this.duration=1e3/e;this.quality=t||.8}e.prototype.add=function(e,t){if(typeof t!="undefined"&&this.duration)throw"you can't pass a duration if the fps is set";if(typeof t=="undefined"&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(e.canvas){e=e.canvas}if(e.toDataURL){e=e.getContext("2d").getImageData(0,0,e.width,e.height)}else if(typeof e!="string"){throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string"}if(typeof e==="string"&&!/^data:image\/webp;base64,/gi.test(e)){throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp"}this.frames.push({image:e,duration:t||this.duration})};e.prototype.encodeFrames=function(n){if(this.frames[0].image instanceof ImageData){const i=this.frames;const a=document.createElement("canvas");const s=a.getContext("2d");a.width=this.frames[0].image.width;a.height=this.frames[0].image.height;var r=function(e){console.log("encodeFrame",e);const t=i[e];s.putImageData(t.image,0,0);t.image=a.toDataURL("image/webp",this.quality);if(e<i.length-1){setTimeout(function(){r(e+1)},1)}else{n()}}.bind(this);r(0)}else{n()}};e.prototype.compile=function(t,n){this.encodeFrames(function(){const e=new r(this.frames.map(function(e){const t=i(s(atob(e.image.slice(23))));t.duration=e.duration;return t}),t);n(e)}.bind(this))};return{Video:e,fromImageArray:function(e,n,t){return r(e.map(function(e){const t=i(s(atob(e.slice(23))));t.duration=1e3/n;return t}),t)},toWebM:r}}();(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.JSZip=e()}})(function(){var e,t,n;return function a(s,o,l){function u(n,e){if(!o[n]){if(!s[n]){var t=typeof require=="function"&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var i=o[n]={exports:{}};s[n][0].call(i.exports,function(e){var t=s[n][1][e];return u(t?t:e)},i,i.exports,a,s,o,l)}return o[n].exports}var c=typeof require=="function"&&require;for(var e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,n){"use strict";var f=e("./utils");var p=e("./support");var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){var t=[];var n,r,i,a,s,o,l;var u=0,c=e.length,h=c;var d=f.getTypeOf(e)!=="string";while(u<e.length){h=c-u;if(!d){n=e.charCodeAt(u++);r=u<c?e.charCodeAt(u++):0;i=u<c?e.charCodeAt(u++):0}else{n=e[u++];r=u<c?e[u++]:0;i=u<c?e[u++]:0}a=n>>2;s=(n&3)<<4|r>>4;o=h>1?(r&15)<<2|i>>6:64;l=h>2?i&63:64;t.push(m.charAt(a)+m.charAt(s)+m.charAt(o)+m.charAt(l))}return t.join("")};n.decode=function(e){var t,n,r;var i,a,s,o;var l=0,u=0;var c="data:";if(e.substr(0,c.length)===c){throw new Error("Invalid base64 input, it looks like a data url.")}e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var h=e.length*3/4;if(e.charAt(e.length-1)===m.charAt(64)){h--}if(e.charAt(e.length-2)===m.charAt(64)){h--}if(h%1!==0){throw new Error("Invalid base64 input, bad content length.")}var d;if(p.uint8array){d=new Uint8Array(h|0)}else{d=new Array(h|0)}while(l<e.length){i=m.indexOf(e.charAt(l++));a=m.indexOf(e.charAt(l++));s=m.indexOf(e.charAt(l++));o=m.indexOf(e.charAt(l++));t=i<<2|a>>4;n=(a&15)<<4|s>>2;r=(s&3)<<6|o;d[u++]=t;if(s!==64){d[u++]=n}if(o!==64){d[u++]=r}}return d}},{"./support":30,"./utils":32}],2:[function(e,t,n){"use strict";var r=e("./external");var i=e("./stream/DataWorker");var a=e("./stream/DataLengthProbe");var s=e("./stream/Crc32Probe");var a=e("./stream/DataLengthProbe");function o(e,t,n,r,i){this.compressedSize=e;this.uncompressedSize=t;this.crc32=n;this.compression=r;this.compressedContent=i}o.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length"));var t=this;e.on("end",function(){if(this.streamInfo["data_length"]!==t.uncompressedSize){throw new Error("Bug : uncompressed data size mismatch")}});return e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};o.createWorkerFrom=function(e,t,n){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new a("compressedSize")).withStreamInfo("compression",t)};t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var r=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}};n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){"use strict";var i=e("./utils");function r(){var e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++){e=e&1?3988292384^e>>>1:e>>>1}t[n]=e}return t}var o=r();function a(e,t,n,r){var i=o,a=r+n;e=e^-1;for(var s=r;s<a;s++){e=e>>>8^i[(e^t[s])&255]}return e^-1}function s(e,t,n,r){var i=o,a=r+n;e=e^-1;for(var s=r;s<a;s++){e=e>>>8^i[(e^t.charCodeAt(s))&255]}return e^-1}t.exports=function e(t,n){if(typeof t==="undefined"||!t.length){return 0}var r=i.getTypeOf(t)!=="string";if(r){return a(n|0,t,t.length,0)}else{return s(n|0,t,t.length,0)}}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=false;n.binary=false;n.dir=false;n.createFolders=true;n.date=null;n.compression=null;n.compressionOptions=null;n.comment=null;n.unixPermissions=null;n.dosPermissions=null},{}],6:[function(e,t,n){"use strict";var r=null;if(typeof Promise!=="undefined"){r=Promise}else{r=e("lie")}t.exports={Promise:r}},{lie:37}],7:[function(e,t,n){"use strict";var r=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined";var i=e("pako");var a=e("./utils");var s=e("./stream/GenericWorker");var o=r?"uint8array":"array";n.magic="\b\0";function l(e,t){s.call(this,"FlateWorker/"+e);this._pako=null;this._pakoAction=e;this._pakoOptions=t;this.meta={}}a.inherits(l,s);l.prototype.processChunk=function(e){this.meta=e.meta;if(this._pako===null){this._createPako()}this._pako.push(a.transformTo(o,e.data),false)};l.prototype.flush=function(){s.prototype.flush.call(this);if(this._pako===null){this._createPako()}this._pako.push([],true)};l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this);this._pako=null};l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:true,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}};n.compressWorker=function(e){return new l("Deflate",e)};n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){"use strict";var S=e("../utils");var i=e("../stream/GenericWorker");var T=e("../utf8");var w=e("../crc32");var N=e("../signature");var L=function(e,t){var n="",r;for(r=0;r<t;r++){n+=String.fromCharCode(e&255);e=e>>>8}return n};var k=function(e,t){var n=e;if(!e){n=t?16893:33204}return(n&65535)<<16};var M=function(e,t){return(e||0)&63};var r=function(e,t,n,r,i,a){var s=e["file"],o=e["compression"],l=a!==T.utf8encode,u=S.transformTo("string",a(s.name)),c=S.transformTo("string",T.utf8encode(s.name)),h=s.comment,d=S.transformTo("string",a(h)),f=S.transformTo("string",T.utf8encode(h)),p=c.length!==s.name.length,m=f.length!==h.length,g,v,b="",_="",F="",C=s.dir,A=s.date;var E={crc32:0,compressedSize:0,uncompressedSize:0};if(!t||n){E.crc32=e["crc32"];E.compressedSize=e["compressedSize"];E.uncompressedSize=e["uncompressedSize"]}var x=0;if(t){x|=8}if(!l&&(p||m)){x|=2048}var B=0;var D=0;if(C){B|=16}if(i==="UNIX"){D=798;B|=k(s.unixPermissions,C)}else{D=20;B|=M(s.dosPermissions,C)}g=A.getUTCHours();g=g<<6;g=g|A.getUTCMinutes();g=g<<5;g=g|A.getUTCSeconds()/2;v=A.getUTCFullYear()-1980;v=v<<4;v=v|A.getUTCMonth()+1;v=v<<5;v=v|A.getUTCDate();if(p){_=L(1,1)+L(w(u),4)+c;b+="up"+L(_.length,2)+_}if(m){F=L(1,1)+L(w(d),4)+f;b+="uc"+L(F.length,2)+F}var y="";y+="\n\0";y+=L(x,2);y+=o.magic;y+=L(g,2);y+=L(v,2);y+=L(E.crc32,4);y+=L(E.compressedSize,4);y+=L(E.uncompressedSize,4);y+=L(u.length,2);y+=L(b.length,2);var O=N.LOCAL_FILE_HEADER+y+u+b;var I=N.CENTRAL_FILE_HEADER+L(D,2)+y+L(d.length,2)+"\0\0"+"\0\0"+L(B,4)+L(r,4)+u+b+d;return{fileRecord:O,dirRecord:I}};var a=function(e,t,n,r,i){var a="";var s=S.transformTo("string",i(r));a=N.CENTRAL_DIRECTORY_END+"\0\0"+"\0\0"+L(e,2)+L(e,2)+L(t,4)+L(n,4)+L(s.length,2)+s;return a};var s=function(e){var t="";t=N.DATA_DESCRIPTOR+L(e["crc32"],4)+L(e["compressedSize"],4)+L(e["uncompressedSize"],4);return t};function o(e,t,n,r){i.call(this,"ZipFileWorker");this.bytesWritten=0;this.zipComment=t;this.zipPlatform=n;this.encodeFileName=r;this.streamFiles=e;this.accumulate=false;this.contentBuffer=[];this.dirRecords=[];this.currentSourceOffset=0;this.entriesCount=0;this.currentFile=null;this._sources=[]}S.inherits(o,i);o.prototype.push=function(e){var t=e.meta.percent||0;var n=this.entriesCount;var r=this._sources.length;if(this.accumulate){this.contentBuffer.push(e)}else{this.bytesWritten+=e.data.length;i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}})}};o.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten;this.currentFile=e["file"].name;var t=this.streamFiles&&!e["file"].dir;if(t){var n=r(e,t,false,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else{this.accumulate=true}};o.prototype.closedSource=function(e){this.accumulate=false;var t=this.streamFiles&&!e["file"].dir;var n=r(e,t,true,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(n.dirRecord);if(t){this.push({data:s(e),meta:{percent:100}})}else{this.push({data:n.fileRecord,meta:{percent:0}});while(this.contentBuffer.length){this.push(this.contentBuffer.shift())}}this.currentFile=null};o.prototype.flush=function(){var e=this.bytesWritten;for(var t=0;t<this.dirRecords.length;t++){this.push({data:this.dirRecords[t],meta:{percent:100}})}var n=this.bytesWritten-e;var r=a(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})};o.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);if(this.isPaused){this.previous.pause()}else{this.previous.resume()}};o.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;e.on("data",function(e){t.processChunk(e)});e.on("end",function(){t.closedSource(t.previous.streamInfo);if(t._sources.length){t.prepareNextSource()}else{t.end()}});e.on("error",function(e){t.error(e)});return this};o.prototype.resume=function(){if(!i.prototype.resume.call(this)){return false}if(!this.previous&&this._sources.length){this.prepareNextSource();return true}if(!this.previous&&!this._sources.length&&!this.generatedError){this.end();return true}};o.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e)){return false}for(var n=0;n<t.length;n++){try{t[n].error(e)}catch(e){}}return true};o.prototype.lock=function(){i.prototype.lock.call(this);var e=this._sources;for(var t=0;t<e.length;t++){e[t].lock()}};t.exports=o},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var i=e("../compressions");var r=e("./ZipFileWorker");var u=function(e,t){var n=e||t;var r=i[n];if(!r){throw new Error(n+" is not a valid compression method !")}return r};n.generateWorker=function(e,s,t){var o=new r(s.streamFiles,t,s.platform,s.encodeFileName);var l=0;try{e.forEach(function(e,t){l++;var n=u(t.options.compression,s.compression);var r=t.options.compressionOptions||s.compressionOptions||{};var i=t.dir,a=t.date;t._compressWorker(n,r).withStreamInfo("file",{name:e,dir:i,date:a,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(o)});o.entriesCount=l}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){"use strict";function r(){if(!(this instanceof r)){return new r}if(arguments.length){throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.")}this.files={};this.comment=null;this.root="";this.clone=function(){var e=new r;for(var t in this){if(typeof this[t]!=="function"){e[t]=this[t]}}return e}}r.prototype=e("./object");r.prototype.loadAsync=e("./load");r.support=e("./support");r.defaults=e("./defaults");r.version="3.5.0";r.loadAsync=function(e,t){return(new r).loadAsync(e,t)};r.external=e("./external");t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){"use strict";var r=e("./utils");var a=e("./external");var i=e("./utf8");var r=e("./utils");var l=e("./zipEntries");var s=e("./stream/Crc32Probe");var u=e("./nodejsUtils");function c(r){return new a.Promise(function(e,t){var n=r.decompressed.getContentWorker().pipe(new s);n.on("error",function(e){t(e)}).on("end",function(){if(n.streamInfo.crc32!==r.decompressed.crc32){t(new Error("Corrupted zip : CRC32 mismatch"))}else{e()}}).resume()})}t.exports=function(e,s){var o=this;s=r.extend(s||{},{base64:false,checkCRC32:false,optimizedBinaryString:false,createFolders:false,decodeFileName:i.utf8decode});if(u.isNode&&u.isStream(e)){return a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file."))}return r.prepareContent("the loaded zip file",e,true,s.optimizedBinaryString,s.base64).then(function(e){var t=new l(s);t.load(e);return t}).then(function e(t){var n=[a.Promise.resolve(t)];var r=t.files;if(s.checkCRC32){for(var i=0;i<r.length;i++){n.push(c(r[i]))}}return a.Promise.all(n)}).then(function e(t){var n=t.shift();var r=n.files;for(var i=0;i<r.length;i++){var a=r[i];o.file(a.fileNameStr,a.decompressed,{binary:true,optimizedBinaryString:true,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:s.createFolders})}if(n.zipComment.length){o.comment=n.zipComment}return o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){"use strict";var r=e("../utils");var i=e("../stream/GenericWorker");function a(e,t){i.call(this,"Nodejs stream input adapter for "+e);this._upstreamEnded=false;this._bindStream(t)}r.inherits(a,i);a.prototype._bindStream=function(e){var t=this;this._stream=e;e.pause();e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){if(t.isPaused){this.generatedError=e}else{t.error(e)}}).on("end",function(){if(t.isPaused){t._upstreamEnded=true}else{t.end()}})};a.prototype.pause=function(){if(!i.prototype.pause.call(this)){return false}this._stream.pause();return true};a.prototype.resume=function(){if(!i.prototype.resume.call(this)){return false}if(this._upstreamEnded){this.end()}else{this._stream.resume()}return true};t.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){"use strict";var i=e("readable-stream").Readable;var r=e("../utils");r.inherits(a,i);function a(e,t,n){i.call(this,t);this._helper=e;var r=this;e.on("data",function(e,t){if(!r.push(e)){r._helper.pause()}if(n){n(t)}}).on("error",function(e){r.emit("error",e)}).on("end",function(){r.push(null)})}a.prototype._read=function(){this._helper.resume()};t.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,t,n){"use strict";t.exports={isNode:typeof Buffer!=="undefined",newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from){return Buffer.from(e,t)}else{if(typeof e==="number"){throw new Error('The "data" argument must not be a number')}return new Buffer(e,t)}},allocBuffer:function(e){if(Buffer.alloc){return Buffer.alloc(e)}else{var t=new Buffer(e);t.fill(0);return t}},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on==="function"&&typeof e.pause==="function"&&typeof e.resume==="function"}}},{}],15:[function(e,t,n){"use strict";var i=e("./utf8");var c=e("./utils");var h=e("./stream/GenericWorker");var a=e("./stream/StreamHelper");var d=e("./defaults");var f=e("./compressedObject");var p=e("./zipObject");var s=e("./generate");var m=e("./nodejsUtils");var g=e("./nodejs/NodejsStreamInputAdapter");var o=function(e,t,n){var r=c.getTypeOf(t),i;var a=c.extend(n||{},d);a.date=a.date||new Date;if(a.compression!==null){a.compression=a.compression.toUpperCase()}if(typeof a.unixPermissions==="string"){a.unixPermissions=parseInt(a.unixPermissions,8)}if(a.unixPermissions&&a.unixPermissions&16384){a.dir=true}if(a.dosPermissions&&a.dosPermissions&16){a.dir=true}if(a.dir){e=b(e)}if(a.createFolders&&(i=v(e))){_.call(this,i,true)}var s=r==="string"&&a.binary===false&&a.base64===false;if(!n||typeof n.binary==="undefined"){a.binary=!s}var o=t instanceof f&&t.uncompressedSize===0;if(o||a.dir||!t||t.length===0){a.base64=false;a.binary=true;t="";a.compression="STORE";r="string"}var l=null;if(t instanceof f||t instanceof h){l=t}else if(m.isNode&&m.isStream(t)){l=new g(e,t)}else{l=c.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64)}var u=new p(e,l,a);this.files[e]=u};var v=function(e){if(e.slice(-1)==="/"){e=e.substring(0,e.length-1)}var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""};var b=function(e){if(e.slice(-1)!=="/"){e+="/"}return e};var _=function(e,t){t=typeof t!=="undefined"?t:d.createFolders;e=b(e);if(!this.files[e]){o.call(this,e,null,{dir:true,createFolders:t})}return this.files[e]};function l(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var r={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files){if(!this.files.hasOwnProperty(t)){continue}r=this.files[t];n=t.slice(this.root.length,t.length);if(n&&t.slice(0,this.root.length)===this.root){e(n,r)}}},filter:function(n){var r=[];this.forEach(function(e,t){if(n(e,t)){r.push(t)}});return r},file:function(e,t,n){if(arguments.length===1){if(l(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}else{var i=this.files[this.root+e];if(i&&!i.dir){return i}else{return null}}}else{e=this.root+e;o.call(this,e,t,n)}return this},folder:function(n){if(!n){return this}if(l(n)){return this.filter(function(e,t){return t.dir&&n.test(e)})}var e=this.root+n;var t=_.call(this,e);var r=this.clone();r.root=t.name;return r},remove:function(n){n=this.root+n;var e=this.files[n];if(!e){if(n.slice(-1)!=="/"){n+="/"}e=this.files[n]}if(e&&!e.dir){delete this.files[n]}else{var t=this.filter(function(e,t){return t.name.slice(0,n.length)===n});for(var r=0;r<t.length;r++){delete this.files[t[r].name]}}return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{n=c.extend(e||{},{streamFiles:false,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode});n.type=n.type.toLowerCase();n.compression=n.compression.toUpperCase();if(n.type==="binarystring"){n.type="string"}if(!n.type){throw new Error("No output type specified.")}c.checkSupport(n.type);if(n.platform==="darwin"||n.platform==="freebsd"||n.platform==="linux"||n.platform==="sunos"){n.platform="UNIX"}if(n.platform==="win32"){n.platform="DOS"}var r=n.comment||this.comment||"";t=s.generateWorker(this,n,r)}catch(e){t=new h("error");t.error(e)}return new a(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){e=e||{};if(!e.type){e.type="nodebuffer"}return this.generateInternalStream(e).toNodejsStream(t)}};t.exports=r},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:undefined}],17:[function(e,t,n){"use strict";var r=e("./DataReader");var i=e("../utils");function a(e){r.call(this,e);for(var t=0;t<this.data.length;t++){e[t]=e[t]&255}}i.inherits(a,r);a.prototype.byteAt=function(e){return this.data[this.zero+e]};a.prototype.lastIndexOfSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3);for(var a=this.length-4;a>=0;--a){if(this.data[a]===t&&this.data[a+1]===n&&this.data[a+2]===r&&this.data[a+3]===i){return a-this.zero}}return-1};a.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&n===a[1]&&r===a[2]&&i===a[3]};a.prototype.readData=function(e){this.checkOffset(e);if(e===0){return[]}var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){"use strict";var r=e("../utils");function i(e){this.data=e;this.length=e.length;this.index=0;this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0){throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")}},setIndex:function(e){this.checkIndex(e);this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,n;this.checkOffset(e);for(n=this.index+e-1;n>=this.index;n--){t=(t<<8)+this.byteAt(n)}this.index+=e;return t},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1))}};t.exports=i},{"../utils":32}],19:[function(e,t,n){"use strict";var r=e("./Uint8ArrayReader");var i=e("../utils");function a(e){r.call(this,e)}i.inherits(a,r);a.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){"use strict";var r=e("./DataReader");var i=e("../utils");function a(e){r.call(this,e)}i.inherits(a,r);a.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)};a.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero};a.prototype.readAndCheckSignature=function(e){var t=this.readData(4);return e===t};a.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){"use strict";var r=e("./ArrayReader");var i=e("../utils");function a(e){r.call(this,e)}i.inherits(a,r);a.prototype.readData=function(e){this.checkOffset(e);if(e===0){return new Uint8Array(0)}var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);this.index+=e;return t};t.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){"use strict";var r=e("../utils");var i=e("../support");var a=e("./ArrayReader");var s=e("./StringReader");var o=e("./NodeBufferReader");var l=e("./Uint8ArrayReader");t.exports=function(e){var t=r.getTypeOf(e);r.checkSupport(t);if(t==="string"&&!i.uint8array){return new s(e)}if(t==="nodebuffer"){return new o(e)}if(i.uint8array){return new l(r.transformTo("uint8array",e))}return new a(r.transformTo("array",e))}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK";n.CENTRAL_FILE_HEADER="PK";n.CENTRAL_DIRECTORY_END="PK";n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK";n.ZIP64_CENTRAL_DIRECTORY_END="PK";n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){"use strict";var r=e("./GenericWorker");var i=e("../utils");function a(e){r.call(this,"ConvertWorker to "+e);this.destType=e}i.inherits(a,r);a.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})};t.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){"use strict";var r=e("./GenericWorker");var i=e("../crc32");var a=e("../utils");function s(){r.call(this,"Crc32Probe");this.withStreamInfo("crc32",0)}a.inherits(s,r);s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0);this.push(e)};t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){"use strict";var r=e("../utils");var i=e("./GenericWorker");function a(e){i.call(this,"DataLengthProbe for "+e);this.propName=e;this.withStreamInfo(e,0)}r.inherits(a,i);a.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)};t.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){"use strict";var r=e("../utils");var i=e("./GenericWorker");var a=16*1024;function s(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=false;this.index=0;this.max=0;this.data=null;this.type="";this._tickScheduled=false;e.then(function(e){t.dataIsReady=true;t.data=e;t.max=e&&e.length||0;t.type=r.getTypeOf(e);if(!t.isPaused){t._tickAndRepeat()}},function(e){t.error(e)})}r.inherits(s,i);s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this);this.data=null};s.prototype.resume=function(){if(!i.prototype.resume.call(this)){return false}if(!this._tickScheduled&&this.dataIsReady){this._tickScheduled=true;r.delay(this._tickAndRepeat,[],this)}return true};s.prototype._tickAndRepeat=function(){this._tickScheduled=false;if(this.isPaused||this.isFinished){return}this._tick();if(!this.isFinished){r.delay(this._tickAndRepeat,[],this);this._tickScheduled=true}};s.prototype._tick=function(){if(this.isPaused||this.isFinished){return false}var e=a;var t=null,n=Math.min(this.max,this.index+e);if(this.index>=this.max){return this.end()}else{switch(this.type){case"string":t=this.data.substring(this.index,n);break;case"uint8array":t=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":t=this.data.slice(this.index,n);break}this.index=n;return this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})}};t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){"use strict";function r(e){this.name=e||"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=true;this.isFinished=false;this.isLocked=false;this._listeners={data:[],end:[],error:[]};this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished){return false}this.flush();try{this.emit("end");this.cleanUp();this.isFinished=true}catch(e){this.emit("error",e)}return true},error:function(e){if(this.isFinished){return false}if(this.isPaused){this.generatedError=e}else{this.isFinished=true;this.emit("error",e);if(this.previous){this.previous.error(e)}this.cleanUp()}return true},on:function(e,t){this._listeners[e].push(t);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(e,t){if(this._listeners[e]){for(var n=0;n<this._listeners[e].length;n++){this._listeners[e][n].call(this,t)}}},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.")}this.streamInfo=e.streamInfo;this.mergeStreamInfo();this.previous=e;var t=this;e.on("data",function(e){t.processChunk(e)});e.on("end",function(){t.end()});e.on("error",function(e){t.error(e)});return this},pause:function(){if(this.isPaused||this.isFinished){return false}this.isPaused=true;if(this.previous){this.previous.pause()}return true},resume:function(){if(!this.isPaused||this.isFinished){return false}this.isPaused=false;var e=false;if(this.generatedError){this.error(this.generatedError);e=true}if(this.previous){this.previous.resume()}return!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){this.extraStreamInfo[e]=t;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(e)){continue}this.streamInfo[e]=this.extraStreamInfo[e]}},lock:function(){if(this.isLocked){throw new Error("The stream '"+this+"' has already been used.")}this.isLocked=true;if(this.previous){this.previous.lock()}},toString:function(){var e="Worker "+this.name;if(this.previous){return this.previous+" -> "+e}else{return e}}};t.exports=r},{}],29:[function(e,t,n){"use strict";var i=e("../utils");var a=e("./ConvertWorker");var s=e("./GenericWorker");var r=e("../base64");var o=e("../support");var l=e("../external");var u=null;if(o.nodestream){try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}}function c(e,t,n){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),n);case"base64":return r.encode(t);default:return i.transformTo(e,t)}}function h(e,t){var n,r=0,i=null,a=0;for(n=0;n<t.length;n++){a+=t[n].length}switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":i=new Uint8Array(a);for(n=0;n<t.length;n++){i.set(t[n],r);r+=t[n].length}return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}function d(e,o){return new l.Promise(function(t,n){var r=[];var i=e._internalType,a=e._outputType,s=e._mimeType;e.on("data",function(e,t){r.push(e);if(o){o(t)}}).on("error",function(e){r=[];n(e)}).on("end",function(){try{var e=c(a,h(i,r),s);t(e)}catch(e){n(e)}r=[]}).resume()})}function f(e,t,n){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string";break}try{this._internalType=r;this._outputType=t;this._mimeType=n;i.checkSupport(r);this._worker=e.pipe(new a(r));e.lock()}catch(e){this._worker=new s("error");this._worker.error(e)}}f.prototype={accumulate:function(e){return d(this,e)},on:function(e,t){var n=this;if(e==="data"){this._worker.on(e,function(e){t.call(n,e.data,e.meta)})}else{this._worker.on(e,function(){i.delay(t,arguments,n)})}return this},resume:function(){i.delay(this._worker.resume,[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(e){i.checkSupport("nodestream");if(this._outputType!=="nodebuffer"){throw new Error(this._outputType+" is not supported by this method")}return new u(this,{objectMode:this._outputType!=="nodebuffer"},e)}};t.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){"use strict";n.base64=true;n.array=true;n.string=true;n.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";n.nodebuffer=typeof Buffer!=="undefined";n.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined"){n.blob=false}else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch(e){try{var i=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;var a=new i;a.append(r);n.blob=a.getBlob("application/zip").size===0}catch(e){n.blob=false}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=false}},{"readable-stream":16}],31:[function(e,t,a){"use strict";var l=e("./utils");var u=e("./support");var n=e("./nodejsUtils");var r=e("./stream/GenericWorker");var c=new Array(256);for(var i=0;i<256;i++){c[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1}c[254]=c[254]=1;var s=function(e){var t,n,r,i,a,s=e.length,o=0;for(i=0;i<s;i++){n=e.charCodeAt(i);if((n&64512)===55296&&i+1<s){r=e.charCodeAt(i+1);if((r&64512)===56320){n=65536+(n-55296<<10)+(r-56320);i++}}o+=n<128?1:n<2048?2:n<65536?3:4}if(u.uint8array){t=new Uint8Array(o)}else{t=new Array(o)}for(a=0,i=0;a<o;i++){n=e.charCodeAt(i);if((n&64512)===55296&&i+1<s){r=e.charCodeAt(i+1);if((r&64512)===56320){n=65536+(n-55296<<10)+(r-56320);i++}}if(n<128){t[a++]=n}else if(n<2048){t[a++]=192|n>>>6;t[a++]=128|n&63}else if(n<65536){t[a++]=224|n>>>12;t[a++]=128|n>>>6&63;t[a++]=128|n&63}else{t[a++]=240|n>>>18;t[a++]=128|n>>>12&63;t[a++]=128|n>>>6&63;t[a++]=128|n&63}}return t};var o=function(e,t){var n;t=t||e.length;if(t>e.length){t=e.length}n=t-1;while(n>=0&&(e[n]&192)===128){n--}if(n<0){return t}if(n===0){return t}return n+c[e[n]]>t?n:t};var h=function(e){var t,n,r,i,a;var s=e.length;var o=new Array(s*2);for(r=0,n=0;n<s;){i=e[n++];if(i<128){o[r++]=i;continue}a=c[i];if(a>4){o[r++]=65533;n+=a-1;continue}i&=a===2?31:a===3?15:7;while(a>1&&n<s){i=i<<6|e[n++]&63;a--}if(a>1){o[r++]=65533;continue}if(i<65536){o[r++]=i}else{i-=65536;o[r++]=55296|i>>10&1023;o[r++]=56320|i&1023}}if(o.length!==r){if(o.subarray){o=o.subarray(0,r)}else{o.length=r}}return l.applyFromCharCode(o)};a.utf8encode=function e(t){if(u.nodebuffer){return n.newBufferFrom(t,"utf-8")}return s(t)};a.utf8decode=function e(t){if(u.nodebuffer){return l.transformTo("nodebuffer",t).toString("utf-8")}t=l.transformTo(u.uint8array?"uint8array":"array",t);return h(t)};function d(){r.call(this,"utf-8 decode");this.leftOver=null}l.inherits(d,r);d.prototype.processChunk=function(e){var t=l.transformTo(u.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(u.uint8array){var n=t;t=new Uint8Array(n.length+this.leftOver.length);t.set(this.leftOver,0);t.set(n,this.leftOver.length)}else{t=this.leftOver.concat(t)}this.leftOver=null}var r=o(t);var i=t;if(r!==t.length){if(u.uint8array){i=t.subarray(0,r);this.leftOver=t.subarray(r,t.length)}else{i=t.slice(0,r);this.leftOver=t.slice(r,t.length)}}this.push({data:a.utf8decode(i),meta:e.meta})};d.prototype.flush=function(){if(this.leftOver&&this.leftOver.length){this.push({data:a.utf8decode(this.leftOver),meta:{}});this.leftOver=null}};a.Utf8DecodeWorker=d;function f(){r.call(this,"utf-8 encode")}l.inherits(f,r);f.prototype.processChunk=function(e){this.push({data:a.utf8encode(e.data),meta:e.meta})};a.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,s){"use strict";var o=e("./support");var l=e("./base64");var n=e("./nodejsUtils");var r=e("set-immediate-shim");var u=e("./external");function c(e){var t=null;if(o.uint8array){t=new Uint8Array(e.length)}else{t=new Array(e.length)}return a(e,t)}s.newBlob=function(t,n){s.checkSupport("blob");try{return new Blob([t],{type:n})}catch(e){try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;var i=new r;i.append(t);return i.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};function i(e){return e}function a(e,t){for(var n=0;n<e.length;++n){t[n]=e.charCodeAt(n)&255}return t}var h={stringifyByChunk:function(e,t,n){var r=[],i=0,a=e.length;if(a<=n){return String.fromCharCode.apply(null,e)}while(i<a){if(t==="array"||t==="nodebuffer"){r.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,a))))}else{r.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,a))))}i+=n}return r.join("")},stringifyByChar:function(e){var t="";for(var n=0;n<e.length;n++){t+=String.fromCharCode(e[n])}return t},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(e){return false}}(),nodebuffer:function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch(e){return false}}()}};function d(e){var t=65536,n=s.getTypeOf(e),r=true;if(n==="uint8array"){r=h.applyCanBeUsed.uint8array}else if(n==="nodebuffer"){r=h.applyCanBeUsed.nodebuffer}if(r){while(t>1){try{return h.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}}}return h.stringifyByChar(e)}s.applyFromCharCode=d;function f(e,t){for(var n=0;n<e.length;n++){t[n]=e[n]}return t}var p={};p["string"]={string:i,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return p["string"]["uint8array"](e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:function(e){return a(e,n.allocBuffer(e.length))}};p["array"]={string:d,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(e)}};p["arraybuffer"]={string:function(e){return d(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(new Uint8Array(e))}};p["uint8array"]={string:d,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return n.newBufferFrom(e)}};p["nodebuffer"]={string:d,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return p["nodebuffer"]["uint8array"](e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:i};s.transformTo=function(e,t){if(!t){t=""}if(!e){return t}s.checkSupport(e);var n=s.getTypeOf(t);var r=p[n][e](t);return r};s.getTypeOf=function(e){if(typeof e==="string"){return"string"}if(Object.prototype.toString.call(e)==="[object Array]"){return"array"}if(o.nodebuffer&&n.isBuffer(e)){return"nodebuffer"}if(o.uint8array&&e instanceof Uint8Array){return"uint8array"}if(o.arraybuffer&&e instanceof ArrayBuffer){return"arraybuffer"}};s.checkSupport=function(e){var t=o[e.toLowerCase()];if(!t){throw new Error(e+" is not supported by this platform")}};s.MAX_VALUE_16BITS=65535;s.MAX_VALUE_32BITS=-1;s.pretty=function(e){var t="",n,r;for(r=0;r<(e||"").length;r++){n=e.charCodeAt(r);t+="\\x"+(n<16?"0":"")+n.toString(16).toUpperCase()}return t};s.delay=function(e,t,n){r(function(){e.apply(n||null,t||[])})};s.inherits=function(e,t){var n=function(){};n.prototype=t.prototype;e.prototype=new n};s.extend=function(){var e={},t,n;for(t=0;t<arguments.length;t++){for(n in arguments[t]){if(arguments[t].hasOwnProperty(n)&&typeof e[n]==="undefined"){e[n]=arguments[t][n]}}}return e};s.prepareContent=function(n,e,r,i,a){var t=u.Promise.resolve(e).then(function(r){var e=o.blob&&(r instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(r))!==-1);if(e&&typeof FileReader!=="undefined"){return new u.Promise(function(t,n){var e=new FileReader;e.onload=function(e){t(e.target.result)};e.onerror=function(e){n(e.target.error)};e.readAsArrayBuffer(r)})}else{return r}});return t.then(function(e){var t=s.getTypeOf(e);if(!t){return u.Promise.reject(new Error("Can't read the data of '"+n+"'. Is it "+"in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}if(t==="arraybuffer"){e=s.transformTo("uint8array",e)}else if(t==="string"){if(a){e=l.decode(e)}else if(r){if(i!==true){e=c(e)}}}return e})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,n){"use strict";var r=e("./reader/readerFor");var a=e("./utils");var s=e("./signature");var i=e("./zipEntry");var o=e("./utf8");var l=e("./support");function u(e){this.files=[];this.loadOptions=e}u.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature "+"("+a.pretty(t)+", expected "+a.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4);var i=r===t;this.reader.setIndex(n);return i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength);var t=l.uint8array?"uint8array":"array";var n=a.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var e=this.zip64EndOfCentralSize-44,t=0,n,r,i;while(t<e){n=this.reader.readInt(2);r=this.reader.readInt(4);i=this.reader.readData(r);this.zip64ExtensibleData[n]={id:n,length:r,value:i}}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1){throw new Error("Multi-volumes zip are not supported")}},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++){t=this.files[e];this.reader.setIndex(t.localHeaderOffset);this.checkSignature(s.LOCAL_FILE_HEADER);t.readLocalPart(this.reader);t.handleUTF8();t.processAttributes()}},readCentralDir:function(){var e;this.reader.setIndex(this.centralDirOffset);while(this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER)){e=new i({zip64:this.zip64},this.loadOptions);e.readCentralPart(this.reader);this.files.push(e)}if(this.centralDirRecords!==this.files.length){if(this.centralDirRecords!==0&&this.files.length===0){throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)}else{}}},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0){var t=!this.isSignature(0,s.LOCAL_FILE_HEADER);if(t){throw new Error("Can't find end of central directory : is this a zip file ? "+"If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html")}else{throw new Error("Corrupted zip: can't find end of central directory")}}this.reader.setIndex(e);var n=e;this.checkSignature(s.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){this.zip64=true;e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(e<0){throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator")}this.reader.setIndex(e);this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)){this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END);if(this.relativeOffsetEndOfZip64CentralDir<0){throw new Error("Corrupted zip: can't find the ZIP64 end of central directory")}}this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;if(this.zip64){r+=20;r+=12+this.zip64EndOfCentralSize}var i=n-r;if(i>0){if(this.isSignature(n,s.CENTRAL_FILE_HEADER)){}else{this.reader.zero=i}}else if(i<0){throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")}},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};t.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){"use strict";var r=e("./reader/readerFor");var a=e("./utils");var i=e("./compressedObject");var s=e("./crc32");var o=e("./utf8");var l=e("./compressions");var u=e("./support");var c=0;var h=3;var d=function(e){for(var t in l){if(!l.hasOwnProperty(t)){continue}if(l[t].magic===e){return l[t]}}return null};function f(e,t){this.options=e;this.loadOptions=t}f.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(e){var t,n;e.skip(22);this.fileNameLength=e.readInt(2);n=e.readInt(2);this.fileName=e.readData(this.fileNameLength);e.skip(n);if(this.compressedSize===-1||this.uncompressedSize===-1){throw new Error("Bug or corrupted zip : didn't get enough information from the central directory "+"(compressedSize === -1 || uncompressedSize === -1)")}t=d(this.compressionMethod);if(t===null){throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")")}this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2);e.skip(2);this.bitFlag=e.readInt(2);this.compressionMethod=e.readString(2);this.date=e.readDate();this.crc32=e.readInt(4);this.compressedSize=e.readInt(4);this.uncompressedSize=e.readInt(4);var t=e.readInt(2);this.extraFieldsLength=e.readInt(2);this.fileCommentLength=e.readInt(2);this.diskNumberStart=e.readInt(2);this.internalFileAttributes=e.readInt(2);this.externalFileAttributes=e.readInt(4);this.localHeaderOffset=e.readInt(4);if(this.isEncrypted()){throw new Error("Encrypted zip are not supported")}e.skip(t);this.readExtraFields(e);this.parseZIP64ExtraField(e);this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null;this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?true:false;if(e===c){this.dosPermissions=this.externalFileAttributes&63}if(e===h){this.unixPermissions=this.externalFileAttributes>>16&65535}if(!this.dir&&this.fileNameStr.slice(-1)==="/"){this.dir=true}},parseZIP64ExtraField:function(e){if(!this.extraFields[1]){return}var t=r(this.extraFields[1].value);if(this.uncompressedSize===a.MAX_VALUE_32BITS){this.uncompressedSize=t.readInt(8)}if(this.compressedSize===a.MAX_VALUE_32BITS){this.compressedSize=t.readInt(8)}if(this.localHeaderOffset===a.MAX_VALUE_32BITS){this.localHeaderOffset=t.readInt(8)}if(this.diskNumberStart===a.MAX_VALUE_32BITS){this.diskNumberStart=t.readInt(4)}},readExtraFields:function(e){var t=e.index+this.extraFieldsLength,n,r,i;if(!this.extraFields){this.extraFields={}}while(e.index+4<t){n=e.readInt(2);r=e.readInt(2);i=e.readData(r);this.extraFields[n]={id:n,length:r,value:i}}e.setIndex(t)},handleUTF8:function(){var e=u.uint8array?"uint8array":"array";if(this.useUTF8()){this.fileNameStr=o.utf8decode(this.fileName);this.fileCommentStr=o.utf8decode(this.fileComment)}else{var t=this.findExtraFieldUnicodePath();if(t!==null){this.fileNameStr=t}else{var n=a.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(r!==null){this.fileCommentStr=r}else{var i=a.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);if(t.readInt(1)!==1){return null}if(s(this.fileName)!==t.readInt(4)){return null}return o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);if(t.readInt(1)!==1){return null}if(s(this.fileComment)!==t.readInt(4)){return null}return o.utf8decode(t.readData(e.length-5))}return null}};t.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){"use strict";var a=e("./stream/StreamHelper");var r=e("./stream/DataWorker");var s=e("./utf8");var i=e("./compressedObject");var o=e("./stream/GenericWorker");var l=function(e,t,n){this.name=e;this.dir=n.dir;this.date=n.date;this.comment=n.comment;this.unixPermissions=n.unixPermissions;this.dosPermissions=n.dosPermissions;this._data=t;this._dataBinary=n.binary;this.options={compression:n.compression,compressionOptions:n.compressionOptions}};l.prototype={internalStream:function(e){var t=null,n="string";try{if(!e){throw new Error("No output type specified.")}n=e.toLowerCase();var r=n==="string"||n==="text";if(n==="binarystring"||n==="text"){n="string"}t=this._decompressWorker();var i=!this._dataBinary;if(i&&!r){t=t.pipe(new s.Utf8EncodeWorker)}if(!i&&r){t=t.pipe(new s.Utf8DecodeWorker)}}catch(e){t=new o("error");t.error(e)}return new a(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof i&&this._data.compression.magic===e.magic){return this._data.getCompressedWorker()}else{var n=this._decompressWorker();if(!this._dataBinary){n=n.pipe(new s.Utf8EncodeWorker)}return i.createWorkerFrom(n,e,t)}},_decompressWorker:function(){if(this._data instanceof i){return this._data.getContentWorker()}else if(this._data instanceof o){return this._data}else{return new r(this._data)}}};var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"];var c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(var h=0;h<u.length;h++){l.prototype[u[h]]=c}t.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,h,t){(function(t){"use strict";var e=t.MutationObserver||t.WebKitMutationObserver;var n;{if(e){var r=0;var i=new e(u);var a=t.document.createTextNode("");i.observe(a,{characterData:true});n=function(){a.data=r=++r%2}}else if(!t.setImmediate&&typeof t.MessageChannel!=="undefined"){var s=new t.MessageChannel;s.port1.onmessage=u;n=function(){s.port2.postMessage(0)}}else if("document"in t&&"onreadystatechange"in t.document.createElement("script")){n=function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u();e.onreadystatechange=null;e.parentNode.removeChild(e);e=null};t.document.documentElement.appendChild(e)}}else{n=function(){setTimeout(u,0)}}}var o;var l=[];function u(){o=true;var e,t;var n=l.length;while(n){t=l;l=[];e=-1;while(++e<n){t[e]()}n=l.length}o=false}h.exports=c;function c(e){if(l.push(e)===1&&!o){n()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],37:[function(e,t,n){"use strict";var i=e("immediate");function u(){}var c={};var a=["REJECTED"];var s=["FULFILLED"];var o=["PENDING"];t.exports=r;function r(e){if(typeof e!=="function"){throw new TypeError("resolver must be a function")}this.state=o;this.queue=[];this.outcome=void 0;if(e!==u){f(this,e)}}r.prototype["finally"]=function(n){if(typeof n!=="function"){return this}var r=this.constructor;return this.then(e,t);function e(e){function t(){return e}return r.resolve(n()).then(t)}function t(e){function t(){throw e}return r.resolve(n()).then(t)}};r.prototype["catch"]=function(e){return this.then(null,e)};r.prototype.then=function(e,t){if(typeof e!=="function"&&this.state===s||typeof t!=="function"&&this.state===a){return this}var n=new this.constructor(u);if(this.state!==o){var r=this.state===s?e:t;h(n,r,this.outcome)}else{this.queue.push(new l(n,e,t))}return n};function l(e,t,n){this.promise=e;if(typeof t==="function"){this.onFulfilled=t;this.callFulfilled=this.otherCallFulfilled}if(typeof n==="function"){this.onRejected=n;this.callRejected=this.otherCallRejected}}l.prototype.callFulfilled=function(e){c.resolve(this.promise,e)};l.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)};l.prototype.callRejected=function(e){c.reject(this.promise,e)};l.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)};function h(t,n,r){i(function(){var e;try{e=n(r)}catch(e){return c.reject(t,e)}if(e===t){c.reject(t,new TypeError("Cannot resolve promise with itself"))}else{c.resolve(t,e)}})}c.resolve=function(e,t){var n=p(d,t);if(n.status==="error"){return c.reject(e,n.value)}var r=n.value;if(r){f(e,r)}else{e.state=s;e.outcome=t;var i=-1;var a=e.queue.length;while(++i<a){e.queue[i].callFulfilled(t)}}return e};c.reject=function(e,t){e.state=a;e.outcome=t;var n=-1;var r=e.queue.length;while(++n<r){e.queue[n].callRejected(t)}return e};function d(t){var n=t&&t.then;if(t&&(typeof t==="object"||typeof t==="function")&&typeof n==="function"){return function e(){n.apply(t,arguments)}}}function f(t,e){var n=false;function r(e){if(n){return}n=true;c.reject(t,e)}function i(e){if(n){return}n=true;c.resolve(t,e)}function a(){e(i,r)}var s=p(a);if(s.status==="error"){r(s.value)}}function p(e,t){var n={};try{n.value=e(t);n.status="success"}catch(e){n.status="error";n.value=e}return n}r.resolve=m;function m(e){if(e instanceof this){return e}return c.resolve(new this(u),e)}r.reject=g;function g(e){var t=new this(u);return c.reject(t,e)}r.all=v;function v(e){var r=this;if(Object.prototype.toString.call(e)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var i=e.length;var a=false;if(!i){return this.resolve([])}var s=new Array(i);var o=0;var t=-1;var l=new this(u);while(++t<i){n(e[t],t)}return l;function n(e,t){r.resolve(e).then(n,function(e){if(!a){a=true;c.reject(l,e)}});function n(e){s[t]=e;if(++o===i&&!a){a=true;c.resolve(l,s)}}}}r.race=b;function b(e){var t=this;if(Object.prototype.toString.call(e)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var n=e.length;var r=false;if(!n){return this.resolve([])}var i=-1;var a=new this(u);while(++i<n){s(e[i])}return a;function s(e){t.resolve(e).then(function(e){if(!r){r=true;c.resolve(a,e)}},function(e){if(!r){r=true;c.reject(a,e)}})}}},{immediate:36}],38:[function(e,t,n){"use strict";var r=e("./lib/utils/common").assign;var i=e("./lib/deflate");var a=e("./lib/inflate");var s=e("./lib/zlib/constants");var o={};r(o,i,a,s);t.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){"use strict";var s=e("./zlib/deflate");var o=e("./utils/common");var l=e("./utils/strings");var i=e("./zlib/messages");var a=e("./zlib/zstream");var u=Object.prototype.toString;var c=0;var h=4;var d=0;var f=1;var p=2;var m=-1;var g=0;var v=8;function b(e){if(!(this instanceof b))return new b(e);this.options=o.assign({level:m,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>0){t.windowBits=-t.windowBits}else if(t.gzip&&t.windowBits>0&&t.windowBits<16){t.windowBits+=16}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new a;this.strm.avail_out=0;var n=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==d){throw new Error(i[n])}if(t.header){s.deflateSetHeader(this.strm,t.header)}if(t.dictionary){var r;if(typeof t.dictionary==="string"){r=l.string2buf(t.dictionary)}else if(u.call(t.dictionary)==="[object ArrayBuffer]"){r=new Uint8Array(t.dictionary)}else{r=t.dictionary}n=s.deflateSetDictionary(this.strm,r);if(n!==d){throw new Error(i[n])}this._dict_set=true}}b.prototype.push=function(e,t){var n=this.strm;var r=this.options.chunkSize;var i,a;if(this.ended){return false}a=t===~~t?t:t===true?h:c;if(typeof e==="string"){n.input=l.string2buf(e)}else if(u.call(e)==="[object ArrayBuffer]"){n.input=new Uint8Array(e)}else{n.input=e}n.next_in=0;n.avail_in=n.input.length;do{if(n.avail_out===0){n.output=new o.Buf8(r);n.next_out=0;n.avail_out=r}i=s.deflate(n,a);if(i!==f&&i!==d){this.onEnd(i);this.ended=true;return false}if(n.avail_out===0||n.avail_in===0&&(a===h||a===p)){if(this.options.to==="string"){this.onData(l.buf2binstring(o.shrinkBuf(n.output,n.next_out)))}else{this.onData(o.shrinkBuf(n.output,n.next_out))}}}while((n.avail_in>0||n.avail_out===0)&&i!==f);if(a===h){i=s.deflateEnd(this.strm);this.onEnd(i);this.ended=true;return i===d}if(a===p){this.onEnd(d);n.avail_out=0;return true}return true};b.prototype.onData=function(e){this.chunks.push(e)};b.prototype.onEnd=function(e){if(e===d){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=o.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function r(e,t){var n=new b(t);n.push(e,true);if(n.err){throw n.msg||i[n.err]}return n.result}function _(e,t){t=t||{};t.raw=true;return r(e,t)}function F(e,t){t=t||{};t.gzip=true;return r(e,t)}n.Deflate=b;n.deflate=r;n.deflateRaw=_;n.gzip=F},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){"use strict";var d=e("./zlib/inflate");var f=e("./utils/common");var p=e("./utils/strings");var m=e("./zlib/constants");var r=e("./zlib/messages");var i=e("./zlib/zstream");var a=e("./zlib/gzheader");var g=Object.prototype.toString;function s(e){if(!(this instanceof s))return new s(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>=0&&t.windowBits<16){t.windowBits=-t.windowBits;if(t.windowBits===0){t.windowBits=-15}}if(t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)){t.windowBits+=32}if(t.windowBits>15&&t.windowBits<48){if((t.windowBits&15)===0){t.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new i;this.strm.avail_out=0;var n=d.inflateInit2(this.strm,t.windowBits);if(n!==m.Z_OK){throw new Error(r[n])}this.header=new a;d.inflateGetHeader(this.strm,this.header)}s.prototype.push=function(e,t){var n=this.strm;var r=this.options.chunkSize;var i=this.options.dictionary;var a,s;var o,l,u;var c;var h=false;if(this.ended){return false}s=t===~~t?t:t===true?m.Z_FINISH:m.Z_NO_FLUSH;if(typeof e==="string"){n.input=p.binstring2buf(e)}else if(g.call(e)==="[object ArrayBuffer]"){n.input=new Uint8Array(e)}else{n.input=e}n.next_in=0;n.avail_in=n.input.length;do{if(n.avail_out===0){n.output=new f.Buf8(r);n.next_out=0;n.avail_out=r}a=d.inflate(n,m.Z_NO_FLUSH);if(a===m.Z_NEED_DICT&&i){if(typeof i==="string"){c=p.string2buf(i)}else if(g.call(i)==="[object ArrayBuffer]"){c=new Uint8Array(i)}else{c=i}a=d.inflateSetDictionary(this.strm,c)}if(a===m.Z_BUF_ERROR&&h===true){a=m.Z_OK;h=false}if(a!==m.Z_STREAM_END&&a!==m.Z_OK){this.onEnd(a);this.ended=true;return false}if(n.next_out){if(n.avail_out===0||a===m.Z_STREAM_END||n.avail_in===0&&(s===m.Z_FINISH||s===m.Z_SYNC_FLUSH)){if(this.options.to==="string"){o=p.utf8border(n.output,n.next_out);l=n.next_out-o;u=p.buf2string(n.output,o);n.next_out=l;n.avail_out=r-l;if(l){f.arraySet(n.output,n.output,o,l,0)}this.onData(u)}else{this.onData(f.shrinkBuf(n.output,n.next_out))}}}if(n.avail_in===0&&n.avail_out===0){h=true}}while((n.avail_in>0||n.avail_out===0)&&a!==m.Z_STREAM_END);if(a===m.Z_STREAM_END){s=m.Z_FINISH}if(s===m.Z_FINISH){a=d.inflateEnd(this.strm);this.onEnd(a);this.ended=true;return a===m.Z_OK}if(s===m.Z_SYNC_FLUSH){this.onEnd(m.Z_OK);n.avail_out=0;return true}return true};s.prototype.onData=function(e){this.chunks.push(e)};s.prototype.onEnd=function(e){if(e===m.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=f.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function o(e,t){var n=new s(t);n.push(e,true);if(n.err){throw n.msg||r[n.err]}return n.result}function l(e,t){t=t||{};t.raw=true;return o(e,t)}n.Inflate=s;n.inflate=o;n.inflateRaw=l;n.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){"use strict";var r=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";n.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var n=t.shift();if(!n){continue}if(typeof n!=="object"){throw new TypeError(n+"must be non-object")}for(var r in n){if(n.hasOwnProperty(r)){e[r]=n[r]}}}return e};n.shrinkBuf=function(e,t){if(e.length===t){return e}if(e.subarray){return e.subarray(0,t)}e.length=t;return e};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray){e.set(t.subarray(n,n+r),i);return}for(var a=0;a<r;a++){e[i+a]=t[n+a]}},flattenChunks:function(e){var t,n,r,i,a,s;r=0;for(t=0,n=e.length;t<n;t++){r+=e[t].length}s=new Uint8Array(r);i=0;for(t=0,n=e.length;t<n;t++){a=e[t];s.set(a,i);i+=a.length}return s}};var a={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++){e[i+a]=t[n+a]}},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){if(e){n.Buf8=Uint8Array;n.Buf16=Uint16Array;n.Buf32=Int32Array;n.assign(n,i)}else{n.Buf8=Array;n.Buf16=Array;n.Buf32=Array;n.assign(n,a)}};n.setTyped(r)},{}],42:[function(e,t,n){"use strict";var l=e("./common");var i=true;var a=true;try{String.fromCharCode.apply(null,[0])}catch(e){i=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=false}var u=new l.Buf8(256);for(var r=0;r<256;r++){u[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1}u[254]=u[254]=1;n.string2buf=function(e){var t,n,r,i,a,s=e.length,o=0;for(i=0;i<s;i++){n=e.charCodeAt(i);if((n&64512)===55296&&i+1<s){r=e.charCodeAt(i+1);if((r&64512)===56320){n=65536+(n-55296<<10)+(r-56320);i++}}o+=n<128?1:n<2048?2:n<65536?3:4}t=new l.Buf8(o);for(a=0,i=0;a<o;i++){n=e.charCodeAt(i);if((n&64512)===55296&&i+1<s){r=e.charCodeAt(i+1);if((r&64512)===56320){n=65536+(n-55296<<10)+(r-56320);i++}}if(n<128){t[a++]=n}else if(n<2048){t[a++]=192|n>>>6;t[a++]=128|n&63}else if(n<65536){t[a++]=224|n>>>12;t[a++]=128|n>>>6&63;t[a++]=128|n&63}else{t[a++]=240|n>>>18;t[a++]=128|n>>>12&63;t[a++]=128|n>>>6&63;t[a++]=128|n&63}}return t};function c(e,t){if(t<65537){if(e.subarray&&a||!e.subarray&&i){return String.fromCharCode.apply(null,l.shrinkBuf(e,t))}}var n="";for(var r=0;r<t;r++){n+=String.fromCharCode(e[r])}return n}n.buf2binstring=function(e){return c(e,e.length)};n.binstring2buf=function(e){var t=new l.Buf8(e.length);for(var n=0,r=t.length;n<r;n++){t[n]=e.charCodeAt(n)}return t};n.buf2string=function(e,t){var n,r,i,a;var s=t||e.length;var o=new Array(s*2);for(r=0,n=0;n<s;){i=e[n++];if(i<128){o[r++]=i;continue}a=u[i];if(a>4){o[r++]=65533;n+=a-1;continue}i&=a===2?31:a===3?15:7;while(a>1&&n<s){i=i<<6|e[n++]&63;a--}if(a>1){o[r++]=65533;continue}if(i<65536){o[r++]=i}else{i-=65536;o[r++]=55296|i>>10&1023;o[r++]=56320|i&1023}}return c(o,r)};n.utf8border=function(e,t){var n;t=t||e.length;if(t>e.length){t=e.length}n=t-1;while(n>=0&&(e[n]&192)===128){n--}if(n<0){return t}if(n===0){return t}return n+u[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){"use strict";function r(e,t,n,r){var i=e&65535|0,a=e>>>16&65535|0,s=0;while(n!==0){s=n>2e3?2e3:n;n-=s;do{i=i+t[r++]|0;a=a+i|0}while(--s);i%=65521;a%=65521}return i|a<<16|0}t.exports=r},{}],44:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){"use strict";function r(){var e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++){e=e&1?3988292384^e>>>1:e>>>1}t[n]=e}return t}var o=r();function i(e,t,n,r){var i=o,a=r+n;e^=-1;for(var s=r;s<a;s++){e=e>>>8^i[(e^t[s])&255]}return e^-1}t.exports=i},{}],46:[function(e,t,n){"use strict";var h=e("../utils/common");var u=e("./trees");var d=e("./adler32");var c=e("./crc32");var r=e("./messages");var f=0;var p=1;var m=3;var g=4;var v=5;var b=0;var _=1;var F=-2;var i=-3;var C=-5;var l=-1;var a=1;var A=2;var E=3;var x=4;var s=0;var o=2;var B=8;var D=9;var y=15;var O=8;var I=29;var S=256;var T=S+1+I;var w=30;var N=19;var L=2*T+1;var k=15;var M=3;var P=258;var V=P+M+1;var U=32;var R=42;var G=69;var j=73;var z=91;var X=103;var W=113;var H=666;var Y=1;var Z=2;var K=3;var Q=4;var J=3;function q(e,t){e.msg=r[t];return t}function $(e){return(e<<1)-(e>4?9:0)}function ee(e){var t=e.length;while(--t>=0){e[t]=0}}function te(e){var t=e.state;var n=t.pending;if(n>e.avail_out){n=e.avail_out}if(n===0){return}h.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out);e.next_out+=n;t.pending_out+=n;e.total_out+=n;e.avail_out-=n;t.pending-=n;if(t.pending===0){t.pending_out=0}}function ne(e,t){u._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t);e.block_start=e.strstart;te(e.strm)}function re(e,t){e.pending_buf[e.pending++]=t}function ie(e,t){e.pending_buf[e.pending++]=t>>>8&255;e.pending_buf[e.pending++]=t&255}function ae(e,t,n,r){var i=e.avail_in;if(i>r){i=r}if(i===0){return 0}e.avail_in-=i;h.arraySet(t,e.input,e.next_in,i,n);if(e.state.wrap===1){e.adler=d(e.adler,t,i,n)}else if(e.state.wrap===2){e.adler=c(e.adler,t,i,n)}e.next_in+=i;e.total_in+=i;return i}function se(e,t){var n=e.max_chain_length;var r=e.strstart;var i;var a;var s=e.prev_length;var o=e.nice_match;var l=e.strstart>e.w_size-V?e.strstart-(e.w_size-V):0;var u=e.window;var c=e.w_mask;var h=e.prev;var d=e.strstart+P;var f=u[r+s-1];var p=u[r+s];if(e.prev_length>=e.good_match){n>>=2}if(o>e.lookahead){o=e.lookahead}do{i=t;if(u[i+s]!==p||u[i+s-1]!==f||u[i]!==u[r]||u[++i]!==u[r+1]){continue}r+=2;i++;do{}while(u[++r]===u[++i]&&u[++r]===u[++i]&&u[++r]===u[++i]&&u[++r]===u[++i]&&u[++r]===u[++i]&&u[++r]===u[++i]&&u[++r]===u[++i]&&u[++r]===u[++i]&&r<d);a=P-(d-r);r=d-P;if(a>s){e.match_start=t;s=a;if(a>=o){break}f=u[r+s-1];p=u[r+s]}}while((t=h[t&c])>l&&--n!==0);if(s<=e.lookahead){return s}return e.lookahead}function oe(e){var t=e.w_size;var n,r,i,a,s;do{a=e.window_size-e.lookahead-e.strstart;if(e.strstart>=t+(t-V)){h.arraySet(e.window,e.window,t,t,0);e.match_start-=t;e.strstart-=t;e.block_start-=t;r=e.hash_size;n=r;do{i=e.head[--n];e.head[n]=i>=t?i-t:0}while(--r);r=t;n=r;do{i=e.prev[--n];e.prev[n]=i>=t?i-t:0}while(--r);a+=t}if(e.strm.avail_in===0){break}r=ae(e.strm,e.window,e.strstart+e.lookahead,a);e.lookahead+=r;if(e.lookahead+e.insert>=M){s=e.strstart-e.insert;e.ins_h=e.window[s];e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;while(e.insert){e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+M-1])&e.hash_mask;e.prev[s&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=s;s++;e.insert--;if(e.lookahead+e.insert<M){break}}}}while(e.lookahead<V&&e.strm.avail_in!==0)}function le(e,t){var n=65535;if(n>e.pending_buf_size-5){n=e.pending_buf_size-5}for(;;){if(e.lookahead<=1){oe(e);if(e.lookahead===0&&t===f){return Y}if(e.lookahead===0){break}}e.strstart+=e.lookahead;e.lookahead=0;var r=e.block_start+n;if(e.strstart===0||e.strstart>=r){e.lookahead=e.strstart-r;e.strstart=r;ne(e,false);if(e.strm.avail_out===0){return Y}}if(e.strstart-e.block_start>=e.w_size-V){ne(e,false);if(e.strm.avail_out===0){return Y}}}e.insert=0;if(t===g){ne(e,true);if(e.strm.avail_out===0){return K}return Q}if(e.strstart>e.block_start){ne(e,false);if(e.strm.avail_out===0){return Y}}return Y}function ue(e,t){var n;var r;for(;;){if(e.lookahead<V){oe(e);if(e.lookahead<V&&t===f){return Y}if(e.lookahead===0){break}}n=0;if(e.lookahead>=M){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}if(n!==0&&e.strstart-n<=e.w_size-V){e.match_length=se(e,n)}if(e.match_length>=M){r=u._tr_tally(e,e.strstart-e.match_start,e.match_length-M);e.lookahead-=e.match_length;if(e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do{e.strstart++;e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}while(--e.match_length!==0);e.strstart++}else{e.strstart+=e.match_length;e.match_length=0;e.ins_h=e.window[e.strstart];e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}}else{r=u._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(r){ne(e,false);if(e.strm.avail_out===0){return Y}}}e.insert=e.strstart<M-1?e.strstart:M-1;if(t===g){ne(e,true);if(e.strm.avail_out===0){return K}return Q}if(e.last_lit){ne(e,false);if(e.strm.avail_out===0){return Y}}return Z}function ce(e,t){var n;var r;var i;for(;;){if(e.lookahead<V){oe(e);if(e.lookahead<V&&t===f){return Y}if(e.lookahead===0){break}}n=0;if(e.lookahead>=M){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}e.prev_length=e.match_length;e.prev_match=e.match_start;e.match_length=M-1;if(n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-V){e.match_length=se(e,n);if(e.match_length<=5&&(e.strategy===a||e.match_length===M&&e.strstart-e.match_start>4096)){e.match_length=M-1}}if(e.prev_length>=M&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-M;r=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-M);e.lookahead-=e.prev_length-1;e.prev_length-=2;do{if(++e.strstart<=i){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask;n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}}while(--e.prev_length!==0);e.match_available=0;e.match_length=M-1;e.strstart++;if(r){ne(e,false);if(e.strm.avail_out===0){return Y}}}else if(e.match_available){r=u._tr_tally(e,0,e.window[e.strstart-1]);if(r){ne(e,false)}e.strstart++;e.lookahead--;if(e.strm.avail_out===0){return Y}}else{e.match_available=1;e.strstart++;e.lookahead--}}if(e.match_available){r=u._tr_tally(e,0,e.window[e.strstart-1]);e.match_available=0}e.insert=e.strstart<M-1?e.strstart:M-1;if(t===g){ne(e,true);if(e.strm.avail_out===0){return K}return Q}if(e.last_lit){ne(e,false);if(e.strm.avail_out===0){return Y}}return Z}function he(e,t){var n;var r;var i,a;var s=e.window;for(;;){if(e.lookahead<=P){oe(e);if(e.lookahead<=P&&t===f){return Y}if(e.lookahead===0){break}}e.match_length=0;if(e.lookahead>=M&&e.strstart>0){i=e.strstart-1;r=s[i];if(r===s[++i]&&r===s[++i]&&r===s[++i]){a=e.strstart+P;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);e.match_length=P-(a-i);if(e.match_length>e.lookahead){e.match_length=e.lookahead}}}if(e.match_length>=M){n=u._tr_tally(e,1,e.match_length-M);e.lookahead-=e.match_length;e.strstart+=e.match_length;e.match_length=0}else{n=u._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(n){ne(e,false);if(e.strm.avail_out===0){return Y}}}e.insert=0;if(t===g){ne(e,true);if(e.strm.avail_out===0){return K}return Q}if(e.last_lit){ne(e,false);if(e.strm.avail_out===0){return Y}}return Z}function de(e,t){var n;for(;;){if(e.lookahead===0){oe(e);if(e.lookahead===0){if(t===f){return Y}break}}e.match_length=0;n=u._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++;if(n){ne(e,false);if(e.strm.avail_out===0){return Y}}}e.insert=0;if(t===g){ne(e,true);if(e.strm.avail_out===0){return K}return Q}if(e.last_lit){ne(e,false);if(e.strm.avail_out===0){return Y}}return Z}function fe(e,t,n,r,i){this.good_length=e;this.max_lazy=t;this.nice_length=n;this.max_chain=r;this.func=i}var pe;pe=[new fe(0,0,0,0,le),new fe(4,4,8,4,ue),new fe(4,5,16,8,ue),new fe(4,6,32,32,ue),new fe(4,4,16,16,ce),new fe(8,16,32,32,ce),new fe(8,16,128,128,ce),new fe(8,32,128,256,ce),new fe(32,128,258,1024,ce),new fe(32,258,258,4096,ce)];function me(e){e.window_size=2*e.w_size;ee(e.head);e.max_lazy_match=pe[e.level].max_lazy;e.good_match=pe[e.level].good_length;e.nice_match=pe[e.level].nice_length;e.max_chain_length=pe[e.level].max_chain;e.strstart=0;e.block_start=0;e.lookahead=0;e.insert=0;e.match_length=e.prev_length=M-1;e.match_available=0;e.ins_h=0}function ge(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=B;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new h.Buf16(L*2);this.dyn_dtree=new h.Buf16((2*w+1)*2);this.bl_tree=new h.Buf16((2*N+1)*2);ee(this.dyn_ltree);ee(this.dyn_dtree);ee(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new h.Buf16(k+1);this.heap=new h.Buf16(2*T+1);ee(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new h.Buf16(2*T+1);ee(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function ve(e){var t;if(!e||!e.state){return q(e,F)}e.total_in=e.total_out=0;e.data_type=o;t=e.state;t.pending=0;t.pending_out=0;if(t.wrap<0){t.wrap=-t.wrap}t.status=t.wrap?R:W;e.adler=t.wrap===2?0:1;t.last_flush=f;u._tr_init(t);return b}function be(e){var t=ve(e);if(t===b){me(e.state)}return t}function _e(e,t){if(!e||!e.state){return F}if(e.state.wrap!==2){return F}e.state.gzhead=t;return b}function Fe(e,t,n,r,i,a){if(!e){return F}var s=1;if(t===l){t=6}if(r<0){s=0;r=-r}else if(r>15){s=2;r-=16}if(i<1||i>D||n!==B||r<8||r>15||t<0||t>9||a<0||a>x){return q(e,F)}if(r===8){r=9}var o=new ge;e.state=o;o.strm=e;o.wrap=s;o.gzhead=null;o.w_bits=r;o.w_size=1<<o.w_bits;o.w_mask=o.w_size-1;o.hash_bits=i+7;o.hash_size=1<<o.hash_bits;o.hash_mask=o.hash_size-1;o.hash_shift=~~((o.hash_bits+M-1)/M);o.window=new h.Buf8(o.w_size*2);o.head=new h.Buf16(o.hash_size);o.prev=new h.Buf16(o.w_size);o.lit_bufsize=1<<i+6;o.pending_buf_size=o.lit_bufsize*4;o.pending_buf=new h.Buf8(o.pending_buf_size);o.d_buf=1*o.lit_bufsize;o.l_buf=(1+2)*o.lit_bufsize;o.level=t;o.strategy=a;o.method=n;return be(e)}function Ce(e,t){return Fe(e,t,B,y,O,s)}function Ae(e,t){var n,r;var i,a;if(!e||!e.state||t>v||t<0){return e?q(e,F):F}r=e.state;if(!e.output||!e.input&&e.avail_in!==0||r.status===H&&t!==g){return q(e,e.avail_out===0?C:F)}r.strm=e;n=r.last_flush;r.last_flush=t;if(r.status===R){if(r.wrap===2){e.adler=0;re(r,31);re(r,139);re(r,8);if(!r.gzhead){re(r,0);re(r,0);re(r,0);re(r,0);re(r,0);re(r,r.level===9?2:r.strategy>=A||r.level<2?4:0);re(r,J);r.status=W}else{re(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(!r.gzhead.extra?0:4)+(!r.gzhead.name?0:8)+(!r.gzhead.comment?0:16));re(r,r.gzhead.time&255);re(r,r.gzhead.time>>8&255);re(r,r.gzhead.time>>16&255);re(r,r.gzhead.time>>24&255);re(r,r.level===9?2:r.strategy>=A||r.level<2?4:0);re(r,r.gzhead.os&255);if(r.gzhead.extra&&r.gzhead.extra.length){re(r,r.gzhead.extra.length&255);re(r,r.gzhead.extra.length>>8&255)}if(r.gzhead.hcrc){e.adler=c(e.adler,r.pending_buf,r.pending,0)}r.gzindex=0;r.status=G}}else{var s=B+(r.w_bits-8<<4)<<8;var o=-1;if(r.strategy>=A||r.level<2){o=0}else if(r.level<6){o=1}else if(r.level===6){o=2}else{o=3}s|=o<<6;if(r.strstart!==0){s|=U}s+=31-s%31;r.status=W;ie(r,s);if(r.strstart!==0){ie(r,e.adler>>>16);ie(r,e.adler&65535)}e.adler=1}}if(r.status===G){if(r.gzhead.extra){i=r.pending;while(r.gzindex<(r.gzhead.extra.length&65535)){if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i){e.adler=c(e.adler,r.pending_buf,r.pending-i,i)}te(e);i=r.pending;if(r.pending===r.pending_buf_size){break}}re(r,r.gzhead.extra[r.gzindex]&255);r.gzindex++}if(r.gzhead.hcrc&&r.pending>i){e.adler=c(e.adler,r.pending_buf,r.pending-i,i)}if(r.gzindex===r.gzhead.extra.length){r.gzindex=0;r.status=j}}else{r.status=j}}if(r.status===j){if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i){e.adler=c(e.adler,r.pending_buf,r.pending-i,i)}te(e);i=r.pending;if(r.pending===r.pending_buf_size){a=1;break}}if(r.gzindex<r.gzhead.name.length){a=r.gzhead.name.charCodeAt(r.gzindex++)&255}else{a=0}re(r,a)}while(a!==0);if(r.gzhead.hcrc&&r.pending>i){e.adler=c(e.adler,r.pending_buf,r.pending-i,i)}if(a===0){r.gzindex=0;r.status=z}}else{r.status=z}}if(r.status===z){if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i){e.adler=c(e.adler,r.pending_buf,r.pending-i,i)}te(e);i=r.pending;if(r.pending===r.pending_buf_size){a=1;break}}if(r.gzindex<r.gzhead.comment.length){a=r.gzhead.comment.charCodeAt(r.gzindex++)&255}else{a=0}re(r,a)}while(a!==0);if(r.gzhead.hcrc&&r.pending>i){e.adler=c(e.adler,r.pending_buf,r.pending-i,i)}if(a===0){r.status=X}}else{r.status=X}}if(r.status===X){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size){te(e)}if(r.pending+2<=r.pending_buf_size){re(r,e.adler&255);re(r,e.adler>>8&255);e.adler=0;r.status=W}}else{r.status=W}}if(r.pending!==0){te(e);if(e.avail_out===0){r.last_flush=-1;return b}}else if(e.avail_in===0&&$(t)<=$(n)&&t!==g){return q(e,C)}if(r.status===H&&e.avail_in!==0){return q(e,C)}if(e.avail_in!==0||r.lookahead!==0||t!==f&&r.status!==H){var l=r.strategy===A?de(r,t):r.strategy===E?he(r,t):pe[r.level].func(r,t);if(l===K||l===Q){r.status=H}if(l===Y||l===K){if(e.avail_out===0){r.last_flush=-1}return b}if(l===Z){if(t===p){u._tr_align(r)}else if(t!==v){u._tr_stored_block(r,0,0,false);if(t===m){ee(r.head);if(r.lookahead===0){r.strstart=0;r.block_start=0;r.insert=0}}}te(e);if(e.avail_out===0){r.last_flush=-1;return b}}}if(t!==g){return b}if(r.wrap<=0){return _}if(r.wrap===2){re(r,e.adler&255);re(r,e.adler>>8&255);re(r,e.adler>>16&255);re(r,e.adler>>24&255);re(r,e.total_in&255);re(r,e.total_in>>8&255);re(r,e.total_in>>16&255);re(r,e.total_in>>24&255)}else{ie(r,e.adler>>>16);ie(r,e.adler&65535)}te(e);if(r.wrap>0){r.wrap=-r.wrap}return r.pending!==0?b:_}function Ee(e){var t;if(!e||!e.state){return F}t=e.state.status;if(t!==R&&t!==G&&t!==j&&t!==z&&t!==X&&t!==W&&t!==H){return q(e,F)}e.state=null;return t===W?q(e,i):b}function xe(e,t){var n=t.length;var r;var i,a;var s;var o;var l;var u;var c;if(!e||!e.state){return F}r=e.state;s=r.wrap;if(s===2||s===1&&r.status!==R||r.lookahead){return F}if(s===1){e.adler=d(e.adler,t,n,0)}r.wrap=0;if(n>=r.w_size){if(s===0){ee(r.head);r.strstart=0;r.block_start=0;r.insert=0}c=new h.Buf8(r.w_size);h.arraySet(c,t,n-r.w_size,r.w_size,0);t=c;n=r.w_size}o=e.avail_in;l=e.next_in;u=e.input;e.avail_in=n;e.next_in=0;e.input=t;oe(r);while(r.lookahead>=M){i=r.strstart;a=r.lookahead-(M-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+M-1])&r.hash_mask;r.prev[i&r.w_mask]=r.head[r.ins_h];r.head[r.ins_h]=i;i++}while(--a);r.strstart=i;r.lookahead=M-1;oe(r)}r.strstart+=r.lookahead;r.block_start=r.strstart;r.insert=r.lookahead;r.lookahead=0;r.match_length=r.prev_length=M-1;r.match_available=0;e.next_in=l;e.input=u;e.avail_in=o;r.wrap=s;return b}n.deflateInit=Ce;n.deflateInit2=Fe;n.deflateReset=be;n.deflateResetKeep=ve;n.deflateSetHeader=_e;n.deflate=Ae;n.deflateEnd=Ee;n.deflateSetDictionary=xe;n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){"use strict";function r(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}t.exports=r},{}],48:[function(e,t,n){"use strict";var O=30;var I=12;t.exports=function e(t,n){var r;var i;var a;var s;var o;var l;var u;var c;var h;var d;var f;var p;var m;var g;var v;var b;var _;var F;var C;var A;var E;var x;var B;var D,y;r=t.state;i=t.next_in;D=t.input;a=i+(t.avail_in-5);s=t.next_out;y=t.output;o=s-(n-t.avail_out);l=s+(t.avail_out-257);u=r.dmax;c=r.wsize;h=r.whave;d=r.wnext;f=r.window;p=r.hold;m=r.bits;g=r.lencode;v=r.distcode;b=(1<<r.lenbits)-1;_=(1<<r.distbits)-1;e:do{if(m<15){p+=D[i++]<<m;m+=8;p+=D[i++]<<m;m+=8}F=g[p&b];t:for(;;){C=F>>>24;p>>>=C;m-=C;C=F>>>16&255;if(C===0){y[s++]=F&65535}else if(C&16){A=F&65535;C&=15;if(C){if(m<C){p+=D[i++]<<m;m+=8}A+=p&(1<<C)-1;p>>>=C;m-=C}if(m<15){p+=D[i++]<<m;m+=8;p+=D[i++]<<m;m+=8}F=v[p&_];n:for(;;){C=F>>>24;p>>>=C;m-=C;C=F>>>16&255;if(C&16){E=F&65535;C&=15;if(m<C){p+=D[i++]<<m;m+=8;if(m<C){p+=D[i++]<<m;m+=8}}E+=p&(1<<C)-1;if(E>u){t.msg="invalid distance too far back";r.mode=O;break e}p>>>=C;m-=C;C=s-o;if(E>C){C=E-C;if(C>h){if(r.sane){t.msg="invalid distance too far back";r.mode=O;break e}}x=0;B=f;if(d===0){x+=c-C;if(C<A){A-=C;do{y[s++]=f[x++]}while(--C);x=s-E;B=y}}else if(d<C){x+=c+d-C;C-=d;if(C<A){A-=C;do{y[s++]=f[x++]}while(--C);x=0;if(d<A){C=d;A-=C;do{y[s++]=f[x++]}while(--C);x=s-E;B=y}}}else{x+=d-C;if(C<A){A-=C;do{y[s++]=f[x++]}while(--C);x=s-E;B=y}}while(A>2){y[s++]=B[x++];y[s++]=B[x++];y[s++]=B[x++];A-=3}if(A){y[s++]=B[x++];if(A>1){y[s++]=B[x++]}}}else{x=s-E;do{y[s++]=y[x++];y[s++]=y[x++];y[s++]=y[x++];A-=3}while(A>2);if(A){y[s++]=y[x++];if(A>1){y[s++]=y[x++]}}}}else if((C&64)===0){F=v[(F&65535)+(p&(1<<C)-1)];continue n}else{t.msg="invalid distance code";r.mode=O;break e}break}}else if((C&64)===0){F=g[(F&65535)+(p&(1<<C)-1)];continue t}else if(C&32){r.mode=I;break e}else{t.msg="invalid literal/length code";r.mode=O;break e}break}}while(i<a&&s<l);A=m>>3;i-=A;m-=A<<3;p&=(1<<m)-1;t.next_in=i;t.next_out=s;t.avail_in=i<a?5+(a-i):5-(i-a);t.avail_out=s<l?257+(l-s):257-(s-l);r.hold=p;r.bits=m;return}},{}],49:[function(e,t,n){"use strict";var I=e("../utils/common");var S=e("./adler32");var T=e("./crc32");var w=e("./inffast");var N=e("./inftrees");var L=0;var k=1;var M=2;var P=4;var V=5;var U=6;var R=0;var G=1;var j=2;var z=-2;var X=-3;var W=-4;var H=-5;var Y=8;var Z=1;var K=2;var Q=3;var J=4;var q=5;var $=6;var ee=7;var te=8;var ne=9;var re=10;var ie=11;var ae=12;var se=13;var oe=14;var le=15;var ue=16;var ce=17;var he=18;var de=19;var fe=20;var pe=21;var me=22;var ge=23;var ve=24;var be=25;var _e=26;var Fe=27;var Ce=28;var Ae=29;var Ee=30;var xe=31;var Be=32;var r=852;var i=592;var a=15;var s=a;function De(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function o(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new I.Buf16(320);this.work=new I.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function l(e){var t;if(!e||!e.state){return z}t=e.state;e.total_in=e.total_out=t.total=0;e.msg="";if(t.wrap){e.adler=t.wrap&1}t.mode=Z;t.last=0;t.havedict=0;t.dmax=32768;t.head=null;t.hold=0;t.bits=0;t.lencode=t.lendyn=new I.Buf32(r);t.distcode=t.distdyn=new I.Buf32(i);t.sane=1;t.back=-1;return R}function u(e){var t;if(!e||!e.state){return z}t=e.state;t.wsize=0;t.whave=0;t.wnext=0;return l(e)}function c(e,t){var n;var r;if(!e||!e.state){return z}r=e.state;if(t<0){n=0;t=-t}else{n=(t>>4)+1;if(t<48){t&=15}}if(t&&(t<8||t>15)){return z}if(r.window!==null&&r.wbits!==t){r.window=null}r.wrap=n;r.wbits=t;return u(e)}function h(e,t){var n;var r;if(!e){return z}r=new o;e.state=r;r.window=null;n=c(e,t);if(n!==R){e.state=null}return n}function d(e){return h(e,s)}var f=true;var p,m;function ye(e){if(f){var t;p=new I.Buf32(512);m=new I.Buf32(32);t=0;while(t<144){e.lens[t++]=8}while(t<256){e.lens[t++]=9}while(t<280){e.lens[t++]=7}while(t<288){e.lens[t++]=8}N(k,e.lens,0,288,p,0,e.work,{bits:9});t=0;while(t<32){e.lens[t++]=5}N(M,e.lens,0,32,m,0,e.work,{bits:5});f=false}e.lencode=p;e.lenbits=9;e.distcode=m;e.distbits=5}function Oe(e,t,n,r){var i;var a=e.state;if(a.window===null){a.wsize=1<<a.wbits;a.wnext=0;a.whave=0;a.window=new I.Buf8(a.wsize)}if(r>=a.wsize){I.arraySet(a.window,t,n-a.wsize,a.wsize,0);a.wnext=0;a.whave=a.wsize}else{i=a.wsize-a.wnext;if(i>r){i=r}I.arraySet(a.window,t,n-r,i,a.wnext);r-=i;if(r){I.arraySet(a.window,t,n-r,r,0);a.wnext=r;a.whave=a.wsize}else{a.wnext+=i;if(a.wnext===a.wsize){a.wnext=0}if(a.whave<a.wsize){a.whave+=i}}}return 0}function g(e,t){var n;var r,i;var a;var s;var o,l;var u;var c;var h,d;var f;var p;var m;var g=0;var v,b,_;var F,C,A;var E;var x;var B=new I.Buf8(4);var D;var y;var O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0){return z}n=e.state;if(n.mode===ae){n.mode=se}s=e.next_out;i=e.output;l=e.avail_out;a=e.next_in;r=e.input;o=e.avail_in;u=n.hold;c=n.bits;h=o;d=l;x=R;e:for(;;){switch(n.mode){case Z:if(n.wrap===0){n.mode=se;break}while(c<16){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if(n.wrap&2&&u===35615){n.check=0;B[0]=u&255;B[1]=u>>>8&255;n.check=T(n.check,B,2,0);u=0;c=0;n.mode=K;break}n.flags=0;if(n.head){n.head.done=false}if(!(n.wrap&1)||(((u&255)<<8)+(u>>8))%31){e.msg="incorrect header check";n.mode=Ee;break}if((u&15)!==Y){e.msg="unknown compression method";n.mode=Ee;break}u>>>=4;c-=4;E=(u&15)+8;if(n.wbits===0){n.wbits=E}else if(E>n.wbits){e.msg="invalid window size";n.mode=Ee;break}n.dmax=1<<E;e.adler=n.check=1;n.mode=u&512?re:ae;u=0;c=0;break;case K:while(c<16){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}n.flags=u;if((n.flags&255)!==Y){e.msg="unknown compression method";n.mode=Ee;break}if(n.flags&57344){e.msg="unknown header flags set";n.mode=Ee;break}if(n.head){n.head.text=u>>8&1}if(n.flags&512){B[0]=u&255;B[1]=u>>>8&255;n.check=T(n.check,B,2,0)}u=0;c=0;n.mode=Q;case Q:while(c<32){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if(n.head){n.head.time=u}if(n.flags&512){B[0]=u&255;B[1]=u>>>8&255;B[2]=u>>>16&255;B[3]=u>>>24&255;n.check=T(n.check,B,4,0)}u=0;c=0;n.mode=J;case J:while(c<16){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if(n.head){n.head.xflags=u&255;n.head.os=u>>8}if(n.flags&512){B[0]=u&255;B[1]=u>>>8&255;n.check=T(n.check,B,2,0)}u=0;c=0;n.mode=q;case q:if(n.flags&1024){while(c<16){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}n.length=u;if(n.head){n.head.extra_len=u}if(n.flags&512){B[0]=u&255;B[1]=u>>>8&255;n.check=T(n.check,B,2,0)}u=0;c=0}else if(n.head){n.head.extra=null}n.mode=$;case $:if(n.flags&1024){f=n.length;if(f>o){f=o}if(f){if(n.head){E=n.head.extra_len-n.length;if(!n.head.extra){n.head.extra=new Array(n.head.extra_len)}I.arraySet(n.head.extra,r,a,f,E)}if(n.flags&512){n.check=T(n.check,r,f,a)}o-=f;a+=f;n.length-=f}if(n.length){break e}}n.length=0;n.mode=ee;case ee:if(n.flags&2048){if(o===0){break e}f=0;do{E=r[a+f++];if(n.head&&E&&n.length<65536){n.head.name+=String.fromCharCode(E)}}while(E&&f<o);if(n.flags&512){n.check=T(n.check,r,f,a)}o-=f;a+=f;if(E){break e}}else if(n.head){n.head.name=null}n.length=0;n.mode=te;case te:if(n.flags&4096){if(o===0){break e}f=0;do{E=r[a+f++];if(n.head&&E&&n.length<65536){n.head.comment+=String.fromCharCode(E)}}while(E&&f<o);if(n.flags&512){n.check=T(n.check,r,f,a)}o-=f;a+=f;if(E){break e}}else if(n.head){n.head.comment=null}n.mode=ne;case ne:if(n.flags&512){while(c<16){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if(u!==(n.check&65535)){e.msg="header crc mismatch";n.mode=Ee;break}u=0;c=0}if(n.head){n.head.hcrc=n.flags>>9&1;n.head.done=true}e.adler=n.check=0;n.mode=ae;break;case re:while(c<32){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}e.adler=n.check=De(u);u=0;c=0;n.mode=ie;case ie:if(n.havedict===0){e.next_out=s;e.avail_out=l;e.next_in=a;e.avail_in=o;n.hold=u;n.bits=c;return j}e.adler=n.check=1;n.mode=ae;case ae:if(t===V||t===U){break e}case se:if(n.last){u>>>=c&7;c-=c&7;n.mode=Fe;break}while(c<3){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}n.last=u&1;u>>>=1;c-=1;switch(u&3){case 0:n.mode=oe;break;case 1:ye(n);n.mode=fe;if(t===U){u>>>=2;c-=2;break e}break;case 2:n.mode=ce;break;case 3:e.msg="invalid block type";n.mode=Ee}u>>>=2;c-=2;break;case oe:u>>>=c&7;c-=c&7;while(c<32){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if((u&65535)!==(u>>>16^65535)){e.msg="invalid stored block lengths";n.mode=Ee;break}n.length=u&65535;u=0;c=0;n.mode=le;if(t===U){break e}case le:n.mode=ue;case ue:f=n.length;if(f){if(f>o){f=o}if(f>l){f=l}if(f===0){break e}I.arraySet(i,r,a,f,s);o-=f;a+=f;l-=f;s+=f;n.length-=f;break}n.mode=ae;break;case ce:while(c<14){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}n.nlen=(u&31)+257;u>>>=5;c-=5;n.ndist=(u&31)+1;u>>>=5;c-=5;n.ncode=(u&15)+4;u>>>=4;c-=4;if(n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols";n.mode=Ee;break}n.have=0;n.mode=he;case he:while(n.have<n.ncode){while(c<3){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}n.lens[O[n.have++]]=u&7;u>>>=3;c-=3}while(n.have<19){n.lens[O[n.have++]]=0}n.lencode=n.lendyn;n.lenbits=7;D={bits:n.lenbits};x=N(L,n.lens,0,19,n.lencode,0,n.work,D);n.lenbits=D.bits;if(x){e.msg="invalid code lengths set";n.mode=Ee;break}n.have=0;n.mode=de;case de:while(n.have<n.nlen+n.ndist){for(;;){g=n.lencode[u&(1<<n.lenbits)-1];v=g>>>24;b=g>>>16&255;_=g&65535;if(v<=c){break}if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if(_<16){u>>>=v;c-=v;n.lens[n.have++]=_}else{if(_===16){y=v+2;while(c<y){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}u>>>=v;c-=v;if(n.have===0){e.msg="invalid bit length repeat";n.mode=Ee;break}E=n.lens[n.have-1];f=3+(u&3);u>>>=2;c-=2}else if(_===17){y=v+3;while(c<y){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}u>>>=v;c-=v;E=0;f=3+(u&7);u>>>=3;c-=3}else{y=v+7;while(c<y){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}u>>>=v;c-=v;E=0;f=11+(u&127);u>>>=7;c-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat";n.mode=Ee;break}while(f--){n.lens[n.have++]=E}}}if(n.mode===Ee){break}if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block";n.mode=Ee;break}n.lenbits=9;D={bits:n.lenbits};x=N(k,n.lens,0,n.nlen,n.lencode,0,n.work,D);n.lenbits=D.bits;if(x){e.msg="invalid literal/lengths set";n.mode=Ee;break}n.distbits=6;n.distcode=n.distdyn;D={bits:n.distbits};x=N(M,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D);n.distbits=D.bits;if(x){e.msg="invalid distances set";n.mode=Ee;break}n.mode=fe;if(t===U){break e}case fe:n.mode=pe;case pe:if(o>=6&&l>=258){e.next_out=s;e.avail_out=l;e.next_in=a;e.avail_in=o;n.hold=u;n.bits=c;w(e,d);s=e.next_out;i=e.output;l=e.avail_out;a=e.next_in;r=e.input;o=e.avail_in;u=n.hold;c=n.bits;if(n.mode===ae){n.back=-1}break}n.back=0;for(;;){g=n.lencode[u&(1<<n.lenbits)-1];v=g>>>24;b=g>>>16&255;_=g&65535;if(v<=c){break}if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if(b&&(b&240)===0){F=v;C=b;A=_;for(;;){g=n.lencode[A+((u&(1<<F+C)-1)>>F)];v=g>>>24;b=g>>>16&255;_=g&65535;if(F+v<=c){break}if(o===0){break e}o--;u+=r[a++]<<c;c+=8}u>>>=F;c-=F;n.back+=F}u>>>=v;c-=v;n.back+=v;n.length=_;if(b===0){n.mode=_e;break}if(b&32){n.back=-1;n.mode=ae;break}if(b&64){e.msg="invalid literal/length code";n.mode=Ee;break}n.extra=b&15;n.mode=me;case me:if(n.extra){y=n.extra;while(c<y){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}n.length+=u&(1<<n.extra)-1;u>>>=n.extra;c-=n.extra;n.back+=n.extra}n.was=n.length;n.mode=ge;case ge:for(;;){g=n.distcode[u&(1<<n.distbits)-1];v=g>>>24;b=g>>>16&255;_=g&65535;if(v<=c){break}if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if((b&240)===0){F=v;C=b;A=_;for(;;){g=n.distcode[A+((u&(1<<F+C)-1)>>F)];v=g>>>24;b=g>>>16&255;_=g&65535;if(F+v<=c){break}if(o===0){break e}o--;u+=r[a++]<<c;c+=8}u>>>=F;c-=F;n.back+=F}u>>>=v;c-=v;n.back+=v;if(b&64){e.msg="invalid distance code";n.mode=Ee;break}n.offset=_;n.extra=b&15;n.mode=ve;case ve:if(n.extra){y=n.extra;while(c<y){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}n.offset+=u&(1<<n.extra)-1;u>>>=n.extra;c-=n.extra;n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back";n.mode=Ee;break}n.mode=be;case be:if(l===0){break e}f=d-l;if(n.offset>f){f=n.offset-f;if(f>n.whave){if(n.sane){e.msg="invalid distance too far back";n.mode=Ee;break}}if(f>n.wnext){f-=n.wnext;p=n.wsize-f}else{p=n.wnext-f}if(f>n.length){f=n.length}m=n.window}else{m=i;p=s-n.offset;f=n.length}if(f>l){f=l}l-=f;n.length-=f;do{i[s++]=m[p++]}while(--f);if(n.length===0){n.mode=pe}break;case _e:if(l===0){break e}i[s++]=n.length;l--;n.mode=pe;break;case Fe:if(n.wrap){while(c<32){if(o===0){break e}o--;u|=r[a++]<<c;c+=8}d-=l;e.total_out+=d;n.total+=d;if(d){e.adler=n.check=n.flags?T(n.check,i,d,s-d):S(n.check,i,d,s-d)}d=l;if((n.flags?u:De(u))!==n.check){e.msg="incorrect data check";n.mode=Ee;break}u=0;c=0}n.mode=Ce;case Ce:if(n.wrap&&n.flags){while(c<32){if(o===0){break e}o--;u+=r[a++]<<c;c+=8}if(u!==(n.total&4294967295)){e.msg="incorrect length check";n.mode=Ee;break}u=0;c=0}n.mode=Ae;case Ae:x=G;break e;case Ee:x=X;break e;case xe:return W;case Be:default:return z}}e.next_out=s;e.avail_out=l;e.next_in=a;e.avail_in=o;n.hold=u;n.bits=c;if(n.wsize||d!==e.avail_out&&n.mode<Ee&&(n.mode<Fe||t!==P)){if(Oe(e,e.output,e.next_out,d-e.avail_out)){n.mode=xe;return W}}h-=e.avail_in;d-=e.avail_out;e.total_in+=h;e.total_out+=d;n.total+=d;if(n.wrap&&d){e.adler=n.check=n.flags?T(n.check,i,d,e.next_out-d):S(n.check,i,d,e.next_out-d)}e.data_type=n.bits+(n.last?64:0)+(n.mode===ae?128:0)+(n.mode===fe||n.mode===le?256:0);if((h===0&&d===0||t===P)&&x===R){x=H}return x}function v(e){if(!e||!e.state){return z}var t=e.state;if(t.window){t.window=null}e.state=null;return R}function b(e,t){var n;if(!e||!e.state){return z}n=e.state;if((n.wrap&2)===0){return z}n.head=t;t.done=false;return R}function _(e,t){var n=t.length;var r;var i;var a;if(!e||!e.state){return z}r=e.state;if(r.wrap!==0&&r.mode!==ie){return z}if(r.mode===ie){i=1;i=S(i,t,n,0);if(i!==r.check){return X}}a=Oe(e,t,n,n);if(a){r.mode=xe;return W}r.havedict=1;return R}n.inflateReset=u;n.inflateReset2=c;n.inflateResetKeep=l;n.inflateInit=d;n.inflateInit2=h;n.inflate=g;n.inflateEnd=v;n.inflateGetHeader=b;n.inflateSetDictionary=_;n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){"use strict";var k=e("../utils/common");var M=15;var P=852;var V=592;var U=0;var R=1;var G=2;var j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var z=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var X=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var W=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function e(t,n,r,i,a,s,o,l){var u=l.bits;var c=0;var h=0;var d=0,f=0;var p=0;var m=0;var g=0;var v=0;var b=0;var _=0;var F;var C;var A;var E;var x;var B=null;var D=0;var y;var O=new k.Buf16(M+1);var I=new k.Buf16(M+1);var S=null;var T=0;var w,N,L;for(c=0;c<=M;c++){O[c]=0}for(h=0;h<i;h++){O[n[r+h]]++}p=u;for(f=M;f>=1;f--){if(O[f]!==0){break}}if(p>f){p=f}if(f===0){a[s++]=1<<24|64<<16|0;a[s++]=1<<24|64<<16|0;l.bits=1;return 0}for(d=1;d<f;d++){if(O[d]!==0){break}}if(p<d){p=d}v=1;for(c=1;c<=M;c++){v<<=1;v-=O[c];if(v<0){return-1}}if(v>0&&(t===U||f!==1)){return-1}I[1]=0;for(c=1;c<M;c++){I[c+1]=I[c]+O[c]}for(h=0;h<i;h++){if(n[r+h]!==0){o[I[n[r+h]]++]=h}}if(t===U){B=S=o;y=19}else if(t===R){B=j;D-=257;S=z;T-=257;y=256}else{B=X;S=W;y=-1}_=0;h=0;c=d;x=s;m=p;g=0;A=-1;b=1<<p;E=b-1;if(t===R&&b>P||t===G&&b>V){return 1}for(;;){w=c-g;if(o[h]<y){N=0;L=o[h]}else if(o[h]>y){N=S[T+o[h]];L=B[D+o[h]]}else{N=32+64;L=0}F=1<<c-g;C=1<<m;d=C;do{C-=F;a[x+(_>>g)+C]=w<<24|N<<16|L|0}while(C!==0);F=1<<c-1;while(_&F){F>>=1}if(F!==0){_&=F-1;_+=F}else{_=0}h++;if(--O[c]===0){if(c===f){break}c=n[r+o[h]]}if(c>p&&(_&E)!==A){if(g===0){g=p}x+=d;m=c-g;v=1<<m;while(m+g<f){v-=O[m+g];if(v<=0){break}m++;v<<=1}b+=1<<m;if(t===R&&b>P||t===G&&b>V){return 1}A=_&E;a[A]=p<<24|m<<16|x-s|0}}if(_!==0){a[x+_]=c-g<<24|64<<16|0}l.bits=p;return 0}},{"../utils/common":41}],51:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){"use strict";var i=e("../utils/common");var o=4;var r=0;var a=1;var l=2;function s(e){var t=e.length;while(--t>=0){e[t]=0}}var u=0;var c=1;var h=2;var d=3;var f=258;var p=29;var m=256;var g=m+1+p;var v=30;var b=19;var _=2*g+1;var F=15;var C=16;var A=7;var E=256;var x=16;var B=17;var D=18;var y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var T=512;var w=new Array((g+2)*2);s(w);var N=new Array(v*2);s(N);var L=new Array(T);s(L);var k=new Array(f-d+1);s(k);var M=new Array(p);s(M);var P=new Array(v);s(P);function V(e,t,n,r,i){this.static_tree=e;this.extra_bits=t;this.extra_base=n;this.elems=r;this.max_length=i;this.has_stree=e&&e.length}var U;var R;var G;function j(e,t){this.dyn_tree=e;this.max_code=0;this.stat_desc=t}function z(e){return e<256?L[e]:L[256+(e>>>7)]}function X(e,t){e.pending_buf[e.pending++]=t&255;e.pending_buf[e.pending++]=t>>>8&255}function W(e,t,n){if(e.bi_valid>C-n){e.bi_buf|=t<<e.bi_valid&65535;X(e,e.bi_buf);e.bi_buf=t>>C-e.bi_valid;e.bi_valid+=n-C}else{e.bi_buf|=t<<e.bi_valid&65535;e.bi_valid+=n}}function H(e,t,n){W(e,n[t*2],n[t*2+1])}function Y(e,t){var n=0;do{n|=e&1;e>>>=1;n<<=1}while(--t>0);return n>>>1}function Z(e){if(e.bi_valid===16){X(e,e.bi_buf);e.bi_buf=0;e.bi_valid=0}else if(e.bi_valid>=8){e.pending_buf[e.pending++]=e.bi_buf&255;e.bi_buf>>=8;e.bi_valid-=8}}function K(e,t){var n=t.dyn_tree;var r=t.max_code;var i=t.stat_desc.static_tree;var a=t.stat_desc.has_stree;var s=t.stat_desc.extra_bits;var o=t.stat_desc.extra_base;var l=t.stat_desc.max_length;var u;var c,h;var d;var f;var p;var m=0;for(d=0;d<=F;d++){e.bl_count[d]=0}n[e.heap[e.heap_max]*2+1]=0;for(u=e.heap_max+1;u<_;u++){c=e.heap[u];d=n[n[c*2+1]*2+1]+1;if(d>l){d=l;m++}n[c*2+1]=d;if(c>r){continue}e.bl_count[d]++;f=0;if(c>=o){f=s[c-o]}p=n[c*2];e.opt_len+=p*(d+f);if(a){e.static_len+=p*(i[c*2+1]+f)}}if(m===0){return}do{d=l-1;while(e.bl_count[d]===0){d--}e.bl_count[d]--;e.bl_count[d+1]+=2;e.bl_count[l]--;m-=2}while(m>0);for(d=l;d!==0;d--){c=e.bl_count[d];while(c!==0){h=e.heap[--u];if(h>r){continue}if(n[h*2+1]!==d){e.opt_len+=(d-n[h*2+1])*n[h*2];n[h*2+1]=d}c--}}}function Q(e,t,n){var r=new Array(F+1);var i=0;var a;var s;for(a=1;a<=F;a++){r[a]=i=i+n[a-1]<<1}for(s=0;s<=t;s++){var o=e[s*2+1];if(o===0){continue}e[s*2]=Y(r[o]++,o)}}function J(){var e;var t;var n;var r;var i;var a=new Array(F+1);n=0;for(r=0;r<p-1;r++){M[r]=n;for(e=0;e<1<<y[r];e++){k[n++]=r}}k[n-1]=r;i=0;for(r=0;r<16;r++){P[r]=i;for(e=0;e<1<<O[r];e++){L[i++]=r}}i>>=7;for(;r<v;r++){P[r]=i<<7;for(e=0;e<1<<O[r]-7;e++){L[256+i++]=r}}for(t=0;t<=F;t++){a[t]=0}e=0;while(e<=143){w[e*2+1]=8;e++;a[8]++}while(e<=255){w[e*2+1]=9;e++;a[9]++}while(e<=279){w[e*2+1]=7;e++;a[7]++}while(e<=287){w[e*2+1]=8;e++;a[8]++}Q(w,g+1,a);for(e=0;e<v;e++){N[e*2+1]=5;N[e*2]=Y(e,5)}U=new V(w,y,m+1,g,F);R=new V(N,O,0,v,F);G=new V(new Array(0),I,0,b,A)}function q(e){var t;for(t=0;t<g;t++){e.dyn_ltree[t*2]=0}for(t=0;t<v;t++){e.dyn_dtree[t*2]=0}for(t=0;t<b;t++){e.bl_tree[t*2]=0}e.dyn_ltree[E*2]=1;e.opt_len=e.static_len=0;e.last_lit=e.matches=0}function $(e){if(e.bi_valid>8){X(e,e.bi_buf)}else if(e.bi_valid>0){e.pending_buf[e.pending++]=e.bi_buf}e.bi_buf=0;e.bi_valid=0}function ee(e,t,n,r){$(e);if(r){X(e,n);X(e,~n)}i.arraySet(e.pending_buf,e.window,t,n,e.pending);e.pending+=n}function te(e,t,n,r){var i=t*2;var a=n*2;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function ne(e,t,n){var r=e.heap[n];var i=n<<1;while(i<=e.heap_len){if(i<e.heap_len&&te(t,e.heap[i+1],e.heap[i],e.depth)){i++}if(te(t,r,e.heap[i],e.depth)){break}e.heap[n]=e.heap[i];n=i;i<<=1}e.heap[n]=r}function re(e,t,n){var r;var i;var a=0;var s;var o;if(e.last_lit!==0){do{r=e.pending_buf[e.d_buf+a*2]<<8|e.pending_buf[e.d_buf+a*2+1];i=e.pending_buf[e.l_buf+a];a++;if(r===0){H(e,i,t)}else{s=k[i];H(e,s+m+1,t);o=y[s];if(o!==0){i-=M[s];W(e,i,o)}r--;s=z(r);H(e,s,n);o=O[s];if(o!==0){r-=P[s];W(e,r,o)}}}while(a<e.last_lit)}H(e,E,t)}function ie(e,t){var n=t.dyn_tree;var r=t.stat_desc.static_tree;var i=t.stat_desc.has_stree;var a=t.stat_desc.elems;var s,o;var l=-1;var u;e.heap_len=0;e.heap_max=_;for(s=0;s<a;s++){if(n[s*2]!==0){e.heap[++e.heap_len]=l=s;e.depth[s]=0}else{n[s*2+1]=0}}while(e.heap_len<2){u=e.heap[++e.heap_len]=l<2?++l:0;n[u*2]=1;e.depth[u]=0;e.opt_len--;if(i){e.static_len-=r[u*2+1]}}t.max_code=l;for(s=e.heap_len>>1;s>=1;s--){ne(e,n,s)}u=a;do{s=e.heap[1];e.heap[1]=e.heap[e.heap_len--];ne(e,n,1);o=e.heap[1];e.heap[--e.heap_max]=s;e.heap[--e.heap_max]=o;n[u*2]=n[s*2]+n[o*2];e.depth[u]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1;n[s*2+1]=n[o*2+1]=u;e.heap[1]=u++;ne(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1];K(e,t);Q(n,l,e.bl_count)}function ae(e,t,n){var r;var i=-1;var a;var s=t[0*2+1];var o=0;var l=7;var u=4;if(s===0){l=138;u=3}t[(n+1)*2+1]=65535;for(r=0;r<=n;r++){a=s;s=t[(r+1)*2+1];if(++o<l&&a===s){continue}else if(o<u){e.bl_tree[a*2]+=o}else if(a!==0){if(a!==i){e.bl_tree[a*2]++}e.bl_tree[x*2]++}else if(o<=10){e.bl_tree[B*2]++}else{e.bl_tree[D*2]++}o=0;i=a;if(s===0){l=138;u=3}else if(a===s){l=6;u=3}else{l=7;u=4}}}function se(e,t,n){var r;var i=-1;var a;var s=t[0*2+1];var o=0;var l=7;var u=4;if(s===0){l=138;u=3}for(r=0;r<=n;r++){a=s;s=t[(r+1)*2+1];if(++o<l&&a===s){continue}else if(o<u){do{H(e,a,e.bl_tree)}while(--o!==0)}else if(a!==0){if(a!==i){H(e,a,e.bl_tree);o--}H(e,x,e.bl_tree);W(e,o-3,2)}else if(o<=10){H(e,B,e.bl_tree);W(e,o-3,3)}else{H(e,D,e.bl_tree);W(e,o-11,7)}o=0;i=a;if(s===0){l=138;u=3}else if(a===s){l=6;u=3}else{l=7;u=4}}}function oe(e){var t;ae(e,e.dyn_ltree,e.l_desc.max_code);ae(e,e.dyn_dtree,e.d_desc.max_code);ie(e,e.bl_desc);for(t=b-1;t>=3;t--){if(e.bl_tree[S[t]*2+1]!==0){break}}e.opt_len+=3*(t+1)+5+5+4;return t}function le(e,t,n,r){var i;W(e,t-257,5);W(e,n-1,5);W(e,r-4,4);for(i=0;i<r;i++){W(e,e.bl_tree[S[i]*2+1],3)}se(e,e.dyn_ltree,t-1);se(e,e.dyn_dtree,n-1)}function ue(e){var t=4093624447;var n;for(n=0;n<=31;n++,t>>>=1){if(t&1&&e.dyn_ltree[n*2]!==0){return r}}if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0){return a}for(n=32;n<m;n++){if(e.dyn_ltree[n*2]!==0){return a}}return r}var ce=false;function he(e){if(!ce){J();ce=true}e.l_desc=new j(e.dyn_ltree,U);e.d_desc=new j(e.dyn_dtree,R);e.bl_desc=new j(e.bl_tree,G);e.bi_buf=0;e.bi_valid=0;q(e)}function de(e,t,n,r){W(e,(u<<1)+(r?1:0),3);ee(e,t,n,true)}function fe(e){W(e,c<<1,3);H(e,E,w);Z(e)}function pe(e,t,n,r){var i,a;var s=0;if(e.level>0){if(e.strm.data_type===l){e.strm.data_type=ue(e)}ie(e,e.l_desc);ie(e,e.d_desc);s=oe(e);i=e.opt_len+3+7>>>3;a=e.static_len+3+7>>>3;if(a<=i){i=a}}else{i=a=n+5}if(n+4<=i&&t!==-1){de(e,t,n,r)}else if(e.strategy===o||a===i){W(e,(c<<1)+(r?1:0),3);re(e,w,N)}else{W(e,(h<<1)+(r?1:0),3);le(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1);re(e,e.dyn_ltree,e.dyn_dtree)}q(e);if(r){$(e)}}function me(e,t,n){e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255;e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255;e.pending_buf[e.l_buf+e.last_lit]=n&255;e.last_lit++;if(t===0){e.dyn_ltree[n*2]++}else{e.matches++;t--;e.dyn_ltree[(k[n]+m+1)*2]++;e.dyn_dtree[z(t)*2]++}return e.last_lit===e.lit_bufsize-1}n._tr_init=he;n._tr_stored_block=de;n._tr_flush_block=pe;n._tr_tally=me;n._tr_align=fe},{"../utils/common":41}],53:[function(e,t,n){"use strict";function r(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}t.exports=r},{}],54:[function(e,t,n){"use strict";t.exports=typeof setImmediate==="function"?setImmediate:function e(){var t=[].slice.apply(arguments);t.splice(1,0,0);setTimeout.apply(null,t)}},{}]},{},[10])(10)});this.CGL=this.CGL||{},this.CGL.COREMODULES=this.CGL.COREMODULES||{},this.CGL.COREMODULES.Copytexture=function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,n){"use strict";n.r(t);class c{constructor(e){this._logs=[],this.initiator=e}stack(e){console.error("["+this.initiator+"] ",e),console.log((new Error).stack),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",e)}groupCollapsed(e){console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(e){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",arguments)}info(e){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"info",arguments)}warn(e){console.warn("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"warn",arguments)}verbose(){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"verbose",arguments)}log(e){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"log",arguments)}userInteraction(e){}}const i=function(){this._log=new c("eventtaget"),this._eventCallbacks={},this._logName="",this._logEvents=!1,this._listeners={},this.addEventListener=this.on=function(e,t,n){const r={id:(n||"")+CABLES.uuid(),name:e,cb:t};return this._eventCallbacks[e]?this._eventCallbacks[e].push(r):this._eventCallbacks[e]=[r],this._listeners[r.id]=r,r.id},this.hasEventListener=function(e,t){if(e&&!t)return!!this._listeners[e];if(this._log.warn("old eventtarget function haseventlistener!"),e&&t&&this._eventCallbacks[e]){return-1!=this._eventCallbacks[e].indexOf(t)}},this.removeEventListener=this.off=function(r,i){if(null==r)return;if(!i){const i=this._listeners[r];if(!i)return;let n=!0;for(;n;){n=!1;let t=-1;for(let e=0;e<this._eventCallbacks[i.name].length;e++)0===this._eventCallbacks[i.name][e].id.indexOf(r)&&(n=!0,t=e);-1!==t&&(this._eventCallbacks[i.name].splice(t,1),delete this._listeners[r])}return}this._log.stack(" old function signature: removeEventListener! use listener id");let t=null;for(let e=0;e<this._eventCallbacks[r].length;e++)this._eventCallbacks[r][e].cb==i&&(t=e);null!==t?delete this._eventCallbacks[t]:this._log.warn("removeEventListener not found "+r)},this.logEvents=function(e,t){this._logEvents=e,this._logName=t},this.emitEvent=function(t,n,r,i,a,s,o){if(this._logEvents&&console.log("[event] ",this._logName,t,this._eventCallbacks),this._eventCallbacks[t])for(let e=0;e<this._eventCallbacks[t].length;e++)this._eventCallbacks[t][e]&&this._eventCallbacks[t][e].cb(n,r,i,a,s,o);else this._logEvents&&console.log("[event] has no event callback",t,this._eventCallbacks)}},a={EASINGS:["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out"],EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27},s={OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},o={PORT_DIR_IN:0,PORT_DIR_OUT:1},l={float32Concat:function(e,t){e instanceof Float32Array||(e=new Float32Array(e)),t instanceof Float32Array||(t=new Float32Array(t));const n=new Float32Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}},r=function(){let n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},u=r;Math.randomSeed=1,Math.seededRandom=function(e,t){0===Math.randomSeed&&(Math.randomSeed=999*Math.random()),e=e||1,t=t||0,Math.randomSeed=(9301*Math.randomSeed+49297)%233280;return t+Math.randomSeed/233280*(e-t)},l.arrayWriteToEnd=function(t,e){for(let e=1;e<t.length;e++)t[e-1]=t[e];t[t.length-1]=e},l.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},l.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},String.prototype.endl=function(){return this+"\n"},String.prototype.startsWith=function(e){return 0===this.indexOf(e)},String.prototype.endsWith=function(e){return this.match(e+"$")==e};window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}};const h={Key:function(e){this.time=0,this.value=0,this.ui=null,this.onChange=null,this._easing=0,this.bezTangIn=0,this.bezTangOut=0,this.cb=null,this.cbTriggered=!1;this.setEasing(a.EASING_LINEAR),this.set(e)}};h.Key.cubicSpline=function(e,t,n){let r=e*e,i=r*e;return(2*i-3*r+1)*t.value+(i-2*r+e)*t.bezTangOut+(-2*i+3*r)*n.value+(i-r)*n.bezTangIn},h.Key.easeCubicSpline=function(e,t){return h.Key.cubicSpline(e,this,t)},h.Key.linear=function(e,t,n){return parseFloat(t.value)+parseFloat(n.value-t.value)*e},h.Key.easeLinear=function(e,t){return h.Key.linear(e,this,t)},h.Key.easeAbsolute=function(e,t){return this.value};h.Key.easeExpoIn=function(e,t){return e=function(e){return Math.pow(2,10*(e-1))}(e),h.Key.linear(e,this,t)};h.Key.easeExpoOut=function(e,t){return e=function(e){return e=1-Math.pow(2,-10*e)}(e),h.Key.linear(e,this,t)};h.Key.easeExpoInOut=function(e,t){return e=function(e){return(e*=2)<1?e=.5*Math.pow(2,10*(e-1)):(e--,e=.5*(2-Math.pow(2,-10*e))),e}(e),h.Key.linear(e,this,t)},h.Key.easeSinIn=function(e,t){return e=-1*Math.cos(e*Math.PI/2)+1,h.Key.linear(e,this,t)},h.Key.easeSinOut=function(e,t){return e=Math.sin(e*Math.PI/2),h.Key.linear(e,this,t)},h.Key.easeSinInOut=function(e,t){return e=-.5*(Math.cos(Math.PI*e)-1),h.Key.linear(e,this,t)};h.Key.easeCubicIn=function(e,t){return e=function(e){return e*=e*e}(e),h.Key.linear(e,this,t)},h.Key.easeInQuint=function(e,t){return e*=e*e*e*e,h.Key.linear(e,this,t)},h.Key.easeOutQuint=function(e,t){return e=(e-=1)*e*e*e*e+1,h.Key.linear(e,this,t)},h.Key.easeInOutQuint=function(e,t){return(e/=.5)<1?e*=.5*e*e*e*e:e=.5*((e-=2)*e*e*e*e+2),h.Key.linear(e,this,t)},h.Key.easeInQuart=function(e,t){return e*=e*e*e,h.Key.linear(e,this,t)},h.Key.easeOutQuart=function(e,t){return e=-1*((e-=1)*e*e*e-1),h.Key.linear(e,this,t)},h.Key.easeInOutQuart=function(e,t){return(e/=.5)<1?e*=.5*e*e*e:e=-.5*((e-=2)*e*e*e-2),h.Key.linear(e,this,t)},h.Key.bounce=function(e){return(e/=1)<1/2.75?e*=7.5625*e:e=e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,e},h.Key.easeInBounce=function(e,t){return h.Key.linear(h.Key.bounce(e),this,t)},h.Key.easeOutBounce=function(e,t){return h.Key.linear(h.Key.bounce(e),this,t)},h.Key.easeInElastic=function(e,t){let n=1.70158,r=0,i=1;return 0===e?e=0:1==(e/=1)?e=1:(r||(r=.3),i<Math.abs(1)?(i=1,n=r/4):n=r/(2*Math.PI)*Math.asin(1/i),e=-i*Math.pow(2,10*(e-=1))*Math.sin((1*e-n)*(2*Math.PI)/r)+0),h.Key.linear(e,this,t)},h.Key.easeOutElastic=function(e,t){let n=1.70158,r=0,i=1;return 0===e?e=0:1==(e/=1)?e=1:(r||(r=.3),i<Math.abs(1)?(i=1,n=r/4):n=r/(2*Math.PI)*Math.asin(1/i),e=i*Math.pow(2,-10*e)*Math.sin((1*e-n)*(2*Math.PI)/r)+1+0),h.Key.linear(e,this,t)},h.Key.easeInBack=function(e,t){const n=1.70158;return e=e*e*((n+1)*e-n),h.Key.linear(e,this,t)},h.Key.easeOutBack=function(e,t){const n=1.70158;return e=(e=e/1-1)*e*((n+1)*e+n)+1,h.Key.linear(e,this,t)},h.Key.easeInOutBack=function(e,t){let n=1.70158;return e=(e/=.5)<1?e*e*((1+(n*=1.525))*e-n)*.5:.5*((e-=2)*e*((1+(n*=1.525))*e+n)+2),h.Key.linear(e,this,t)};h.Key.easeCubicOut=function(e,t){return e=function(e){return e=--e*e*e+1}(e),h.Key.linear(e,this,t)};h.Key.easeCubicInOut=function(e,t){return e=function(e){return(e*=2)<1?e*=.5*e*e:e=.5*((e-=2)*e*e+2),e}(e),h.Key.linear(e,this,t)},h.Key.easeSmoothStep=function(e,t){const n=Math.max(0,Math.min(1,e));return e=n*n*(3-2*n),h.Key.linear(e,this,t)},h.Key.easeSmootherStep=function(e,t){const n=Math.max(0,Math.min(1,(e-0)/1));return e=n*n*n*(n*(6*n-15)+10),h.Key.linear(e,this,t)},h.Key.prototype.setEasing=function(e){this._easing=e,this._easing==a.EASING_LINEAR?this.ease=h.Key.easeLinear:this._easing==a.EASING_ABSOLUTE?this.ease=h.Key.easeAbsolute:this._easing==a.EASING_SMOOTHSTEP?this.ease=h.Key.easeSmoothStep:this._easing==a.EASING_SMOOTHERSTEP?this.ease=h.Key.easeSmootherStep:this._easing==a.EASING_CUBIC_IN?this.ease=h.Key.easeCubicIn:this._easing==a.EASING_CUBIC_OUT?this.ease=h.Key.easeCubicOut:this._easing==a.EASING_CUBIC_INOUT?this.ease=h.Key.easeCubicInOut:this._easing==a.EASING_EXPO_IN?this.ease=h.Key.easeExpoIn:this._easing==a.EASING_EXPO_OUT?this.ease=h.Key.easeExpoOut:this._easing==a.EASING_EXPO_INOUT?this.ease=h.Key.easeExpoInOut:this._easing==a.EASING_SIN_IN?this.ease=h.Key.easeSinIn:this._easing==a.EASING_SIN_OUT?this.ease=h.Key.easeSinOut:this._easing==a.EASING_SIN_INOUT?this.ease=h.Key.easeSinInOut:this._easing==a.EASING_BACK_OUT?this.ease=h.Key.easeOutBack:this._easing==a.EASING_BACK_IN?this.ease=h.Key.easeInBack:this._easing==a.EASING_BACK_INOUT?this.ease=h.Key.easeInOutBack:this._easing==a.EASING_ELASTIC_IN?this.ease=h.Key.easeInElastic:this._easing==a.EASING_ELASTIC_OUT?this.ease=h.Key.easeOutElastic:this._easing==a.EASING_ELASTIC_INOUT?this.ease=h.Key.easeElasticInOut:this._easing==a.EASING_BOUNCE_IN?this.ease=h.Key.easeInBounce:this._easing==a.EASING_BOUNCE_OUT?this.ease=h.Key.easeOutBounce:this._easing==a.EASING_QUART_OUT?this.ease=h.Key.easeOutQuart:this._easing==a.EASING_QUART_IN?this.ease=h.Key.easeInQuart:this._easing==a.EASING_QUART_INOUT?this.ease=h.Key.easeInOutQuart:this._easing==a.EASING_QUINT_OUT?this.ease=h.Key.easeOutQuint:this._easing==a.EASING_QUINT_IN?this.ease=h.Key.easeInQuint:this._easing==a.EASING_QUINT_INOUT?this.ease=h.Key.easeInOutQuint:this._easing==a.EASING_CUBICSPLINE?this.ease=h.Key.easeCubicSpline:(this._easing=a.EASING_LINEAR,this.ease=h.Key.easeLinear)},h.Key.prototype.trigger=function(){this.cb(),this.cbTriggered=!0},h.Key.prototype.setValue=function(e){this.value=e,null!==this.onChange&&this.onChange()},h.Key.prototype.set=function(e){e&&(e.e&&this.setEasing(e.e),e.cb&&(this.cb=e.cb,this.cbTriggered=!1),e.b,e.hasOwnProperty("t")&&(this.time=e.t),e.hasOwnProperty("time")&&(this.time=e.time),e.hasOwnProperty("v")?this.value=e.v:e.hasOwnProperty("value")&&(this.value=e.value)),null!==this.onChange&&this.onChange()},h.Key.prototype.getSerialized=function(){const e={};return e.t=this.time,e.v=this.value,e.e=this._easing,e},h.Key.prototype.getEasing=function(){return this._easing};const d=function(e){i.apply(this),e=e||{},this.keys=[],this.onChange=null,this.stayInTimeline=!1,this.loop=!1,this._log=new c("Anim"),this.defaultEasing=e.defaultEasing||a.EASING_LINEAR,this.onLooped=null,this._timesLooped=0,this._needsSort=!1};d.prototype.forceChangeCallback=function(){null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this)},d.prototype.getLoop=function(){return this.loop},d.prototype.setLoop=function(e){this.loop=e,this.emitEvent("onChange",this)},d.prototype.hasEnded=function(e){return 0===this.keys.length||this.keys[this.keys.length-1].time<=e},d.prototype.isRising=function(e){if(this.hasEnded(e))return!1;const t=this.getKeyIndex(e);return this.keys[t].value<this.keys[t+1].value},d.prototype.clearBefore=function(e){const t=this.getValue(e),n=this.getKeyIndex(e);this.setValue(e,t),n>1&&this.keys.splice(0,n)},d.prototype.clear=function(e){let t=0;e&&(t=this.getValue(e)),this.keys.length=0,e&&this.setValue(e,t),null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this)},d.prototype.sortKeys=function(){this.keys.sort((e,t)=>parseFloat(e.time)-parseFloat(t.time)),this._needsSort=!1},d.prototype.getLength=function(){return 0===this.keys.length?0:this.keys[this.keys.length-1].time},d.prototype.getKeyIndex=function(t){let n=0;for(let e=0;e<this.keys.length;e++)if(t>=this.keys[e].time&&(n=e),this.keys[e].time>t)return n;return n},d.prototype.setValue=function(t,n,r){let i=null;for(const e in this.keys)if(this.keys[e].time==t){i=this.keys[e],this.keys[e].setValue(n),this.keys[e].cb=r;break}return i||(i=new h.Key({time:t,value:n,e:this.defaultEasing,cb:r}),this.keys.push(i)),this.onChange&&this.onChange(),this.emitEvent("onChange",this),this._needsSort=!0,i},d.prototype.setKeyEasing=function(e,t){this.keys[e]&&(this.keys[e].setEasing(t),this.emitEvent("onChange",this))},d.prototype.getSerialized=function(){const t={keys:[]};t.loop=this.loop;for(const e in this.keys)t.keys.push(this.keys[e].getSerialized());return t},d.prototype.getKey=function(e){const t=this.getKeyIndex(e);return this.keys[t]},d.prototype.getNextKey=function(e){let t=this.getKeyIndex(e)+1;return t>=this.keys.length&&(t=this.keys.length-1),this.keys[t]},d.prototype.isFinished=function(e){return this.keys.length<=0||e>this.keys[this.keys.length-1].time},d.prototype.isStarted=function(e){return!(this.keys.length<=0)&&e>=this.keys[0].time},d.prototype.getValue=function(e){if(0===this.keys.length)return 0;if(this._needsSort&&this.sortKeys(),e<this.keys[0].time)return this.keys[0].value;const t=this.keys.length-1;if(this.loop&&e>this.keys[t].time){e/this.keys[t].time>this._timesLooped&&(this._timesLooped++,this.onLooped&&this.onLooped()),e=(e-this.keys[0].time)%(this.keys[t].time-this.keys[0].time),e+=this.keys[0].time}const n=this.getKeyIndex(e);if(n>=t)return this.keys[t].cb&&!this.keys[t].cbTriggered&&this.keys[t].trigger(),this.keys[t].value;const r=parseInt(n,10)+1,i=this.keys[n],a=this.keys[r];if(i.cb&&!i.cbTriggered&&i.trigger(),!a)return-1;const s=(e-i.time)/(a.time-i.time);return i.ease||this.log._warn("has no ease",i,a),i.ease(s,a)},d.prototype.addKey=function(e){void 0===e.time?this.log.warn("key time undefined, ignoring!"):(this.keys.push(e),null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this))},d.prototype.easingFromString=function(e){return"linear"==e?a.EASING_LINEAR:"absolute"==e?a.EASING_ABSOLUTE:"smoothstep"==e?a.EASING_SMOOTHSTEP:"smootherstep"==e?a.EASING_SMOOTHERSTEP:"Cubic In"==e?a.EASING_CUBIC_IN:"Cubic Out"==e?a.EASING_CUBIC_OUT:"Cubic In Out"==e?a.EASING_CUBIC_INOUT:"Expo In"==e?a.EASING_EXPO_IN:"Expo Out"==e?a.EASING_EXPO_OUT:"Expo In Out"==e?a.EASING_EXPO_INOUT:"Sin In"==e?a.EASING_SIN_IN:"Sin Out"==e?a.EASING_SIN_OUT:"Sin In Out"==e?a.EASING_SIN_INOUT:"Back In"==e?a.EASING_BACK_IN:"Back Out"==e?a.EASING_BACK_OUT:"Back In Out"==e?a.EASING_BACK_INOUT:"Elastic In"==e?a.EASING_ELASTIC_IN:"Elastic Out"==e?a.EASING_ELASTIC_OUT:"Bounce In"==e?a.EASING_BOUNCE_IN:"Bounce Out"==e?a.EASING_BOUNCE_OUT:"Quart Out"==e?a.EASING_QUART_OUT:"Quart In"==e?a.EASING_QUART_IN:"Quart In Out"==e?a.EASING_QUART_INOUT:"Quint Out"==e?a.EASING_QUINT_OUT:"Quint In"==e?a.EASING_QUINT_IN:"Quint In Out"==e?a.EASING_QUINT_INOUT:void 0},d.prototype.createPort=function(e,t,n){const r=e.inDropDown(t,a.EASINGS);return r.set("linear"),r.defaultValue="linear",r.onChange=function(){this.defaultEasing=this.easingFromString(r.get()),n&&n()}.bind(this),r},d.slerpQuaternion=function(n,r,i,a,s,o){d.slerpQuaternion.q1||(d.slerpQuaternion.q1=quat.create(),d.slerpQuaternion.q2=quat.create());const l=i.getKeyIndex(n);let u=l+1;if(u>=i.keys.length&&(u=i.keys.length-1),l==u)quat.set(r,i.keys[l].value,a.keys[l].value,s.keys[l].value,o.keys[l].value);else{const e=i.keys[l].time,t=(n-e)/(i.keys[u].time-e);quat.set(d.slerpQuaternion.q1,i.keys[l].value,a.keys[l].value,s.keys[l].value,o.keys[l].value),quat.set(d.slerpQuaternion.q2,i.keys[u].value,a.keys[u].value,s.keys[u].value,o.keys[u].value),quat.slerp(r,d.slerpQuaternion.q1,d.slerpQuaternion.q2,t)}return r};h.Anim=d;const f=function(e,t,n,r){i.apply(this),this.data={},this._log=new c("core_port"),this.direction=o.PORT_DIR_IN,this.id=u(),this.parent=e,this.links=[],this.value=0,this.name=t,this.type=n||s.OP_PORT_TYPE_VALUE,this.uiAttribs=r||{},this.anim=null,this._oldAnimVal=-5711,this.defaultValue=null,this._uiActiveState=!0,this.ignoreValueSerialize=!1,this.onLinkChanged=null,this.crashed=!1,this._valueBeforeLink=null,this._lastAnimFrame=-1,this._animated=!1,this.onValueChanged=null,this.onTriggered=null,this.onUiActiveStateChange=null,this.changeAlways=!1,this._warnedDeprecated=!1,this._useVariableName=null,this.activityCounter=0,this._tempLastUiValue=null,Object.defineProperty(this,"val",{get(){return this._log.warn("val getter deprecated!",this),this._log.stack("val getter deprecated"),this._warnedDeprecated=!0,this.get()},set(e){this._log.warn("val setter deprecated!",this),this._log.stack("val setter deprecated"),this.setValue(e),this._warnedDeprecated=!0}})};f.prototype.getValueForDisplay=function(){let e=String(this.value);return this.uiAttribs&&"boolnum"==this.uiAttribs.display&&(e+=" - ",this.value?e+="true":e+="false"),e=e.replace(/(<([^>]+)>)/gi,""),e.length>100&&(e=e.substring(0,100)),e},f.prototype.onAnimToggle=function(){},f.prototype._onAnimToggle=function(){this.onAnimToggle()},f.prototype.remove=function(){this.removeLinks(),this.parent.removePort(this)},f.prototype.setUiAttribs=function(t){let n=!1;this.uiAttribs||(this.uiAttribs={});for(const e in t)this.uiAttribs[e]!=t[e]&&(n=!0),this.uiAttribs[e]=t[e],"group"==e&&this.indexPort&&this.indexPort.setUiAttribs({group:t[e]});n&&this.emitEvent("onUiAttrChange",t)},f.prototype.getUiAttribs=function(){return this.uiAttribs},f.prototype.getUiAttrib=function(e){return this.uiAttribs&&this.uiAttribs.hasOwnProperty(e)?this.uiAttribs[e]:null},f.prototype.get=function(){return this._animated&&this._lastAnimFrame!=this.parent.patch.getFrameNum()&&(this._lastAnimFrame=this.parent.patch.getFrameNum(),this.value=this.anim.getValue(this.parent.patch.timer.getTime()),this._oldAnimVal=this.value,this.forceChange()),this.value},f.prototype.set=f.prototype.setValue=function(e){if(void 0!==e&&this.parent.enabled&&!this.crashed&&(e!==this.value||this.changeAlways||this.type==s.OP_PORT_TYPE_TEXTURE||this.type==s.OP_PORT_TYPE_ARRAY)){if(this._animated)this.anim.setValue(this.parent.patch.timer.getTime(),e);else{try{this.value=e,this.forceChange()}catch(e){this.crashed=!0,this.setValue=function(e){},this.onTriggered=function(){},this._log.error("onvaluechanged exception cought",e),this._log.error(e.stack),this._log.warn("exception in: "+this.parent.name),this.parent.patch.isEditorMode()&&gui.showOpCrash(this.parent),this.parent.patch.emitEvent("exception",e,this.parent),this.parent.onError&&this.parent.onError(e)}this.parent&&this.parent.patch&&this.parent.patch.isEditorMode()&&this.type==s.OP_PORT_TYPE_TEXTURE&&gui.texturePreview().updateTexturePort(this)}if(this.direction==o.PORT_DIR_OUT)for(let e=0;e<this.links.length;++e)this.links[e].setValue()}},f.prototype.updateAnim=function(){this._animated&&(this.value=this.get(),(this._oldAnimVal!=this.value||this.changeAlways)&&(this._oldAnimVal=this.value,this.forceChange()),this._oldAnimVal=this.value)},f.args=function(e){return(e+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},f.prototype.forceChange=function(){this.onValueChanged||this.onChange,this._activity(),this.emitEvent("change",this.value,this),this.onChange?this.onChange(this,this.value):this.onValueChanged&&this.onValueChanged(this,this.value)},f.prototype.getTypeString=function(){return this.type==s.OP_PORT_TYPE_VALUE?"Number":this.type==s.OP_PORT_TYPE_FUNCTION?"Trigger":this.type==s.OP_PORT_TYPE_OBJECT?"Object":this.type==s.OP_PORT_TYPE_DYNAMIC?"Dynamic":this.type==s.OP_PORT_TYPE_ARRAY?"Array":this.type==s.OP_PORT_TYPE_STRING?"String":"Unknown"},f.prototype.deSerializeSettings=function(t){if(t&&(t.animated&&this.setAnimated(t.animated),t.useVariable&&this.setVariableName(t.useVariable),t.anim)){this.anim||(this.anim=new d),this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)}),t.anim.loop&&(this.anim.loop=t.anim.loop);for(const e in t.anim.keys)this.anim.keys.push(new h.Key(t.anim.keys[e]))}},f.prototype.getSerialized=function(){const t={};if(t.name=this.getName(),this.ignoreValueSerialize||0!==this.links.length||this.type==s.OP_PORT_TYPE_OBJECT&&this.value&&this.value.tex||(t.value=this.value),this._useVariableName&&(t.useVariable=this._useVariableName),this._animated&&(t.animated=!0),this.anim&&(t.anim=this.anim.getSerialized()),"file"==this.uiAttribs.display&&(t.display=this.uiAttribs.display),this.direction==o.PORT_DIR_OUT&&this.links.length>0){t.links=[];for(const e in this.links)!this.links[e].ignoreInSerialize&&this.links[e].portIn&&this.links[e].portOut&&t.links.push(this.links[e].getSerialized())}return t},f.prototype.shouldLink=function(){return!0},f.prototype.removeLinks=function(){let e=0;for(;this.links.length>0;){if(e++,e>5e3){this._log.warn("could not delete links... / infinite loop"),this.links.length=0;break}this.links[0].remove()}},f.prototype.removeLink=function(t){for(const e in this.links)this.links[e]==t&&this.links.splice(e,1);this.direction==o.PORT_DIR_IN&&(this.type==s.OP_PORT_TYPE_VALUE?this.setValue(this._valueBeforeLink||0):this.setValue(this._valueBeforeLink||null)),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},f.prototype.getName=function(){return this.name},f.prototype.addLink=function(e){this._valueBeforeLink=this.value,this.links.push(e),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},f.prototype.getLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]},f.prototype.removeLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e].remove(),this.onLinkChanged&&this.onLinkChanged(),void this.emitEvent("onLinkChanged")},f.prototype.isLinkedTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},f.prototype._activity=function(){this.activityCounter++},f.prototype.trigger=function(){if(this._activity(),0===this.links.length)return;if(!this.parent.enabled)return;let t=null;try{for(let e=0;e<this.links.length;++e)this.links[e].portIn&&(t=this.links[e].portIn,t.parent.patch.pushTriggerStack(t),t._onTriggered(),t.parent.patch.popTriggerStack()),this.links[e]&&this.links[e].activity()}catch(e){this.parent.enabled=!1,this.parent.patch.isEditorMode()&&(this.parent.patch.emitEvent("exception",e,t.parent),this.parent.patch.emitEvent("opcrash",t),t.parent.onError&&t.parent.onError(e)),this._log.warn("exception!"),this._log.error("ontriggered exception cought",e),this._log.error(e.stack),this._log.warn("exception in: "+t.parent.name)}},f.prototype.call=function(){this._log.warn("call deprecated - use trigger() "),this.trigger()},f.prototype.execute=function(){this._log.warn("### execute port: "+this.getName(),this.goals.length)},f.prototype.setVariableName=function(e){this._useVariableName=e},f.prototype.getVariableName=function(){return this._useVariableName},f.prototype.setVariable=function(e){this.setAnimated(!1);const t={useVariable:!1};this._variableIn&&(this._variableIn.removeListener(this.set.bind(this)),this._variableIn=null),e?(this._variableIn=this.parent.patch.getVar(e),this._variableIn?(this.type==s.OP_PORT_TYPE_OBJECT?this._variableIn.addListener(()=>{this.set(null),this.set(this._variableIn.getValue())}):this._variableIn.addListener(this.set.bind(this)),this.set(this._variableIn.getValue())):this._log.warn("PORT VAR NOT FOUND!!!",e),this._useVariableName=e,t.useVariable=!0,t.variableName=this._useVariableName):(t.variableName=this._useVariableName=null,t.useVariable=!1),this.setUiAttribs(t),this.parent.patch.emitEvent("portSetVariable",this.parent,this,e)},f.prototype._handleNoTriggerOpAnimUpdates=function(e){let t=!1;for(let e=0;e<this.parent.portsIn.length;e++)if(this.parent.portsIn.type==s.OP_PORT_TYPE_FUNCTION){t=!0;break}t||(e?this._notriggerAnimUpdate=this.parent.patch.on("onRenderFrame",()=>{this.updateAnim()}):this.parent.patch.removeEventListener(this._notriggerAnimUpdate))},f.prototype.setAnimated=function(e){this._animated!=e&&(this._animated=e,this._animated&&!this.anim&&(this.anim=new d,this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)})),this._onAnimToggle()),this._handleNoTriggerOpAnimUpdates(e),this.setUiAttribs({isAnimated:this._animated})},f.prototype.toggleAnim=function(e){this._animated=!this._animated,this._animated&&!this.anim&&(this.anim=new d,this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)})),this.setAnimated(this._animated),this._onAnimToggle(),this.setUiAttribs({isAnimated:this._animated})},f.prototype.getType=function(){return this.type},f.prototype.isLinked=function(){return this.links.length>0},f.prototype.isBoundToVar=function(){return null!=this._useVariableName},f.prototype.isAnimated=function(){return this._animated},f.prototype.isHidden=function(){return this.uiAttribs.hidePort},f.prototype._onTriggered=function(e){this._activity(),this.parent.updateAnims(),this.parent.enabled&&this.onTriggered&&this.onTriggered(e)},f.prototype._onSetProfiling=function(e){this.parent.patch.profiler.add("port",this),this.setValue(e),this.parent.patch.profiler.add("port",null)},f.prototype._onTriggeredProfiling=function(){this.parent.enabled&&this.onTriggered&&(this.parent.patch.profiler.add("port",this),this.onTriggered(),this.parent.patch.profiler.add("port",null))},f.prototype.onValueChange=function(e){this.onChange=e},f.prototype.getUiActiveState=function(){return this._uiActiveState},f.prototype.setUiActiveState=function(e){this._uiActiveState=e,this.onUiActiveStateChange&&this.onUiActiveStateChange()},f.prototype.hidePort=function(){this._log.warn("op.hideport() is deprecated, do not use it!")},f.portTypeNumberToString=function(e){return e==s.OP_PORT_TYPE_VALUE?"value":e==s.OP_PORT_TYPE_FUNCTION?"function":e==s.OP_PORT_TYPE_OBJECT?"object":e==s.OP_PORT_TYPE_ARRAY?"array":e==s.OP_PORT_TYPE_STRING?"string":e==s.OP_PORT_TYPE_DYNAMIC?"dynamic":"unknown"};const p=function(e,t,n,r,i,a,s,o,l,u){if(this._loc=-1,this._log=new c("cgl_uniform"),this._type=t,this._cgl=e._cgl,this._name=n,this._shader=e,this._value=1e-5,this._oldValue=null,this._port=null,this._structName=l,this._structUniformName=o,this._propertyName=u,this._shader._addUniform(this),this.needsUpdate=!0,this.shaderType=null,this.comment=null,"f"==t)this.set=this.setValue=this.setValueF.bind(this),this.updateValue=this.updateValueF.bind(this);else if("f[]"==t)this.set=this.setValue=this.setValueArrayF.bind(this),this.updateValue=this.updateValueArrayF.bind(this);else if("2f[]"==t)this.set=this.setValue=this.setValueArray2F.bind(this),this.updateValue=this.updateValueArray2F.bind(this);else if("3f[]"==t)this.set=this.setValue=this.setValueArray3F.bind(this),this.updateValue=this.updateValueArray3F.bind(this);else if("4f[]"==t)this.set=this.setValue=this.setValueArray4F.bind(this),this.updateValue=this.updateValueArray4F.bind(this);else if("i"==t)this.set=this.setValue=this.setValueI.bind(this),this.updateValue=this.updateValueI.bind(this);else if("2i"==t)this.set=this.setValue=this.setValue2I.bind(this),this.updateValue=this.updateValue2I.bind(this);else if("3i"==t)this.set=this.setValue=this.setValue3I.bind(this),this.updateValue=this.updateValue3I.bind(this);else if("4i"==t)this.set=this.setValue=this.setValue4I.bind(this),this.updateValue=this.updateValue4I.bind(this);else if("b"==t)this.set=this.setValue=this.setValueBool.bind(this),this.updateValue=this.updateValueBool.bind(this);else if("4f"==t)this.set=this.setValue=this.setValue4F.bind(this),this.updateValue=this.updateValue4F.bind(this);else if("3f"==t)this.set=this.setValue=this.setValue3F.bind(this),this.updateValue=this.updateValue3F.bind(this);else if("2f"==t)this.set=this.setValue=this.setValue2F.bind(this),this.updateValue=this.updateValue2F.bind(this);else if("t"==t)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("tc"==t)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("t[]"==t)this.set=this.setValue=this.setValueArrayT.bind(this),this.updateValue=this.updateValueArrayT.bind(this);else{if("m4"!=t&&"m4[]"!=t)throw new Error("Unknown uniform type");this.set=this.setValue=this.setValueM4.bind(this),this.updateValue=this.updateValueM4.bind(this)}"object"==typeof r&&r instanceof f?(this._port=r,this._value=this._port.get(),i&&a&&s?(i instanceof f&&a instanceof f&&s instanceof f||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0,0],this._port2=i,this._port3=a,this._port4=s,this._port.on("change",this.updateFromPort4f.bind(this)),this._port2.on("change",this.updateFromPort4f.bind(this)),this._port3.on("change",this.updateFromPort4f.bind(this)),this._port4.on("change",this.updateFromPort4f.bind(this)),this.updateFromPort4f()):i&&a?(i instanceof f&&a instanceof f||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0],this._port2=i,this._port3=a,this._port.on("change",this.updateFromPort3f.bind(this)),this._port2.on("change",this.updateFromPort3f.bind(this)),this._port3.on("change",this.updateFromPort3f.bind(this)),this.updateFromPort3f()):i?(i instanceof f||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0],this._port2=i,this._port.on("change",this.updateFromPort2f.bind(this)),this._port2.on("change",this.updateFromPort2f.bind(this)),this.updateFromPort2f()):this._port.on("change",this.updateFromPort.bind(this))):this._value=r,this.setValue(this._value),this.needsUpdate=!0};p.prototype.copy=function(e){const t=new p(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);return t.shaderType=this.shaderType,t},p.prototype.getGlslTypeString=function(){return"f"==this._type?"float":"b"==this._type?"bool":"i"==this._type?"int":"2i"==this._type?"ivec2":"2f"==this._type?"vec2":"3f"==this._type?"vec3":"4f"==this._type?"vec4":"m4"==this._type?"mat4":"t"==this._type?"sampler2D":"tc"==this._type?"samplerCube":"3f[]"==this._type||"m4[]"==this._type?null:void this._log.warn("[CGL UNIFORM] unknown glsl type string ",this._type)},p.prototype._isValidLoc=function(){return-1!=this._loc},p.prototype.getType=function(){return this._type},p.prototype.getName=function(){return this._name},p.prototype.getValue=function(){return this._value},p.prototype.getShaderType=function(){return this.shaderType},p.prototype.isStructMember=function(){return!!this._structName},p.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},p.prototype.bindTextures=function(){return this._value},p.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},p.prototype.bindTextures=function(){},p.prototype.getLoc=function(){return this._loc},p.prototype.updateFromPort4f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this._value[3]=this._port4.get(),this.setValue(this._value)},p.prototype.updateFromPort3f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this.setValue(this._value)},p.prototype.updateFromPort2f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this.setValue(this._value)},p.prototype.updateFromPort=function(){this.setValue(this._port.get())},p.prototype.updateValueF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1f(this._loc,this._value),this._cgl.profileData.profileUniformCount++},p.prototype.setValueF=function(e){e!=this._value&&(this.needsUpdate=!0,this._value=e)},p.prototype.updateValueI=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value),this._cgl.profileData.profileUniformCount++},p.prototype.updateValue2I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},p.prototype.updateValue3I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},p.prototype.updateValue4I=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},p.prototype.setValueI=function(e){e!=this._value&&(this.needsUpdate=!0,this._value=e)},p.prototype.setValue2I=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1],this.needsUpdate=!0),this._value=e)},p.prototype.setValue3I=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]&&e[2]==this._oldValue[2]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this._oldValue[2]=e[2],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1,2],this.needsUpdate=!0),this._value=e)},p.prototype.setValue4I=function(e){this.needsUpdate=!0,this._value=e||vec4.create()},p.prototype.updateValueBool=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0),this._cgl.profileData.profileUniformCount++},p.prototype.setValueBool=function(e){e!=this._value&&(this.needsUpdate=!0,this._value=e)},p.prototype.setValueArray4F=function(e){this.needsUpdate=!0,this._value=e},p.prototype.updateValueArray4F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform4fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},p.prototype.setValueArray3F=function(e){this.needsUpdate=!0,this._value=e},p.prototype.updateValueArray3F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform3fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},p.prototype.setValueArray2F=function(e){this.needsUpdate=!0,this._value=e},p.prototype.updateValueArray2F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform2fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},p.prototype.setValueArrayF=function(e){this.needsUpdate=!0,this._value=e},p.prototype.updateValueArrayF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},p.prototype.setValueArrayT=function(e){this.needsUpdate=!0,this._value=e},p.prototype.updateValue3F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},p.prototype.setValue3F=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]&&e[2]==this._oldValue[2]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this._oldValue[2]=e[2],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1,2],this.needsUpdate=!0),this._value=e)},p.prototype.updateValue2F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},p.prototype.setValue2F=function(e){e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1],this.needsUpdate=!0),this._value=e)},p.prototype.updateValue4F=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._value||(this._log.warn("no value for uniform",this._name,this),this._value=[0,0,0,0]),this.needsUpdate=!1,this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},p.prototype.setValue4F=function(e){"number"==typeof this.value&&(this.value=vec4.create()),e&&(this._oldValue?e[0]==this._oldValue[0]&&e[1]==this._oldValue[1]&&e[2]==this._oldValue[2]&&e[3]==this._oldValue[3]||(this._oldValue[0]=e[0],this._oldValue[1]=e[1],this._oldValue[2]=e[2],this.needsUpdate=!0):(this._oldValue=[e[0]-1,1,2,3],this.needsUpdate=!0),this._value=e)},p.prototype.updateValueM4=function(){if(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,!1,this._value),this._cgl.profileData.profileUniformCount++},p.prototype.setValueM4=function(e){this.needsUpdate=!0,this._value=e||mat4.create()},p.prototype.updateValueArrayT=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1iv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},p.prototype.updateValueT=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._cgl.profileData.profileUniformCount++,this._shader.getCgl().gl.uniform1i(this._loc,this._value),this.needsUpdate=!1},p.prototype.setValueT=function(e){this.needsUpdate=!0,this._value=e};const m=180/Math.PI,g=(Math.PI,{SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_VIEWPOS:"camPos"});const v={lastMesh:null},b=function(e,t,n){this._cgl=e,this._log=new c("cgl_mesh"),this._bufVertexAttrib=null,this._bufVerticesIndizes=this._cgl.gl.createBuffer(),this._indexType=this._cgl.gl.UNSIGNED_SHORT,this._attributes=[],this._attribLocs={},this._geom=null,this._lastShader=null,this._numInstances=0,this._glPrimitive=n,this._preWireframeGeom=null,this.addVertexNumbers=!1,this.feedBackAttributes=[],this.setGeom(t),this._feedBacks=[],this._feedBacksChanged=!1,this._transformFeedBackLoc=-1,this._lastAttrUpdate=0,this._name="unknown",this._cgl.profileData.addHeavyEvent("mesh constructed",this._name),this._queryExt=null,Object.defineProperty(this,"numInstances",{get(){return this._numInstances},set(e){this.setNumInstances(e)}})};b.prototype.updateVertices=function(e){this.setAttribute(g.SHADERVAR_VERTEX_POSITION,e.vertices,3),this._numVerts=e.vertices.length/3},b.prototype.setAttributePointer=function(t,n,r,i){for(let e=0;e<this._attributes.length;e++)this._attributes[e].name==t&&(this._attributes[e].pointer||(this._attributes[e].pointer=[]),this._attributes[e].pointer.push({loc:-1,name:n,stride:r,offset:i,instanced:t==g.SHADERVAR_INSTANCE_MMATRIX}))},b.prototype.getAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]},b.prototype.setAttributeRange=function(e,t,n,r){e&&(n||r)&&(e.name||(console.log(e),this._log.stack("no attrname?!")),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,e.buffer),this._cgl.profileData.profileMeshAttributes+=r-n||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]=this._cgl.profileData.profileSingleMeshAttribute[this._name]||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]+=r-n||0,e.numItems<t.length/e.itemSize&&this._resizeAttr(t,e),r>=t.length-1&&this._log.log(this._cgl.canvas.id+" "+e.name+" buffersubdata out of bounds ?",t.length,r,n,e),1==this._cgl.glVersion?this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,0,t):this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,4*n,t,n,r-n))},b.prototype._resizeAttr=function(e,t){t.buffer&&this._cgl.gl.deleteBuffer(t.buffer),t.buffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,t.buffer),this._bufferArray(e,t),t.numItems=e.length/t.itemSize},b.prototype._bufferArray=function(e,t){let n=null;e&&(this._cgl.debugOneFrame&&console.log("_bufferArray",e.length,t.name),e instanceof Float32Array?n=e:t&&n&&n.length==e.length?n.set(e):(n=new Float32Array(e),this._cgl.debugOneFrame&&console.log("_bufferArray create new float32array",e.length,t.name),this._cgl.profileData.profileNonTypedAttrib++,this._cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"),t.arrayLength=n.length,this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,n,this._cgl.gl.DYNAMIC_DRAW))},b.prototype.addAttribute=b.prototype.updateAttribute=b.prototype.setAttribute=function(e,t,n,r){if(!t)throw this._log.error("mesh addAttribute - no array given! "+e),new Error;let i=null,a=!1,s=0;const o=t.length/n;for(this._cgl.profileData.profileMeshAttributes+=o||0,"function"==typeof r&&(i=r),"object"==typeof r&&(r.cb&&(i=r.cb),r.instanced&&(a=r.instanced)),e==g.SHADERVAR_INSTANCE_MMATRIX&&(a=!0),s=0;s<this._attributes.length;s++){const n=this._attributes[s];if(n.name==e)return n.numItems===o||this._resizeAttr(t,n),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,n.buffer),this._bufferArray(t,n),n}const l=this._cgl.gl.createBuffer();this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,l);let u=this._cgl.gl.FLOAT;r&&r.type&&(u=r.type);const c={buffer:l,name:e,cb:i,itemSize:n,numItems:o,startItem:0,instanced:a,type:u};return this._bufferArray(t,c),e==g.SHADERVAR_VERTEX_POSITION&&(this._bufVertexAttrib=c),this._attributes.push(c),this._attribLocs={},c},b.prototype.getAttributes=function(){return this._attributes},b.prototype.updateTexCoords=function(t){if(t.texCoords&&t.texCoords.length>0)this.setAttribute(g.SHADERVAR_VERTEX_TEXCOORD,t.texCoords,2);else{const e=new Float32Array(Math.round(t.vertices.length/3*2));this.setAttribute(g.SHADERVAR_VERTEX_TEXCOORD,e,2)}},b.prototype.updateNormals=function(t){if(t.vertexNormals&&t.vertexNormals.length>0)this.setAttribute("attrVertNormal",t.vertexNormals,3);else{const e=new Float32Array(Math.round(t.vertices.length));this.setAttribute("attrVertNormal",e,3)}},b.prototype._setVertexNumbers=function(e){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(g.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,n)=>{n.uniformNumVertices||(n.uniformNumVertices=new p(n,"f","numVertices",this._numVerts)),n.uniformNumVertices.setValue(this._numVerts)})}},b.prototype.setVertexIndices=function(t){if(this._bufVerticesIndizes)if(t.length>0){for(let e=0;e<t.length;e++)if(t[e]>=this._numVerts)return void this._log.warn("invalid index in "+this._name);this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes),t instanceof Float32Array&&this._log.warn("vertIndices float32Array: "+this._name),t instanceof Uint32Array?(this.vertIndicesTyped=t,this._indexType=this._cgl.gl.UNSIGNED_INT):t instanceof Uint16Array?this.vertIndicesTyped=t:this.vertIndicesTyped=new Uint16Array(t),this._cgl.gl.bufferData(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this._cgl.gl.DYNAMIC_DRAW),this._bufVerticesIndizes.itemSize=1,this._bufVerticesIndizes.numItems=t.length}else this._bufVerticesIndizes.numItems=0;else this._log.warn("no bufVerticesIndizes: "+this._name)},b.prototype.setGeom=function(e,t){this._geom=e,null!=e.glPrimitive&&(this._glPrimitive=e.glPrimitive),this._geom&&this._geom.name&&(this._name="mesh "+this._geom.name),v.lastMesh=null,this._cgl.profileData.profileMeshSetGeom++,this._disposeAttributes(),this.updateVertices(this._geom),this.setVertexIndices(this._geom.verticesIndices),this.updateTexCoords(this._geom),this.updateNormals(this._geom),this._geom.hasOwnProperty("tangents")&&this._geom.tangents&&this._geom.tangents.length>0&&this.setAttribute("attrTangent",this._geom.tangents,3),this._geom.hasOwnProperty("biTangents")&&this._geom.biTangents&&this._geom.biTangents.length>0&&this.setAttribute("attrBiTangent",this._geom.biTangents,3),this._geom.vertexColors.length>0&&(this._geom.vertexColors.flat&&this._geom.vertexColors.flat(100),this.setAttribute("attrVertColor",this._geom.vertexColors,4)),this.addVertexNumbers&&this._setVertexNumbers();const n=this._geom.getAttributes();for(const e in n)this.setAttribute(e,n[e].data,n[e].itemSize);t&&(this._geom=null)},b.prototype._preBind=function(t){for(let e=0;e<this._attributes.length;e++)this._attributes[e].cb&&this._attributes[e].cb(this._attributes[e],this._geom,t)},b.prototype._checkAttrLengths=function(){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";this._geom&&(e=this._geom.name)}},b.prototype._bind=function(r){if(!r.isValid())return;let t=[];if(this._attribLocs[r.id]?t=this._attribLocs[r.id]:this._attribLocs[r.id]=t,this._lastShader=r,r.lastCompile>this._lastAttrUpdate||t.length!=this._attributes.length){this._lastAttrUpdate=r.lastCompile;for(let e=0;e<this._attributes.length;e++)t[e]=-1}for(let e=0;e<this._attributes.length;e++){const n=this._attributes[e];if(-1==t[e]&&n._attrLocationLastShaderTime!=r.lastCompile&&(n._attrLocationLastShaderTime=r.lastCompile,t[e]=this._cgl.glGetAttribLocation(r.getProgram(),n.name),this._cgl.profileData.profileAttrLoc++),-1!=t[e])if(this._cgl.gl.enableVertexAttribArray(t[e]),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,n.buffer),n.instanced)if(n.itemSize<=4)n.itemSize&&0!=n.itemSize||this._log.warn("instanced attrib itemsize error",this._geom.name,n),this._cgl.gl.vertexAttribPointer(t[e],n.itemSize,n.type,!1,4*n.itemSize,0),this._cgl.gl.vertexAttribDivisor(t[e],1);else if(16==n.itemSize){const r=64;this._cgl.gl.vertexAttribPointer(t[e],4,n.type,!1,r,0),this._cgl.gl.enableVertexAttribArray(t[e]+1),this._cgl.gl.vertexAttribPointer(t[e]+1,4,n.type,!1,r,16),this._cgl.gl.enableVertexAttribArray(t[e]+2),this._cgl.gl.vertexAttribPointer(t[e]+2,4,n.type,!1,r,32),this._cgl.gl.enableVertexAttribArray(t[e]+3),this._cgl.gl.vertexAttribPointer(t[e]+3,4,n.type,!1,r,48),this._cgl.gl.vertexAttribDivisor(t[e],1),this._cgl.gl.vertexAttribDivisor(t[e]+1,1),this._cgl.gl.vertexAttribDivisor(t[e]+2,1),this._cgl.gl.vertexAttribDivisor(t[e]+3,1)}else this._log.warn("unknown instance attrib size",n.name);else{if(n.itemSize&&0!=n.itemSize||this._log.warn("attrib itemsize error",this._name,n),this._cgl.gl.vertexAttribPointer(t[e],n.itemSize,n.type,!1,4*n.itemSize,0),n.pointer)for(let t=0;t<n.pointer.length;t++){const e=n.pointer[t];-1==e.loc&&(e.loc=this._cgl.glGetAttribLocation(r.getProgram(),e.name)),this._cgl.profileData.profileAttrLoc++,this._cgl.gl.enableVertexAttribArray(e.loc),this._cgl.gl.vertexAttribPointer(e.loc,n.itemSize,n.type,!1,e.stride,e.offset)}this.bindFeedback(n)}}0!==this._bufVerticesIndizes.numItems&&this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes)},b.prototype.unBind=function(){const e=this._lastShader;if(this._lastShader=null,!e)return;let t=[];this._attribLocs[e.id]?t=this._attribLocs[e.id]:this._attribLocs[e.id]=t,v.lastMesh=null;for(let e=0;e<this._attributes.length;e++)this._attributes[e].instanced&&(this._attributes[e].itemSize<=4?(-1!=t[e]&&this._cgl.gl.vertexAttribDivisor(t[e],0),t[e]>=0&&this._cgl.gl.disableVertexAttribArray(t[e])):(this._cgl.gl.vertexAttribDivisor(t[e],0),this._cgl.gl.vertexAttribDivisor(t[e]+1,0),this._cgl.gl.vertexAttribDivisor(t[e]+2,0),this._cgl.gl.vertexAttribDivisor(t[e]+3,0),this._cgl.gl.disableVertexAttribArray(t[e]+1),this._cgl.gl.disableVertexAttribArray(t[e]+2),this._cgl.gl.disableVertexAttribArray(t[e]+3))),-1!=t[e]&&this._cgl.gl.disableVertexAttribArray(t[e])},b.prototype.meshChanged=function(){return this._cgl.lastMesh&&this._cgl.lastMesh!=this},b.prototype.printDebug=function(e){console.log("--attributes");for(let e=0;e<this._attributes.length;e++)console.log("attribute "+e+" "+this._attributes[e].name)},b.prototype.setNumVertices=function(e){this._bufVertexAttrib.numItems=e},b.prototype.getNumVertices=function(){return this._bufVertexAttrib.numItems},b.prototype.render=function(n){if(!n||!n.isValid())return;if(this._checkAttrLengths(),this._geom&&(!this._preWireframeGeom||n.wireframe||this._geom.isIndexed()||(this.setGeom(this._preWireframeGeom),this._preWireframeGeom=null),n.wireframe)){let e=!1;this._geom.isIndexed()&&(this._preWireframeGeom||(this._preWireframeGeom=this._geom,this._geom=this._geom.copy()),this._geom.unIndex(),e=!0),this._geom.getAttribute("attrBarycentric")||(this._preWireframeGeom||(this._preWireframeGeom=this._geom,this._geom=this._geom.copy()),e=!0,this._geom.calcBarycentric()),e&&this.setGeom(this._geom)}let e=!1;v.lastMesh!=this&&(v.lastMesh&&v.lastMesh.unBind(),e=!0),e&&this._preBind(n),n.bind(),n.bindTextures&&n.bindTextures(),this._bind(n),this.addVertexNumbers&&this._setVertexNumbers(),v.lastMesh=this;let t=this._cgl.gl.TRIANGLES;void 0!==this._glPrimitive&&(t=this._glPrimitive),null!==n.glPrimitive&&(t=n.glPrimitive);let r=1,i=this._cgl.profileData.doProfileGlQuery,a=!1;if(i){let e=this._name+" "+n.getName()+" #"+n.id;this._numInstances&&(e+=" instanced "+this._numInstances+"x");let t=this._cgl.profileData.glQueryData[e];if(t||(t={id:e,num:0},this._cgl.profileData.glQueryData[e]=t),this._queryExt||!1===this._queryExt||(this._queryExt=this._cgl.gl.getExtension("EXT_disjoint_timer_query_webgl2")||!1),this._queryExt){if(t._drawQuery){if(this._cgl.gl.getQueryParameter(t._drawQuery,this._cgl.gl.QUERY_RESULT_AVAILABLE)){const n=this._cgl.gl.getQueryParameter(t._drawQuery,this._cgl.gl.QUERY_RESULT)/1e6;t._times+=n,t._numcount++,t.when=performance.now(),t._drawQuery=null,t.queryStarted=!1}}t.queryStarted||(t._drawQuery=this._cgl.gl.createQuery(),this._cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery),a=t.queryStarted=!0)}}if(this.hasFeedbacks()?this.drawFeedbacks(n,t):0===this._bufVerticesIndizes.numItems?(t==this._cgl.gl.TRIANGLES&&(r=3),0===this._numInstances?this._cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem):this._cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)):0===this._numInstances?this._cgl.gl.drawElements(t,this._bufVerticesIndizes.numItems,this._indexType,0):this._cgl.gl.drawElementsInstanced(t,this._bufVerticesIndizes.numItems,this._indexType,0,this._numInstances),this._cgl.debugOneFrame&&this._cgl.gl.getError()!=this._cgl.gl.NO_ERROR){this._log.error("mesh draw gl error"),this._log.error("mesh",this),this._log.error("shader",n);for(let e=0;e<this._cgl.gl.getProgramParameter(n.getProgram(),this._cgl.gl.ACTIVE_ATTRIBUTES);e++){const t=this._cgl.gl.getActiveAttrib(n.getProgram(),e).name;this._log.error("attrib ",t)}}this._cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/r*(this._numInstances||1),this._cgl.profileData.profileMeshDraw++,i&&a&&this._cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT),this.unBind()},b.prototype.setNumInstances=function(n){if(n=Math.max(0,n),this._numInstances!=n){this._numInstances=n;const t=new Float32Array(n);for(let e=0;e<n;e++)t[e]=e;this.setAttribute("instanceIndex",t,1,{instanced:!0})}},b.prototype._disposeAttributes=function(){if(this._attributes){for(let e=0;e<this._attributes.length;e++)this._attributes[e].buffer&&(this._cgl.gl.deleteBuffer(this._attributes[e].buffer),this._attributes[e].buffer=null);this._attributes.length=0}},b.prototype.dispose=function(){this._bufVertexAttrib&&this._bufVertexAttrib.buffer&&this._cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer),this._bufVerticesIndizes&&this._cgl.gl.deleteBuffer(this._bufVerticesIndizes),this._bufVerticesIndizes=null,this._disposeAttributes()},function(e){e.prototype.hasFeedbacks=function(){return this._feedBacks.length>0},e.prototype.removeFeedbacks=function(e){this._feedbacks&&(this._feedbacks.length=0,this._feedBacksChanged=!0)},e.prototype.setAttributeFeedback=function(){},e.prototype.setFeedback=function(e,t,n){let r={nameOut:t},i=!1;this.unBindFeedbacks();for(let e=0;e<this._feedBacks.length;e++)this._feedBacks[e].nameOut==t&&(r=this._feedBacks[e],i=!0);return i||(this._feedBacksChanged=!0),r.initialArr=n,r.attrib=e,r.outBuffer&&this._cgl.gl.deleteBuffer(r.outBuffer),r.outBuffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,r.outBuffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,r.initialArr,this._cgl.gl.STATIC_DRAW),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,r.attrib.buffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,r.initialArr,this._cgl.gl.STATIC_DRAW),i||this._feedBacks.push(r),r},e.prototype.bindFeedback=function(n){if(!this._feedBacks||0===this._feedBacks.length)return;-1==this._transformFeedBackLoc&&(this._transformFeedBackLoc=this._cgl.gl.createTransformFeedback()),this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc);let r=!1;for(let t=0;t<this._feedBacks.length;t++){const e=this._feedBacks[t];e.attrib==n&&(r=!0,this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,t,e.outBuffer))}},e.prototype.drawFeedbacks=function(e,t){let n=0;if(this._feedBacksChanged){const t=[];for(this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc),n=0;n<this._feedBacks.length;n++)t.push(this._feedBacks[n].nameOut);return e.setFeedbackNames(t),console.log("feedbacknames",t),e.compile(),this._feedBacksChanged=!1,this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null),void console.log("changed finished")}this._cgl.gl.beginTransformFeedback(this.glPrimitive),this._cgl.gl.drawArrays(t,0,this._feedBacks[0].attrib.numItems),this._cgl.gl.endTransformFeedback(),this.unBindFeedbacks(),this.feedBacksSwapBuffers()},e.prototype.unBindFeedbacks=function(){for(let e=0;e<this._feedBacks.length;e++)this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,e,null);this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null)},e.prototype.feedBacksSwapBuffers=function(){for(let t=0;t<this._feedBacks.length;t++){const e=this._feedBacks[t].attrib.buffer;this._feedBacks[t].attrib.buffer=this._feedBacks[t].outBuffer,this._feedBacks[t].outBuffer=e}}}(b);const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=new Uint8Array(256);for(let e=0;e<_.length;e++)F[_.charCodeAt(e)]=e;const C=F,A=function(e){let t,n,r,i,a,s=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);let u=new ArrayBuffer(s),c=new Uint8Array(u);for(t=0;t<o;t+=4)n=C[e.charCodeAt(t)],r=C[e.charCodeAt(t+1)],i=C[e.charCodeAt(t+2)],a=C[e.charCodeAt(t+3)],c[l++]=n<<2|r>>4,c[l++]=(15&r)<<4|i>>2,c[l++]=(3&i)<<6|63&a;return u};class E{constructor(e){this._init(),this._first=!0,this._wireMesh=null,e&&this.apply(e)}_init(){this._max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],this._min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this._center=[0,0,0],this._size=[0,0,0],this._maxAxis=0,this._first=!0}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(t,e){if(t){if(t instanceof E){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ),this.applyPos(e.minX,e.minY,e.minZ)}else for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2]);this.calcCenterSize()}}copy(){return new E(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,n){if(e!=Number.MAX_VALUE&&e!=-Number.MAX_VALUE&&t!=Number.MAX_VALUE&&t!=-Number.MAX_VALUE&&n!=Number.MAX_VALUE&&n!=-Number.MAX_VALUE&&CABLES.UTILS.isNumeric(e)&&CABLES.UTILS.isNumeric(t)&&CABLES.UTILS.isNumeric(n)){if(this._first)return this._max[0]=e,this._max[1]=t,this._max[2]=n,this._min[0]=e,this._min[1]=t,this._min[2]=n,void(this._first=!1);this._max[0]=Math.max(this._max[0],e),this._max[1]=Math.max(this._max[1],t),this._max[2]=Math.max(this._max[2],n),this._min[0]=Math.min(this._min[0],e),this._min[1]=Math.min(this._min[1],t),this._min[2]=Math.min(this._min[2],n)}}calcCenterSize(){this._first||(this._size[0]=this._max[0]-this._min[0],this._size[1]=this._max[1]-this._min[1],this._size[2]=this._max[2]-this._min[2],this._center[0]=(this._min[0]+this._max[0])/2,this._center[1]=(this._min[1]+this._max[1])/2,this._center[2]=(this._min[2]+this._max[2])/2,this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1])))}mulMat4(e){this._first&&(this._max[0]=0,this._max[1]=0,this._max[2]=0,this._min[0]=0,this._min[1]=0,this._min[2]=0,this._first=!1),vec3.transformMat4(this._max,this._max,e),vec3.transformMat4(this._min,this._min,e),this.calcCenterSize()}render(e,t){this._wireMesh||(this._wireMesh=new CGL.WireCube(e)),e.pushModelMatrix(),mat4.translate(e.mMatrix,e.mMatrix,this._center),this._wireMesh.render(e,this._size[0]/2,this._size[1]/2,this._size[2]/2),e.popModelMatrix()}}const x=function(e){this.name=e||"unknown",this._log=new c("cgl_geometry"),this.faceVertCount=3,this._vertices=[],this.verticesIndices=[],this.texCoords=new Float32Array,this.texCoordsIndices=[],this.vertexNormals=[],this.tangents=[],this.biTangents=[],this.morphTargets=[],this.vertexColors=[],this._attributes={},this.glPrimitive=null,Object.defineProperty(this,"vertices",{get(){return this._vertices},set(e){this.setVertices(e)}})};x.prototype.clear=function(){this.vertices=new Float32Array([]),this.verticesIndices.length=0,this.texCoords=new Float32Array([]),this.texCoordsIndices.length=0,this.vertexNormals=new Float32Array([])},x.prototype.getAttributes=function(){return this._attributes},x.prototype.getAttribute=function(t){for(const e in this._attributes)if(this._attributes[e].name==t)return this._attributes[e];return null},x.prototype.setAttribute=function(e,t,n){let r="";1==n?r="float":2==n?r="vec2":3==n?r="vec3":4==n&&(r="vec4");const i={name:e,data:t,itemSize:n,type:r};this._attributes[e]=i},x.prototype.setVertices=function(e){e instanceof Float32Array?this._vertices=e:this._vertices=new Float32Array(e)},x.prototype.setTexCoords=function(e){e instanceof Float32Array?this.texCoords=e:this.texCoords=new Float32Array(e)},x.prototype.calcNormals=function(e){e||this.unIndex(),this.calculateNormals({})},x.prototype.flipNormals=function(t,n,r){let i=vec3.create();null==t&&(t=1),null==n&&(n=1),null==r&&(r=1);for(let e=0;e<this.vertexNormals.length;e+=3)vec3.set(i,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]),i[0]*=-t,i[1]*=-n,i[2]*=-r,vec3.normalize(i,i),this.vertexNormals[e+0]=i[0],this.vertexNormals[e+1]=i[1],this.vertexNormals[e+2]=i[2]},x.prototype.getNumTriangles=function(){return this.verticesIndices&&this.verticesIndices.length?this.verticesIndices.length/3:this.vertices.length/3},x.prototype.flipVertDir=function(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3)t[e]=this.verticesIndices[e+2],t[e+1]=this.verticesIndices[e+1],t[e+2]=this.verticesIndices[e];this.verticesIndices=t},x.prototype.setPointVertices=function(t){if(t.length%3==0){t instanceof Float32Array?this.vertices=t:this.vertices=new Float32Array(t),this.texCoords instanceof Float32Array||(this.texCoords=new Float32Array(t.length/3*2)),this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++)this.verticesIndices[e]=e,this.texCoords[2*e]=0,this.texCoords[2*e+1]=0}else this._log.error("SetPointVertices: Array must be multiple of three.")},x.prototype.merge=function(t){if(!t)return;const n=this.verticesIndices.length,r=this.vertices.length/3;this.verticesIndices.length=this.verticesIndices.length+t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[n+e]=t.verticesIndices[e]+r;this.vertices=l.float32Concat(this.vertices,t.vertices),this.texCoords=l.float32Concat(this.texCoords,t.texCoords),this.vertexNormals=l.float32Concat(this.vertexNormals,t.vertexNormals),this.tangents=l.float32Concat(this.tangents,t.tangents),this.biTangents=l.float32Concat(this.biTangents,t.biTangents)},x.prototype.copy=function(){let e=0;const t=new x(this.name+" copy");if(t.faceVertCount=this.faceVertCount,t.glPrimitive=this.glPrimitive,t.setVertices(this._vertices.slice(0)),this.verticesIndices)for(t.verticesIndices.length=this.verticesIndices.length,e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e];if(this.texCoords)for(t.texCoords=new Float32Array(this.texCoords.length),e=0;e<this.texCoords.length;e++)t.texCoords[e]=this.texCoords[e];if(this.texCoordsIndices)for(t.texCoordsIndices.length=this.texCoordsIndices.length,e=0;e<this.texCoordsIndices.length;e++)t.texCoordsIndices[e]=this.texCoordsIndices[e];if(this.vertexNormals)for(t.vertexNormals=new Float32Array(this.vertexNormals.length),e=0;e<this.vertexNormals.length;e++)t.vertexNormals[e]=this.vertexNormals[e];if(this.tangents)for(t.tangents=[],t.tangents.length=this.tangents.length,e=0;e<this.tangents.length;e++)t.tangents[e]=this.tangents[e];if(this.biTangents)for(t.biTangents=[],t.biTangents.length=this.biTangents.length,e=0;e<this.biTangents.length;e++)t.biTangents[e]=this.biTangents[e];for(t.morphTargets.length=this.morphTargets.length,e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];for(t.vertexColors.length=this.vertexColors.length,e=0;e<this.vertexColors.length;e++)t.vertexColors[e]=this.vertexColors[e];return t},x.prototype.calculateNormals=function(t){const n=vec3.create(),r=vec3.create(),i=vec3.create();function a(e){return vec3.subtract(n,e[0],e[1]),vec3.subtract(r,e[0],e[2]),vec3.cross(i,n,r),vec3.normalize(i,i),t&&t.forceZUp&&i[2]<0&&(i[0]*=-1,i[1]*=-1,i[2]*=-1),i}this.getVertexVec=function(e){const t=[0,0,0];return t[0]=this.vertices[3*e+0],t[1]=this.vertices[3*e+1],t[2]=this.vertices[3*e+2],t},this.vertexNormals instanceof Float32Array&&this.vertexNormals.length==this.vertices.length||(this.vertexNormals=new Float32Array(this.vertices.length));for(let e=0;e<this.vertices.length;e++)this.vertexNormals[e]=0;if(this.isIndexed()){const t=[];t.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const r=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];t[e/3]=a(r),this.vertexNormals[3*this.verticesIndices[e+0]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+0]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+0]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+1]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+1]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+1]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+2]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+2]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+2]+2]+=t[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3)for(let e=0;e<3;e++){const r=[this.vertexNormals[3*this.verticesIndices[t+e]+0],this.vertexNormals[3*this.verticesIndices[t+e]+1],this.vertexNormals[3*this.verticesIndices[t+e]+2]];vec3.normalize(r,r),this.vertexNormals[3*this.verticesIndices[t+e]+0]=r[0],this.vertexNormals[3*this.verticesIndices[t+e]+1]=r[1],this.vertexNormals[3*this.verticesIndices[t+e]+2]=r[2]}}else{const t=[];for(let e=0;e<this.vertices.length;e+=9){const r=a([[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]]);t.push(r[0],r[1],r[2],r[0],r[1],r[2],r[0],r[1],r[2])}this.vertexNormals=t}},x.prototype.calcTangentsBitangents=function(){if(!this.vertices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertices.");if(!this.vertexNormals.length)return void this._log.error("Cannot calculate tangents/bitangents without normals.");if(!this.texCoords.length){const o=this.vertices.length/3*2;this.texCoords=new Float32Array(o);for(let e=0;e<o;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertex indices.");if(this.verticesIndices.length%3!=0)return void this._log.error("Vertex indices mismatch!");const o=this.verticesIndices.length/3,l=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length),this.biTangents=new Float32Array(this.vertexNormals.length);const u=[];u.length=2*l;const c=vec3.create(),h=vec3.create(),d=vec3.create(),f=vec2.create(),p=vec2.create(),m=vec2.create(),g=vec3.create(),v=vec3.create();for(let s=0;s<o;s+=1){const o=this.verticesIndices[3*s],b=this.verticesIndices[3*s+1],_=this.verticesIndices[3*s+2];vec3.set(c,this.vertices[3*o],this.vertices[3*o+1],this.vertices[3*o+2]),vec3.set(h,this.vertices[3*b],this.vertices[3*b+1],this.vertices[3*b+2]),vec3.set(d,this.vertices[3*_],this.vertices[3*_+1],this.vertices[3*_+2]),vec2.set(f,this.texCoords[2*o],this.texCoords[2*o+1]),vec2.set(p,this.texCoords[2*b],this.texCoords[2*b+1]),vec2.set(m,this.texCoords[2*_],this.texCoords[2*_+1]);const F=h[0]-c[0],C=d[0]-c[0],A=h[1]-c[1],E=d[1]-c[1],x=h[2]-c[2],e=d[2]-c[2],t=p[0]-f[0],n=m[0]-f[0],r=p[1]-f[1],i=m[1]-f[1],a=1/(t*i-n*r);vec3.set(g,(i*F-r*C)*a,(i*A-r*E)*a,(i*x-r*e)*a),vec3.set(v,(t*C-n*F)*a,(t*E-n*A)*a,(t*e-n*x)*a),u[o]=g,u[b]=g,u[_]=g,u[o+l]=v,u[b+l]=v,u[_+l]=v}const t=vec3.create(),b=vec3.create(),_=vec3.create(),F=vec3.create(),C=vec3.create(),A=vec3.create(),E=vec3.create(),x=vec3.create();for(let e=0;e<l;e+=1){if(!u[e])continue;vec3.set(t,this.vertexNormals[3*e],this.vertexNormals[3*e+1],this.vertexNormals[3*e+2]),vec3.set(b,u[e][0],u[e][1],u[e][2]);const c=vec3.dot(t,b);vec3.scale(C,t,c),vec3.subtract(A,b,C),vec3.normalize(x,A),vec3.cross(E,t,b);vec3.dot(E,u[e+l]);const h=1;vec3.scale(_,x,1/h),vec3.cross(F,t,_),this.tangents[3*e+0]=_[0],this.tangents[3*e+1]=_[1],this.tangents[3*e+2]=_[2],this.biTangents[3*e+0]=F[0],this.biTangents[3*e+1]=F[1],this.biTangents[3*e+2]=F[2]}},x.prototype.isIndexed=function(){return 0!=this.verticesIndices.length},x.prototype.unIndex=function(e,t){const n=[],r=[],i=[],a=[],s=[],o=[];let l=0,u=0;for(u=0;u<this.verticesIndices.length;u+=3)n.push(this.vertices[3*this.verticesIndices[u+0]+0],this.vertices[3*this.verticesIndices[u+0]+1],this.vertices[3*this.verticesIndices[u+0]+2]),a.push(this.vertexNormals[3*this.verticesIndices[u+0]+0],this.vertexNormals[3*this.verticesIndices[u+0]+1],this.vertexNormals[3*this.verticesIndices[u+0]+2]),this.tangents.length>0&&s.push(this.tangents[3*this.verticesIndices[u+0]+0],this.tangents[3*this.verticesIndices[u+0]+1],this.tangents[3*this.verticesIndices[u+0]+2]),this.biTangents.length>0&&o.push(this.biTangents[3*this.verticesIndices[u+0]+0],this.biTangents[3*this.verticesIndices[u+0]+1],this.biTangents[3*this.verticesIndices[u+0]+2]),this.texCoords?i.push(this.texCoords[2*this.verticesIndices[u+0]+0],this.texCoords[2*this.verticesIndices[u+0]+1]):i.push(0,0),r.push(l),l++,n.push(this.vertices[3*this.verticesIndices[u+1]+0],this.vertices[3*this.verticesIndices[u+1]+1],this.vertices[3*this.verticesIndices[u+1]+2]),a.push(this.vertexNormals[3*this.verticesIndices[u+1]+0],this.vertexNormals[3*this.verticesIndices[u+1]+1],this.vertexNormals[3*this.verticesIndices[u+1]+2]),this.tangents.length>0&&s.push(this.tangents[3*this.verticesIndices[u+1]+0],this.tangents[3*this.verticesIndices[u+1]+1],this.tangents[3*this.verticesIndices[u+1]+2]),this.biTangents.length>0&&o.push(this.biTangents[3*this.verticesIndices[u+1]+0],this.biTangents[3*this.verticesIndices[u+1]+1],this.biTangents[3*this.verticesIndices[u+1]+2]),this.texCoords?i.push(this.texCoords[2*this.verticesIndices[u+1]+0],this.texCoords[2*this.verticesIndices[u+1]+1]):i.push(0,0),r.push(l),l++,n.push(this.vertices[3*this.verticesIndices[u+2]+0],this.vertices[3*this.verticesIndices[u+2]+1],this.vertices[3*this.verticesIndices[u+2]+2]),a.push(this.vertexNormals[3*this.verticesIndices[u+2]+0],this.vertexNormals[3*this.verticesIndices[u+2]+1],this.vertexNormals[3*this.verticesIndices[u+2]+2]),this.tangents.length>0&&s.push(this.tangents[3*this.verticesIndices[u+2]+0],this.tangents[3*this.verticesIndices[u+2]+1],this.tangents[3*this.verticesIndices[u+2]+2]),this.biTangents.length>0&&o.push(this.biTangents[3*this.verticesIndices[u+2]+0],this.biTangents[3*this.verticesIndices[u+2]+1],this.biTangents[3*this.verticesIndices[u+2]+2]),this.texCoords?i.push(this.texCoords[2*this.verticesIndices[u+2]+0],this.texCoords[2*this.verticesIndices[u+2]+1]):i.push(0,0),r.push(l),l++;this.vertices=n,this.texCoords=i,this.vertexNormals=a,s.length>0&&(this.tangents=s),o.length>0&&(this.biTangents=o),this.verticesIndices.length=0,e&&(this.verticesIndices=r),t||this.calculateNormals()},x.prototype.calcBarycentric=function(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let n=0;for(let e=0;e<this.vertices.length;e+=3)t[e+n]=1,n++,3==n&&(n=0);this.setAttribute("attrBarycentric",t,3)},x.prototype.getBounds=function(){return new E(this)},x.prototype.center=function(e,t,n){void 0===e&&(e=!0,t=!0,n=!0);let r=0;const i=this.getBounds(),a=[i.minX+(i.maxX-i.minX)/2,i.minY+(i.maxY-i.minY)/2,i.minZ+(i.maxZ-i.minZ)/2];for(r=0;r<this.vertices.length;r+=3)this.vertices[r+0]==this.vertices[r+0]&&(e&&(this.vertices[r+0]-=a[0]),t&&(this.vertices[r+1]-=a[1]),n&&(this.vertices[r+2]-=a[2]));return a},x.prototype.mapTexCoords2d=function(){const n=this.getBounds(),r=this.vertices.length/3;this.texCoords=new Float32Array(2*r);for(let t=0;t<r;t++){const r=this.vertices[3*t+0],e=this.vertices[3*t+1];this.texCoords[2*t+0]=r/(n.maxX-n.minX)+.5,this.texCoords[2*t+1]=1-e/(n.maxY-n.minY)+.5}},x.prototype.getInfo=function(){const e={};return this.verticesIndices?e.numFaces=this.verticesIndices.length/3:e.numFaces=0,this.vertices?e.numVerts=this.vertices.length/3:e.numVerts=0,this.vertexNormals?e.numNormals=this.vertexNormals.length/3:e.numNormals=0,this.texCoords?e.numTexCoords=this.texCoords.length/2:e.numTexCoords=0,this.tangents?e.numTangents=this.tangents.length/3:e.numTangents=0,this.biTangents?e.numBiTangents=this.biTangents.length/3:e.numBiTangents=0,this.biTangents?e.numBiTangents=this.biTangents.length/3:e.numBiTangents=0,this.vertexColors?e.numVertexColors=this.vertexColors.length/4:e.numVertexColors=0,this.getAttributes()?e.numAttribs=Object.keys(this.getAttributes()).length:e.numAttribs=0,e.isIndexed=this.isIndexed(),e},x.buildFromFaces=function(i,e,a){const s=[],o=[];for(let e=0;e<i.length;e+=3){const l=i[e+0],t=i[e+1],n=i[e+2],r=[-1,-1,-1];if(a)for(let e=0;e<s.length;e+=3)s[e+0]==l[0]&&s[e+1]==l[1]&&s[e+2]==l[2]&&(r[0]=e/3),s[e+0]==t[0]&&s[e+1]==t[1]&&s[e+2]==t[2]&&(r[1]=e/3),s[e+0]==n[0]&&s[e+1]==n[1]&&s[e+2]==n[2]&&(r[2]=e/3);-1==r[0]&&(s.push(l[0],l[1],l[2]),r[0]=(s.length-1)/3),-1==r[1]&&(s.push(t[0],t[1],t[2]),r[1]=(s.length-1)/3),-1==r[2]&&(s.push(n[0],n[1],n[2]),r[2]=(s.length-1)/3),o.push(parseInt(r[0],10)),o.push(parseInt(r[1],10)),o.push(parseInt(r[2],10))}const l=new x(e);return l.name=e,l.vertices=s,l.verticesIndices=o,l},x.json2geom=function(t){const n=new x("jsonMeshGeom");if(n.verticesIndices=[],n.vertices=t.vertices||[],n.vertexNormals=t.normals||[],n.vertexColors=t.colors||[],n.tangents=t.tangents||[],n.biTangents=t.bitangents||[],t.texturecoords&&n.setTexCoords(t.texturecoords[0]),t.vertices_b64&&(n.vertices=new Float32Array(A(t.vertices_b64))),t.normals_b64&&(n.vertexNormals=new Float32Array(A(t.normals_b64))),t.tangents_b64&&(n.tangents=new Float32Array(A(t.tangents_b64))),t.bitangents_b64&&(n.biTangents=new Float32Array(A(t.bitangents_b64))),t.texturecoords_b64&&n.setTexCoords(new Float32Array(A(t.texturecoords_b64[0]))),t.faces_b64)n.verticesIndices=new Uint32Array(A(t.faces_b64));else{n.verticesIndices.length=3*t.faces.length;for(let e=0;e<t.faces.length;e++)n.verticesIndices[3*e]=t.faces[e][0],n.verticesIndices[3*e+1]=t.faces[e][1],n.verticesIndices[3*e+2]=t.faces[e][2]}return n};const B={getSimpleRect:function(e,t){const n=new x(t);return n.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],n.texCoords=[1,1,0,1,1,0,0,0],n.verticesIndices=[0,1,2,2,1,3],n.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0],new b(e,n)}};CGL.CopyTexture=class{constructor(e,t,n){this.cgl=e,this._options=n,this.fb=null;const r=n.shader||"".endl()+"UNI sampler2D tex;".endl()+"IN vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"    vec4 col=texture(tex,texCoord);".endl()+"    outColor= col;".endl()+"}",i="".endl()+"IN vec3 vPosition;".endl()+"IN vec2 attrTexCoord;".endl()+"OUT vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   gl_Position = vec4(vPosition,  1.0);".endl()+"}";this.bgShader=new CGL.Shader(e,"corelib copytexture "+t),this.bgShader.setSource(i,r);new CGL.Uniform(this.bgShader,"t","tex",0);this.mesh=B.getSimpleRect(this.cgl,"texEffectRect")}copy(e){if(!e)return CGL.Texture.getEmptyTexture(this.cgl);const r=this._options.width||e.width,i=this._options.height||e.height,a=this.cgl;if(this.fb)this.fb.getWidth()==r&&this.fb.getHeight()==i||this.fb.setSize(r,i);else{let e=CGL.Texture.FILTER_LINEAR,t=CGL.Texture.WRAP_CLAMP_TO_EDGE;this._options.hasOwnProperty("filter")&&(e=this._options.filter),this._options.hasOwnProperty("wrap")&&(t=this._options.wrap);const n={isFloatingPointTexture:this._options.isFloatingPointTexture,numRenderBuffers:this._options.numRenderBuffers||1,filter:e,wrap:t};1==a.glVersion?this.fb=new CGL.Framebuffer(a,r,i,n):this.fb=new CGL.Framebuffer2(a,r,i,n)}return a.frameStore.renderOffscreen=!0,this.fb.renderStart(a),a.setTexture(0,e.tex),a.pushShader(this.bgShader),this.mesh.render(this.bgShader),a.popShader(),this.fb.renderEnd(),a.frameStore.renderOffscreen=!1,this.fb.getTextureColor()}dispose(){this.fb&&this.fb.dispose(),this.bgShader&&this.bgShader.dispose(),this.mesh&&this.mesh.dispose()}}}]).Copytexture;this.CABLES=this.CABLES||{},this.CABLES.COREMODULES=this.CABLES.COREMODULES||{},this.CABLES.COREMODULES.Vargetset=function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t){CABLES.VarSetOpWrapper=class{constructor(t,e,n,r,i,a){this._valuePort=n,this._varNamePort=r,this._op=t,this._type=e,this._triggerPort=i,this._nextPort=a,this._btnCreate=t.inTriggerButton("Create new variable"),this._btnCreate.setUiAttribs({hidePort:!0}),this._btnCreate.onTriggered=this._createVar.bind(this),this._helper=t.inUiTriggerButtons("",["Rename"]),this._helper.setUiAttribs({hidePort:!0}),this._helper.onTriggered=e=>{"Rename"==e&&CABLES.CMD.PATCH.renameVariable(t.varName.get())},this._op.setPortGroup("Variable",[this._helper,this._varNamePort,this._btnCreate]),this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this)),this._op.patch.addEventListener("variablesChanged",this._updateName.bind(this)),this._op.patch.addEventListener("variableRename",this._renameVar.bind(this)),this._varNamePort.onChange=this._updateName.bind(this),this._isTexture="texture"===this._valuePort.uiAttribs.objType,this._valuePort.changeAlways=!0,this._triggerPort?this._triggerPort.onTriggered=()=>{this._setVarValue(!0)}:this._valuePort.onChange=this._setVarValue.bind(this),this._op.init=()=>{this._updateName(),this._triggerPort||this._setVarValue(),this._updateErrorUi()}}_updateErrorUi(){CABLES.UI&&(this._varNamePort.get()?this._op.setUiError("novarname",null):this._op.setUiError("novarname","no variable selected"))}_updateName(){const e=this._varNamePort.get();this._op.setTitle("var set "),this._op.setUiAttrib({extendTitle:"#"+e}),this._updateErrorUi();const t=this._op.patch.getVar(e);t&&!t.type&&(t.type=this._type),this._op.patch.hasVar(e)||0==e||this._triggerPort||this._setVarValue(),!this._op.patch.hasVar(e)&&0!=e&&this._triggerPort&&("string"==this._type||"number"==this._type?this._op.patch.setVarValue(e,""):this._op.patch.setVarValue(e,null)),this._op.isCurrentUiOp()&&(this._updateVarNamesDropdown(),this._op.refreshParams()),this._updateDisplay(),this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varNamePort.get())}_createVar(){CABLES.CMD.PATCH.createVariable(this._op,this._type,()=>{this._updateName()})}_updateDisplay(){this._valuePort.setUiAttribs({greyout:!this._varNamePort.get()})}_updateVarNamesDropdown(){if(CABLES.UI){const e=[],t=this._op.patch.getVars();for(const n in t)t[n].type==this._type&&"0"!=n&&e.push(n);this._varNamePort.uiAttribs.values=e}}_renameVar(e,t){e==this._varNamePort.get()&&(this._varNamePort.set(t),this._updateName())}_setVarValue(e){const t=this._varNamePort.get();if(!t)return;const n=this._valuePort.get();"array"==this._type?(this._arr=[],CABLES.copyArray(n,this._arr),this._op.patch.setVarValue(t,null),this._op.patch.setVarValue(t,this._arr)):("object"==this._type&&(this._isTexture?this._op.patch.setVarValue(t,CGL.Texture.getEmptyTexture(this._op.patch.cgl)):this._op.patch.setVarValue(t,null),n&&n.tex&&n._cgl&&!this._isTexture?this._op.setUiError("texobj","Dont use object variables for textures, use varSetTexture"):this._op.setUiError("texobj",null)),this._op.patch.setVarValue(t,n)),e&&this._nextPort&&this._nextPort.trigger()}},CABLES.VarGetOpWrapper=class{constructor(e,t,n,r){this._op=e,this._type=t,this._varnamePort=n,this._variable=null,this._valueOutPort=r,this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this)),this._op.patch.on("variableRename",this._renameVar.bind(this)),this._op.patch.on("variableDeleted",e=>{this._op.isCurrentUiOp()&&this._op.refreshParams()}),this._varnamePort.onChange=this._init.bind(this),this._op.patch.addEventListener("variablesChanged",this._init.bind(this)),this._op.onDelete=function(){this._variable&&this._variable.removeListener(this._setValueOut.bind(this))},this._op.init=()=>{this._init()}}_renameVar(e,t){e==this._varnamePort.get()&&(this._varnamePort.set(t),this._updateVarNamesDropdown())}_updateVarNamesDropdown(){if(CABLES.UI){const e=[],t=this._op.patch.getVars();for(const n in t)t[n].type==this._type&&"0"!=n&&e.push(n);this._op.varName.uiAttribs.values=e}}_setValueOut(e){this._updateVarNamesDropdown(),this._valueOutPort.set(e)}_init(){this._updateVarNamesDropdown(),this._variable&&this._variable.removeListener(this._setValueOut.bind(this)),this._variable=this._op.patch.getVar(this._op.varName.get()),this._variable?(this._variable.addListener(this._setValueOut.bind(this)),this._op.setUiError("unknownvar",null),this._op.setTitle("var get "),this._op.setUiAttrib({extendTitle:"#"+this._varnamePort.get()}),this._valueOutPort.set(this._variable.getValue())):(this._op.setUiError("unknownvar","unknown variable! - there is no setVariable with this name ("+this._varnamePort.get()+")"),this._op.setUiAttrib({extendTitle:"#invalid"}),this._valueOutPort.set(0)),this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varnamePort.get())}}}]).Cables;this.CGL=this.CGL||{},this.CGL.COREMODULES=this.CGL.COREMODULES||{},this.CGL.COREMODULES.Shadermodifier=function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,n){"use strict";n.r(t);CGL.ShaderModifier=class{constructor(e,t,n){this._cgl=e,this._name=t,this._origShaders={},this._uniforms=[],this._structUniforms=[],this._definesToggled={},this._defines={},this._mods=[],this._textures=[],this._boundShader=null,this._changedDefines=!0,this._changedUniforms=!0,this._modulesChanged=!1,this.needsTexturePush=!1,this._lastShader=null,1==this._cgl.glVersion&&(this._cgl.gl.getExtension("OES_texture_float"),this._cgl.gl.getExtension("OES_texture_float_linear"),this._cgl.gl.getExtension("OES_texture_half_float"),this._cgl.gl.getExtension("OES_texture_half_float_linear"))}bind(){const n=this._cgl.getShader();if(!n)return;this._boundShader=this._origShaders[n.id];let r=!1;if(this._boundShader&&this._lastShader!=this._boundShader.shader&&(this._boundShader.shader.hasModule(this._mods[0].id)||(r=!0)),(r||!this._boundShader||n.lastCompile!=this._boundShader.lastCompile||this._modulesChanged||n._needsRecompile)&&(this._boundShader&&this._boundShader.shader.dispose(),n._needsRecompile&&n.compile(),this._boundShader=this._origShaders[n.id]={lastCompile:n.lastCompile,orig:n,shader:n.copy()},1==this._cgl.glVersion&&(this._boundShader.shader.enableExtension("GL_OES_standard_derivatives"),this._boundShader.shader.enableExtension("GL_OES_texture_float"),this._boundShader.shader.enableExtension("GL_OES_texture_float_linear"),this._boundShader.shader.enableExtension("GL_OES_texture_half_float"),this._boundShader.shader.enableExtension("GL_OES_texture_half_float_linear")),this._addModulesToShader(this._boundShader.shader),this._updateDefinesShader(this._boundShader.shader),this._updateUniformsShader(this._boundShader.shader)),this._boundShader.wireframe=n.wireframe,this._changedDefines&&this._updateDefines(),this._changedUniforms&&this._updateUniforms(),this._cgl.pushShader(this._boundShader.shader),this._boundShader.shader.copyUniformValues(this._boundShader.orig),this.needsTexturePush){for(let t=0;t<this._textures.length;t+=1){const r=this._textures[t][0],e=this._textures[t][1],i=this._textures[t][2];if(this._getUniform(r)){const n=this.getPrefixedName(r),a=this._boundShader.shader.getUniform(n);a&&this._boundShader.shader.pushTexture(a,e,i)}}this.needsTexturePush=!1,this._textures.length=0}this._modulesChanged=!1}unbind(){this._boundShader&&this._cgl.popShader(),this._boundShader=null}_addModulesToShader(t){let n;this._mods.length>1&&(n=this._mods[0]);for(let e=0;e<this._mods.length;e++)t.addModule(this._mods[e],n)}_removeModulesFromShader(t){for(const e in this._origShaders)this._origShaders[e].shader.removeModule(t)}addModule(e){this._mods.push(e),this._modulesChanged=!0}removeModule(t){const n=[];for(let e=0;e<this._mods.length;e++)this._mods[e].title==t&&(this._removeModulesFromShader(this._mods[e]),n.push(e));for(let e=n.length-1;e>=0;e-=1)this._mods.splice(n[e],1);this._modulesChanged=!0}_updateUniformsShader(i){for(let e=0;e<this._uniforms.length;e++){const t=this._uniforms[e],n=this.getPrefixedName(t.name);if(!i.hasUniform(n)&&!t.structName){let e=null;"both"===t.shaderType?(e=i.addUniformBoth(t.type,n,t.v1,t.v2,t.v3,t.v4),e.comment="mod: "+this._name):"frag"===t.shaderType?(e=i.addUniformFrag(t.type,n,t.v1,t.v2,t.v3,t.v4),e.comment="mod: "+this._name):"vert"===t.shaderType&&(e=i.addUniformVert(t.type,n,t.v1,t.v2,t.v3,t.v4),e.comment="mod: "+this._name)}}for(let r=0;r<this._structUniforms.length;r+=1){const e=this._structUniforms[r];let t=e.uniformName,n=e.structName;const a=e.members;t=this.getPrefixedName(e.uniformName),n=this.getPrefixedName(e.structName),"frag"===e.shaderType&&i.addUniformStructFrag(n,t,a),"vert"===e.shaderType&&i.addUniformStructVert(n,t,a),"both"===e.shaderType&&i.addUniformStructBoth(n,t,a)}}_updateUniforms(){for(const e in this._origShaders)this._updateUniformsShader(this._origShaders[e].shader);this._changedUniforms=!1}_setUniformValue(e,t,n){const r=e.getUniform(t);r&&r.setValue(n)}setUniformValue(e,t){if(!this._getUniform(e))return;const n=this.getPrefixedName(e);for(const e in this._origShaders)this._setUniformValue(this._origShaders[e].shader,n,t)}hasUniform(e){return this._getUniform(e)}_getUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return this._uniforms[e];if(this._uniforms[e].structName&&this._uniforms[e].propertyName==t)return this._uniforms[e]}return!1}_getStructUniform(t){for(let e=0;e<this._structUniforms.length;e+=1)if(this._structUniforms[e].uniformName===t)return this._structUniforms[e];return null}_isStructUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return!1;if(this._uniforms[e].structName&&this._uniforms[e].propertyName==t)return!0}return!1}addUniform(t,n,r,i,a,s,o,l,u,c){if(!this._getUniform(n)){let e="both";c&&(e=c),this._uniforms.push({type:t,name:n,v1:r,v2:i,v3:a,v4:s,structUniformName:o,structName:l,propertyName:u,shaderType:e}),this._changedUniforms=!0}}addUniformFrag(e,t,n,r,i,a){this.addUniform(e,t,n,r,i,a,null,null,null,"frag"),this._changedUniforms=!0}addUniformVert(e,t,n,r,i,a){this.addUniform(e,t,n,r,i,a,null,null,null,"vert"),this._changedUniforms=!0}addUniformBoth(e,t,n,r,i,a){this.addUniform(e,t,n,r,i,a,null,null,null,"both"),this._changedUniforms=!0}addUniformStruct(t,n,r,i){for(let e=0;e<r.length;e+=1){const a=r[e];"2i"!==a.type&&"i"!==a.type&&"3i"!==a.type||"both"!==i||console.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",a.name," of type:",a.type,"."),this._getUniform(n+"."+a.name)||this.addUniform(a.type,n+"."+a.name,a.v1,a.v2,a.v3,a.v4,n,t,a.name,i)}this._getStructUniform(n)||this._structUniforms.push({structName:t,uniformName:n,members:r,shaderType:i})}addUniformStructVert(e,t,n){this.addUniformStruct(e,t,n,"vert")}addUniformStructFrag(e,t,n){this.addUniformStruct(e,t,n,"frag")}addUniformStructBoth(e,t,n){this.addUniformStruct(e,t,n,"both")}pushTexture(e,t,n){if(!t)throw new Error("no texture given to texturestack");this._textures.push([e,t,n]),this.needsTexturePush=!0}_removeUniformFromShader(e,t){t.hasUniform(e)&&t.removeUniform(e)}removeUniform(n){if(this._getUniform(n)){for(let t=this._uniforms.length-1;t>=0;t-=1){const e=n;if(this._uniforms[t].name==n&&!this._uniforms[t].structName){for(const n in this._origShaders)this._removeUniformFromShader(this.getPrefixedName(e),this._origShaders[n].shader);this._uniforms.splice(t,1)}}this._changedUniforms=!0}}removeUniformStruct(n){if(this._getStructUniform(n)){for(let e=this._structUniforms.length-1;e>=0;e-=1){const t=this._structUniforms[e];if(t.uniformName===n){for(const n in this._origShaders)for(let e=0;e<t.members.length;e+=1){const r=t.members[e];this._removeUniformFromShader(this.getPrefixedName(r.name),this._origShaders[n].shader)}this._structUniforms.splice(e,1)}}this._changedUniforms=!0}}getPrefixedName(e){const t=this._mods[0].group;if(void 0!==t)return 0==e.indexOf("MOD_")&&(e="mod"+t+"_"+(e=e.substr("MOD_".length))),e}_updateDefinesShader(n){for(const t in this._defines){const e=this.getPrefixedName(t);null!==this._defines[t]&&void 0!==this._defines[t]?n.define(e,this._defines[t]):n.removeDefine(e)}for(const t in this._definesToggled){const e=this.getPrefixedName(t);n.toggleDefine(e,this._definesToggled[t])}}_updateDefines(){for(const e in this._origShaders)this._updateDefinesShader(this._origShaders[e].shader);this._changedDefines=!1}define(e,t){this._defines[e]=t,this._changedDefines=!0}removeDefine(e){this._defines[e]=null,this._changedDefines=!0}hasDefine(e){return null!==this._defines[e]&&void 0!==this._defines[e]}toggleDefine(e,t){this._changedDefines=!0,this._definesToggled[e]=t}currentShader(){return this._boundShader.shader}dispose(){}}}]).Shadermodifier;